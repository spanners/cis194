<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <META http-equiv="Content-Type" content="text/html; charset='UTF-8'">
  <title>CIS 194</title>

  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <link href="./css/style.css" rel="stylesheet" type="text/css"></link>
</head>
<body>

  <div id="canvas">
    <div id="nav"><p><strong>CIS 194</strong>: <a href="./">Home</a> | <a href="./lectures.html">Lectures &amp; Assignments</a> | <a href="./policies.html">Policies</a> | <a href="./resources.html">Resources</a> | <a href="./final.html">Final Project</a></p></div>

    <div id="content">
      
      <h1 id="cis-194-introduction-to-haskell-spring-2013">CIS 194: Introduction to Haskell (Spring 2013)</h1>
<img src="./images/haskell-logo-small.png" style="float:right;" />
<p>Mondays 1:30-3<br />Towne 309</p>
<p><a href="http://piazza.com/upenn/spring2013/cis194">Class Piazza site</a></p>
<p>Instructor: <a href="http://www.cis.upenn.edu/~byorgey/">Brent Yorgey</a></p>
<ul>
<li>Email: byorgey at cis</li>
<li>Office: Levine 513</li>
<li>Office hours: Friday 2-4pm</li>
</ul>
<p>TAs:</p>
<ul>
<li><a href="http://www.adidahiya.com/">Adi Dahiya</a> (office hours: Thursdays 1-3pm, Moore 100)</li>
<li><a href="http://zwass.com/">Zach Wasserman</a> (office hours: Thursdays 12-1pm, Moore 100)</li>
</ul>
<h2 id="course-description">Course Description</h2>
<p>Haskell is a high-level, pure functional programming language with a strong static type system and elegant mathematical underpinnings, and is being increasingly used in industry by organizations such as Facebook, AT&amp;T, and NASA. In the first 3/4 of the course, we will explore the joys of pure, lazy, typed functional programming in Haskell (warning: euphoric, mind-bending epiphanies may result!). The last 1/4 of the course will consist of case studies in fun and interesting applications of Haskell. Potential case study topics include automated randomized testing, software transactional memory, graphics generation, parser combinators, or others as time and interest allow. Evaluation will be based on class participation, weekly programming assignments, and an open-ended final project.</p>

    </div>

    <div id="footer"><center>
      <font size="-2">Powered
      by <a href="http://community.haskell.org/~ndm/shake/">shake</a>,
      <a href="http://jaspervdj.be/hakyll/index.html">hakyll</a>,
      and <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>.
      </center>
    </div>
  </div>
</body>

</html>
r/>Enter your own search at the top of the page.
</p>
<p>
    The <a href="http://www.haskell.org/haskellwiki/Hoogle">Hoogle manual</a> contains more details,
    including further details on search queries, how to install Hoogle as a command line application
    and how to integrate Hoogle with Firefox/Emacs/Vim etc.
</p>
<p>
    I am very interested in any feedback you may have. Please
    <a href="http://community.haskell.org/~ndm/contact/">email me</a>, or add an entry to my
    <a href="http://code.google.com/p/ndmitchell/issues/list">bug tracker</a>.
</p>
            <div class="push"></div>
        </div>
        <div id="footer">&copy; <a href="http://community.haskell.org/~ndm/">Neil Mitchell</a> 2004-2013, version 4.2.26</div>
    </body>
</html>

is of a <a
    href="http://en.wikipedia.org/wiki/Hercules_beetle">Hercules
    beetle</a>.  These beetles are among the largest in the world.
    They are also, in proportion to their size, the strongest
    animals on Earth, able to lift up to 850 times their own weight.
    Needless to say, we like the association with a creature that has
    such a high power-to-weight ratio.</p>
      
  <h2>What is Haskell?</h2>

  <p>Here is a description of the Haskell language from the <a
  href="http://www.haskell.org/">Haskell web site</a>, with links
  to chapters from our book and to other sites.</p>

  <p>Haskell is an advanced purely functional programming
  language. The product of more than twenty years of cutting edge
  research, it allows rapid development of robust, concise, <a href="/read/testing-and-quality-assurance.html">correct</a>
  software. With strong support for <a
  href="/read/interfacing-with-c-the-ffi.html">integration with other
  languages</a>, built-in <a
  href="/read/concurrent-and-multicore-programming.html">concurrency
  and parallelism</a>, debuggers, <a
  href="/read/profiling-and-optimization.html">profilers</a>, <a href="http://hackage.haskell.org/packages/hackage.html">rich libraries</a> and an active community, Haskell makes it easier to produce flexible, maintainable high-quality software.</p>
</div>


    <div class="rwhfooter"> <p><img src="/support/figs/rss.png"> Want to stay
	up to date? Subscribe to comment feeds for any chapter, or
	the <a class="feed"
	  href="/feeds/comments/">entire book</a>.</p> <p>Copyright
	2007, 2008 Bryan O'Sullivan, Don Stewart, and John Goerzen. This
	work is licensed under a <a rel="license" href=
	  "http://creativecommons.org/licenses/by-nc/3.0/">Creative
	  Commons Attribution-Noncommercial 3.0 License</a>. Icons by
	  <a href="mailto:mattahan@gmail.com">Paul Davey</a> aka <a
	  href="http://mattahan.deviantart.com/">Mattahan</a>.</p>
    </div>

    <script src="http://www.google-analytics.com/urchin.js"
      type="text/javascript"></script>
    <script type="text/javascript">_uacct = "UA-1805907-3";
      urchinTracker();</script>
  </body>
</html>
 the sources or need to install in other than the default
  location, please check the <a
  href="http://vimdoc.sourceforge.net/htmldoc/pi_vimball.html#vimball">vimball
  documentation</a>). After installation, try <code>:help haskellmode</code> to
  find out more details about the features provided by these haskell mode
  plugins (or peek at the <a
  href="http://code.haskell.org/haskellmode-vim/doc/haskellmode.txt">help file
  source</a> here).
  </p>
  
  <p>
  There is a <a
  href="http://code.haskell.org/haskellmode-vim/haskellmode-files.txt">log of open issues and recent
  changes</a> and an <a
  href="http://trac.haskell.org/haskellmode-vim/">issue tracker for your bug
  reports</a>. You can also try to follow the <a
  href="http://libraryinstitute.wordpress.com/tag/haskellmode/">haskellmode tag
  on my blog</a> to keep up to date with plugin development and occasional
  update releases.
  </p>
  </dd>
  
</dd>

<dt>Source repo:</dt>
<dd>
  <dl>

  <dt>There is a darcs repo: <a
  href="http://code.haskell.org/haskellmode-vim/">http://code.haskell.org/haskellmode-vim/</a>
  with an
  <a href="http://code.haskell.org/haskellmode-vim/_darcs/changes.xml">rss feed</a>
  for commit messages.
  </dt>
  <dd>
  <p>
  Not needed for general use (you can unpack the sources from the vimballs),
  but useful if you want to prepare patches, or if you want to keep local
  modifications, or if you just generally prefer source control repos over
  vimballs (see <a href="http://darcs.net/">darcs home page</a>).
  <pre>
  darcs get http://code.haskell.org/haskellmode-vim/
  darcs pull -a http://code.haskell.org/haskellmode-vim/
  </pre>
  </p>
  </dd>

  <dd>

  <!--
  <dl>

  <dt>The vimball archive contains the following files (which you should not
    need to download seperately - they're just here if you want to look before
    downloading the vimball):
  </dt>

  <dt><a href="vimfiles/doc/haskellmode.txt">vimfiles/doc/haskellmode.txt</a>
  </dt>
  <dd>
  helpfile for the haskell mode plugins (initial version contributed
  by Alex Tarkovsky). after installation, just try :help haskellmode
  to find out more details about the features provided by these
  haskell mode plugins (or have a peek at the helpfile provided
  here, it is lightly annotated text). if you do not use the vimball
  above, you will need to run :helptags (see :help :helptags) by hand.
  </dd>

  <dt><a href="vimfiles/compiler/ghc.vim">vimfiles/compiler/ghc.vim</a></dt>
  <dd>set basic error format and makeprg, to enable use of quickfix
  mode with ghci. also provide 'show type', 'add type declaration', 'show
  info', 'create tags file', insert-mode completion based on ghci
  browsing current and imported modules.
  </dd>

  <dt><a href="vimfiles/ftplugin/haskell.vim">vimfiles/ftplugin/haskell.vim</a></dt>
  <dd>generic haskell filetype plugin. defines module import
  format, to enable vim's functionality for searching in and
  completing wrt imported files. 
  </dd>

  <dt><a href="vimfiles/autoload/haskellmode.vim">vimfiles/autoload/haskellmode.vim</a></dt>
  <dd>auxiliary functions used by the other scripts to identify Haskell 
      identifiers, gather imports as well as some list ops.
  </dd>

  <dt><a href="vimfiles/ftplugin/haskell_doc.vim">vimfiles/ftplugin/haskell_doc.vim</a></dt>
  <dd>lots of functionality based on haddock's indices (you'll need a
  local installation of the haddock-generated html for the libraries,
  and might need to adjust some paths, eg to your HTML browser),
  including opening docs for id under cursor, completion of id under
  cursor wrt haddock indices, adding import for id under cursor. see
  comments at top of file for more info. </dd>

  <dt><a href="vimfiles/ftplugin/haskell_hpaste.vim">vimfiles/ftplugin/haskell_hpaste.vim</a>
  <dd>([alpha] experimental support for editing haskell paste buffer
  entries at <a href="http://hpaste.org">hpaste.org</a>)
  </dd>

  </dl>
  -->

  </dd>

  </dl>
</dd>
<dt>Setup:</dt>
<dd>
  <p>
  use the vimball archive (vimball is a standard plugin, and straightforward to
  use; mostly open the archive in Vim and source it, <code>:so %</code>; for
  details and alternatives, see <a
  href="http://vimdoc.sourceforge.net/htmldoc/pi_vimball.html#vimball">:help
  vimball</a>) - it will copy the individual scripts to your .vim/ or vimfiles/
  directory and install the helpfile. 
  <!-- can't see them anymore?
  the scripts can also be found in the <a
  href="http://haskell.org/haskellwiki/Gentoo">official
  Gentoo Haskell overlay</a> (thanks to Alex Tarkovsky).
  -->
  </p>
  <p>
  the haskell_*.vim files from the filetype-plugin directory will be
  loaded automatically when editing haskell files (<em>NB: this assumes that
  you have set</em> <tt>:filetype plugin on</tt> -- see <tt>:help
  filetype-plugin-on</tt>). to configure the web browser and to load the ghc
  compiler plugin for .hs file, add the following in your .vimrc:
  <pre>
  " use ghc functionality for haskell files
  au Bufenter *.hs compiler ghc

  " switch on syntax highlighting
  syntax on

  " enable filetype detection, plus loading of filetype plugins
  filetype plugin on

  " configure browser for haskell_doc.vim
  let g:haddock_browser = "insert path to your web browser"
    "let g:haddock_browser = "C:/Program Files/Opera/Opera.exe"
    "let g:haddock_browser = "C:/Program Files/Mozilla Firefox/firefox.exe"
    "let g:haddock_browser = "C:/Program Files/Internet Explorer/IEXPLORE.exe"
  </pre>
  For Macs, Sean Leather <a href="http://splonderzoek.blogspot.com/2009/04/haskell-mode-for-vim-on-mac.html">recommends</a> (would all other Mac users be happy with <a href="http://trac.haskell.org/haskellmode-vim/ticket/4">this as default</a>?)
  <pre>
  " Configure browser for haskell_doc.vim
  let g:haddock_browser = "open"
  let g:haddock_browser_callformat = "%s %s"
  </pre>
  next, edit some Haskell file, call ':DocSettings', and check
  whether you are happy with what the script has found:
  g:haddock_browser will be called to display HTML docs (if you 
  need to send your browser into the background, you could set
  g:haddock_browser_callformat), s:libraries should point to your
  local copy of the haddock files (if it doesn't, you could set
  g:haddock_docdir), and s:haddock_indexfile should be a place where
  vim can cache the information it gathers from the HTML files, so
  that it only has to do that once per version of the libraries 
  (you can specify another directory for this cache file by setting
  g:haddock_indexfiledir); if you're happy with the settings,
  :DocIndex will populate the index, and :ExportDocIndex
  will store it for future use  
  </p>
  <p>
  Btw, if your GHC installation came without documentation, you can find
  documentation tarballs at <a
    href="http://www.haskell.org/ghc/docs/">http://www.haskell.org/ghc/docs/</a>.
  </p>
  <p>
  Before version 20090430, haskellmode used to <tt>set
  completeopt=menu,menuone,longest</tt>. I still recommend having <tt>menu,menuone</tt>
  in there, but haskellmode no longer interferes with that setting, and in future,
  other haskellmode menus will take a lead from the presence or absence of menuone
  there (<tt>_?</tt> already does).
  </p>
</dd>

<dt>Acknowledgements:</dt>
<dd>
Thanks to all of you who have provided feedback and suggestions on
earlier versions, especially on removing portability issues.
</dd>
</dl>
</p>

  </body>
</html>

nd persistent-template. I maintain the persitent-mongoDB backend. The issue now is more with the SQL backends, where the maitenance and development for them is being pushed on Michael. For example, I implemented custom Key types in persistent, persistent-template, and persistent-mongoDB. Michael and myself implemented them for persistent-sqlite, but it still needs to be implement for persistent-postgressql and persistent-mysql.</p><p>Maintaining persitent and persitent-template has had a questionable cost/benefit ratio for me. But I have personally found that maintaing the persistent-mongoDB backend has paid off well for me.
I need to have a good understanding of what is happening with my code that deals with the database. Rather than treating it as a black box I make continous incremental improvements to the library that I rely on, and I can smoothly get code onto hackage rather than having local modifications.</p><p>Let us know if you are interested in helping to maintain a backend.</p></div>






<p class="date">
<a href="http://www.yesodweb.com/blog/2014/09/persistent-2">September 16, 2014 10:15 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://neilmitchell.blogspot.com/" title="Neil Mitchell's Haskell Blog">Neil Mitchell</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-7094652.post-967563694980911478">
<blockquote>
<h1 class="entry"><a href="http://neilmitchell.blogspot.com/2014/09/towards-shake-10.html">Towards Shake 1.0</a></h1>
<div class="entry">
<p><em>Summary: I've just released a new version of Shake, with a --demo feature and an underlying continuation monad. I want to release v1.0 in the near future.</em></p><p>I've just released a new version of the <a href="https://github.com/ndmitchell/shake#readme">Shake build system</a>, version 0.13.3. While the version number is only 0.0.1 higher, the <a href="https://github.com/ndmitchell/shake/blob/master/CHANGES.txt">changelog</a> lists a large number of improvements. In particular, two changes are:</p><ul><li>The <code>Action</code> monad is now based on continuations, which allows Shake to suspend threads without requiring a GHC RTS thread. The result is significantly less memory used on thread stacks. I still find it quite amazing that Haskell has such powerful and robust abstraction mechanisms that a huge change doesn't even break the API.</li><li>The <code>shake</code> binary now features a <code>--demo</code> mode, invoked by running <code>shake --demo</code>. This mode generates a Shake project, compiles it, and shows off some of the features of Shake. You can the output of <code>--demo</code> <a href="https://github.com/ndmitchell/shake/blob/master/docs/Demo.md#readme">here</a>.</li></ul><p><strong>Version 1.0</strong></p><p>With the two features above, I'm now looking towards Shake version 1.0. I'm not looking to make any significant backwards-incompatible change, or necessarily any code/API changes at all. However, if you have anything you think should be addressed before reaching such a milestone, please <a href="https://github.com/ndmitchell/shake/issues">comment on the issue tracker</a> or email the <a href="https://groups.google.com/forum/?fromgroups#!forum/shake-build-system">mailing list</a>.</p><p><strong>Shake website</strong></p><p>The one thing I still want to finish before releasing version 1.0 is to have a proper website for Shake. I've registered <a href="http://shakebuild.com">shakebuild.com</a> which will host the content, and have set up GitHub pages to serve it up. I have some rough content in <a href="https://github.com/ndmitchell/shake/tree/master/docs">the docs directory</a> and a prototype generator in <a href="https://github.com/ndmitchell/shake/tree/master/website">the website directory</a> - as an example it currently generates something a bit like <a href="http://shakebuild.com/manual">this for the user manual</a>, but with a table of contents when run through the latest generator. I'd appreciate any help with the content, the generator, or the styling - just email the <a href="https://groups.google.com/forum/?fromgroups#!forum/shake-build-system">mailing list</a>.</p></div>






<p class="date">
<a href="http://neilmitchell.blogspot.com/2014/09/towards-shake-10.html">by Neil Mitchell (noreply@blogger.com) at September 16, 2014 08:54 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://conway.rutgers.edu/~ccshan/wiki/blog/tags/english/" title="Proper Treatment">Chung-chieh Shan</a></h3>

<div class="entrygroup" id="http://conway.rutgers.edu/~ccshan/wiki/blog/posts/lambda4ada/">
<blockquote>
<h1 class="entry"><a href="http://conway.rutgers.edu/~ccshan/wiki/blog/posts/lambda4ada/">A challenge for a better community</a></h1>
<div class="entry">
<p><a href="https://supportada.org/?campaign=lambda"><img src="https://adainitiative.org/wp-content/uploads/2014/08/donate_red_small.png" alt="Donation button" width="185" height="54" /><br />
<img src="https://adainitiative.org/counters/2014counter-lambda.svg" alt="Donate to the Ada Initiative" width="400" /></a></p>
<p>Did you know that all ACM-sponsored conferences have an <a href="http://www.acm.org/sigs/volunteer_resources/officers_manual/anti-harassment-policy">
anti-harassment policy</a>? I didn’t, until I chaired the Haskell
Symposium last year. The concise policy says, among other things,
that people shouldn’t use my family constitution to interfere with
my professional participation. And the policy has teeth. That’s
great.</p>
<p>My not knowing the policy and not seeing it publicized didn’t
make me go out of my way to harass anyone. But it did make me less
sure and less comfortable that I belonged at ICFP. Briefly, it’s
because I didn’t know if it would be common ground at the
conference that my actual self was fully human. That’s not
something I can take for granted in general society. Also, it’s
because I didn’t know whether my fellow conference attendees were
aware of the policy. We could all use a reminder, and a public
signal that we mean it.</p>
<p>For these reasons, I’m very happy that ICFP will start to
publicize ACM’s existing anti-harassment policy and make sure
everyone registered knows it. All ACM conferences should do it.
That’s why <a href="http://tim.dreamwidth.org/1856739.html">Tim
Chevalier</a>, <a href="http://blog.clement.delafargue.name/posts/2014-09-13-of-conferences-and-cocs.html">
Clement Delafargue</a>, <a href="http://tim.dreamwidth.org/1856828.html">Adam Foltzer</a>, Eric
Merritt, and I are doing two things. We ask you to join us:</p>
<ol>
<li>Donate to the Ada Initiative. Our goal is for the functional
programming community to raise $4096 by the end of Friday (Sept 19)
UTC. To count toward this goal, please use this link: <a href="http://supportada.org/?campaign=lambda">http://supportada.org/?campaign=lambda</a></li>
<li>Call on the ACM and tell your friends. For example, I tweeted
this:<br />
I donate to <a href="http://twitter.com/AdaInitiative">@AdaInitiative</a> because I
want <a href="http://twitter.com/TheOfficialACM">@TheOfficialACM</a> events to
announce their anti-harassment policy <a href="http://supportada.org/?campaign=lambda">http://supportada.org/?campaign=lambda</a>
<a href="http://twitter.com/hashtag/lambda4ada?src=hash">#lambda4ada</a></li>
</ol>
<p>Thanks for improving our professional homes!</p></div>






<p class="date">
<a href="http://conway.rutgers.edu/~ccshan/wiki/blog/posts/lambda4ada/">September 16, 2014 04:09 PM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 15, 2014</h2>

<div class="channelgroup">







<h3><a href="http://existentialtype.wordpress.com" title="Existential Type">Robert Harper</a></h3>

<div class="entrygroup" id="http://existentialtype.wordpress.com/?p=998">
<blockquote>
<h1 class="entry"><a href="http://existentialtype.wordpress.com/2014/09/15/scotland-vote-no/">Scotland: Vote No</a></h1>
<div class="entry">
<p>So far I’ve ignored the back and forth on the Scottish referendum on secession from the United Kingdom, but this weekend I decided that it was past time for me to sort it out.  For those of you who don’t know me, I’ll mention that I lived for 3.5 years in Scotland quite some time ago, so I am not completely ignorant of the cultural and political issues that underly the debate.  As a rule my political views are very much in line with those of the average Scot, solidly Labour Party back in the day when people like Derek Hatton and Ken Livingston and Roy Hattersley and Tony Benn defined what that meant.  Despite Tony Blair’s slimy “third way” nonsense, and his toadying up to Dick “Dick” Cheney’s sock puppet to help lie us into the Iraq war, Scotland in national politics remains solidly Labour; practically every Scottish seat is a Labour seat.</p>
<p>Although I used to be a so up on British politics that I could read and enjoy Private Eye, it’s been a long while since I’ve paid more than scant attention to what’s been going on there, apart from noting that The Scotsman was one of the few sources of truth about the Iraq War back when it really mattered.  The Scots have spines.</p>
<p>I’m no historian, but I do have basic understanding of Scottish history, particularly as regards the English, and am very familiar with the Scottish concept of valor in glorious defeat.  I understand full well that practically every Scotsman harbors some resentment towards the English for centuries of injustices, including the highland clearances, and, more recently, the appropriation of the oil in Scottish territory for the scant benefit of the Scots themselves.  And I am well aware of the bravery and sacrifice that so many Scots made fighting against the Axis during World War II.</p>
<p>My home institution, Carnegie Mellon University, was founded by a Scotsman from Kirkaldy, just across the spectacular Forth Bridge from Edinburgh.  Carnegie was born into penury and died as the wealthiest man on earth, far wealthier relative to GDP than Gates by a wide margin.  Carnegie was extraordinary, but the Scots in general punch far above their weight class in all things, especially industrious self-reliance.</p>
<p>In short, I love Scotland, and consider it to be a second home.  (OK, the weather is appalling, but we’ll set that aside for the time being.)</p>
<p>Emotionally, I am deeply sympathetic to the Scottish independence movement.  I know full well how poorly the U.K. treats Scotland and its interests.  Politics in the UK revolves around the “home counties” in the south of England; the terminology tells you all you need to know.  One time while watching the weather report on the BBC, the national broadcasting network, the announcer said that there was some horrendous weather coming our way, but that “it’ll mostly be up in Scotland, though”.  Though.  Though.</p>
<p>But I urge all my Scottish friends to vote NO on the independence proposal.  It makes no sense whatsoever in its present form, and represents to me a huge scam being perpetrated by the SNP to seize power and impose policies that nearly every Scot, judging from their voting record over decades and decades, would oppose.  The whole movement seems driven by the powerful urge to finally stick it to the English and get their country back, and Salmond is exploiting that to the hilt.  Back when I lived in Scotland I looked into the SNP, because even then I had separatist sympathies, but when I did, it was obvious why they had so few backers.  They’re just Tories without the class structure, more akin to our Tea Party lunatics than to the British Conservatives, and steadfastly opposed to policies, such as well-funded public education, that nearly all Scots support, and determined to follow the post-cold war Slovakian model of slashing taxes on the wealthy in the hope of attracting business to the country.  Having not followed Scottish politics for so long, it is astonishing to me that the SNP has managed to gain a majority in the Scottish Parliament, while the voting pattern at the national level has not changed at all.  How did this happen?  From my position of ignorance of the last decade or so of politics in Scotland, it looks as though Salmond is a slick operator who has pulled off a colossal con by exploiting the nationalist tendencies that lie within every Scot.</p>
<p>But never mind Salmond, the main reason that Scots must vote NO on the referendum is that it proposes to keep the English pound as Scotland’s national currency!  This is such a preposterous idea that I can only suspect dishonesty and deceit, because no sane political leader of honest intent could ever voluntarily place his or her country’s economic future in the hands of another.  The Bank of England will, particularly after separation, have no interest whatsoever in the economic conditions in Scotland when determining its policies on the pound.  And the Bank of Scotland will have no ability to control its own currency, the prime means of maintaining economic balance between labor and capital.  The Scots will, in effect, be putting themselves on a gold standard, the stupidest possible monetary system, so that, in a crisis, they will have to buy or borrow pounds, at interest, in emergency conditions, to deal with, say, the failure of the Royal Bank of Scotland (but don’t worry, that sort of thing can never happen again).  And the Bank of Scotland will have no means of sticlick="toggleSection('n.9.1.2')">Passes</span><ul id="section.n.9.1.2" class="show"><li><span class="module"><a href="hoopl-3.10.0.1/Compiler-Hoopl-Passes-DList.html">Compiler.Hoopl.Passes.DList</a></span><span class="package">hoopl-3.10.0.1</span></li><li><span class="module"><a href="hoopl-3.10.0.1/Compiler-Hoopl-Passes-Dominator.html">Compiler.Hoopl.Passes.Dominator</a></span><span class="package">hoopl-3.10.0.1</span></li></ul></li><li><span class="module"><a href="hoopl-3.10.0.1/Compiler-Hoopl-Wrappers.html">Compiler.Hoopl.Wrappers</a></span><span class="package">hoopl-3.10.0.1</span></li></ul></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/Complex.html">Complex</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span id="control.n.11" class="module collapser" onclick="toggleSection('n.11')">Control</span><ul id="section.n.11" class="show"><li><span class="module"><span id="control.n.11.1" class="collapser" onclick="toggleSection('n.11.1')">&nbsp;</span><a href="base-4.7.0.1/Control-Applicative.html">Control.Applicative</a></span><span class="package">base</span><ul id="section.n.11.1" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Applicative-Backwards.html">Control.Applicative.Backwards</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Applicative-Lift.html">Control.Applicative.Lift</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Control-Arrow.html">Control.Arrow</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Category.html">Control.Category</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.11.4" class="collapser" onclick="toggleSection('n.11.4')">&nbsp;</span><a href="base-4.7.0.1/Control-Concurrent.html">Control.Concurrent</a></span><span class="package">base</span><ul id="section.n.11.4" class="show"><li><span class="module"><a href="base-4.7.0.1/Control-Concurrent-Chan.html">Control.Concurrent.Chan</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Concurrent-MVar.html">Control.Concurrent.MVar</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Concurrent-QSem.html">Control.Concurrent.QSem</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Concurrent-QSemN.html">Control.Concurrent.QSemN</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="deepseq-1.3.0.2/Control-DeepSeq.html">Control.DeepSeq</a></span><span class="package">deepseq-1.3.0.2</span></li><li><span class="module"><span id="control.n.11.6" class="collapser" onclick="toggleSection('n.11.6')">&nbsp;</span><a href="base-4.7.0.1/Control-Exception.html">Control.Exception</a></span><span class="package">base</span><ul id="section.n.11.6" class="show"><li><span class="module"><a href="base-4.7.0.1/Control-Exception-Base.html">Control.Exception.Base</a></span><span class="package">base</span></li></ul></li><li><span class="module"><span id="control.n.11.7" class="collapser" onclick="toggleSection('n.11.7')">&nbsp;</span><a href="base-4.7.0.1/Control-Monad.html">Control.Monad</a></span><span class="package">base</span><ul id="section.n.11.7" class="show"><li><span class="module"><a href="base-4.7.0.1/Control-Monad-Fix.html">Control.Monad.Fix</a></span><span class="package">base</span></li><li><span id="control.n.11.7.2" class="module collapser" onclick="toggleSection('n.11.7.2')">IO</span><ul id="section.n.11.7.2" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-IO-Class.html">Control.Monad.IO.Class</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-Instances.html">Control.Monad.Instances</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.11.7.4" class="collapser" onclick="toggleSection('n.11.7.4')">&nbsp;</span><a href="base-4.7.0.1/Control-Monad-ST.html">Control.Monad.ST</a></span><span class="package">base</span><ul id="section.n.11.7.4" class="show"><li><span class="module"><span id="control.n.11.7.4.1" class="collapser" onclick="toggleSection('n.11.7.4.1')">&nbsp;</span><a href="base-4.7.0.1/Control-Monad-ST-Lazy.html">Control.Monad.ST.Lazy</a></span><span class="package">base</span><ul id="section.n.11.7.4.1" class="show"><li><span class="module"><a href="base-4.7.0.1/Control-Monad-ST-Lazy-Safe.html">Control.Monad.ST.Lazy.Safe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-ST-Lazy-Unsafe.html">Control.Monad.ST.Lazy.Unsafe</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-ST-Safe.html">Control.Monad.ST.Safe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-ST-Strict.html">Control.Monad.ST.Strict</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-ST-Unsafe.html">Control.Monad.ST.Unsafe</a></span><span class="package">base</span></li></ul></li><li><span id="control.n.11.7.5" class="module collapser" onclick="toggleSection('n.11.7.5')">Trans</span><ul id="section.n.11.7.5" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Class.html">Control.Monad.Trans.Class</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Cont.html">Control.Monad.Trans.Cont</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Error.html">Control.Monad.Trans.Error</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Identity.html">Control.Monad.Trans.Identity</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-List.html">Control.Monad.Trans.List</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Maybe.html">Control.Monad.Trans.Maybe</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><span id="control.n.11.7.5.7" class="collapser" onclick="toggleSection('n.11.7.5.7')">&nbsp;</span><a href="transformers-0.3.0.0/Control-Monad-Trans-RWS.html">Control.Monad.Trans.RWS</a></span><span class="package">transformers-0.3.0.0</span><ul id="section.n.11.7.5.7" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-RWS-Lazy.html">Control.Monad.Trans.RWS.Lazy</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-RWS-Strict.html">Control.Monad.Trans.RWS.Strict</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Reader.html">Control.Monad.Trans.Reader</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><span id="control.n.11.7.5.9" class="collapser" onclick="toggleSection('n.11.7.5.9')">&nbsp;</span><a href="transformers-0.3.0.0/Control-Monad-Trans-State.html">Control.Monad.Trans.State</a></span><span class="package">transformers-0.3.0.0</span><ul id="section.n.11.7.5.9" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-State-Lazy.html">Control.Monad.Trans.State.Lazy</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-State-Strict.html">Control.Monad.Trans.State.Strict</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li><li><span class="module"><span id="control.n.11.7.5.10" class="collapser" onclick="toggleSection('n.11.7.5.10')">&nbsp;</span><a href="transformers-0.3.0.0/Control-Monad-Trans-Writer.html">Control.Monad.Trans.Writer</a></span><span class="package">transformers-0.3.0.0</span><ul id="section.n.11.7.5.10" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Writer-Lazy.html">Control.Monad.Trans.Writer.Lazy</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Control-Monad-Trans-Writer-Strict.html">Control.Monad.Trans.Writer.Strict</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Control-Monad-Zip.html">Control.Monad.Zip</a></span><span class="package">base</span></li></ul></li></ul></li><li><span id="control.n.12" class="module collapser" onclick="toggleSection('n.12')">Data</span><ul id="section.n.12" class="show"><li><span class="module"><span id="control.n.12.1" class="collapser" onclick="toggleSection('n.12.1')">&nbsp;</span><a href="array-0.5.0.0/Data-Array.html">Data.Array</a></span><span class="package">array-0.5.0.0</span><ul id="section.n.12.1" class="show"><li><span class="module"><a href="array-0.5.0.0/Data-Array-IArray.html">Data.Array.IArray</a></span><span class="package">array-0.5.0.0</span></li><li><span class="module"><span id="control.n.12.1.2" class="collapser" onclick="toggleSection('n.12.1.2')">&nbsp;</span><a href="array-0.5.0.0/Data-Array-IO.html">Data.Array.IO</a></span><span class="package">array-0.5.0.0</span><ul id="section.n.12.1.2" class="show"><li><span class="module"><a href="array-0.5.0.0/Data-Array-IO-Safe.html">Data.Array.IO.Safe</a></span><span class="package">array-0.5.0.0</span></li></ul></li><li><span class="module"><span id="control.n.12.1.3" class="collapser" onclick="toggleSection('n.12.1.3')">&nbsp;</span><a href="array-0.5.0.0/Data-Array-MArray.html">Data.Array.MArray</a></span><span class="package">array-0.5.0.0</span><ul id="section.n.12.1.3" class="show"><li><span class="module"><a href="array-0.5.0.0/Data-Array-MArray-Safe.html">Data.Array.MArray.Safe</a></span><span class="package">array-0.5.0.0</span></li></ul></li><li><span class="module"><span id="control.n.12.1.4" class="collapser" onclick="toggleSection('n.12.1.4')">&nbsp;</span><a href="array-0.5.0.0/Data-Array-ST.html">Data.Array.ST</a></span><span class="package">array-0.5.0.0</span><ul id="section.n.12.1.4" class="show"><li><span class="module"><a href="array-0.5.0.0/Data-Array-ST-Safe.html">Data.Array.ST.Safe</a></span><span class="package">array-0.5.0.0</span></li></ul></li><li><span class="module"><span id="control.n.12.1.5" class="collapser" onclick="toggleSection('n.12.1.5')">&nbsp;</span><a href="array-0.5.0.0/Data-Array-Storable.html">Data.Array.Storable</a></span><span class="package">array-0.5.0.0</span><ul id="section.n.12.1.5" class="show"><li><span class="module"><a href="array-0.5.0.0/Data-Array-Storable-Safe.html">Data.Array.Storable.Safe</a></span><span class="package">array-0.5.0.0</span></li></ul></li><li><span class="module"><a href="array-0.5.0.0/Data-Array-Unboxed.html">Data.Array.Unboxed</a></span><span class="package">array-0.5.0.0</span></li><li><span class="module"><a href="array-0.5.0.0/Data-Array-Unsafe.html">Data.Array.Unsafe</a></span><span class="package">array-0.5.0.0</span></li></ul></li><li><span class="module"><span id="control.n.12.2" class="collapser" onclick="toggleSection('n.12.2')">&nbsp;</span><a href="binary-0.7.1.0/Data-Binary.html">Data.Binary</a></span><span class="package">binary-0.7.1.0</span><ul id="section.n.12.2" class="show"><li><span class="module"><span id="control.n.12.2.1" class="collapser" onclick="toggleSection('n.12.2.1')">&nbsp;</span><a href="binary-0.7.1.0/Data-Binary-Builder.html">Data.Binary.Builder</a></span><span class="package">binary-0.7.1.0</span><ul id="section.n.12.2.1" class="show"><li><span class="module"><a href="binary-0.7.1.0/Data-Binary-Builder-Internal.html">Data.Binary.Builder.a 
href="haskellch11.html#x18-18600011.4" id="QQ2-18-199">Derived instances of <span 
class="pcrr7t-">Read</span> and <span 
class="pcrr7t-">Show</span></a></span>
<br />&#x00A0;<span class="sectionToc" >11.5 <a 
href="haskellch11.html#x18-18700011.5" id="QQ2-18-200">An Example</a></span>
<br /><span class="chapterToc" >12 <a 
href="haskellch12.html#x19-18800012" id="QQ2-19-202">Compiler Pragmas</a></span>
<br />&#x00A0;<span class="sectionToc" >12.1 <a 
href="haskellch12.html#x19-18900012.1" id="QQ2-19-203">Inlining</a></span>
<br />&#x00A0;<span class="sectionToc" >12.2 <a 
href="haskellch12.html#x19-19000012.2" id="QQ2-19-204">Specialization</a></span>
<br />&#x00A0;<span class="sectionToc" >12.3 <a 
href="haskellch12.html#x19-19100012.3" id="QQ2-19-205">Language extensions</a></span>
<br /><span class="partToc" >II&#x00A0;&#x00A0;<a 
href="haskellpa2.html#x20-192000II" id="QQ2-20-206">The Haskell 2010 Libraries</a></span>
<br /><span class="chapterToc" >13 <a 
href="haskellch13.html#x21-19300013" id="QQ2-21-207"><span 
class="pcrr7t-">Control.Monad</span></a></span>
<br />&#x00A0;<span class="sectionToc" >13.1 <a 
href="haskellch13.html#x21-19400013.1" id="QQ2-21-208">Functor and monad classes </a></span>
<br />&#x00A0;<span class="sectionToc" >13.2 <a 
href="haskellch13.html#x21-19500013.2" id="QQ2-21-209">Functions </a></span>
<br /><span class="chapterToc" >14 <a 
href="haskellch14.html#x22-20100014" id="QQ2-22-215"><span 
class="pcrr7t-">Data.Array</span></a></span>
<br />&#x00A0;<span class="sectionToc" >14.1 <a 
href="haskellch14.html#x22-20200014.1" id="QQ2-22-216">Immutable non-strict arrays </a></span>
<br />&#x00A0;<span class="sectionToc" >14.2 <a 
href="haskellch14.html#x22-20300014.2" id="QQ2-22-217">Array construction </a></span>
<br />&#x00A0;<span class="sectionToc" >14.3 <a 
href="haskellch14.html#x22-20400014.3" id="QQ2-22-218">Accessing arrays </a></span>
<br />&#x00A0;<span class="sectionToc" >14.4 <a 
href="haskellch14.html#x22-20500014.4" id="QQ2-22-219">Incremental array updates </a></span>
<br />&#x00A0;<span class="sectionToc" >14.5 <a 
href="haskellch14.html#x22-20600014.5" id="QQ2-22-220">Derived arrays </a></span>
<br />&#x00A0;<span class="sectionToc" >14.6 <a 
href="haskellch14.html#x22-20700014.6" id="QQ2-22-221">Specification </a></span>
<br /><span class="chapterToc" >15 <a 
href="haskellch15.html#x23-20800015" id="QQ2-23-222"><span 
class="pcrr7t-">Data.Bits</span></a></span>
<br /><span class="chapterToc" >16 <a 
href="haskellch16.html#x24-20900016" id="QQ2-24-223"><span 
class="pcrr7t-">Data.Char</span></a></span>
<br />&#x00A0;<span class="sectionToc" >16.1 <a 
href="haskellch16.html#x24-21000016.1" id="QQ2-24-224">Characters and strings </a></span>
<br />&#x00A0;<span class="sectionToc" >16.2 <a 
href="haskellch16.html#x24-21100016.2" id="QQ2-24-225">Character classification </a></span>
<br />&#x00A0;<span class="sectionToc" >16.3 <a 
href="haskellch16.html#x24-21400016.3" id="QQ2-24-228">Case conversion </a></span>
                                                                                   

                                                                                   
<br />&#x00A0;<span class="sectionToc" >16.4 <a 
href="haskellch16.html#x24-21500016.4" id="QQ2-24-229">Single digit characters </a></span>
<br />&#x00A0;<span class="sectionToc" >16.5 <a 
href="haskellch16.html#x24-21600016.5" id="QQ2-24-230">Numeric representations </a></span>
<br />&#x00A0;<span class="sectionToc" >16.6 <a 
href="haskellch16.html#x24-21700016.6" id="QQ2-24-231">String representations </a></span>
<br /><span class="chapterToc" >17 <a 
href="haskellch17.html#x25-21800017" id="QQ2-25-232"><span 
class="pcrr7t-">Data.Complex</span></a></span>
<br />&#x00A0;<span class="sectionToc" >17.1 <a 
href="haskellch17.html#x25-21900017.1" id="QQ2-25-233">Rectangular form </a></span>
<br />&#x00A0;<span class="sectionToc" >17.2 <a 
href="haskellch17.html#x25-22000017.2" id="QQ2-25-234">Polar form </a></span>
<br />&#x00A0;<span class="sectionToc" >17.3 <a 
href="haskellch17.html#x25-22100017.3" id="QQ2-25-235">Conjugate </a></span>
<br />&#x00A0;<span class="sectionToc" >17.4 <a 
href="haskellch17.html#x25-22200017.4" id="QQ2-25-236">Specification </a></span>
<br /><span class="chapterToc" >18 <a 
href="haskellch18.html#x26-22300018" id="QQ2-26-237"><span 
class="pcrr7t-">Data.Int</span></a></span>
<br />&#x00A0;<span class="sectionToc" >18.1 <a 
href="haskellch18.html#x26-22400018.1" id="QQ2-26-238">Signed integer types </a></span>
<br /><span class="chapterToc" >19 <a 
href="haskellch19.html#x27-22500019" id="QQ2-27-239"><span 
class="pcrr7t-">Data.Ix</span></a></span>
<br />&#x00A0;<span class="sectionToc" >19.1 <a 
href="haskellch19.html#x27-22600019.1" id="QQ2-27-240">The <span 
class="pcrr7t-">Ix </span>class </a></span>
<br />&#x00A0;<span class="sectionToc" >19.2 <a 
href="haskellch19.html#x27-22700019.2" id="QQ2-27-241">Deriving Instances of <span 
class="pcrr7t-">Ix</span></a></span>
<br /><span class="chapterToc" >20 <a 
href="haskellch20.html#x28-22800020" id="QQ2-28-242"><span 
class="pcrr7t-">Data.List</span></a></span>
<br />&#x00A0;<span class="sectionToc" >20.1 <a 
href="haskellch20.html#x28-22900020.1" id="QQ2-28-243">Basic functions </a></span>
<br />&#x00A0;<span class="sectionToc" >20.2 <a 
href="haskellch20.html#x28-23000020.2" id="QQ2-28-244">List transformations </a></span>
<br />&#x00A0;<span class="sectionToc" >20.3 <a 
href="haskellch20.html#x28-23100020.3" id="QQ2-28-245">Reducing lists (folds) </a></span>
<br />&#x00A0;<span class="sectionToc" >20.4 <a 
href="haskellch20.html#x28-23300020.4" id="QQ2-28-247">Building lists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.5 <a 
href="haskellch20.html#x28-23800020.5" id="QQ2-28-252">Sublists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.6 <a 
href="haskellch20.html#x28-24100020.6" id="QQ2-28-255">Searching lists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.7 <a 
href="haskellch20.html#x28-24400020.7" id="QQ2-28-258">Indexing lists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.8 <a 
href="haskellch20.html#x28-24500020.8" id="QQ2-28-259">Zipping and unzipping lists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.9 <a 
href="haskellch20.html#x28-24600020.9" id="QQ2-28-260">Special lists </a></span>
<br />&#x00A0;<span class="sectionToc" >20.10 <a 
href="haskellch20.html#x28-25000020.10" id="QQ2-28-264">Generalized functions </a></span>
<br /><span class="chapterToc" >21 <a 
href="haskellch21.html#x29-25500021" id="QQ2-29-269"><span 
class="pcrr7t-">Data.Maybe</span></a></span>
<br />&#x00A0;<span class="sectionToc" >21.1 <a 
href="haskellch21.html#x29-25600021.1" id="QQ2-29-270">The <span 
class="pcrr7t-">Maybe </span>type and operations </a></span>
<br />&#x00A0;<span class="sectionToc" >21.2 <a 
href="haskellch21.html#x29-25700021.2" id="QQ2-29-271">Specification </a></span>
<br /><span class="chapterToc" >22 <a 
href="haskellch22.html#x30-25800022" id="QQ2-30-272"><span 
class="pcrr7t-">Data.Ratio</span></a></span>
<br />&#x00A0;<span class="sectionToc" >22.1 <a 
href="haskellch22.html#x30-25900022.1" id="QQ2-30-273">Specification </a></span>
                                                                                   

                                                                                   
<br /><span class="chapterToc" >23 <a 
href="haskellch23.html#x31-26000023" id="QQ2-31-274"><span 
class="pcrr7t-">Data.Word</span></a></span>
<br />&#x00A0;<span class="sectionToc" >23.1 <a 
href="haskellch23.html#x31-26100023.1" id="QQ2-31-275">Unsigned integral types </a></span>
<br /><span class="chapterToc" >24 <a 
href="haskellch24.html#x32-26200024" id="QQ2-32-276"><span 
class="pcrr7t-">Foreign</span></a></span>
<br /><span class="chapterToc" >25 <a 
href="haskellch25.html#x33-26300025" id="Internal</a></span><span class="package">binary-0.7.1.0</span></li></ul></li><li><span class="module"><span id="control.n.12.2.2" class="collapser" onclick="toggleSection('n.12.2.2')">&nbsp;</span><a href="binary-0.7.1.0/Data-Binary-Get.html">Data.Binary.Get</a></span><span class="package">binary-0.7.1.0</span><ul id="section.n.12.2.2" class="show"><li><span class="module"><a href="binary-0.7.1.0/Data-Binary-Get-Internal.html">Data.Binary.Get.Internal</a></span><span class="package">binary-0.7.1.0</span></li></ul></li><li><span class="module"><a href="binary-0.7.1.0/Data-Binary-Put.html">Data.Binary.Put</a></span><span class="package">binary-0.7.1.0</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Data-Bits.html">Data.Bits</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Bool.html">Data.Bool</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.5" class="collapser" onclick="toggleSection('n.12.5')">&nbsp;</span><a href="bytestring-0.10.4.0/Data-ByteString.html">Data.ByteString</a></span><span class="package">bytestring-0.10.4.0</span><ul id="section.n.12.5" class="show"><li><span class="module"><spanr</span></a></span>
<br />&#x00A0;<span class="sectionToc" >29.1 <a 
href="haskellch29.html#x37-28100029.1" id="QQ2-37-295">Finalised data pointers </a></span>
<br /><span class="chapterToc" >30 <a 
href="haskellch30.html#x38-28500030" id="QQ2-38-299"><span 
class="pcrr7t-">Foreign.Marshal</span></a></span>
<br /><span class="chapterToc" >31 <a 
href="haskellch31.html#x39-28600031" id="QQ2-39-300"><span 
class="pcrr7t-">Foreign.Marshal.Alloc</span></a></span>
<br />&#x00A0;<span class="sectionToc" >31.1 <a 
href="haskellch31.html#x39-28700031.1" id="QQ2-39-301">Memory allocation </a></span>
<br /><span class="chapterToc" >32 <a 
href="haskellch32.html#x40-29000032" id="QQ2-40-304"><span 
class="pcrr7t-">Foreign.Marshal.Array</span></a></span>
<br />&#x00A0;<span class="sectionToc" >32.1 <a 
href="haskellch32.html#x40-29100032.1" id="QQ2-40-305">Marshalling arrays </a></span>
<br /><span class="chapterToc" >33 <a 
href="haskellch33.html#x41-29800033" id="QQ2-41-312"><span 
class="pcrr7t-">Foreign.Marshal.Error</span></a></span>
<br /><span class="chapterToc" >34 <a 
href="haskellch34.html#x42-29900034" id="QQ2-42-313"><span 
class="pcrr7t-">Foreign.Marshal.Utils</span></a></span>
<br />&#x00A0;<span class="sectionToc" >34.1 <a 
href="haskellch34.html#x42-30000034.1" id="QQ2-42-314">General marshalling utilities </a></span>
<br /><span class="chapterToc" >35 <a 
href="haskellch35.html#x43-30600035" id="QQ2-43-320"><span 
class="pcrr7t-">Foreign.Ptr</span></a></span>
<br />&#x00A0;<span class="sectionToc" >35.1 <a 
href="haskellch35.html#x43-30700035.1" id="QQ2-43-321">Data pointers </a></span>
<br />&#x00A0;<span class="sectionToc" >35.2 <a 
href="haskellch35.html#x43-30800035.2" id="QQ2-43-322">Function pointers </a></span>
<br />&#x00A0;<span class="sectionToc" >35.3 <a 
href="haskellch35.html#x43-30900035.3" id="QQ2-43-323">Integral types with lossless conversion to and from pointers </a></span>
<br /><span class="chapterToc" >36 <a 
href="haskellch36.html#x44-31000036" id="QQ2-44-324"><span 
class="pcrr7t-">Foreign.StablePtr</span></a></span>
<br />&#x00A0;<span class="sectionToc" >36.1 <a 
href="haskellch36.html#x44-31100036.1" id="QQ2-44-325">Stable references to Haskell values </a></span>
<br /><span class="chapterToc" >37 <a 
href="haskellch37.html#x45-31300037" id="QQ2-45-327"><span 
class="pcrr7t-">Foreign.Storable</span></a></span>
<br /><span class="chapterToc" >38 <a 
href="haskellch38.html#x46-31400038" id="QQ2-46-328"><span 
class="pcrr7t-">Numeric</span></a></span>
                                                                                   

                                                                                   
<br />&#x00A0;<span class="sectionToc" >38.1 <a 
href="haskellch38.html#x46-31500038.1" id="QQ2-46-329">Showing </a></span>
<br />&#x00A0;<span class="sectionToc" >38.2 <a 
href="haskellch38.html#x46-31600038.2" id="QQ2-46-330">Reading </a></span>
<br />&#x00A0;<span class="sectionToc" >38.3 <a 
href="haskellch38.html#x46-31700038.3" id="QQ2-46-331">Miscellaneous </a></span>
<br /><span class="chapterToc" >39 <a 
href="haskellch39.html#x47-31800039" id="QQ2-47-332"><span 
class="pcrr7t-">System.Environment</span></a></span>
<br /><span class="chapterToc" >40 <a 
href="haskellch40.html#x48-31900040" id="QQ2-48-333"><span 
class="pcrr7t-">System.Exit</span></a></span>
<br /><span class="chapterToc" >41 <a 
href="haskellch41.html#x49-32000041" id="QQ2-49-334"><span 
class="pcrr7t-">System.IO</span></a></span>
<br />&#x00A0;<span class="sectionToc" >41.1 <a 
href="haskellch41.html#x49-32100041.1" id="QQ2-49-335">The IO monad </a></span>
<br />&#x00A0;<span class="sectionToc" >41.2 <a 
href="haskellch41.html#x49-32200041.2" id="QQ2-49-336">Files and handles </a></span>
<br />&#x00A0;<span class="sectionToc" >41.3 <a 
href="haskellch41.html#x49-32400041.3" id="QQ2-49-338">Opening and closing files </a></span>
<br />&#x00A0;<span class="sectionToc" >41.4 <a 
href="haskellch41.html#x49-32900041.4" id="QQ2-49-343">Operations on handles </a></span>
<br />&#x00A0;<span class="sectionToc" >41.5 <a 
href="haskellch41.html#x49-33700041.5" id="QQ2-49-351">Text input and output </a></span>
<br /><span class="chapterToc" >42 <a 
href="haskellch42.html#x50-34100042" id="QQ2-50-355"><span 
class="pcrr7t-">System.IO.Error</span></a></span>
<br />&#x00A0;<span class="sectionToc" >42.1 <a 
href="haskellch42.html#x50-34200042.1" id="QQ2-50-356">I/O errors </a></span>
<br />&#x00A0;<span class="sectionToc" >42.2 <a 
href="haskellch42.html#x50-34500042.2" id="QQ2-50-359">Types of I/O error </a></span>
<br />&#x00A0;<span class="sectionToc" >42.3 <a 
href="haskellch42.html#x50-34600042.3" id="QQ2-50-360">Throwing and catching I/O errors </a></span>
<br /><span class="likechapterToc" ><a 
href="haskellli3.html#x51-34700042.3" id="QQ2-51-361">Bibliography</a></span>
</div>
                                                                                   

                                                                                   

                                                                                   

                                                                                   
                                                                                   

                                                                                   
 <p class="noindent">
                                                                                   

                                                                                   

                                                                                   

                                                                                   
                                                                                   

                                                                                   
 <p class="noindent">
                                                                                   

                                                                                   
 <p class="noindent">
                                                                                   

                                                                                   
 
</body> </html> 

                                                                                   


le"><a href="base-4.7.0.1/Data-Fixed.html">Data.Fixed</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Foldable.html">Data.Foldable</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Function.html">Data.Function</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.16" class="collapser" onclick="toggleSection('n.12.16')">&nbsp;</span><a href="base-4.7.0.1/Data-Functor.html">Data.Functor</a></span><span class="package">base</span><ul id="section.n.12.16" class="show"><li><span class="module"><a href="transformers-0.3.0.0/Data-Functor-Compose.html">Data.Functor.Compose</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Data-Functor-Constant.html">Data.Functor.Constant</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Data-Functor-Identity.html">Data.Functor.Identity</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Data-Functor-Product.html">Data.Functor.Product</a></span><span class="package">transformers-0.3.0.0</span></li><li><span class="module"><a href="transformers-0.3.0.0/Data-Functor-Reverse.html">Data.Functor.Reverse</a></span><span class="package">transformers-0.3.0.0</span></li></ul></li><li><span class="module"><a href="containers-0.5.5.1/Data-Graph.html">Data.Graph</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="base-4.7.0.1/Data-IORef.html">Data.IORef</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Int.html">Data.Int</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.20" class="collapser" onclick="toggleSection('n.12.20')">&nbsp;</span><a href="containers-0.5.5.1/Data-IntMap.html">Data.IntMap</a></span><span class="package">containers-0.5.5.1</span><ul id="section.n.12.20" class="show"><li><span class="module"><a href="containers-0.5.5.1/Data-IntMap-Lazy.html">Data.IntMap.Lazy</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="containers-0.5.5.1/Data-IntMap-Strict.html">Data.IntMap.Strict</a></span><span class="package">containers-0.5.5.1</span></li></ul></li><li><span class="module"><a href="containers-0.5.5.1/Data-IntSet.html">Data.IntSet</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Ix.html">Data.Ix</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-List.html">Data.List</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.24" class="collapser" onclick="toggleSection('n.12.24')">&nbsp;</span><a href="containers-0.5.5.1/Data-Map.html">Data.Map</a></span><span class="package">containers-0.5.5.1</span><ul id="section.n.12.24" class="show"><li><span class="module"><a href="containers-0.5.5.1/Data-Map-Lazy.html">Data.Map.Lazy</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="containers-0.5.5.1/Data-Map-Strict.html">Data.Map.Strict</a></span><span class="package">containers-0.5.5.1</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Data-Maybe.html">Data.Maybe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Monoid.html">Data.Monoid</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.27" class="collapser" onclick="toggleSection('n.12.27')">&nbsp;</span><a href="base-4.7.0.1/Data-OldTypeable.html">Data.OldTypeable</a></span><span class="package">base</span><ul id="section.n.12.27" class="show"><li><span class="module"><a href="base-4.7.0.1/Data-OldTypeable-Internal.html">Data.OldTypeable.Internal</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Data-Ord.html">Data.Ord</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Proxy.html">Data.Proxy</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Ratio.html">Data.Ratio</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.31" class="collapser" onclick="toggleSection('n.12.31')">&nbsp;</span><a href="base-4.7.0.1/Data-STRef.html">Data.STRef</a></span><span class="package">base</span><ul id="section.n.12.31" class="show"><li><span class="module"><a href="base-4.7.0.1/Data-STRef-Lazy.html">Data.STRef.Lazy</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-STRef-Strict.html">Data.STRef.Strict</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="containers-0.5.5.1/Data-Sequence.html">Data.Sequence</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="containers-0.5.5.1/Data-Set.html">Data.Set</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="base-4.7.0.1/Data-String.html">Data.String</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.12.35" class="collapser" onclick="toggleSection('n.12.35')">&nbsp;</span><a href="time-1.4.2/Data-Time.html">Data.Time</a></span><span class="package">time-1.4.2</span><ul id="section.n.12.35" class="show"><li><span class="module"><span id="control.n.12.35.1" class="collapser" onclick="toggleSection('n.12.35.1')">&nbsp;</span><a href="time-1.4.2/Data-Time-Calendar.html">Data.Time.Calendar</a></span><span class="package">time-1.4.2</span><ul id="section.n.12.35.1" class="show"><li><span class="module"><a href="time-1.4.2/Data-Time-Calendar-Easter.html">Data.Time.Calendar.Easter</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-Calendar-Julian.html">Data.Time.Calendar.Julian</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-Calendar-MonthDay.html">Data.Time.Calendar.MonthDay</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-Calendar-OrdinalDate.html">Data.Time.Calendar.OrdinalDate</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-Calendar-WeekDate.html">Data.Time.Calendar.WeekDate</a></span><span class="package">time-1.4.2</span></li></ul></li><li><span class="module"><span id="control.n.12.35.2" class="collapser" onclick="toggleSection('n.12.35.2')">&nbsp;</span><a href="time-1.4.2/Data-Time-Clock.html">Data.Time.Clock</a></span><span class="package">time-1.4.2</span><ul id="section.n.12.35.2" class="show"><li><span class="module"><a href="time-1.4.2/Data-Time-Clock-POSIX.html">Data.Time.Clock.POSIX</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-Clock-TAI.html">Data.Time.Clock.TAI</a></span><span class="package">time-1.4.2</span></li></ul></li><li><span class="module"><a href="time-1.4.2/Data-Time-Format.html">Data.Time.Format</a></span><span class="package">time-1.4.2</span></li><li><span class="module"><a href="time-1.4.2/Data-Time-LocalTime.html">Data.Time.LocalTime</a></span><span class="package">time-1.4.2</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Data-Traversable.html">Data.Traversable</a></span><span class="package">base</span></li><li><span class="module"><a href="containers-0.5.5.1/Data-Tree.html">Data.Tree</a></span><span class="package">containers-0.5.5.1</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Tuple.html">Data.Tuple</a></span><span class="package">base</span></li><li><span id="control.n.12.39" class="module collapser" onclick="toggleSection('n.12.39')">Type</span><ul id="section.n.12.39" class="show"><li><span class="module"><a href="base-4.7.0.1/Data-Type-Bool.html">Data.Type.Bool</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Type-Coercion.html">Data.Type.Coercion</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Type-Equality.html">Data.Type.Equality</a></span><span class="package">base</span></li></ul></li><li><span class="module"><span id="control.n.12.40" class="collapser" onclick="toggleSection('n.12.40')">&nbsp;</span><a href="base-4.7.0.1/Data-Typeable.html">Data.Typeable</a></span><span class="package">base</span><ul id="section.n.12.40" class="show"><li><span class="module"><a href="base-4.7.0.1/Data-Typeable-Internal.html">Data.Typeable.Internal</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Data-Unique.html">Data.Unique</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Version.html">Data.Version</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Data-Word.html">Data.Word</a></span><span class="package">base</span></li></ul></li><li><span id="control.n.13" class="module collapser" onclick="toggleSection('n.13')">Debug</span><ul id="section.n.13" class="show"><li><span class="module"><a href="base-4.7.0.1/Debug-Trace.html">Debug.Trace</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/Directory.html">Directory</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span id="control.n.15" class="module collapser" onclick="toggleSection('n.15')">Distribution</span><ul id="section.n.15" class="show"><li><span id="control.n.15.1" class="module collapser" onclick="toggleSection('n.15.1')">Compat</span><ul id="section.n.15.1" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Compat-Exception.html">Distribution.Compat.Exception</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Compat-ReadP.html">Distribution.Compat.ReadP</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Compiler.html">Distribution.Compiler</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.15.3" class="collapser" onclick="toggleSection('n.15.3')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-InstalledPackageInfo.html">Distribution.InstalledPackageInfo</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.3" class="show"><li><span class="module"><a href="bin-package-db-0.0.0.0/Distribution-InstalledPackageInfo-Binary.html">Distribution.InstalledPackageInfo.Binary</a></span><span class="package">bin-package-db-0.0.0.0</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-License.html">Distribution.License</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Make.html">Distribution.Make</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-ModuleName.html">Distribution.ModuleName</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Package.html">Distribution.Package</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.15.8" class="collapser" onclick="toggleSection('n.15.8')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-PackageDescription.html">Distribution.PackageDescription</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.8" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-PackageDescription-Check.html">Distribution.PackageDescription.Check</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-PackageDescription-Configuration.html">Distribution.PackageDescription.Configuration</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-PackageDescription-Parse.html">Distribution.PackageDescription.Parse</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-PackageDescription-PrettyPrint.html">Distribution.PackageDescription.PrettyPrint</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-PackageDescription-Utils.html">Distribution.PackageDescription.Utils</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-ReadE.html">Distribution.ReadE</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.15.10" class="collapser" onclick="toggleSection('n.15.10')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-Simple.html">Distribution.Simple</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.10" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Bench.html">Distribution.Simple.Bench</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.15.10.2" class="collapser" onclick="toggleSection('n.15.10.2')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-Simple-Build.html">Distribution.Simple.Build</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.10.2" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Build-Macros.html">Distribution.Simple.Build.Macros</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Build-PathsModule.html">Distribution.Simple.Build.PathsModule</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-BuildPaths.html">Distribution.Simple.BuildPaths</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-BuildTarget.html">Distribution.Simple.BuildTarget</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-CCompiler.html">Distribution.Simple.CCompiler</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Command.html">Distribution.Simple.Command</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Compiler.html">Distribution.Simple.Compiler</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Configure.html">Distribution.Simple.Configure</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-GHC.html">Distribution.Simple.GHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Haddock.html">Distribution.Simple.Haddock</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Hpc.html">Distribution.Simple.Hpc</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Hugs.html">Distribution.Simple.Hugs</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Install.html">Distribution.Simple.Install</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-InstallDirs.html">Distribution.Simple.InstallDirs</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-JHC.html">Distribution.Simple.JHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-LHC.html">Distribution.Simple.LHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-LocalBuildInfo.html">Distribution.Simple.LocalBuildInfo</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-NHC.html">Distribution.Simple.NHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-PackageIndex.html">Distribution.Simple.PackageIndex</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.15.10.20" class="collapser" onclick="toggleSection('n.15.10.20')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-Simple-PreProcess.html">Distribution.Simple.PreProcess</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.10.20" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-PreProcess-Unlit.html">Distribution.Simple.PreProcess.Unlit</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><span id="control.n.15.10.21" class="collapser" onclick="toggleSection('n.15.10.21')">&nbsp;</span><a href="Cabal-1.18.1.3/Distribution-Simple-Program.html">Distribution.Simple.Program</a></span><span class="package">Cabal-1.18.1.3</span><ul id="section.n.15.10.21" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Ar.html">Distribution.Simple.Program.Ar</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Builtin.html">Distribution.Simple.Program.Builtin</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Db.html">Distribution.Simple.Program.Db</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Find.html">Distribution.Simple.Program.Find</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-GHC.html">Distribution.Simple.Program.GHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-HcPkg.html">Distribution.Simple.Program.HcPkg</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Hpc.html">Distribution.Simple.Program.Hpc</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Ld.html">Distribution.Simple.Program.Ld</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Run.html">Distribution.Simple.Program.Run</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Script.html">Distribution.Simple.Program.Script</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Program-Types.html">Distribution.Simple.Program.Types</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Register.html">Distribution.Simple.Register</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Setup.html">Distribution.Simple.Setup</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-SrcDist.html">Distribution.Simple.SrcDist</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Test.html">Distribution.Simple.Test</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-UHC.html">Distribution.Simple.UHC</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-UserHooks.html">Distribution.Simple.UserHooks</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Simple-Utils.html">Distribution.Simple.Utils</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-System.html">Distribution.System</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-TestSuite.html">Distribution.TestSuite</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Text.html">Distribution.Text</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Verbosity.html">Distribution.Verbosity</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><a href="Cabal-1.18.1.3/Distribution-Version.html">Distribution.Version</a></span><span class="package">Cabal-1.18.1.3</span></li></ul></li><li><span class="module"><span id="control.n.16" class="collapser" onclick="toggleSection('n.16')">&nbsp;</span><a href="base-4.7.0.1/Foreign.html">Foreign</a></span><span class="package">base</span><ul id="section.n.16" class="show"><li><span class="module"><span id="control.n.16.1" class="collapser" onclick="toggleSection('n.16.1')">&nbsp;</span><a href="base-4.7.0.1/Foreign-C.html">Foreign.C</a></span><span class="package">base</span><ul id="section.n.16.1" class="show"><li><span class="module"><a href="base-4.7.0.1/Foreign-C-Error.html">Foreign.C.Error</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-C-String.html">Foreign.C.String</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-C-Types.html">Foreign.C.Types</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Concurrent.html">Foreign.Concurrent</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.16.3" class="collapser" onclick="toggleSection('n.16.3')">&nbsp;</span><a href="base-4.7.0.1/Foreign-ForeignPtr.html">Foreign.ForeignPtr</a></span><span class="package">base</span><ul id="section.n.16.3" class="show"><li><span class="module"><a href="base-4.7.0.1/Foreign-ForeignPtr-Safe.html">Foreign.ForeignPtr.Safe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-ForeignPtr-Unsafe.html">Foreign.ForeignPtr.Unsafe</a></span><span class="package">base</span></li></ul></li><li><span class="module"><span id="control.n.16.4" class="collapser" onclick="toggleSection('n.16.4')">&nbsp;</span><a href="base-4.7.0.1/Foreign-Marshal.html">Foreign.Marshal</a></span><span class="package">base</span><ul id="section.n.16.4" class="show"><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Alloc.html">Foreign.Marshal.Alloc</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Array.html">Foreign.Marshal.Array</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Error.html">Foreign.Marshal.Error</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Pool.html">Foreign.Marshal.Pool</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Safe.html">Foreign.Marshal.Safe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Unsafe.html">Foreign.Marshal.Unsafe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Marshal-Utils.html">Foreign.Marshal.Utils</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Ptr.html">Foreign.Ptr</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Safe.html">Foreign.Safe</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-StablePtr.html">Foreign.StablePtr</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Foreign-Storable.html">Foreign.Storable</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/ForeignPtr.html">ForeignPtr</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span id="control.n.18" class="module collapser" onclick="toggleSection('n.18')">GHC</span><ul id="section.n.18" class="show"><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-CString.html">GHC.CString</a></span><span class="package">ghc-prim</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Char.html">GHC.Char</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.18.3" class="collapser" onclick="toggleSection('n.18.3')">&nbsp;</span><a href="base-4.7.0.1/GHC-Conc.html">GHC.Conc</a></span><span class="package">base</span><ul id="section.n.18.3" class="show"><li><span class="module"><a href="base-4.7.0.1/GHC-Conc-IO.html">GHC.Conc.IO</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Conc-Signal.html">GHC.Conc.Signal</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Conc-Sync.html">GHC.Conc.Sync</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/GHC-ConsoleHandler.html">GHC.ConsoleHandler</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Constants.html">GHC.Constants</a></span><span class="package">base</span></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-Debug.html">GHC.Debug</a></span><span class="package">ghc-prim</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Environment.html">GHC.Environment</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Event.html">GHC.Event</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Exts.html">GHC.Exts</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.18.10" class="collapser" onclick="toggleSection('n.18.10')">&nbsp;</span><a href="base-4.7.0.1/GHC-Fingerprint.html">GHC.Fingerprint</a></span><span class="package">base</span><ul id="section.n.18.10" class="show"><li><span class="module"><a href="base-4.7.0.1/GHC-Fingerprint-Type.html">GHC.Fingerprint.Type</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/GHC-Foreign.html">GHC.Foreign</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Generics.html">GHC.Generics</a></span><span class="package">base</span></li><li><span id="control.n.18.13" class="module collapser" onclick="toggleSection('n.18.13')">IO</span><ul id="section.n.18.13" class="show"><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Buffer.html">GHC.IO.Buffer</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-BufferedIO.html">GHC.IO.BufferedIO</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Device.html">GHC.IO.Device</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.18.13.4" class="collapser" onclick="toggleSection('n.18.13.4')">&nbsp;</span><a href="base-4.7.0.1/GHC-IO-Encoding.html">GHC.IO.Encoding</a></span><span class="package">base</span><ul id="section.n.18.13.4" class="show"><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-CodePage.html">GHC.IO.Encoding.CodePage</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-Failure.html">GHC.IO.Encoding.Failure</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-Latin1.html">GHC.IO.Encoding.Latin1</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-Types.html">GHC.IO.Encoding.Types</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-UTF16.html">GHC.IO.Encoding.UTF16</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-UTF32.html">GHC.IO.Encoding.UTF32</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Encoding-UTF8.html">GHC.IO.Encoding.UTF8</a></span><span class="package">base</span></li></ul></li><li><span class="module"><span id="control.n.18.13.5" class="collapser" onclick="toggleSection('n.18.13.5')">&nbsp;</span><a href="base-4.7.0.1/GHC-IO-Handle.html">GHC.IO.Handle</a></span><span class="package">base</span><ul id="section.n.18.13.5" class="show"><li><span class="module"><a href="base-4.7.0.1/GHC-IO-Handle-FD.html">GHC.IO.Handle.FD</a></span><span class="package">base</span></li></ul></li></ul></li><li><span class="module"><a href="base-4.7.0.1/GHC-IP.html">GHC.IP</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.18.15" class="collapser" onclick="toggleSection('n.18.15')">&nbsp;</span><a href="integer-gmp-0.5.1.0/GHC-Integer.html">GHC.Integer</a></span><span class="package">integer-gmp</span><ul id="section.n.18.15" class="show"><li><span id="control.n.18.15.1" class="module collapser" onclick="toggleSection('n.18.15.1')">GMP</span><ul id="section.n.18.15.1" class="show"><li><span class="module"><a href="integer-gmp-0.5.1.0/GHC-Integer-GMP-Internals.html">GHC.Integer.GMP.Internals</a></span><span class="package">integer-gmp</span></li></ul></li><li><span class="module"><a href="integer-gmp-0.5.1.0/GHC-Integer-Logarithms.html">GHC.Integer.Logarithms</a></span><span class="package">integer-gmp</span></li></ul></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-Magic.html">GHC.Magic</a></span><span class="package">ghc-prim</span></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-Prim.html">GHC.Prim</a></span><span class="package">ghc-prim</span></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-PrimopWrappers.html">GHC.PrimopWrappers</a></span><span class="package">ghc-pr/li
  ></ul
><p
>The guide itself is written as a &quot;literate&quot; Haskell file, meaning it is directly executable. That file is available when using the latter two options above.</p
><p
>The source is hosted at <a href="http://github.com/m4dc4p/cheatsheet/tree/master"
  >http://github.com/m4dc4p/cheatsheet/tree/master</a
  > and can be cloned from <tt>git://github.com/m4dc4p/cheatsheet.git</tt>.</p
><h1>¿Usted habla español?</h1>
<p
>Jaime Soffer was kind enough to translate the Haskell Cheatsheet into Spanish! Just download <a href="http://cloud.github.com/downloads/jsoffer/cheatsheet/CheatSheetEs.pdf"
  >CheatSheetEs.pdf</a
  > from his <a href="http://github.com/jsoffer/cheatsheet/downloads"
  >GitHub repository</a
  >.</p
><h1>Anata ha Nihongo wo hanashimasuka?</h1>
<p
>Yuji Ichikawa has translated the Haskell Cheatsheet into Japanese. Download it now: <a href="http://www.h3.dion.ne.jp/~y.ich/CheatSheet-ja.pdf"
  >CheatSheet-ja.pdf</a
  >.</p
></div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-81888-3");
pageTracker._trackPageview();
} catch(err) {}</script>
<script type="text/javascript" src="http://www.assoc-amazon.com/s/link-enhancer?tag=thehaskchea-20&o=1">
</script>

</body>
</html>
im</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Profiling.html">GHC.Profiling</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Stack.html">GHC.Stack</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-Stats.html">GHC.Stats</a></span><span class="package">base</span></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-Tuple.html">GHC.Tuple</a></span><span class="package">ghc-prim</span></li><li><span class="module"><a href="base-4.7.0.1/GHC-TypeLits.html">GHC.TypeLits</a></span><span class="package">base</span></li><li><span class="module"><a href="ghc-prim-0.3.1.0/GHC-Types.html">GHC.Types</a></span><span class="package">ghc-prim</span></li></ul></li><li><span id="control.n.19" class="module collapser" onclick="toggleSection('n.19')">Graphics</span><ul id="section.n.19" class="show"><li><span class="module"><span id="control.n.19.1" class="collapser" onclick="toggleSection('n.19.1')">&nbsp;</span><a href="Win32-2.3.0.2/Graphics-Win32.html">Graphics.Win32</a></span><span class="package">Win32-2.3.0.2</span><ul id="section.n.19.1" class="show"><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Control.html">Graphics.Win32.Control</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Dialogue.html">Graphics.Win32.Dialogue</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><span id="control.n.19.1.3" class="collapser" onclick="toggleSection('n.19.1.3')">&nbsp;</span><a href="Win32-2.3.0.2/Graphics-Win32-GDI.html">Graphics.Win32.GDI</a></span><span class="package">Win32-2.3.0.2</span><ul id="section.n.19.1.3" class="show"><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Bitmap.html">Graphics.Win32.GDI.Bitmap</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Brush.html">Graphics.Win32.GDI.Brush</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Clip.html">Graphics.Win32.GDI.Clip</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Font.html">Graphics.Win32.GDI.Font</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Graphics2D.html">Graphics.Win32.GDI.Graphics2D</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-HDC.html">Graphics.Win32.GDI.HDC</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Palette.html">Graphics.Win32.GDI.Palette</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Path.html">Graphics.Win32.GDI.Path</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Pen.html">Graphics.Win32.GDI.Pen</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Region.html">Graphics.Win32.GDI.Region</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-GDI-Types.html">Graphics.Win32.GDI.Types</a></span><span class="package">Win32-2.3.0.2</span></li></ul></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Icon.html">Graphics.Win32.Icon</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Key.html">Graphics.Win32.Key</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Menu.html">Graphics.Win32.Menu</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Message.html">Graphics.Win32.Message</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Misc.html">Graphics.Win32.Misc</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Resource.html">Graphics.Win32.Resource</a></span><span class="package">Win32-2.3.0.2</span></li><li><span class="module"><a href="Win32-2.3.0.2/Graphics-Win32-Window.html">Graphics.Win32.Window</a></span><span class="package">Win32-2.3.0.2</span></li></ul></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/IO.html">IO</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Int.html">Int</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Ix.html">Ix</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span id="control.n.23" class="module collapser" onclick="toggleSection('n.23')">Language</span><ul id="section.n.23" class="show"><li><span id="control.n.23.1" class="module collapser" onclick="toggleSection('n.23.1')">Haskell</span><ul id="section.n.23.1" class="show"><li><span class="module"><a href="Cabal-1.18.1.3/Language-Haskell-Extension.html">Language.Haskell.Extension</a></span><span class="package">Cabal-1.18.1.3</span></li><li><span class="module"><span id="control.n.23.1.2" class="collapser" onclick="toggleSection('n.23.1.2')">&nbsp;</span><a href="template-haskell-2.9.0.0/Language-Haskell-TH.html">Language.Haskell.TH</a></span><span class="package">template-haskell</span><ul id="section.n.23.1.2" class="show"><li><span class="module"><a href="template-haskell-2.9.0.0/Language-Haskell-TH-Lib.html">Language.Haskell.TH.Lib</a></span><span class="package">template-haskell</span></li><li><span class="module"><a href="template-haskell-2.9.0.0/Language-Haskell-TH-Ppr.html">Language.Haskell.TH.Ppr</a></span><span class="package">template-haskell</span></li><li><span class="module"><a href="template-haskell-2.9.0.0/Language-Haskell-TH-PprLib.html">Language.Haskell.TH.PprLib</a></span><span class="package">template-haskell</span></li><li><span class="module"><a href="template-haskell-2.9.0.0/Language-Haskell-TH-Quote.html">Language.Haskell.TH.Quote</a></span><span class="package">template-haskell</span></li><li><span class="module"><a href="template-haskell-2.9.0.0/Language-Haskell-TH-Syntax.html">Language.Haskell.TH.Syntax</a></span><span class="package">template-haskell</span></li></ul></li></ul></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/List.html">List</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Locale.html">Locale</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/MarshalAlloc.html">MarshalAlloc</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/MarshalArray.html">MarshalArray</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/MarshalError.html">MarshalError</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/MarshalUtils.html">MarshalUtils</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Maybe.html">Maybe</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Monad.html">Monad</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="base-4.7.0.1/Numeric.html">Numeric</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/Prelude.html">Prelude</a></span><span class="package">base</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Ptr.html">Ptr</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Random.html">Random</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Ratio.html">Ratio</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/StablePtr.html">StablePtr</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><a href="haskell98-2.0.0.3/Storable.html">Storable</a></span><span class="package">haskell98-2.0.0.3</span></li><li><span class="module"><span id="control.n.39" class="collapser" onclick="toggleSection('n.39')">&nbsp;</span><a href="haskell98-2.0.0.3/System.html">System</a></span><span class="package">haskell98-2.0.0.3</span><ul id="section.n.39" class="show"><li><span class="module"><a href="base-4.7.0.1/System-CPUTime.html">System.CPUTime</a></span><span class="package">base</span></li><li><span class="module"><a href="process-1.2.0.0/System-Cmd.html">System.Cmd</a></span><span class="package">process-1.2.0.0</span></li><li><span id="control.n.39.3" class="module collapser" onclick="toggleSection('n.39.3')">Console</span><ul id="section.n.39.3" class="show"><li><span class="module"><a href="base-4.7.0.1/System-Console-GetOpt.html">System.Console.GetOpt</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.39.3.2" class="collapser" onclick="toggleSection('n.39.3.2')">&nbsp;</span><a href="haskeline-0.7.1.2/System-Console-Haskeline.html">System.Console.Haskeline</a></span><span class="package">haskeline-0.7.1.2</span><ul id="section.n.39.3.2" class="show"><li><span class="module"><a href="haskeline-0.7.1.2/System-Console-Haskeline-Completion.html">System.Console.Haskeline.Completion</a></span><span class="package">haskeline-0.7.1.2</span></li><li><span class="module"><a href="haskeline-0.7.1.2/System-Console-Haskeline-History.html">System.Console.Haskeline.History</a></span><span class="package">haskeline-0.7.1.2</span></li><li><span class="module"><a href="haskeline-0.7.1.2/System-Console-Haskeline-IO.html">System.Console.Haskeline.IO</a></span><span class="package">haskeline-0.7.1.2</span></li><li><span class="module"><a href="haskeline-0.7.1.2/System-Console-Haskeline-MonadException.html">System.Console.Haskeline.MonadException</a></span><span class="package">haskeline-0.7.1.2</span></li></ul></li><li><span class="module"><span id="control.n.39.3.3" class="collapser" onclick="toggleSection('n.39.3.3')">&nbsp;</span><a href="terminfo-0.4.0.0/System-Console-Terminfo.html">System.Console.Terminfo</a></span><span class="package">terminfo-0.4.0.0</span><ul id="section.n.39.3.3" class="show"><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Base.html">System.Console.Terminfo.Base</a></span><span class="package">terminfo-0.4.0.0</span></li><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Color.html">System.Console.Terminfo.Color</a></span><span class="package">terminfo-0.4.0.0</span></li><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Cursor.html">System.Console.Terminfo.Cursor</a></span><span class="package">terminfo-0.4.0.0</span></li><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Edit.html">System.Console.Terminfo.Edit</a></span><span class="package">terminfo-0.4.0.0</span></li><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Effects.html">System.Console.Terminfo.Effects</a></span><span class="package">terminfo-0.4.0.0</span></li><li><span class="module"><a href="terminfo-0.4.0.0/System-Console-Terminfo-Keys.html">System.Console.Terminfo.Keys</a></span><span class="package">terminfo-0.4.0.0</span></li></ul></li></ul></li><li><span class="module"><a href="directory-1.2.1.0/System-Directory.html">System.Directory</a></span><span class="package">directory-1.2.1.0</span></li><li><span class="module"><a href="base-4.7.0.1/System-Environment.html">System.Environment</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/System-Exit.html">System.Exit</a></span><span class="package">base</span></li><li><span class="module"><span id="control.n.39.7" class="collapser" onclick="toggleSection('n.39.7')">&nbsp;</span><a href="filepath-1.3.0.2/System-FilePath.html">System.FilePath</a></span><span class="package">filepath-1.3.0.2</span><ul id="section.n.39.7" class="show"><li><span class="module"><a href="filepath-1.3.0.2/System-FilePath-Posix.html">System.FilePath.Posix</a></span><span class="package">filepath-1.3.0.2</span></li><li><span class="module"><a href="filepath-1.3.0.2/System-FilePath-Windows.html">System.FilePath.Windows</a></span><span class="package">filepath-1.3.0.2</span></li></ul></li><li><span class="module"><span id="control.n.39.8" class="collapser" onclick="toggleSection('n.39.8')">&nbsp;</span><a href="base-4.7.0.1/System-IO.html">System.IO</a></span><span class="package">base</span><ul id="section.n.39.8" class="show"><li><span class="module"><a href="base-4.7.0.1/System-IO-Error.html">System.IO.Error</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/System-IO-Unsafe.html">System.IO.Unsafe</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="base-4.7.0.1/System-Info.html">System.Info</a></span><span class="package">base</span></li><li><span class="module"><a href="old-locale-1.0.0.6/System-Locale.html">System.Locale</a></span><span class="package">old-locale-1.0.0.6</span></li><li><span class="module"><span id="control.n.39.11" class="collapser" onclick="toggleSection('n.39.11')">&nbsp;</span><a href="base-4.7.0.1/System-Mem.html">System.Mem</a></span><span class="package">base</span><ul id="section.n.39.11" class="show"><li><span class="module"><a href="base-4.7.0.1/System-Mem-StableName.html">System.Mem.StableName</a></span><span class="package">base</span></li><li><span class="module"><a href="base-4.7.0.1/System-Mem-Weak.html">System.Mem.Weak</a></span><span class="package">base</span></li></ul></li><li><span class="module"><span id="control.n.39.12" class="collapser" onclick="toggleSection('n.39.12')">&nbsp;</span><a href="unix-2.7.0.1/System-Posix.html">System.Posix</a></span><span class="package">unix-2.7.0.1</span><ul id="section.n.39.12" class="show"><li><span class="module"><span id="control.n.39.12.1" class="collapser" onclick="toggleSection('n.39.12.1')">&nbsp;</span><a href="unix-2.7.0.1/System-Posix-ByteString.html">System.Posix.ByteString</a></span><span class="package">unix-2.7.0.1</span><ul id="section.n.39.12.1" class="show"><li><span class="module"><a href="unix-2.7.0.1/System-Posix-ByteString-FilePath.html">System.Posix.ByteString.FilePath</a></span><span class="package">unix-2.7.0.1</span></li></ul></li><li><span class="module"><span id="control.n.39.12.2" class="collapser" onclick="toggleSection('n.39.12.2')">&nbsp;</span><a href="unix-2.7.0.1/System-Posix-Directory.html">System.Posix.Directory</a></span><span class="package">unix-2.7.0.1</span><ul id="section.n.39.12.2" class="show"><li><span class="module"><a href="unix-2.7.0.1/System-Posix-Directory-ByteString.html">System.Posix.Directory.ByteString</a></span><span class="package">unix-2.7.0.1</span></li></ul></li><li><span class="module"><span id="control.n.39.12.3" class="collapser" onclick="toggleSection('n.39.12.3')">&nbsp;</span><a href="unix-2.7.0.1/System-Posix-DynamicLinker.html">System.Posix.DynamicLinker</a></span><span class="package">unix-2.7.0.1</spasily create their own graphical modeling workbenches by leveraging the Eclipse modeling technologies, including <a href="/emf">Eclipse Modeling Framework (EMF)</a> and <a href="/gmf/">Graphical Modeling Framework (GMF)</a>. <a href="/ecoretools/">EcoreTools</a>, the graphical modeler for Ecore, has been completely re-implemented based on Sirius.</li>
			  </ul>
	    </div>
		</div>
		<p><a href="/home" class="btn btn-warning">Go to Eclipse.org</a></p><br/><br/>
  </div>

  <div class="col-md-8 col-md-offset-1">
    <div style="text-align: center;padding:25px 0;">
      <h3>Become a <span class="fw-600">Friend of Eclipse</span></h3>
      <p><a href="/donate" class="btn btn-warning">Donate now</a></p>
    </div>
	  <div class="block-box">
		 <h3><i class="fa fa-twitter"></i>  Recent <span class="fw-700">#eclipseluna</span> tweets</h3>
		   <div class="content">
	     <a class="twitter-timeline"  href="https://twitter.com/search?q=%23eclipseluna"  data-widget-id="470988115096510464" data-chrome="noheader noscrollbar transparent">Tweets about "#eclipseluna"</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	     </div>
		  </div>
	  </div>
  </div>
</div>
      </div>
    </main> <!-- /#main-content-container-row -->
    <p id="back-to-top">
      <a class="visible-xs" href="#top">Back to the top</a>
    </p>
    <footer role="contentinfo" id="solstice-footer">

      <div class="container">

        <div class="row">
          <section id="footer-eclipse-foundation" class="col-xs-offset-1 col-xs-11 col-sm-7 col-md-6 col-md-offset-0 hidden-print">
            <h2 class="section-title">Eclipse Foundation</h2>
            <ul class="nav">
              <li><a href="http://www.eclipse.org/org/">About us</a></li>
              <li><a href="http://www.eclipse.org/org/foundation/contact.php">Contact Us</a></li>
              <li><a href="http://www.eclipse.org/donate">Donate</a></li>
              <li><a href="http://www.eclipse.org/org/documents/">Governance</a></li>
              <li><a href="http://www.eclipse.org/artwork/">Logo and Artwork</a></li>
              <li><a href="http://www.eclipse.org/org/foundation/directors.php">Board of Directors</a></li>
            </ul>
          </section>
          <section id="footer-legal" class="col-xs-offset-1 col-xs-11 col-sm-7 col-md-6 col-md-offset-0 hidden-print ">
            <h2 class="section-title">Legal</h2>
            <ul class="nav">
              <li><a href="http://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
              <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
              <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
              <li><a href="http://www.eclipse.org/org/documents/epl-v10.php">Eclipse Public License </a></li>
              <li><a href="http://www.eclipse.org/legal/">Legal Resources </a></li>

            </ul>
          </section>

          <section id="footer-useful-links" class="col-xs-offset-1 col-xs-11 col-sm-7 col-md-6 col-md-offset-0 hidden-print">
            <h2 class="section-title">Useful Links</h2>
            <ul class="nav">
              <li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li>
              <li><a href="//help.eclipse.org/">Documentation</a></li>
              <li><a href="http://www.eclipse.org/contribute/">How to Contribute</a></li>
              <li><a href="http://www.eclipse.org/mail/">Mailing Lists</a></li>
              <li><a href="http://www.eclipse.org/forums/">Forums</a></li>
              <li><a href="//marketplace.eclipse.org">Marketplace</a></li>
            </ul>
          </section>

          <section id="footer-other" class="col-xs-offset-1 col-xs-11 col-sm-7 col-md-6 col-md-offset-0 hidden-print">

            <h2 class="section-title">Other</h2>
            <ul class="nav">
               <li><a href="http://www.eclipse.org/ide/">IDE and Tools</a></li>
              <li><a href="http://www.eclipse.org/projects">Community of Projects</a></li>
              <li><a href="http://www.eclipse.org/org/workinggroups/">Working Groups</a></li>
            </ul>

            <ul class="list-inline social-media">
              <li><a href="https://twitter.com/EclipseFdn"><i class="fa fa-twitter-square"></i></a></li>
              <li><a href="https://plus.google.com/+Eclipse"><i class="fa fa-google-plus-square"></i></a></li>
              <li><a href="https://www.facebook.com/eclipse.org"><i class="fa fa-facebook-square"></i> </a></li>
              <li><a href="https://www.youtube.com/user/EclipseFdn"><i class="fa fa-youtube-square"></i></a></li>
            </ul>

          </section>
          <div id="copyright"  class="col-xs-offset-1 col-sm-14 col-md-24 col-md-offset-0">
            <div>
              <span class="hidden-print"><img src="/eclipse.org-common/themes/solstice/public/images/logo/eclipse-logo-bw-800x188.png" alt="Eclipse.org black and white logo" width="166" height="39" id="logo-eclipse-white"/></span>
              <p id="copyright-text">Copyright &copy; 2014 The Eclipse Foundation. All Rights Reserved.</p>
            </div>
          </div>
        <a href="#" class="scrollup">Back to the top</a>
        </div>
      </div>
    </footer>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/eclipse.org-common/themes/solstice/public/javascript/main.min.js"></script>
        <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=searchbox_017941334893793413703%3Asqfrdtd112s&amp;lang=en"></script>
          <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-910670-2']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

      </script>
  </body>
</html>
 mulating the economy in a demand slump other than borrowing pounds from somewhere outside the country, rendering themselves in debt beyond their means.  And this will become an excuse for dismantling the social system that has been so important to elevating the Scots from poverty to a decent standard of living within one or two generations.  Just look at the poor PIGS in the Euro-zone being pushed around by Germany, especially, to satisfy the conveniences of the German bankers, and to hell with the living, breathing souls in Greece or Spain or Ireland or Portugal, to name the canonical victims.</p>
<p>A country that does not control its own currency is not independent and cannot be independent.  It’s an illusion.  Just what are Salmond’s true intentions are not entirely clear to me, but on the basis of his monetary policies alone, I implore my Scottish friends to suppress the natural wish to make a statement of pride, and instead do the sensible thing.  The proposal to be voted on this week is not a spittle on the  Heart of Midlothian, it is an irrevocable decision to place Scotland in an even worse position with respect to England than it already is in.</p>
<p>Listen to reason.  Vote NO on independence.</p><br />Filed under: <a href="http://existentialtype.wordpress.com/category/research/">Research</a> Tagged: <a href="http://existentialtype.wordpress.com/tag/scottish-referendum/">Scottish referendum</a> <a href="http://feeds.wordpress.com/1.0/gocomments/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/godelicious/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/delicious/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/gofacebook/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/facebook/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/gotwitter/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/twitter/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/gostumble/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/stumble/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/godigg/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/digg/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <a href="http://feeds.wordpress.com/1.0/goreddit/existentialtype.wordpress.com/998/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/reddit/existentialtype.wordpress.com/998/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=existentialtype.wordpress.com&amp;blog=2157150&amp;post=998&amp;subd=existentialtype&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://existentialtype.wordpress.com/2014/09/15/scotland-vote-no/">by Robert Harper at September 15, 2014 04:05 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://ghc.haskell.org/trac/ghc/blog" title="GHC - Blog">The GHC Team</a></h3>

<div class="entrygroup" id="http://ghc.haskell.org/trac/ghc/blog/weekly20140915">
<blockquote>
<h1 class="entry"><a href="http://ghc.haskell.org/trac/ghc/blog/weekly20140915">GHC Weekly News - 2014/09/15</a></h1>
<div class="entry">
<p>
Hi *,
</p>
<p>
Here's a new thing: Blog posts! That's right. A while back, we started a new set of emails on the developers list containing weekly updates, from GHC HQ. But we eventually decided it should be more broad and encompass the work GHC sees as a project - including all the things our contributors do.
</p>
<p>
So now it's the weekly GHC news - and we (or, well, I) have decided to blogify the weekly emails!
</p>
<p>
So without further adieu, here's the current recap. The original mailing list copy is available <a href="https://www.haskell.org/pipermail/ghc-devs/2014-September/006309.html" class="ext-link"><span class="icon">​</span>here</a>.
</p>
<ul><li>As Gabor mentioned on the list earlier today, I (Austin) accidentally broke the Windows build. Sorry. :( We really need to get Phab building Windows too ASAP... I'm working on a fix this morning.
</li></ul><ul><li>I sent out the HCAR draft this morning. Please edit it! I think we have a few weeks of lead time however, so we're not in a rush like last time. But I will send reminders. :)
</li></ul><ul><li>The server migration for ghc.haskell.org seems to have gone pretty smoothly in the past week. It's had plenty of traffic so far. The full migration is still ongoing and I want to complete it this week.
</li></ul><ul><li>I've finished reorganizing some of the Git and Repository pages after some discussion. We now have the Repositories[1] page, linked to on the left side, which details some notes on the repositories we use, and links to other various pages. I'm thinking of replacing this side-bar "root" with a link to the main Git[2] page, perhaps.
</li></ul><ul><li>Miscellaneous: ghc.haskell.org and phabricator.haskell.org now sets the <tt>Strict-Transport-Security</tt> header. This just means you always use SSL now when you visit those pages (so you can't be connection-hijacked via a 503 redirect).
</li></ul><ul><li>I'm merging some patches at the moment, although the windows fix is currently what I'll push first: <a href="https://phabricator.haskell.org/D205" class="ext-link" title="D205 in Phab"><span class="icon">​</span>Phab:D205</a>, <a href="https://phabricator.haskell.org/D204" class="ext-link" title="D204 in Phab"><span class="icon">​</span>Phab:D204</a>, <a href="https://phabricator.haskell.org/D203" class="ext-link" title="D203 in Phab"><span class="icon">​</span>Phab:D203</a>, <a href="https://phabricator.haskell.org/D199" class="ext-link" title="D199 in Phab"><span class="icon">​</span>Phab:D199</a>, <a href="https://phabricator.haskell.org/D194" class="ext-link" title="D194 in Phab"><span class="icon">​</span>Phab:D194</a>, <a href="https://phabricator.haskell.org/D179" class="ext-link" title="D179 in Phab"><span class="icon">​</span>Phab:D179</a>, <a href="https://phabricator.haskell.org/D174" class="ext-link" title="D174 in Phab"><span class="icon">​</span>Phab:D174</a>. Do let me know if there's anything you want me to look at.
</li></ul><ul><li>GHC works on Wine apparently for all you Linux users - thanks Mikolaj![3]
</li></ul><ul><li>Jan had some questions about infrastructure which I just followed up on this morning. In particular: does anyone feel strongly about his first question?[4]
</li></ul><ul><li>Herbert committed the first part of the Traversable/Foldable changes, by moving the typeclasses to Prelude. This is part of an ongoing series of patches. Things like adding Bifunctor will finally come after this.[5]
</li></ul><p>
Also, added bonus: we'll start including some of the tickets we closed
this week.
</p>
<p>
Closed tickets for the past week include: <a href="http://ghc.haskell.org/trac/ghc/ticket/9585" class="closed ticket" title="bug: Note about semantics of (!!) is not specific enough, if it's correct (closed: fixed)">#9585</a>, <a href="http://ghc.haskell.org/trac/ghc/ticket/9545" class="closed ticket" title="task: Evaluate Takano Akio's foldrW/buildW fusion framework as a possible ... (closed: wontfix)">#9545</a>, <a href="http://ghc.haskell.org/trac/ghc/ticket/9581" class="closed ticket" title="bug: Parse error in multiline case expression inside let inside do block (closed: invalid)">#9581</a>, <a href="http://ghc.haskell.org/trac/ghc/ticket/6086" class="closed ticket" title="bug: Cross compilation fails using system linker for other architecture ... (closed: fixed)">#6086</a>, <a href="http://ghc.haskell.org/trac/ghc/ticket/9558" class="closed ticket" title="bug: ">#9558</a>, and <a href="http://ghc.haskell.org/trac/ghc/ticket/3658" class="closed ticket" title="task: Dynamically link GHCi (and use system linker) on platforms that support it (closed: fixed)">#3658</a>.
</p>
<p>
Please let me know if you have any questions.
</p>
<p>
[1] <a href="https://ghc.haskell.org/trac/ghc/wiki/Repositories" class="ext-link"><span class="icon">​</span>https://ghc.haskell.org/trac/ghc/wiki/Repositories</a> <br />
[2] <a href="https://ghc.haskell.org/trac/ghc/wiki/WorkingConventions/Git" class="ext-link"><span class="icon">​</span>https://ghc.haskell.org/trac/ghc/wiki/WorkingConventions/Git</a> <br />
[3] <a href="https://www.haskell.org/pipermail/ghc-devs/2014-September/006283.html" class="ext-link"><span class="icon">​</span>https://www.haskell.org/pipermail/ghc-devs/2014-September/006283.html</a> <br />
[4] <a href="https://www.haskell.org/pipermail/ghc-devs/2014-September/006275.html" class="ext-link"><span class="icon">​</span>https://www.haskell.org/pipermail/ghc-devs/2014-September/006275.html</a> <br />
[5] <a href="https://phabricator.haskell.org/D209" class="ext-link"><span class="icon">​</span>https://phabricator.haskell.org/D209</a>
</p></div>






<p class="date">
<a href="http://ghc.haskell.org/trac/ghc/blog/weekly20140915">by thoughtpolice at September 15, 2014 01:47 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://izbicki.me" title="Mike Izbicki's blog posts">Mike Izbicki</a></h3>

<div class="entrygroup" id="http://izbicki.me/blog/avl-tree-runtimes-c%2B%2B-vs-haskell.html">
<blockquote>
<h1 class="entry"><a href="http://izbicki.me/blog/avl-tree-runtimes-c%2B%2B-vs-haskell.html">Comparing AVL Trees in C++ and Haskell</a></h1>
<div class="entry">
<h1>Comparing AVL Trees in C++ and Haskell</h1>
<div class="info">
    
        posted on 2014-09-15
    
    
        by <a href="https://github.com/cheripai">Dat Do</a>
    
</div>

<p>This post compares the runtimes of <a href="https://en.wikipedia.org/wiki/AVL_tree">AVL tree</a> operations in C++ vs Haskell. In particular, we insert 713,000 strings from a file into an AVL Tree. This is a <span class="math">\(O(n \log n)\)</span> operation. But we want to investigate what the constant factor looks like in different situations.</p>
<p><strong>Experimental setup:</strong> All the code for these tests is available in the <a href="https://github.com/CheriPai/AVLComparison">github repository</a>. The C++ AVL tree was created in a data structures course that I took recently and the Haskell AVL tree is from the Haskell library <a href="http://hackage.haskell.org/package/AvlTree-4.2/docs/Data-Tree-AVL.html"><code>Data.Tree.AVL</code></a>. Additionally, the Haskell code stores the strings as <code>ByteString</code>s because they are much more efficient than the notoriously slow <code>String</code>. To see how the runtime is affected by files of different sizes, the file was first partitioned into 10 segments. The first segment has 71,300 words, the second 71,300 * 2 words, and so on. Both the C++ and Haskell programs were compiled with the <code>-O2</code> flag for optimization. The test on each segment is the average runtime of three separate runs.</p>
<p>Here’s the results:</p>
<div class="figure">
<img src="https://izbicki.me/blog/category/img/CvsH.png" alt="C++vHaskell" /><p class="caption">C++vHaskell</p>
</div>
<p>C++ is a bit faster than Haskell on the last partition for this test.</p>
<p>I guess this is because Haskell operates on immutable data. Every time a new element is to be inserted into the Haskell AVL tree, new parent nodes must be created because the old parent nodes cannot be changed. This creates quite a bit of overhead. C++ on the other hand, does have mutable data and can simply change the node that a parent node is pointing to. This is faster than making a whole new copy like the Haskell code does.</p>
<p><em>Is there an easy way to speed up our Haskell code?</em></p>
<p>There is a Haskell library called <a href="http://hackage.haskell.org/package/parallel-2.2.0.1/docs/Control-Parallel.html"><code>parallel</code></a> that makes parallel computations really convenient. We’ll try to speed up our program with this library.</p>
<p>You might think that it is unfair to compare multithreaded Haskell against C++ that is not multithreaded. And you’re absolutely right! But let’s be honest, manually working with <a href="http://linux.die.net/man/7/pthreads"><code>pthreads</code></a> in C++ is quite the headache, but parallism in Haskell is super easy.</p>
<p>Before we look at the results, let’s look at the parallelized code. What we do is create four trees each with a portion of the set of strings. Then, we call <code>par</code> on the trees so that the code is parallelized. Afterwards, we union the trees to make them a single tree. Finally, we call <code>deepseq</code> so that the code is evaluated.</p>
<pre><code>{-# LANGUAGE TemplateHaskell #-}
import Control.DeepSeq.TH
import Control.Concurrent
import Data.Tree.AVL as A
import Data.COrdering
import System.CPUTime
import qualified Data.ByteString.Char8 as B
import Control.DeepSeq
import Data.List.Split
import System.Environment
import Control.Parallel

$(deriveNFData ''AVL)

-- Inserts elements from list into AVL tree
load :: AVL B.ByteString -&gt; [B.ByteString] -&gt; AVL B.ByteString
load t [] = t
load t (x:xs) = A.push (fstCC x) x (load t xs)


main = do
    args &lt;- getArgs
    contents &lt;- fmap B.lines $ B.readFile $ args !! 0
    let l = splitEvery (length contents `div` 4) contents
    deepseq contents $ deepseq l $ return ()
    start &lt;- getCPUTime

    -- Loading the tree with the subpartitions
    let t1 = load empty $ l !! 0
    let t2 = load empty $ l !! 1
    let t3 = load empty $ l !! 2
    let t4 = load empty $ l !! 3
    let p = par t1 $ par t2 $ par t3 t4

    -- Calling union to combine the trees
    let b = union fstCC t1 t2
    let t = union fstCC t3 t4
    let bt = union fstCC b t
    let bt' = par b $ par t bt
    deepseq p $ deepseq bt' $ return ()

    end &lt;- getCPUTime
    n &lt;- getNumCapabilities
    let diff = ((fromIntegral (end-start)) / (10^12) / fromIntegral n)
    putStrLn $ show diff</code></pre>
<p>Great, so now that the Haskell code has been parallelized, we can compile and run the program again to see the difference. To compile for parallelism, we must use some special flags.</p>
<pre><code>ghc –O2 filename -rtsopts –threaded</code></pre>
<p>And to run the program (<code>-N4</code> refers to the number of cores).</p>
<pre><code>./filename +RTS –N4</code></pre>
<div class="figure">
<img src="https://izbicki.me/blog/category/img/CvsH4.png" alt="C++vHaskell4" /><p class="caption">C++vHaskell4</p>
</div>
<p>Haskell now gets better runtimes than C++.</p>
<p>Now that we know Haskell is capable of increasing its speeds through parallelism, it would be interesting to see how the runtime is affected by the degree of parallelism.</p>
<p>According to <a href="http://en.wikipedia.org/wiki/Amdahl%27s_law">Amdahl’s law</a>, a program that is 100% parallelized will see a proportional speed up based on the number of threads of execution. For example, if a program that is 100% parallelized takes 2 seconds to run on 1 thread, then it should take 1 second to run using 2 threads. The code used for our test, however, is not 100% parallelized since there a union operation performed at the end to combine the trees created by the separate threads. The union of the trees is a <span class="math">\(O(n)\)</span> operation while the insertion of the strings into the AVL tree is a <span class="math">\(O\left(\frac{n \log n }{p}\right)\)</span> operation, where <span class="math">\(p\)</span> is the number of threads. Therefore, the runtime for our test should be</p>
<p><span class="math">\[O\left(\frac{n\log{n}}{p} + n\right)\]</span></p>
<p>Here is a graph showing the runtime of the operation on the largest set (713,000 strings) across increasing levels of parallelism.</p>
<div class="figure">
<img src="https://izbicki.me/blog/category/img/HParallelism.png" alt="HaskellParallelization" /><p class="caption">HaskellParallelization</p>
</div>
<p>Taking a look at the resul></li><li><span id="control.n.43" class="module collapser" onclick="toggleSection('n.43')">Unsafe</span><ul id="section.n.43" class="show"><li><span class="module"><a href="base-4.7.0.1/Unsafe-Coerce.html">Unsafe.Coerce</a></span><span class="package">base</span></li></ul></li><li><span class="module"><a href="haskell98-2.0.0.3/Word.html">Word</a></span><span class="package">haskell98-2.0.0.3</span></li></ul></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>ts, we can see that the improvement in runtime does not fit the 100% parallelized theoretical model, but does follow it to some extent. Rather than the 2 core runtime being 50% of the 1 core runtime, the 2 core runtime is 56% of the 1 core runtime, with decreasing efficiency as the number of cores increases. Though, it is clear that there are significant improvements in speed through the use of more processor cores and that parallelism is an easy way to get better runtime speeds with little effort.</p></div>






<p class="date">
<a href="http://izbicki.me/blog/avl-tree-runtimes-c%2B%2B-vs-haskell.html">September 15, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 14, 2014</h2>

<div class="channelgroup">







<h3><a href="http://wadler.blogspot.com/" title="Wadler's Blog">Philip Wadler</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-9757377.post-4093290279726999660">
<blockquote>
<h1 class="entry"><a href="http://wadler.blogspot.com/2014/09/the-british-biased-corporation.html">The British Biased Corporation</a></h1>
<div class="entry">
Scandalous! Nick Robinson asks Alex Salmond a question, and Salmond takes seven minutes to answer in detail.<br /><br /><center>&lt;iframe allowfullscreen="" frameborder="0" height="315" src="http://www.youtube.com/embed/rHmLb-RIbrM" width="560"&gt;&lt;/iframe&gt;</center><br /><br />On the evening news, Nick Robinson summarises Salmond's answer in a few seconds as 'He didn't answer'.<br /><br /><center>&lt;iframe allowfullscreen="" frameborder="0" height="259" src="http://www.youtube.com/embed/enrdDaf3uss" width="460"&gt;&lt;/iframe&gt;</center><br />(Above spotted via <a href="http://www.arcofprosperity.org/the-better-together-broadcasting-corporation/">Arc of Prosperity</a>.)<br /><br />And today, this.<br /><div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-HidK8HFEWbU/VBYNqZQWGxI/AAAAAAAAMds/L1QfHvoRXFY/s1600/bbcbias.tiff"><img width="640" src="http://3.bp.blogspot.com/-HidK8HFEWbU/VBYNqZQWGxI/AAAAAAAAMds/L1QfHvoRXFY/s1600/bbcbias.tiff" border="0" height="616" /></a></div>I used to be a supporter of the BBC, but it's getting harder and harder to justify.</div>






<p class="date">
<a href="http://wadler.blogspot.com/2014/09/the-british-biased-corporation.html">by Philip Wadler (noreply@blogger.com) at September 14, 2014 10:01 PM</a>
</p>
</blockquote>
</div>



<div class="entrygroup" id="tag:blogger.com,1999:blog-9757377.post-8376378768845102308">
<blockquote>
<h1 class="entry"><a href="http://wadler.blogspot.com/2014/09/krugman-vs-stiglitz-now-with-added.html">Krugman vs. Stiglitz, now with added Stiglitz</a></h1>
<div class="entry">
<div class="tr_bq"><div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-Bi0xwoUtCFk/VBSEnxAjw3I/AAAAAAAAMcA/4BXomzTz29s/s1600/krugman.jpg"><img width="213" src="http://3.bp.blogspot.com/-Bi0xwoUtCFk/VBSEnxAjw3I/AAAAAAAAMcA/4BXomzTz29s/s1600/krugman.jpg" border="0" height="320" /></a><a style="margin-left: 1em; margin-right: 1em;" href="http://1.bp.blogspot.com/-cFdUbFraoqE/VBSEpwuz-eI/AAAAAAAAMcI/-SaOrdzqTFE/s1600/stiglitz.jpg"><img width="239" src="http://1.bp.blogspot.com/-cFdUbFraoqE/VBSEpwuz-eI/AAAAAAAAMcI/-SaOrdzqTFE/s1600/stiglitz.jpg" border="0" height="320" /></a></div><span style="font-family: Arial, Helvetica, sans-serif;">My <a href="http://wadler.blogspot.co.uk/2014/09/krugman-vs-stiglitz.html">last post quoted</a> Joe Stiglitz, indirectly, to refute Paul Krugman's fear mongering. Now the man himself has spoken in the <a href="http://www.heraldscotland.com/comment/columnists/there-is-no-basis-for-this-scaremongering-but-this-is-not-just-about-money.25313968">Sunday Herald</a>.</span></div><blockquote class="tr_bq"><div style="background-color: white; clear: both; color: #333333; margin: 12px 0px 0px;" id="article-abstract"><span style="font-family: Arial, Helvetica, sans-serif;">As Scotland contemplates independence, some, such as Paul Krugman, have questioned the "economics".<br /><br />Would Scotland, going it alone, risk a decline in standards of living or a fall in GDP? There are, to be sure, risks in any course of action: should Scotland stay in the UK, and the UK leave the EU, the downside risks are, by almost any account, significantly greater. If Scotland stays in the UK, and the UK continues in its policies which have resulted in growing inequality, even if GDP were slightly larger, the standards of living of most Scots could fall.<br /><br />Cutbacks in UK public support to education and health could force Scotland to face a set of unpalatable choices - even with Scotland having considerable discretion over what it spends its money on.<br /><br />But there is, in fact, little basis for any of the forms of fear-mongering that have been advanced. Krugman, for instance, suggests that there are significant economies of scale: a small economy is likely, he seems to suggest, not to do well. But an independent Scotland will still be part of Europe, and the great success of the EU is the creation of a large economic zone.<br /><br />Besides, small political entities, like Sweden, Singapore, and Hong Kong have prospered, while much larger entities have not. By an order of magnitude, far more important is pursuit of the right policies.<br /><br />Another example of a non-issue is the currency. There are many currency arrangements that would work. Scotland could continue using sterling - with or without England's consent.<br /><br />Because the economies of England and Scotland are so similar, a common currency is likely to work far better than the euro - even without shared fiscal policy. But many small countries have managed to have a currency of their own - floating, pegged, or "managed."</span></div></blockquote><div style="background-color: white; color: #333333; font-family: Georgia, 'Times New Roman', serif; font-size: 12px; margin: 0px 0px 40px;" class="body-content"><div style="margin: 0px;" id="videoHolder"></div></div></div>






<p class="date">
<a href="http://wadler.blogspot.com/2014/09/krugman-vs-stiglitz-now-with-added.html">by Philip Wadler (noreply@blogger.com) at September 14, 2014 06:13 PM</a>
</p>
</blockquote>
</div>



<div class="entrygroup" id="tag:blogger.com,1999:blog-9757377.post-6335989815168919226">
<blockquote>
<h1 class="entry"><a href="http://wadler.blogspot.com/2014/09/dinna-fash-yersel-scotland-will-dae.html">Dinna fash yersel — Scotland will dae juist fine!</a></h1>
<div class="entry">
<div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://4.bp.blogspot.com/-JwmX6V2KBN4/VBXQQd8xITI/AAAAAAAAMcU/d3tMxmFZhOQ/s1600/whisky.jpg"><img width="400" src="http://4.bp.blogspot.com/-JwmX6V2KBN4/VBXQQd8xITI/AAAAAAAAMcU/d3tMxmFZhOQ/s1600/whisky.jpg" border="0" height="263" /></a></div><span style="font-family: Arial, Helvetica, sans-serif;">One relentless lie behind 'No' is that Scotland is too wee to make it on its own, counterexamples such as Denmark, Sweden, Singapore, and Hong Kong being conveniently ignored. May this <a href="http://www.arcofprosperity.org/dinna-fash-yersel-scotland-will-dae-juist-fine/">post</a> from Thomas Widmann, a Dane residing in Scotland, help to dispel the disinformation. </span><br /><blockquote class="tr_bq"><span style="font-family: Arial, Helvetica, sans-serif;">Pick a random person from somewhere on this planet. Ask them to name an alcoholic drink from Scotland, and it’s very likely they’ll reply “Whisky”. Ask them to name one from Denmark, and they’ll probably be tongue-tied. (They could answer “Gammel Dansk” or “Akvavit”, but they’re just not nearly as famous as whisky.)</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Now repeat the exercise, but ask about a food item. Again, it’s likely they’ll have heard of haggis but that they’ll be struggling to name anything from Denmark.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Now try a musical instrument. Bagpipes and … sorry, cannot think of a Danish one.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">A sport? Scotland has golf, of course. Denmark can perhaps claim ownership of handball, but it’s not associated with Denmark in the way that golf makes everybody think of Scotland.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">A piece of clothing? Everybody knows the kilt, but I’d be very surprised if anybody can name one from Denmark.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">A monster? Everybody knows what’s lurking in Loch Ness, but is there anything scary in Denmark?</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">The only category where Denmark perhaps wins is toys, where Lego surely is more famous than anything from Scotland (but many people don’t know Lego is from Denmark).</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Denmark is also well-known for butter and bacon, of course, but these aren’t Danish in origin or strongly associated with Denmark in people’s minds.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Several famous writers and philosophers were Danish (e.g., Hans Christian Andersen and Søren Kierkegaard), but Scotland can arguably list more names of the same calibre, and the Scottish ones wrote in English, which makes them much more accessible to the outside world.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Scottish universities are also ranked better than the Danish ones in recent World rankings.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Finally, Scotland has lots of oil and wind, water and waves. Denmark has some, but not nearly as much, and most other countries have less than Denmark.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Because of all of this, I don’t worry about the details when it comes to Scottish independence. If Denmark can be one of the richest countries on the planet, of course Scotland can be one too.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Yes, there might be a few tough years while the rUK are in a huff and before everything has been sorted out. And of course there will be occasional crises in the future, like in any other country.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">However, unless you subscribe to the school that Denmark and other small countries like Norway and Switzerland are complete failures because they don’t have nuclear weapons and a permanent seat on the UN’s Security Council, there’s simply no reason to assume Scotland won’t do exceptionally well as an independent country in the longer term.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">So I’m not worried. Of course there are many details to sort out, but at the end of the day everything will be fine. Scotland will be a hugely successful independent country. Dinna fash yersel! </span></blockquote></div>






<p class="date">
<a href="http://wadler.blogspot.com/2014/09/dinna-fash-yersel-scotland-will-dae.html">by Philip Wadler (noreply@blogger.com) at September 14, 2014 06:13 PM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 13, 2014</h2>

<div class="channelgroup">







<h3><a href="http://wadler.blogspot.com/" title="Wadler's Blog">Philip Wadler</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-9757377.post-6004121762373834347">
<blockquote>
<h1 class="entry"><a href="http://wadler.blogspot.com/2014/09/krugman-vs-stiglitz.html">Krugman vs Stiglitz</a></h1>
<div class="entry">
<div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-Bi0xwoUtCFk/VBSEnxAjw3I/AAAAAAAAMb8/oGB7o1NDkSE/s1600/krugman.jpg"><img width="213" src="http://3.bp.blogspot.com/-Bi0xwoUtCFk/VBSEnxAjw3I/AAAAAAAAMb8/oGB7o1NDkSE/s1600/krugman.jpg" border="0" height="320" /></a><a style="margin-left: 1em; margin-right: 1em;" href="http://1.bp.blogspot.com/-cFdUbFraoqE/VBSEpwuz-eI/AAAAAAAAMcE/SMXKuNjCMSg/s1600/stiglitz.jpg"><img width="238" src="http://1.bp.blogspot.com/-cFdUbFraoqE/VBSEpwuz-eI/AAAAAAAAMcE/SMXKuNjCMSg/s1600/stiglitz.jpg" border="0" height="320" /></a></div><br />Some of my colleagues have commented on Paul Krugman's financial diatribe, <a href="http://www.nytimes.com/2014/09/08/opinion/paul-krugman-scots-what-the-heck.html?_r=0">Scots, what the heck</a>. My colleague Nigel Goddard penned a response.<br /><blockquote class="tr_bq">While I have a lot of respect for Paul Krugman, his blanket warning against currency unions is misplaced, at least according to Joe Stiglitz, another Nobel prize winning economist (two economists; three opinions).  Stiglitz said (at the book festival) that all three proposed models (currency union, use of currency without union, separate currency) can work depending on the characteristics of the economies and, most particularly, the quality of the institutions running the currency (or currencies).  For a union to work the economies must be similar in various important ways (level of investment, competitive advantage, etc).  rUK and Scotland are similar at present so it can easily work.  Over the longer term it may be that Scotland breaks out of the low-investment, low-skill rUK model and goes for a more northern European high-investment, high-skill model (let's hope!).  In that case a currency union would over time come under strain and eventually break up (i.e., into separate currencies).  But in that case I know which economy I'd rather be in.</blockquote>In the current situation, if the UK's central bank takes a decision contrary to Scotland's interest there is nothing we can do about it. An independent Scotland using UK currency could, if need be, move to its own currency. Krugman's piece says not a word on this option.<br /><br />RBS, Lloyds, and TSB cannot afford to keep their headquarters in Scotland without the backing of the larger UK, though they may well keep much of their operations here. This is touted by Darling as a reason to vote No, but for me it's a reason to vote Yes. Banks too big to fail are an appalling idea; getting rid of them is an enormous benefit of an independent Scotland. I only hope Westminster keeps its promise not to agree a fiscal union!<br /><br /></div>






<p class="date">
<a href="http://wadler.blogspot.com/2014/09/krugman-vs-stiglitz.html">by Philip Wadler (noreply@blogger.com) at September 13, 2014 06:18 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://gentoohaskell.wordpress.com" title="Gentoo Linux and Haskell">The Gentoo Haskell Team</a></h3>

<div class="entrygroup" id="http://gentoohaskell.wordpress.com/?p=119">
<blockquote>
<h1 class="entry"><a href="http://gentoohaskell.wordpress.com/2014/09/13/ghc-7-8-3-and-rare-architectures/">ghc 7.8.3 and rare architectures</a></h1>
<div class="entry">
<p>After some initially <a href="http://gentoohaskell.wordpress.com/2014/02/08/7-8-1-rc1-gentoo-experience/">positive experience</a> with <strong>ghc-7.8-rc1</strong> I’ve decided to upstream most of gentoo fixes.</p>
<p>On rare arches <strong>ghc-7.8.3</strong> behaves a bit bad:</p>
<ul>
<li><strong>ia64</strong> build stopped being able to link itself after <strong>ghc-7.4</strong> (<strong>gprel</strong> overflow)</li>
<li>on <strong>sparc</strong>, <strong>ia64</strong> and <strong>ppc</strong> <strong>ghc</strong> was not able to create working shared libraries</li>
<li><strong>integer-gmp</strong> library on <strong>ia64</strong> crashed, and we had to use <strong>integer-simple</strong></li>
</ul>
<p>I have written a small story of those fixes <a href="http://trofi.github.io/posts/187-fixing-ghc-on-sparc-ia64-and-friends.html">here</a> if you are curious.</p>
<p>TL;DR:</p>
<p>To get ghc-7.8.3 working nicer for exotic arches you will need to backport at least the following patches:</p>
<ul>
<li><a href="https://git.haskell.org/ghc.git/commitdiff/43f1b2ecd1960fa7377cf55a2b97c66059a701ef">integer literals trimming</a></li>
<li><a href="https://git.haskell.org/ghc.git/commitdiff/a93ab43ab5f40cadbedea2f6342b93c245e91434">incorrect -fPIC passing to the assembler</a></li>
<li><a href="http://git.haskell.org/ghc.git/commitdiff/e18525fae273f4c1ad8d6cbe1dea4fc074cac721">fixed foreign export propotype</a></li>
</ul>
<p>Thank you!</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/gentoohaskell.wordpress.com/119/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/gentoohaskell.wordpress.com/119/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=gentoohaskell.wordpress.com&amp;blog=7667502&amp;post=119&amp;subd=gentoohaskell&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://gentoohaskell.wordpress.com/2014/09/13/ghc-7-8-3-and-rare-architectures/">by Sergei Trofimovich at September 13, 2014 12:35 PM</a>
</p>
</blockquote>
</div>



<div class="entrygroup" id="http://gentoohaskell.wordpress.com/?p=113">
<blockquote>
<h1 class="entry"><a href="http://gentoohaskell.wordpress.com/2014/06/16/unsafeperformio-and-missing-noinline/">unsafePerformIO and missing NOINLINE</a></h1>
<div class="entry">
<p>Two months ago Ivan asked me if we had working <strong>darcs-2.8</strong> for <strong>ghc-7.8</strong> in <strong>gentoo</strong>. We had a workaround to compile <strong>darcs</strong> to that day, but <strong>darcs</strong> did not work reliably. Sometimes it needed 2-3 attempts to pull a repository.</p>
<p>A bit later I’ve decided to actually look at <a href="http://bugs.darcs.net/issue2364">failure case (Issued on darcs bugtracker)</a> and do something about it. My idea to debug the mystery was simple: to reproduce the difference on the same source for <strong>ghc-7.6/7.8</strong> and start plugging debug info unless difference I can understand will pop up.</p>
<p>Darcs has great <strong>debug-verbose</strong> option for most of commands. I used <strong>debugMessage</strong> function to litter code with more debugging statements unless complete horrible image would emerge.</p>
<p>As you can see in bugtracker issue I posted there various intermediate points of what I thought went wrong (don’t expect those comments to have much sense).</p>
<p>The immediate consequence of a breakage was file overwrite of partially downloaded file. The event timeline looked simple:</p>
<ul>
<li>darcs scheduled for download the same file twice (two jobs in download queue)</li>
<li>first download job did finish</li>
<li>notified waiter started processing of that downloaded temp file</li>
<li>second download started truncating previous complete download</li>
<li>notified waiter continued processing partially downloadeed file and detected breakage</li>
</ul>
<p>Thus first I’ve decided <a href="http://hub.darcs.net/darcs/darcs-screened/patch/20140429134020-6895e">to fix the consequence</a>. It did not fix problems completely, sometimes <strong>darcs pull</strong> complained about remote repositories still being broken (missing files), but it made errors saner (only remote side was allegedly at fault).</p>
<p>Ideally, that file overwrite should not happen in the first place. Partially, it was <a href="https://ghc.haskell.org/trac/ghc/ticket/9058">temp file predictability</a>.</p>
<p>But, OK. Then i’ve started digging why <strong>7.6</strong>/<strong>7.8</strong> request download patterns were so severely different. At first I thought of <a href="http://haskell.cs.yale.edu/wp-content/uploads/2013/08/hask035-voellmy.pdf">new IO manager</a> being a cause of difference. The paper says it fixed haskell thread scheduling issue (paper is nice even for leisure reading!):</p>
<pre class="sourceCode bash"><code class="sourceCode bash">GHC’s RTS had a bug <span class="kw">in</span> <span class="kw">which</span> yield
placed the thread back on the front of the run queue<span class="kw">.</span> This bug
was uncovered by our use of yield
<span class="kw">which</span> requires that the thread
be placed at the end of the run queue</code></pre>
<p>Thus I was expecting the bug from this side.</p>
<p>Then being determined to dig A Lot in <strong>darcs</strong> source code I’ve decided to disable optimizations (<strong>-O0</strong>) to speedup rebuilds. And, the bug has vanished.</p>
<p>That made the click: <strong>unsafePerformIO</strong> might be the real problem. I’ve grepped for all <strong>unsafePerformIO</strong> instances and examined all definition sites.</p>
<p>Two were especially interesting:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- src/Darcs/Util/Global.hs</span>
<span class="co">-- ...</span>
_<span class="ot">crcWarningList ::</span> <span class="dt">IORef</span> <span class="dt">CRCWarningList</span>
_crcWarningList <span class="fu">=</span> unsafePerformIO <span class="fu">$</span> newIORef []
<span class="ot">{-# NOINLINE _crcWarningList #-}</span>
<span class="co">-- ...</span>
_<span class="ot">badSourcesList ::</span> <span class="dt">IORef</span> [<span class="dt">String</span>]
_badSourcesList <span class="fu">=</span> unsafePerformIO <span class="fu">$</span> newIORef []
<span class="co">{- NOINLINE _badSourcesList -}</span>
<span class="co">-- ...</span></code></pre>
<p>Did you spot the bug?</p>
<p>Thus The Proper Fix was pushed upstream <a href="https://github.com/gentoo-haskell/gentoo-haskell/blob/master/dev-vcs/darcs/files/darcs-2.8.4-issue2364-part-2.patch">a month ago</a>. Which means <strong>ghc</strong> is now able to inline things more aggressively (and <strong>_badSourcesList</strong> were inlined in all user sites, throwing out all update sites).</p>
<p>I don’t know if those <strong>newIORef []</strong> can be <strong>de-CSE</strong>d if types would have the same representation. Ideally the module also needs <strong>-fno-cse</strong>, or get rid of <strong>unsafePerformIO</strong> completely :].</p>
<p>(Side thought: top-level global variables in <strong>C</strong> style are surprisingly non-trivial in "pure" haskell. They are easy to use via <strong>peek</strong> / <strong>poke</strong> (in a racy way), but are hard to declare / initialize.)</p>
<p>I had a question wondered how many haskell packages manage to misspell ghc pragma decparations in a way <strong>darcs</strong> did it. And there still _is_ a few of such offenders:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">fgrep</span> -R NOINLINE <span class="kw">.</span> <span class="kw">|</span> <span class="kw">grep</span> -v <span class="st">'{-# NOINLINE'</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'{-'</span>
--
ajhc-0.8.0.10/lib/jhc/Jhc/List.hs:{- NOINLINE filterFB <span class="co">#-}</span>
ajhc-0.8.0.10/lib/jhc/Jhc/List.hs:{- NOINLINE iterateFB <span class="co">#-}</span>
ajhc-0.8.0.10/lib/jhc/Jhc/List.hs:{- NOINLINE mapFB <span class="co">#-}</span>
--
darcs-2.8.4/src/Darcs/Global.hs:{- NOINLINE _badSourcesList -}
darcs-2.8.4/src/Darcs/Global.hs:{- NOINLINE _reachableSourcesList -}
--
dph-lifted-copy-0.7.0.1/Data/Array/Parallel.hs:{- NOINLINE emptyP <span class="co">#-}</span>
--
dph-par-0.5.1.1/Data/Array/Parallel.hs:{- NOINLINE emptyP <span class="co">#-}</span>
--
dph-seq-0.5.1.1/Data/Array/Parallel.hs:{- NOINLINE emptyP <span class="co">#-}</span>
--
freesect-0.8/FreeSectAnnotated.hs:{- <span class="co"># NOINLINE showSSI #-}</span>
freesect-0.8/FreeSectAnnotated.hs:{- <span class="co"># NOINLINE FreeSectAnnotated.showSSI #-}</span>
freesect-0.8/FreeSect.hs:{- <span class="co"># NOINLINE fs_warn_flaw #-}</span>
--
http-proxy-0.0.8/Network/HTTP/Proxy/ReadInt.hs:{- NOINLINE readInt64MH <span class="co">#-}</span>
http-proxy-0.0.8/Network/HTTP/Proxy/ReadInt.hs:{- NOINLINE mhDigitToInt <span class="co">#-}</span>
--
lhc-0.10/lib/base/src/GHC/PArr.hs:{- NOINLINE emptyP <span class="co">#-}</span>
--
property-list-0.1.0.2/src/Data/PropertyList/Binary/Float.hs:{- NOINLINE doubleToWord64 -}
property-list-0.1.0.2/src/Data/PropertyList/Binary/Float.hs:{- NOINLINE word64ToDouble -}
property-list-0.1.0.2/src/Data/PropertyList/Binary/Float.hs:{- NOINLINE floatToWord32 -}
property-list-0.1.0.2/src/Data/PropertyList/Binary/Float.hs:{- NOINLINE word32ToFloat -}
--
warp-2.0.3.3/Network/Wai/Handler/Warp/ReadInt.hs:{- NOINLINE readInt64MH <span class="co">#-}</span>
warp-2.0.3.3/Network/Wai/Handler/Warp/ReadInt.hs:{- NOINLINE mhDigitToInt <span class="co">#-}</span></code></pre>
<p>Looks like there is yet something to fix :]</p>
<p>Would be great if <strong>hlint</strong> would be able to detect pragma-like comments and warn when comment contents is a valid pragma, but comment brackets don’t allow it to fire.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{- NOINLINE foo -}</span> <span class="co">-- bad</span>
<span class="co">{- NOINLINE foo #-}</span> <span class="co">-- bad</span>
<span class="co">{-# NOINLINE foo -}</span> <span class="co">-- bad</span>
<span class="ot">{-# NOINLINE foo #-}</span> <span class="co">-- ok</span></code></pre>
<p>Thanks for reading!</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/gentoohaskell.wordpress.com/113/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/gentoohaskell.wordpress.com/113/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=gentoohaskell.wordpress.com&amp;blog=7667502&amp;post=113&amp;subd=gentoohaskell&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://gentoohaskell.wordpress.com/2014/06/16/unsafeperformio-and-missing-noinline/">by Sergei Trofimovich at September 13, 2014 09:18 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 12, 2014</h2>

<div class="channelgroup">







<h3><a href="http://flygdynamikern.blogspot.com/" title="Flygdynamikern">Bjorn Buckwalter</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-2553815923640620572.post-7409096497549783767">
<blockquote>
<h1 class="entry"><a href="http://flygdynamikern.blogspot.com/2014/09/haskell-tools-for-satellite-operations.html">Haskell tools for satellite operations</a></h1>
<div class="entry">
<div style="text-align: left;" dir="ltr">
At last week's CUFP I did a talk called “Haskell tools for satellite operations”. The abstract is:<div>
<br /></div>
<div>
<blockquote class="tr_bq">
<div style="background-color: white; color: #444444; font-family: Lato, 'Helvetica Neue', Helvetica, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.6; padding: 0px;">
Since 2013-04 the presenter has been supporting SSC (the Swedish Space Corporation) in operating the telecommunications satellite “Sirius 3” from its Mission Control Center in Kiruna. Functions in the satellite vendor's operations software are breaking down as the orbit of the ageing satellite degrades. To fill in the gaps in software capabilities the presenter has developed several operational tools using Haskell.</div>
<div style="background-color: white; color: #444444; font-family: Lato, 'Helvetica Neue', Helvetica, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.6; padding: 0px;">
The talk will give an overview of the satellite operations environment, the tools developed in Haskell, how they benefitted (and occasionally suffered) from the choice of implementation language, which (public) libraries were critical to their success, and how they were deployed in the satellite operations environment.</div>
</blockquote>
A video recording of the talk is available on the <a href="http://cufp.org/2014/bjrn-buckwalter-haskell-tools-for-satellite-operations.html">CUFP page</a> for the talk and on <a href="https://www.youtube.com/watch?v=QpRGe5d3ouo">youtube</a>.<br />
<div>
<br /></div>
</div>
<div>
If this interests you be sure to check out the other talk from the “Functional programming in space!” track; Michael Oswald's <a href="http://cufp.org/2014/michael-oswald-haskell-in-the-misson-control-domain.html">Haskell in the Misson Control Domain</a>.</div>
</div></div>






<p class="date">
<a href="http://flygdynamikern.blogspot.com/2014/09/haskell-tools-for-satellite-operations.html">by Björn Buckwalter (noreply@blogger.com) at September 12, 2014 12:46 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.haskellforall.com/" title="Haskell for all">Gabriel Gonzalez</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-1777990983847811806.post-1179905794869657936">
<blockquote>
<h1 class="entry"><a href="http://www.haskellforall.com/2014/09/morte-intermediate-language-for-super.html">Morte: an intermediate language for super-optimizing functional programs</a></h1>
<div class="entry">
<p>The Haskell language provides the following guarantee (with caveats): if two programs are equal according to <a href="http://www.haskellforall.com/2013/12/equational-reasoning.html">equational reasoning</a> then they will behave the same. On the other hand, Haskell does <strong>not</stron42e703170c536073e9c1f952f0"}, "https_endpoint": "https://ssl.reddit.com", "static_root": "//www.redditstatic.com", "extension": null, "status_msg": {"fetching": "fetching title...", "loading": "loading...", "submitting": "submitting..."}, "debug": false, "has_subscribed": false})</script><script type="text/javascript">reddit.cur_site = "t5_2qh36";</script><style type="text/css">/* Custom css: use this block to insert special translation-dependent css in the page header */</style><script type="text/javascript">(function() { var url = '//pixel.redditmedia.com/pixel/of_destiny.png?v=7vO8PF6EyIXM5vDupdctaqL08j8hEpI%2BvjO3uIfdDqYZzZtB0yzYEpsmomTqZcxxe9hsX8GFySA%3D'; var cachebuster = Math.round(Math.random() * 2147483647); var cachebusted_url = url + "&r=" + cachebuster; var img = new Image(); img.src = cachebusted_url; })();</script><script type="text/javascript">var user_type = 'guest'; var _gaq = _gaq || []; _gaq.push( ['_require', 'inpage_linkid', '//www.google-analytics.com/plugins/ga/inpage_linkid.js'], ['_setAccount', 'UA-12131688-1'], ['_setDomainName', 'reddit.com'], ['_setCustomVar', 1, 'site', 'haskell', 3], ['_setCustomVar', 2, 'srpath', 'haskell-GET_listing', 3], ['_setCustomVar', 3, 'usertype', user_type, 2], ['_setCustomVar', 4, 'uitype', 'web', 3], ['_trackPageview'] ); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></head><body class="listing-page hot-page" ><div id="header" role="banner"><a tabindex="1" href="#content" id="jumpToContent">jump to content</a><div id="sr-header-area"><div class="width-clip"><div class="dropdown srdrop" onclick="open_menu(this)" onmouseover="hover_open_menu(this)"><span class="selected title">my subreddits</span></div><div class="drop-choices srdrop"><a href="http://www.reddit.com/r/announcements/" class="choice" >announcements</a><a href="http://www.reddit.com/r/Art/" class="choice" >Art</a><a href="http://www.reddit.com/r/AskReddit/" class="choice" >AskReddit</a><a href="http://www.reddit.com/r/askscience/" class="choice" >askscience</a><a href="http://www.reddit.com/r/aww/" class="choice" >aww</a><a href="http://www.reddit.com/r/blog/" class="choice" >blog</a><a href="http://www.reddit.com/r/books/" class="choice" >books</a><a href="http://www.reddit.com/r/creepy/" class="choice" >creepy</a><a href="http://www.reddit.com/r/dataisbeautiful/" class="choice" >dataisbeautiful</a><a href="http://www.reddit.com/r/DIY/" class="choice" >DIY</a><a href="http://www.reddit.com/r/Documentaries/" class="choice" >Documentaries</a><a href="http://www.reddit.com/r/EarthPorn/" class="choice" >EarthPorn</a><a href="http://www.reddit.com/r/explainlikeimfive/" class="choice" >explainlikeimfive</a><a href="http://www.reddit.com/r/Fitness/" class="choice" >Fitness</a><a href="http://www.reddit.com/r/food/" class="choice" >food</a><a href="http://www.reddit.com/r/funny/" class="choice" >funny</a><a href="http://www.reddit.com/r/Futurology/" class="choice" >Futurology</a><a href="http://www.reddit.com/r/gadgets/" class="choice" >gadgets</a><a href="http://www.reddit.com/r/gaming/" class="choice" >gaming</a><a href="http://www.reddit.com/r/GetMotivated/" class="choice" >GetMotivated</a><a href="http://www.reddit.com/r/gifs/" class="choice" >gifs</a><a href="http://www.reddit.com/r/history/" class="choice" >history</a><a href="http://www.reddit.com/r/IAmA/" class="choice" >IAmA</a><a href="http://www.reddit.com/r/InternetIsBeautiful/" class="choice" >InternetIsBeautiful</a><a href="http://www.reddit.com/r/Jokes/" class="choice" >Jokes</a><a href="http://www.reddit.com/r/LifeProTips/" class="choice" >LifeProTips</a><a href="http://www.reddit.com/r/listentothis/" class="choice" >listentothis</a><a href="http://www.reddit.com/r/mildlyinteresting/" class="choice" >mildlyinteresting</a><a href="http://www.reddit.com/r/movies/" class="choice" >movies</a><a href="http://www.reddit.com/r/Music/" class="choice" >Music</a><a href="http://www.reddit.com/r/news/" class="choice" >news</a><a href="http://www.reddit.com/r/nosleep/" class="choice" >nosleep</a><a href="http://www.reddit.com/r/nottheonion/" class="choice" >nottheonion</a><a href="http://www.reddit.com/r/OldSchoolCool/" class="choice" >OldSchoolCool</a><a href="http://www.reddit.com/r/personalfinance/" class="choice" >personalfinance</a><a href="http://www.reddit.com/r/philosophy/" class="choice" >philosophy</a><a href="http://www.reddit.com/r/photoshopbattles/" class="choice" >photoshopbattles</a><a href="http://www.reddit.com/r/pics/" class="choice" >pics</a><a href="http://www.reddit.com/r/science/" class="choice" >science</a><a href="http://www.reddit.com/r/Showerthoughts/" class="choice" >Showerthoughts</a><a href="http://www.reddit.com/r/space/" class="choice" >space</a><a href="http://www.reddit.com/r/sports/" class="choice" >sports</a><a href="http://www.reddit.com/r/television/" class="choice" >television</a><a href="http://www.reddit.com/r/tifu/" class="choice" >tifu</a><a href="http://www.reddit.com/r/todayilearned/" class="choice" >todayilearned</a><a href="http://www.reddit.com/r/TwoXChromosomes/" class="choice" >TwoXChromosomes</a><a href="http://www.reddit.com/r/UpliftingNews/" class="choice" >UpliftingNews</a><a href="http://www.reddit.com/r/videos/" class="choice" >videos</a><a href="http://www.reddit.com/r/worldnews/" class="choice" >worldnews</a><a href="http://www.reddit.com/r/WritingPrompts/" class="choice" >WritingPrompts</a><a href="http://www.reddit.com/subreddits/" class="bottom-option choice" >edit subscriptions</a></div><div class="sr-list"><ul class="flat-list sr-bar hover" ><li ><a href="http://www.reddit.com/" class="choice" >front</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/all" class="choice" >all</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/random/" class="random choice" >random</a></li></ul><span class="separator">&nbsp;|&nbsp;</span><ul class="flat-list sr-bar hover" id='sr-bar'><li ><a href="http://www.reddit.com/r/funny/" class="choice" >funny</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/aww/" class="choice" >aww</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/news/" class="choice" >news</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/listentothis/" class="choice" >listentothis</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Futurology/" class="choice" >Futurology</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/science/" class="choice" >science</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Showerthoughts/" class="choice" >Showerthoughts</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/food/" class="choice" >food</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/TwoXChromosomes/" class="choice" >TwoXChromosomes</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/space/" class="choice" >space</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/photoshopbattles/" class="choice" >photoshopbattles</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/WritingPrompts/" class="choice" >WritingPrompts</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Documentaries/" class="choice" >Documentaries</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/pics/" class="choice" >pics</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/creepy/" class="choice" >creepy</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/gifs/" class="choice" >gifs</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/askscience/" class="choice" >askscience</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Music/" class="choice" >Music</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/books/" class="choice" >books</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/UpliftingNews/" class="choice" >UpliftingNews</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/movies/" class="choice" >movies</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/nosleep/" class="choice" >nosleep</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/history/" class="choice" >history</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Art/" class="choice" >Art</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/AskReddit/" class="choice" >AskReddit</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/gaming/" class="choice" >gaming</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Jokes/" class="choice" >Jokes</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/DIY/" class="choice" >DIY</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/GetMotivated/" class="choice" >GetMotivated</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/EarthPorn/" class="choice" >EarthPorn</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/philosophy/" class="choice" >philosophy</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/sports/" class="choice" >sports</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/gadgets/" class="choice" >gadgets</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/television/" class="choice" >television</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/videos/" class="choice" >videos</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/mildlyinteresting/" class="choice" >mildlyinteresting</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/dataisbeautiful/" class="choice" >dataisbeautiful</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/Fitness/" class="choice" >Fitness</a></li><li ><span class="separator">-</span><a href="http://www.redg> guarantee that equal programs will generate identical performance. Consequently, Haskell library writers must employ <a href="http://www.haskellforall.com/2014/01/stream-fusion-for-pipes.html">rewrite rules</a> to ensure that their abstractions do not interfere with performance.</p><p>Now suppose there were a hypothetical language with a stronger guarantee: if two programs are equal then they generate identical executables. Such a language would be immune to abstraction: no matter how many layers of indirection you might add the binary size and runtime performance would be unaffected.</p><p>Here I will introduce such an intermediate language named <a href="http://hackage.haskell.org/package/morte">Morte</a> that obeys this stronger guarantee. I have not yet implemented a back-end code generator for Morte, but I wanted to pause to share what I have completed so far because Morte uses several tricks from computer science that I believe deserve more attention.</p><p>Morte is nothing more than a bare-bones implementation of the calculus of constructions, which is a specific type of lambda calculus. The only novelty is how I intend to use this lambda calculus: as a super-optimizer.</p><h4 id="normalization">Normalization</h4><p>The typed lambda calculus possesses a useful property: every term in the lambda calculus has a unique normal form if you beta-reduce everything. If you're new to lambda calculus, normalizing an expression equates to indiscriminately inlining every function call.</p><p>What if we built a programming language whose intermediate language was lambda calculus? What if optimization was just normalization of lambda terms (i.e. indiscriminate inlining)? If so, then we would could abstract freely, knowing that while compile times might increase, our final executable would never change.</p><h4 id="recursion">Recursion</h4><p>Normally you would not want to inline everything because infinitely recursive functions would become infinitely large expressions. Fortunately, we can often translate recursive code to non-recursive code!</p><p>I'll demonstrate this trick first in Haskell and then in Morte. Let's begin from the following recursive <code>List</code> type along with a recursive <code>map</code> function over lists:</p><pre><code>import Prelude hiding (map, foldr)<br /><br />data List a = Cons a (List a) | Nil<br /><br />example :: List Int<br />example = Cons 1 (Cons 2 (Cons 3 Nil))<br /><br />map :: (a -&gt; b) -&gt; List a -&gt; List b<br />map f  Nil       = Nil<br />map f (Cons a l) = Cons (f a) (map f l)<br /><br />-- Argument order intentionally switched<br />foldr :: List a -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x<br />foldr  Nil       c n = n<br />foldr (Cons a l) c n = c a (foldr l c n)<br /><br />result :: Int<br />result = foldr (map (+1) example) (+) 0<br /><br />-- result = 9</code></pre><p>Now imagine that we disable all recursion in Haskell: no more recursive types and no more recursive functions. Now we must reject the above program because:</p><ul class="incremental"><li><p>the <code>List</code> data type definition recursively refers to itself</p></li><li><p>the <code>map</code> and <code>foldr</code> functions recursively refer to themselves</p></li></ul><p>Can we still encode lists in a non-recursive dialect of Haskell?</p><p>Yes, we can!</p><pre><code>-- This is a valid Haskell program<br /><br />{-# LANGUAGE RankNTypes #-}<br /><br />import Prelude hiding (map, foldr)<br /><br />type List a = forall x . (a -&gt; x -&gt; x) -&gt; x -&gt; x<br /><br />example :: List Int<br />example = \cons nil -&gt; cons 1 (cons 2 (cons 3 nil))<br /><br />map :: (a -&gt; b) -&gt; List a -&gt; List b<br />map f l = \cons nil -&gt; l (\a x -&gt; cons (f a) x) nil<br /><br />foldr :: List a -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x<br />foldr l = l<br /><br />result :: Int<br />result = foldr (map (+ 1) example) (+) 0<br /><br />-- result = 9</code></pre><p>Carefully note that:</p><ul class="incremental"><li><p><code>List</code> is no longer defined recursively in terms of itself</p></li><li><p><code>map</code> and <code>foldr</code> are no longer defined recursively in terms of themselves</p></li></ul><p>Yet, we somehow managed to build a list, map a function over the list, and fold the list, all without ever using recursion! We do this by encoding the list as a fold, which is why <code>foldr</code> became the identity function.</p><p>This trick works for more than just lists. You can take any recursive data type and mechanically transform the type into a fold and transform functions on the type into functions on folds. If you want to learn more about this trick, the specific name for it is "Boehm-Berarducci encoding". If you are curious, this in turn is equivalent to an even more general concept from category theory known as "F-algebras", which let you encode inductive things in a non-inductive way.</p><p>Non-recursive code greatly simplifies equational reasoning. For example, we can easily prove that we can optimize <code>map id l</code> to <code>l</code>:</p><pre><code>map id l<br /><br />-- Inline: map f l = \cons nil -&gt; l (\a x -&gt; cons (f a) x) nil<br />= \cons nil -&gt; l (\a x -&gt; cons (id a) x) nil<br /><br />-- Inline: id x = x<br />= \cons nil -&gt; l (\a x -&gt; cons a x) nil<br /><br />-- Eta-reduce<br />= \cons nil -&gt; l cons nil<br /><br />-- Eta-reduce<br />= l</code></pre><p>Note that we did not need to use induction to prove this optimization because <code>map</code> is no longer recursive. The optimization became downright trivial, so trivial that we can automate it!</p><p>Morte optimizes programs using this same simple scheme:</p><ul class="incremental"><li>Beta-reduce everything (equivalent to inlining)</li><li>Eta-reduce everything</li></ul><p>To illustrate this, I will desugar our high-level Haskell code to the calculus of constructions. This desugaring process is currently manual (and tedious), but I plan to automate this, too, by providing a front-end high-level language similar to Haskell that compiles to Morte:</p><pre><code>-- mapid.mt<br /><br />(    \(List : * -&gt; *)<br />-&gt;   \(  map<br />     :   forall (a : *)<br />     -&gt;  forall (b : *)<br />     -&gt; (a -&gt; b) -&gt; List a -&gt; List b<br />     )<br />-&gt;   \(id : forall (a : *) -&gt; a -&gt; a)<br /><br />    -&gt;   \(a : *) -&gt; map a a (id a)<br />)<br /><br />-- List<br />(\(a : *) -&gt; forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br /><br />-- map<br />(   \(a : *)<br />-&gt;  \(b : *)<br />-&gt;  \(f : a -&gt; b)<br />-&gt;  \(l : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />-&gt;  \(x : *)<br />-&gt;  \(Cons : b -&gt; x -&gt; x)<br />-&gt;  \(Nil: x)<br />-&gt;  l x (\(va : a) -&gt; \(vx : x) -&gt; Cons (f va) vx) Nil<br />)<br /><br />-- id<br />(\(a : *) -&gt; \(va : a) -&gt; va)</code></pre><p>This line of code is the "business end" of the progdit.com/r/IAmA/" class="choice" >IAmA</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/nottheonion/" class="choice" >nottheonion</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/LifeProTips/" class="choice" >LifeProTips</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/todayilearned/" class="choice" >todayilearned</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/OldSchoolCool/" class="choice" >OldSchoolCool</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/tifu/" class="choice" >tifu</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/explainlikeimfive/" class="choice" >explainlikeimfive</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/InternetIsBeautiful/" class="choice" >InternetIsBeautiful</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/personalfinance/" class="choice" >personalfinance</a></li><li ><span class="separator">-</span><a href="http://www.reddit.com/r/worldnews/" class="choice" >worldnews</a></li></ul></div><a href="http://www.reddit.com/subreddits/" id="sr-more-link" >more &raquo;</a></div></div><div id="header-bottom-left"><a title="The Haskell Programming Language Community" href="http://www.reddit.com/" id="header-img-a" ><img id='header-img' src="http://b.thumbs.redditmedia.com/R35_WzFTousI_gRg.png" width='120' height='40' alt="haskell"/></a>&nbsp;<span class="hover pagename redditname"><a href="http://www.reddit.com/r/haskell/" >haskell</a></span><ul class="tabmenu " ><li class='selected'><a href="http://www.reddit.com/r/haskell/" class="choice" >hot</a></li><li ><a href="http://www.reddit.com/r/haskell/new/" class="choice" >new</a></li><li ><a href="http://www.reddit.com/r/haskell/rising/" class="choice" >rising</a></li><li ><a href="http://www.reddit.com/r/haskell/controversial/" class="choice" >controversial</a></li><li ><a href="http://www.reddit.com/r/haskell/top/" class="choice" >top</a></li><li ><a href="http://www.reddit.com/r/haskell/gilded/" class="choice" >gilded</a></li><li ><a href="http://www.reddit.com/r/haskell/ads/" class="choice" >promoted</a></li></ul></div><div id="header-bottom-right"><span class="user">want to join?&#32;<a href="https://ssl.reddit.com/login" class="login-required" >login or register</a>&#32;in seconds</span><span class="separator">|</span><ul class="flat-list hover" ><li ><a href="javascript:void(0)" class="pref-lang choice" onclick="return showlang();" >English</a></li></ul></div></div><div class="side"><div class='spacer'><form action="http://www.reddit.com/r/haskell/search" id="search" role="search"><input type="text" name="q" placeholder="search reddit" /><div id="searchexpando" class="infobar"><label><input type="checkbox" name="restrict_sr" />limit my search to /r/haskell</label><div id="moresearchinfo"><p>use the following search parameters to narrow your results:</p><dl><dt>subreddit:<i>subreddit</i></dt><dd>find submissions in &quot;subreddit&quot;</dd><dt>author:<i>username</i></dt><dd>find submissions by &quot;username&quot;</dd><dt>site:<i>example.com</i></dt><dd>find submissions from &quot;example.com&quot;</dd><dt>url:<i>text</i></dt><dd>search for &quot;text&quot; in url</dd><dt>selftext:<i>text</i></dt><dd>search for &quot;text&quot; in self post contents</dd><dt>self:yes (or self:no)</dt><dd>include (or exclude) self posts</dd><dt>nsfw:yes (or nsfw:no)</dt><dd>include (or exclude) results marked as NSFW</dd></dl><p>e.g.&#32;<code>subreddit:aww site:imgur.com dog</code></p><p><a href="http://www.reddit.com/wiki/search">see the search faq for details.</a></p></div><p><a href="http://www.reddit.com/wiki/search" id="search_showmore">advanced search: by author, subreddit...</a></p></div></form></div><div class='spacer'><form method="post" action="https://ssl.reddit.com/r/haskell/post/login" id="login_login-main" class="login-form login-form-side"><input type="hidden" name="op" value="login-main" /><input name="user" placeholder="username" type="text" maxlength="20" tabindex="1"/><input name="passwd" placeholder="password" type="password" tabindex="1"/><div class="status"></div><div id="remember-me"><input type="checkbox" name="rem" id="rem-login-main" tabindex="1" /><label for="rem-login-main">remember me</label><a class="recover-password" href="/password">reset password</a></div><div class="submit"><span class="throbber"></span><button class="btn" type="submit" tabindex="1">login</button></div><div class="clear"></div></form></div><div class='spacer'><div class="sponsorshipbox"></div></div><div class='spacer'><div class="sidebox submit submit-link"><div class="morelink"><a href="http://www.reddit.com/r/haskell/submit" class="login-required" target="_top" >Submit a new link</a><div class="nub"></div></div></div></div><div class='spacer'><div class="sidebox submit submit-text"><div class="morelink"><a href="http://www.reddit.com/r/haskell/submit?selftext=true" class="login-required" target="_top" >Submit a new text post</a><div class="nub"></div></div></div></div><div class='spacer'><div class="titlebox"><h1 class="hover redditname"><a href="http://www.reddit.com/r/haskell/" class="hover" >haskell</a></h1><span class="subscribe-button fancy-toggle-button toggle" style="" data-sr_name="haskell" ><a class="option active add login-required" href="#" tabindex="100" >subscribe</a><a class="option remove" href="#">unsubscribe</a></span><span class="subscribers"><span class='number'>17,332</span>&#32;<span class='word'>readers</span></span><p class="users-online fuzzed" title="logged-in users viewing this subreddit in the past 15 minutes"><span class='number'>~59</span>&#32;<span class='word'>users here now</span></p><form action="#" class="usertext" onsubmit="return post_form(this, 'editusertext')" id="form-t5_2qh3675q"><input type="hidden" name="thing_id" value="t5_2qh36"/><div class="usertext-body may-blank-within"><div class="md"><p><strong>The <a href="http://haskell.org">Haskell programming language</a> community.</strong></p>

<p>Daily news and info about all things <strong>Haskell</strong> related: practical stuff, theory, types, libraries, jobs, patches, releases, events and conferences and more...</p>

<ul>
<li><strong><a href="http://hackage.haskell.org/platform">Download Haskell</a></strong></li>
<li><strong><a href="http://tryhaskell.org/">Try Haskell</a> in your browser</strong></li>
</ul>

<hr/>

<ul>
<li><strong><a href="http://www.reddit.com/r/haskell/comments/j8df0/moderator_guidelines_thems_the_rules/">Community Guidelines</a></strong></li>
</ul>

<hr/>

<p><strong>Other community locations:</strong></p>

<ul>
<li><a href="http://haskell.org/haskellwiki/IRC_channel">#haskell IRC channel</a></li>
<li><a href="http://planet.haskell.org/">Planet Haskell</a> blog aggregator</li>
<li><a href="http://twitter.com/reddit_haskell">Follow Haskell on Twitter</a></li>
<li><a href="http://www.haskell.org/haskellwiki/Mailing_lists">Haskell mailing lists</a></li>
</ul>

<p><strong>Professional resources:</strong></p>

<ul>
<li><a href="http://industry.haskell.org/">The Industrial Haskell Group</a></li>
<li><a href="http://www.haskellers.com/">Hire Haskell programmers</a></li>
<li><a href="http://cufp.org">The Commercial Users of FP</a></li>
</ul>

<p><strong>Learning material:</strong></p>

<ul>
<li><a href="http://stackoverflow.com/questions/tagged/haskell">Ask a question on Haskell Stack Overflow</a></li>
<li><a href="http://learnyouahaskell.com/">Learn You a Haskell</a></li>
<li><a href="http://realworldhaskell.org">Real World Haskell</a></li>
<li><a href="https://haskell.fpcomplete.com/school">School of Haskell</a></li>
</ul>

<p><strong>Haskell development:</strong></p>

<ul>
<li><a href="http://hackage.haskell.org">Hackage: Haskell Libraries</a></li>
<li><a href="http://www.reddit.com/r/haskell_proposals">New Haskell Project Ideas</a></li>
</ul>

<p><strong>Other Subreddits:</strong></p>

<ul>
<li><a href="/r/haskellquestions">/r/haskellquestions</a></li>
</ul>
</div>
</div></form><div class="bottom"><span class="age">a community for&#32;<time title="Fri Jan 25 06:37:23 2008 UTC" datetime="2008-01-24T22:37:23-08:00">6 years</time></span></div><div class="clear"></div></div></div><div class='spacer'><iframe id="ad_main" frameborder="0" scrolling="no" name="ad_main" src="http://static.adzerk.net/reddit/ads.html?sr=haskell,loggedout&amp;bust2#http://www.reddit.com"></iframe><script type="text/javascript">$(function() { var ad = $("#ad_main"); if(!ad.length || ad.height() == 0 || ad.width() == 0 || ad.offset().left == 0) { $(".footer").append("<img alt='' src='//pixel.redditmedia.com/pixel/of_defenestration.png?hash=adblock0e31bc319d5b5882b0cddf147f4ce1da5ac9c731&id=adblock&random=" + Math.random()*10000000000000000 + "'/>"); $(window).trigger('adBlockEnabled', true) } else { $(window).trigger('adBlockEnabled', false) } });</script></div><div class='spacer'><div class="sidecontentbox " ><a class="helplink" href="/message/compose?to=%2Fr%2Fhaskell">message the moderators</a><div class="title"><h1>MODERATORS</h1></div><ul class="content"><li><a href="http://www.reddit.com/user/dons" class="author may-blank id-t2_jzjf" >dons</a><span class="userattrs"></span></li><li><a href="http://www.reddit.com/user/jfredett" class="author may-blank id-t2_23tj7" >jfredett</a><span class="userattrs"></span></li><li><a href="http://www.reddit.com/user/godofpumpkins" class="author may-blank id-t2_334ov" >godofpumpkins</a><span class="userattrs"></span></li><li><a href="http://www.reddit.com/user/dstcruz" class="author may-blank id-t2_1vvx" >dstcruz</a><span class="userattrs"></span></li><li><a href="http://www.reddit.com/user/camccann" class="author may-blank id-t2_3xib6" >camccann</a><span class="userattrs"></span></li></ul></div></div></div><a name="content"></a><div class="content" role="main"><div class="infobar welcome"><h1>reddit is a website about everything</h1><div class="button-row"><h2>powered by community, democracy, and you.</h2><a href="/about">learn more &rsaquo;</a></div></div><div class='spacer'><div id="siteTable_organic" class="organic-listing loading" ><div class="help help-hoverable">what's this?<div id="spotlight-help" class="hover-bubble help-bubble anchor-top"><div class="help-section help-promoted"><p>This sponsored link is an advertisement generated with our&#32;<a href="http://www.reddit.com/wiki/selfserve" >self-serve advertisement tool</a>.</p><p>Use of this tool is open to all members of reddit.com, and for as little as $5.00 you can advertise in this area.&#32;<a href="http://www.reddit.com/advertising" >Get started &rsaquo;</a></p></div><div class="help-section help-organic"><p>This area shows new and upcoming links. Vote on links here to help them become popular, and click the forwards and backwards buttons to view more.</p></div><div class="help-section help-interestbar"><p>Enter a keyword or topic to discover new subreddits around your interests. Be specific!</p><p>You can access this tool at any time on the&#32;<a href="http://www.reddit.com/subreddits/" >/subreddits/</a>&#32;page.</p></div></div></div></div><script>r.spotlight.setup( [], 0.0, true, "haskell" )</script></div><div class='spacer'><style>body >.content .link .rank, .rank-spacer { width: 2.2ex } body >.content .link .midcol, .midcol-spacer { width: 3.1ex }</style><div id="siteTable" class="sitetable linklisting"><div class=" thing id-t3_2glk10 odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2glk10" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">1</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">97</div><div class="score unvoted">98</div><div class="score likes">99</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://blog.chucklefish.org/?p=154" tabindex="1" >Wayward Tide is Being Written in Haskell</a>&#32;<span class="domain">(<a href="/domain/blog.chucklefish.org/">blog.chucklefish.org</a>)</span></p><p class="tagline">submitted&#32;<time title="Tue Sep 16 21:23:40 2014 UTC" datetime="2014-09-16T21:23:40+00:00" class="live-timestamp">15 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/thatisthewaz" class="author may-blank id-t2_9ysr9" >thatisthewaz</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2glk10/wayward_tide_is_being_written_in_haskell/" class="comments may-blank" >15 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gnat7 even&#32; link " onclick="click_thing(this)" data-fullname="t3_2gnat7" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">2</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">6</div><div class="score unvoted">7</div><div class="score likes">8</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://neilmitchell.blogspot.com/2014/09/towards-shake-10.html" tabindex="1" >Towards Shake 1.0</a>&#32;<span class="domain">(<a href="/domain/neilmitchell.blogspot.com/">neilmitchell.blogspot.com</a>)</span></p><p class="tagline">submitted&#32;<time title="Wed Sep 17 10:00:59 2014 UTC" datetime="2014-09-17T10:00:59+00:00" class="live-timestamp">2 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/ibotty" class="author may-blank id-t2_9quus" >ibotty</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gnat7/towards_shake_10/" class="comments empty may-blank" >comment</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gn81y odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gn81y" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">3</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">5</div><div class="score unvoted">6</div><div class="score likes">7</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://findmelike.com" tabindex="1" >Built on Haskell: Findmelike - visual search for art</a>&#32;<span class="domain">(<a href="/domain/findmelike.com/">findmelike.com</a>)</span></p><p class="tagline">submitted&#32;<time title="Wed Sep 17 09:07:06 2014 UTC" datetime="2014-09-17T09:07:06+00:00" class="live-timestamp">3 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/glutamate" class="author may-blank id-t2_bo2s" >glutamate</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gn81y/built_on_haskell_findmelike_visual_search_for_art/" class="comments may-blank" >1 comment</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gmsao even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gmsao" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">4</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">3</div><div class="score unvoted">4</div><div class="score likes">5</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gmsao/security_with_cabal_install/" tabindex="1" >Security with 'cabal install'</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Wed Sep 17 04:47:26 2014 UTC" datetime="2014-09-17T04:47:26+00:00" class="live-timestamp">7 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/MintyGrindy" class="author may-blank id-t2_g6ajz" >MintyGrindy</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gmsao/security_with_cabal_install/" class="comments may-blank" >3 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gk51p odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gk51p" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">5</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">42</div><div class="score unvoted">43</div><div class="score likes">44</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://h2.jaguarpaw.co.uk/posts/strictness-in-types/" tabindex="1" >Reflecting strictness in Haskell types</a>&#32;<span class="domain">(<a href="/domain/h2.jaguarpaw.co.uk/">h2.jaguarpaw.co.uk</a>)</span></p><p class="tagline">submitted&#32;<time title="Tue Sep 16 13:51:00 2014 UTC" datetime="2014-09-16T13:51:00+00:00" class="live-timestamp">22 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/tomejaguar" class="author may-blank id-t2_45sug" >tomejaguar</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gk51p/reflecting_strictness_in_haskell_types/" class="comments may-blank" >25 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gkjij even&#32; link " onclick="click_thing(this)" data-fullname="t3_2gkjij" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">6</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">20</div><div class="score unvoted">21</div><div class="score likes">22</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://www.reddit.com/r/theghostofchurch/comments/2fccjw/i_found_this_trinket_by_a_rho_of_trees/ckh62js" tabindex="1" >ICFP &quot;The Ghost of Church&quot; - writeup by Olle Fredriksson who was the first to solve it!</a>&#32;<span class="domain">(<a href="/domain/reddit.com/">reddit.com</a>)</span></p><p class="tagline">submitted&#32;<time title="Tue Sep 16 16:10:46 2014 UTC" datetime="2014-09-16T16:10:46+00:00" class="live-timestamp">20 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/icfpfan" class="author may-blank id-t2_i7lqz" >icfpfan</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gkjij/icfp_the_ghost_of_church_writeup_by_olle/" class="comments empty may-blank" >comment</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gkrrr odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gkrrr" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">7</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">9</div><div class="score unvoted">10</div><div class="score likes">11</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://tim.dreamwidth.org/1856739.html" tabindex="1" >Functional Programmers Support the Ada Initiative</a>&#32;<span class="domain">(<a href="/domain/tim.dreamwidth.org/">tim.dreamwidth.org</a>)</span></p><p class="tagline">submitted&#32;<time title="Tue Sep 16 17:20:55 2014 UTC" datetime="2014-09-16T17:20:55+00:00" class="live-timestamp">19 hours ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/LeCoqUser" class="author may-blank id-t2_9l9s8" >LeCoqUser</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gkrrr/functional_programmers_support_the_ada_initiative/" class="comments may-blank" >14 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gjqop even&#32; link " onclick="click_thing(this)" data-fullname="t3_2gjqop" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">8</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">15</div><div class="score unvoted">16</div><div class="score likes">17</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://stackoverflow.com/questions/25855507/are-typeclasses-essential" tabindex="1" >Are typeclasses essential? (includes Luke Palmer's view on it)</a>&#32;<span class="domain">(<a href="/domain/stackoverflow.com/">stackoverflow.com</a>)</span></p><p class="tagline">submitted&#32;<time title="Tue Sep 16 10:34:10 2014 UTC" datetime="2014-09-16T10:34:10+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/sibip" class="author may-blank id-t2_ghg8c" >sibip</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gjqop/are_typeclasses_essential_includes_luke_palmers/" class="comments may-blank" >26 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gia13 odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gia13" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">9</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">27</div><div class="score unvoted">28</div><div class="score likes">29</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="https://ghc.haskell.org/trac/ghc/blog/weekly20140915" tabindex="1" >Blog: GHC Weekly News - 2014/09/15</a>&#32;<span class="domain">(<a href="/domain/ghc.haskell.org/">ghc.haskell.org</a>)</span></p><p class="tagline">submitted&#32;<time title="Mon Sep 15 23:19:43 2014 UTC" datetime="2014-09-15T23:19:43+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/n00bomb" class="author may-blank id-t2_fhy7z" >n00bomb</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gia13/blog_ghc_weekly_news_20140915/" class="comments empty may-blank" >comment</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ghl6w even&#32; link " onclick="click_thing(this)" data-fullname="t3_2ghl6w" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">10</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">11</div><div class="score unvoted">12</div><div class="score likes">13</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="https://izbicki.me/blog/avl-tree-runtimes-c%2B%2B-vs-haskell.html" tabindex="1" >Comparing AVL Trees in C++ and Haskell</a>&#32;<span class="domain">(<a href="/domain/izbicki.me/">izbicki.me</a>)</span></p><p class="tagline">submitted&#32;<time title="Mon Sep 15 19:36:34 2014 UTC" datetime="2014-09-15T19:36:34+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/CheriPai" class="author may-blank id-t2_5uyov" >CheriPai</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ghl6w/comparing_avl_trees_in_c_and_haskell/" class="comments may-blank" >22 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ghthz odd&#32; link self" onclick="click_thing(this)" data-fullname="t3_2ghthz" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">11</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">7</div><div class="score unvoted">8</div><div class="score likes">9</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2ghthz/i_liked_object_oriented_programming_versus/" tabindex="1" >I liked &quot;Object Oriented Programming versus Abstract Data Types&quot;, what to read next?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Mon Sep 15 20:47:31 2014 UTC" datetime="2014-09-15T20:47:31+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/liberalogica" class="author may-blank id-t2_gpl04" >liberalogica</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ghthz/i_liked_object_oriented_programming_versus/" class="comments may-blank" >4 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ghqyo even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2ghqyo" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">12</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">8</div><div class="score unvoted">9</div><div class="score likes">10</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2ghqyo/netwire_5_pong_and_experiences/" tabindex="1" >Netwire 5 - Pong and Experiences</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Mon Sep 15 20:25:28 2014 UTC" datetime="2014-09-15T20:25:28+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/crockeo" class="author may-blank id-t2_6ieat" >crockeo</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ghqyo/netwire_5_pong_and_experiences/" class="comments may-blank" >8 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gg3um odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gg3um" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">13</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">35</div><div class="score unvoted">36</div><div class="score likes">37</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://derekmcloughlin.github.io/2014/09/13/Haskell-Dice-Of-Doom-Part-1/" tabindex="1" >Haskell Dice of Doom - Part 1</a>&#32;<span class="domain">(<a href="/domain/derekmcloughlin.github.io/">derekmcloughlin.github.io</a>)</span></p><p class="tagline">submitted&#32;<time title="Mon Sep 15 10:14:41 2014 UTC" datetime="2014-09-15T10:14:41+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/derek-mcloughlin" class="author may-blank id-t2_enuxi" >derek-mcloughlin</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gg3um/haskell_dice_of_doom_part_1/" class="comments may-blank" >6 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ggopt even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2ggopt" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">14</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">13</div><div class="score unvoted">14</div><div class="score likes">15</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2ggopt/whats_the_right_way_to_name_packages_and_modules/" tabindex="1" >What's the right way to name packages and modules?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Mon Sep 15 14:52:13 2014 UTC" datetime="2014-09-15T14:52:13+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/tomejaguar" class="author may-blank id-t2_45sug" >tomejaguar</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ggopt/whats_the_right_way_to_name_packages_and_modules/" class="comments may-blank" >13 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ggi4z odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2ggi4z" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">15</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">14</div><div class="score unvoted">15</div><div class="score likes">16</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://blog.spacekitteh.moe/posts/new-monoidal-cats.html" tabindex="1" >Preliminary proposal for monoidal category classes in the base Haskell library</a>&#32;<span class="domain">(<a href="/domain/blog.spacekitteh.moe/">blog.spacekitteh.moe</a>)</span></p><p class="tagline">submitted&#32;<time title="Mon Sep 15 13:43:29 2014 UTC" datetime="2014-09-15T13:43:29+00:00" class="live-timestamp">1 day ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/deltaSquee" class="author may-blank id-t2_gcq39" >deltaSquee</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ggi4z/preliminary_proposal_for_monoidal_category/" class="comments may-blank" >34 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gfpgk even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gfpgk" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">16</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">11</div><div class="score unvoted">12</div><div class="score likes">13</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gfpgk/simulating_trade_system_with_frp_or_pipes_or/" tabindex="1" >Simulating trade system with FRP (or pipes or conduit)</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Mon Sep 15 05:54:18 2014 UTC" datetime="2014-09-15T05:54:18+00:00" class="live-timestamp">2 days ago</time>&#32;<time class="edited-timestamp" title="last edited 2 days ago" datetime="2014-09-15T05:59:19+00:00">*</time>&#32;by&#32;<a href="http://www.reddit.com/user/nicheComicsProject" class="author may-blank id-t2_941me" >nicheComicsProject</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gfpgk/simulating_trade_system_with_frp_or_pipes_or/" class="comments may-blank" >13 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2ge7om odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2ge7om" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">17</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">15</div><div class="score unvoted">16</div><div class="score likes">17</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://hrothen.github.io/2014/09/14/lets-build-a-browser-engine-in-haskell-setting-up-tests/" tabindex="1" >Let's Build a Browser Engine in Haskell: setting up tests</a>&#32;<span class="domain">(<a href="/domain/hrothen.github.io/">hrothen.github.io</a>)</span></p><p class="tagline">submitted&#32;<time title="Sun Sep 14 20:00:58 2014 UTC" datetime="2014-09-14T20:00:58+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/Hrothen" class="author may-blank id-t2_6gtqz" >Hrothen</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2ge7om/lets_build_a_browser_engine_in_haskell_setting_up/" class="comments may-blank" >9 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2geb7i even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2geb7i" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">18</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">11</div><div class="score unvoted">12</div><div class="score likes">13</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2geb7i/question_on_parsing_haskell_subset/" tabindex="1" >Question on Parsing Haskell Subset</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Sun Sep 14 20:34:56 2014 UTC" datetime="2014-09-14T20:34:56+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/hmltyp" class="author may-blank id-t2_fntm3" >hmltyp</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2geb7i/question_on_parsing_haskell_subset/" class="comments may-blank" >6 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gdl31 odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gdl31" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">19</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">21</div><div class="score unvoted">22</div><div class="score likes">23</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://www.lmcs-online.org/ojs/viewarticle.php?id=1469" tabindex="1" >Inferring Algebraic Effects</a>&#32;<span class="domain">(<a href="/domain/lmcs-online.org/">lmcs-online.org</a>)</span></p><p class="tagline">submitted&#32;<time title="Sun Sep 14 16:12:07 2014 UTC" datetime="2014-09-14T16:12:07+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/gallais" class="author may-blank id-t2_430kf" >gallais</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gdl31/inferring_algebraic_effects/" class="comments empty may-blank" >comment</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gd1hl even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gd1hl" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">20</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">16</div><div class="score unvoted">17</div><div class="score likes">18</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gd1hl/did_hackage_stop_building_packages/" tabindex="1" >Did hackage stop building packages?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Sun Sep 14 11:31:11 2014 UTC" datetime="2014-09-14T11:31:11+00:00" class="live-timestamp">3 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/45g" class="author may-blank id-t2_38gtg" >45g</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gd1hl/did_hackage_stop_building_packages/" class="comments may-blank" >10 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gcyy8 odd&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gcyy8" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">21</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">11</div><div class="score unvoted">12</div><div class="score likes">13</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gcyy8/bind_in_haskell_why_is_it_the_same_as_selectmany/" tabindex="1" >Bind (&gt;&gt;=) in haskell, why is it the same as SelectMany in Linq (C#) ?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Sun Sep 14 10:35:33 2014 UTC" datetime="2014-09-14T10:35:33+00:00" class="live-timestamp">3 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/binge_learner" class="author may-blank id-t2_duqpr" >binge_learner</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gcyy8/bind_in_haskell_why_is_it_the_same_as_selectmany/" class="comments may-blank" >13 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gfyuc even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gfyuc" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">22</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">0</div><div class="score unvoted">0</div><div class="score likes">0</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gfyuc/how_should_i_go_about_making_a_function_more/" tabindex="1" rel="nofollow" >How should I go about making a function more elegant?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Mon Sep 15 08:38:06 2014 UTC" datetime="2014-09-15T08:38:06+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/ninklo" class="author may-blank id-t2_97p38" >ninklo</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gfyuc/how_should_i_go_about_making_a_function_more/" class="comments may-blank" >12 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gewil odd&#32; link " onclick="click_thing(this)" data-fullname="t3_2gewil" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">23</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">0</div><div class="score unvoted">0</div><div class="score likes">0</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="http://gianolio.svbtle.com/project-euler-6-10" tabindex="1" rel="nofollow" >Haskell: Project Euler 6-10</a>&#32;<span class="domain">(<a href="/domain/gianolio.svbtle.com/">gianolio.svbtle.com</a>)</span></p><p class="tagline">submitted&#32;<time title="Mon Sep 15 00:17:55 2014 UTC" datetime="2014-09-15T00:17:55+00:00" class="live-timestamp">2 days ago</time>&#32;by&#32;<a href="http://www.reddit.com/user/megalodonon" class="author may-blank id-t2_ib666" >megalodonon</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gewil/haskell_project_euler_610/" class="comments may-blank" >3 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gcpn0 even&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gcpn0" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">24</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">3</div><div class="score unvoted">4</div><div class="score likes">5</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gcpn0/should_oo_classes_have_laws/" tabindex="1" >Should OO classes have laws?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Sun Sep 14 07:03:39 2014 UTC" datetime="2014-09-14T07:03:39+00:00" class="live-timestamp">3 days ago</time>&#32;<time class="edited-timestamp" title="last edited 3 days ago" datetime="2014-09-14T11:52:56+00:00">*</time>&#32;by&#32;<a href="http://www.reddit.com/user/togrof" class="author may-blank id-t2_frk3n" >togrof</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gcpn0/should_oo_classes_have_laws/" class="comments may-bram:</p><pre><code>\(a : *) -&gt; map a a (id a)</code></pre><p>The extra <code>'a'</code> business is because in any polymorphic lambda calculus you explicitly accept polymorphic types as arguments and specialize functions by applying them to types. Higher-level functional languages like Haskell or ML use type inference to automatically infer and supply type arguments when possible.</p><p>We can compile this program using the <code>morte</code> executable, which accepts a Morte program on <code>stdin</code>, outputs the program's type <code>stderr</code>, and outputs the optimized program on <code>stdout</code>:</p><pre><code>$ morte &lt; id.mt<br />∀(a : *) → (∀(x : *) → (a → x → x) → x → x) → ∀(x : *) → (a <br />→ x → x) → x → x<br /><br />λ(a : *) → λ(l : ∀(x : *) → (a → x → x) → x → x) → l</code></pre><p>The first line is the type, which is a desugared form of:</p><pre><code>forall a . List a -&gt; List a</code></pre><p>The second line is the program, which is the identity function on lists. Morte optimized away the <code>map</code> completely, the same way we did by hand.</p><p>Morte also optimized away the rest of the code, too. Dead-code elimination is just an emergent property of Morte's simple optimization scheme.</p><h4 id="equality">Equality</h4><p>We could double-check our answer by asking Morte to optimize the identity function on lists:</p><pre><code>-- idlist.mt<br /><br />(    \(List : * -&gt; *)<br />-&gt;   \(id   : forall (a : *) -&gt; a -&gt; a)<br /><br />    -&gt;   \(a : *) -&gt; id (List a)<br />)<br /><br />-- List<br />(\(a : *) -&gt; forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br /><br />-- id<br />(\(a : *) -&gt; \(va : a) -&gt; va)</code></pre><p>Sure enough, Morte outputs an alpha-equivalent result (meaning the same up to variable renaming):</p><pre><code>$ ~/.cabal/bin/morte &lt; idlist.mt<br />∀(a : *) → (∀(x : *) → (a → x → x) → x → x) → ∀(x : *) → (a <br />→ x → x) → x → x<br /><br />λ(a : *) → λ(va : ∀(x : *) → (a → x → x) → x → x) → va</code></pre><p>We can even use the <code>morte</code> library to mechanically check if two Morte expressions are alpha-, beta-, and eta- equivalent. We can parse our two Morte files into Morte's <code>Expr</code> type and then use the <code>Eq</code> instance for <code>Expr</code> to test for equivalence:</p><pre><code>$ ghci<br />Prelude&gt; import qualified Data.Text.Lazy.IO as Text<br />Prelude Text&gt; txt1 &lt;- Text.readFile "mapid.mt"<br />Prelude Text&gt; txt2 &lt;- Text.readFile "idlist.mt"<br />Prelude Text&gt; import Morte.Parser (exprFromText)<br />Prelude Text Morte.Parser&gt; let e1 = exprFromText txt1<br />Prelude Text Morte.Parser&gt; let e2 = exprFromText txt2<br />Prelude Text Morte.Parser&gt; import Control.Applicative (liftA2)<br />Prelude Text Morte.Parser Control.Applicative&gt; liftA2 (==) e1 e2<br />Right True<br />$ -- `Right` means both expressions parsed successfully<br />$ -- `True` means they are alpha-, beta-, and eta-equivalent</code></pre><p>We can use this to mechanically verify that two Morte programs optimize to the same result.</p><h4 id="compile-time-computation">Compile-time computation</h4><p>Morte can compute as much (or as little) at compile as you want. The more information you encode directly within lambda calculus, the more compile-time computation Morte will perform for you. For example, if we translate our Haskell <code>List</code> code entirely to lambda calculus, then Morte will statically compute the result at compile time.</p><pre><code>-- nine.mt<br /><br />(   \(Nat : *)<br />-&gt;  \(zero : Nat)<br />-&gt;  \(one : Nat)<br />-&gt;  \((+) : Nat -&gt; Nat -&gt; Nat)<br />-&gt;  \((*) : Nat -&gt; Nat -&gt; Nat)<br />-&gt;  \(List : * -&gt; *)<br />-&gt;  \(Cons : forall (a : *) -&gt; a -&gt; List a -&gt; List a)<br />-&gt;  \(Nil  : forall (a : *)                -&gt; List a)<br />-&gt;  \(  map<br />    :   forall (a : *) -&gt; forall (b : *)<br />    -&gt;  (a -&gt; b) -&gt; List a -&gt; List b<br />    )<br />-&gt;  \(  foldr<br />    :   forall (a : *)<br />    -&gt;  List a<br />    -&gt;  forall (r : *)<br />    -&gt;  (a -&gt; r -&gt; r) -&gt; r -&gt; r<br />    )<br />-&gt;  (    \(two   : Nat)<br />    -&gt;   \(three : Nat)<br />    -&gt;   (    \(example : List Nat)<br /><br />         -&gt;   foldr Nat (map Nat Nat ((+) one) example) Nat (+) zero<br />         )<br /><br />         -- example<br />         (Cons Nat one (Cons Nat two (Cons Nat three (Nil Nat))))<br />    )<br /><br />    -- two<br />    ((+) one one)<br /><br />    -- three<br />    ((+) one ((+) one one))<br />)<br /><br />-- Nat<br />(   forall (a : *)<br />-&gt;  (a -&gt; a)<br />-&gt;  a<br />-&gt;  a<br />)<br /><br />-- zero<br />(   \(a : *)<br />-&gt;  \(Succ : a -&gt; a)<br />-&gt;  \(Zero : a)<br />-&gt;  Zero<br />)<br /><br />-- one<br />(   \(a : *)<br />-&gt;  \(Succ : a -&gt; a)<br />-&gt;  \(Zero : a)<br />-&gt;  Succ Zero<br />)<br /><br />-- (+)<br />(   \(m : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />-&gt;  \(n : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />-&gt;  \(a : *)<br />-&gt;  \(Succ : a -&gt; a)<br />-&gt;  \(Zero : a)<br />-&gt;  m a Succ (n a Succ Zero)<br />)<br /><br />-- (*)<br />(   \(m : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />-&gt;  \(n : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />-&gt;  \(a : *)<br />-&gt;  \(Succ : a -&gt; a)<br />-&gt;  \(Zero : a)<br />-&gt;  m a (n a Succ) Zero<br />)<br /><br />-- List<br />(   \(a : *)<br />-&gt;  forall (x : *)<br />-&gt;  (a -&gt; x -&gt; x)  -- Cons<br />-&gt;  x              -- Nil<br />-&gt;  x<br />)<br /><br />-- Cons<br />(   \(a : *)<br />-&gt;  \(va  : a)<br />-&gt;  \(vas : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />-&gt;  \(x : *)<br />-&gt;  \(Cons : a -&gt; x -&gt; x)<br />-&gt;  \(Nil  : x)<br />-&gt;  Cons va (vas x Cons Nil)<br />)<br /><br />-- Nil<br />(   \(a : *)<br />-&gt;  \(x : *)<br />-&gt;  \(Cons : a -&gt; x -&gt; x)<br />-&gt;  \(Nil  : x)<br />-&gt;  Nil<br />)<br /><br />-- map<br />(   \(a : *)<br />-&gt;  \(b : *)<br />-&gt;  \(f : a -&gt; b)<br />-&gt;  \(l : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />-&gt;  \(x : *)<br />-&gt;  \(Cons : b -&gt; x -&gt; x)<br />-&gt;  \(Nil: x)<br />-&gt;  l x (\(va : a) -&gt; \(vx : x) -&gt; Cons (f va) vx) Nil<br />)<br /><br />-- foldr<br />(   \(a : *)<br />-&gt;  \(vas : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />-&gt;  vas<br />)</code></pre><p>The relevant line is:</p><pre><code>foldr Nat (map Nat Nat ((+) one) example) Nat (+) zero</code></pre><p>If you remove the type-applications to <code>Nat</code>, this parallels our original Haskell <code>example</code>. We can then evaluate this expression at compile time:</p><pre><code>$ morte &lt; nine.mt<br />∀(a : *) → (a → a) → a → a<br /><br />λ(a : *) → λ(Succ : a → a) → λ(Zero : a) → Succ (Succ (Succ <br />(Succ (Succ (Succ (Succ (Succ (Succ Zero))))))))</code></pre><p>Morte reduces our program to a church-encoded nine.</p><h4 id="run-time-computation">Run-time computation</h4><p>Morte does not force you to compute everything using lambda calculus at compile time. Suppose that we wanted to use machine arithmetic at run-time instead. We can do this by parametrizing our program on:</p><ul class="incremental"><li>the <code>Int</code> type,</li><li>operations on <code>Int</code>s, and</li><li>any integer literals we use</li></ul><p>We accept these "foreign imports" as ordinary arguments to our program:</p><pre><code>-- foreign.mt<br /><br />-- Foreign imports<br />    \(Int : *)                      -- Foreign type<br />-&gt;  \((+) : Int -&gt; Int -&gt; Int)      -- Foreign function<br />-&gt;  \((*) : Int -&gt; Int -&gt; Int)      -- Foreign function<br />-&gt;  \(lit@0 : Int)  -- Literal "1"  -- Foreign data<br />-&gt;  \(lit@1 : Int)  -- Literal "2"  -- Foreign data<br />-&gt;  \(lit@2 : Int)  -- Literal "3"  -- Foreign data<br />-&gt;  \(lit@3 : Int)  -- Literal "1"  -- Foreign data<br />-&gt;  \(lit@4 : Int)  -- Literal "0"  -- Foreign data<br /><br />-- The rest is compile-time lambda calculus<br />-&gt;  (   \(List : * -&gt; *)<br />    -&gt;  \(Cons : forall (a : *) -&gt; a -&gt; List a -&gt; List a)<br />    -&gt;  \(Nil  : forall (a : *)                -&gt; List a)<br />    -&gt;  \(  map<br />        :   forall (a : *)<br />        -&gt;  forall (b : *)<br />        -&gt;  (a -&gt; b) -&gt; List a -&gt; List b<br />        )<br />    -&gt;  \(  foldr<br />        :   forall (a : *)<br />        -&gt;  List a<br />        -&gt;  forall (r : *)<br />        -&gt;  (a -&gt; r -&gt; r) -&gt; r -&gt; r<br />        )<br />        -&gt;   (    \(example : List Int)<br /><br />             -&gt;   foldr Int (map Int Int ((+) lit@3) example) Int (+) lit@4<br />             )<br /><br />             -- example<br />             (Cons Int lit@0 (Cons Int lit@1 (Cons Int lit@2 (Nil Int))))<br />    )<br /><br />    -- List<br />    (   \(a : *)<br />    -&gt;  forall (x : *)<br />    -&gt;  (a -&gt; x -&gt; x)  -- Cons<br />    -&gt;  x              -- Nil<br />    -&gt;  x<br />    )<br /><br />    -- Cons<br />    (   \(a : *)<br />    -&gt;  \(va  : a)<br />    -&gt;  \(vas : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />    -&gt;  \(x : *)<br />    -&gt;  \(Cons : a -&gt; x -&gt; x)<br />    -&gt;  \(Nil  : x)<br />    -&gt;  Cons va (vas x Cons Nil)<br />    )<br /><br />    -- Nil<br />    (   \(a : *)<br />    -&gt;  \(x : *)<br />    -&gt;  \(Cons : a -&gt; x -&gt; x)<br />    -&gt;  \(Nil  : x)<br />    -&gt;  Nil<br />    )<br /><br />    -- map<br />    (   \(a : *)<br />    -&gt;  \(b : *)<br />    -&gt;  \(f : a -&gt; b)<br />    -&gt;  \(l : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />    -&gt;  \(x : *)<br />    -&gt;  \(Cons : b -&gt; x -&gt; x)<br />    -&gt;  \(Nil: x)<br />    -&gt;  l x (\(va : a) -&gt; \(vx : x) -&gt; Cons (f va) vx) Nil<br />    )<br /><br />    -- foldr<br />    (   \(a : *)<br />    -&gt;  \(vas : forall (x : *) -&gt; (a -&gt; x -&gt; x) -&gt; x -&gt; x)<br />    -&gt;  vas<br />    )</code></pre><p>We can use Morte to optimize the above program and Morte will reduce the program to nothing but foreign types, operations, and values:</p><pre><code>$ morte &lt; foreign.mt<br />∀(Int : *) → (Int → Int → Int) → (Int → Int → Int) → Int →<br />Int → Int → Int → Int → Int<br /><br />λ(Int : *) → λ((+) : Int → Int → Int) → λ((*) : Int → Int → <br />Int) → λ(lit : Int) → λ(lit@1 : Int) → λ(lit@2 : Int) → <br />λ(lit@3 : Int) → λ(lit@4 : Int) → (+) ((+) lit@3 lit) ((+) <br />((+) lit@3 lit@1) ((+) ((+) lit@3 lit@2) lit@4))</code></pre><p>If you study that closely, Morte adds <code>lit@3</code> (the "1" literal) to each literal of the list and then adds them up. We can then pass this foreign syntax tree to our machine arithmetic backend to transform those foreign operations to efficient operations.</p><p>Morte lets you choose how much information you want to encode within lambda calculus. The more information you encode in lambda calculus the more Morte can optimize your program, but the slower your compile times will get, so it's a tradeoff.</p><h4 id="corecursion">Corecursion</h4><p>Corecursion is the dual of recursion. Where recursion works on finite data types, corecursion works on potentially infinite data types. An example would be the following infinite <code>Stream</code> in Haskell:</p><pre><code>data Stream a = Cons a (Stream a)<br /><br />numbers :: Stream Int<br />numbers = go 0<br />  where<br />    go n = Cons n (go (n + 1))<br /><br />-- numbers = Cons 0 (Cons 1 (Cons 2 (...<br /><br />map :: (a -&gt; b) -&gt; Stream a -&gt; Stream b<br />map f (Cons a l) = Cons (f a) (map f l)<br /><br />example :: Stream Int<br />example = map (+ 1) numbers<br /><br />-- example = Cons 1 (Cons 2 (Cons 3 (...</code></pre><p>Again, pretend that we disable any function from referencing itself so that the above code becomes invalid. This time we cannot reuse the same trick from previous sections because we cannot encode <code>numbers</code> as a fold without referencing itself. Try this if you don't believe me.</p><p>However, we can still encode corecursive things in a non-corecursive way. This time, we encode our <code>Stream</code> type as an unfold instead of a fold:</p><pre><code>-- This is also valid Haskell code<br /><br />{-# LANGUAGE ExistentialQuantification #-}<br /><br />data Stream a = forall s . MkStream<br />    { seed :: s<br />    , step :: s -&gt; (a, s)<br />    }<br /><br />numbers :: Stream Int<br />numbers = MkStream 0 (\n -&gt; (n, n + 1))<br /><br />map :: (a -&gt; b) -&gt; Stream a -&gt; Stream b<br />map f (MkStream s0 k) = MkStream s0 k'<br />  where<br />    k' s = (f a, s')<br />      where (a, s') = k s </code></pre><p>In other words, we store an initial seed of some type <code>s</code> and a step function of type <code>s -&gt; (a, s)</code> that emits one element of our <code>Stream</code>. The type of our seed <code>s</code> can be anything and in our <code>numbers</code> example, the type of the internal state is <code>Int</code>. Another stream could use a completely different internal state of type <code>()</code>, like this:</p><pre><code>-- ones = Cons 1 ones<br /><br />ones :: Stream Int<br />ones = MkStream () (\_ -&gt; (1, ()))</code></pre><p>The general name for this trick is an "F-coalgebra" encoding of a corecursive type.</p><p>Once we encode our infinite stream non-recursively, we can safely optimize the stream by inlining and eta reduction:</p><pre><code>map id l<br /><br />-- l = MkStream s0 k<br />= map id (MkStream s0 k)<br /><br />-- Inline definition of `map`<br />= MkStream s0 k'<br />  where<br />    k' = \s -&gt; (id a, s')<br />      where<br />        (a, s') = k s<br /><br />-- Inline definition of `id`<br />= MkStream s0 k'<br />  where<br />    k' = \s -&gt; (a, s')<br />      where<br />        (a, s') = k s<br /><br />-- Inline: (a, s') = k s<br />= MkStream s0 k'<br />  where<br />    k' = \s -&gt; k s<br /><br />-- Eta reduce<br />= MkStream s0 k'<br />  where<br />    k' = k<br /><br />-- Inline: k' = k<br />= MkStream s0 k<br /><br />-- l = MkStream s0 k<br />= l</code></pre><p>Now let's encode <code>Stream</code> and <code>map</code> in Morte and compile the following four expressions:</p><pre><code>map id<br /><br />id<br /><br />map f . map g<br /><br />map (f . g)</code></pre><p>Save the following Morte file to <code>stream.mt</code> and then uncomment the expression you want to test:</p><pre><code>(   \(id : forall (a : *) -&gt; a -&gt; a)<br />-&gt;  \(  (.)<br />    :   forall (a : *)<br />    -&gt;  forall (b : *)<br />    -&gt;  forall (c : *)<br />    -&gt;  (b -&gt; c)<br />    -&gt;  (a -&gt; b)<br />    -&gt;  (a -&gt; c)<br />    )<br />-&gt;  \(Pair : * -&gt; * -&gt; *)<br />-&gt;  \(P : forall (a : *) -&gt; forall (b : *) -&gt; a -&gt; b -&gt; Pair a b)<br />-&gt;  \(  first<br />    :   forall (a : *)<br />    -&gt;  forall (b : *)<br />    -&gt;  forall (c : *)<br />    -&gt;  (a -&gt; b)<br />    -&gt;  Pair a c<br />    -&gt;  Pair b c<br />    )<br /><br />-&gt;  (   \(Stream : * -&gt; *)<br />    -&gt;  \(  map<br />        :   forall (a : *)<br />        -&gt;  forall (b : *)<br />        -&gt;  (a -&gt; b)<br />        -&gt;  Stream a<br />        -&gt;  Stream b<br />        )<br /><br />        -- example@1 = example@2<br />    -&gt;  (   \(example@1 : forall (a : *) -&gt; Stream a -&gt; Stream a)<br />        -&gt;  \(example@2 : forall (a : *) -&gt; Stream a -&gt; Stream a)<br /><br />        -- example@3 = example@4<br />        -&gt;  \(  example@3<br />            :   forall (a : *)<br />            -&gt;  forall (b : *)<br />            -&gt;  forall (c : *)<br />            -&gt;  (b -&gt; c)<br />            -&gt;  (a -&gt; b)<br />            -&gt;  Stream a<br />            -&gt;  Stream c<br />            )<br /><br />        -&gt;  \(  example@4<br />            :   forall (a : *)<br />            -&gt;  forall (b : *)<br />            -&gt;  forall (c : *)<br />            -&gt;  (b -&gt; c)<br />            -&gt;  (a -&gt; b)<br />            -&gt;  Stream a<br />            -&gt;  Stream c<br />            )<br /><br />        -- Uncomment the example you want to test<br />        -&gt;  example@1<br />--      -&gt;  example@2<br />--      -&gt;  example@3<br />--      -&gt;  example@4<br />        )<br /><br />        -- example@1<br />        (\(a : *) -&gt; map a a (id a))<br /><br />        -- example@2<br />        (\(a : *) -&gt; id (Stream a))<br /><br />        -- example@3<br />        (   \(a : *)<br />        -&gt;  \(b : *)<br />        -&gt;  \(c : *)<br />        -&gt;  \(f : b -&gt; c)<br />        -&gt;  \(g : a -&gt; b)<br />        -&gt;  map a c ((.) a b c f g)<br />        )<br /><br />        --  example@4<br />        (   \(a : *)<br />        -&gt;  \(b : *)<br />        -&gt;  \(c : *)<br />        -&gt;  \(f : b -&gt; c)<br />        -&gt;  \(g : a -&gt; b)<br />        -&gt;  (.) (Stream a) (Stream b) (Stream c) (map b c f) (map a b g)<br />        )<br />    )<br /><br />    -- Stream<br />    (   \(a : *)<br />    -&gt;  forall (x : *)<br />    -&gt;  (forall (s : *) -&gt; s -&gt; (s -&gt; Pair a s) -&gt; x)<br />    -&gt;  x<br />    )<br /><br />    -- map<br />    (   \(a : *)<br />    -&gt;  \(b : *)<br />    -&gt;  \(f : a -&gt; b)<br />    -&gt;  \(  st<br />        :   forall (x : *)<br />        -&gt; (forall (s : *) -&gt; s -&gt; (s -&gt; Pair a s) -&gt; x)<br />        -&gt; x<br />        )<br />    -&gt;  \(x : *)<br />    -&gt;  \(S : forall (s : *) -&gt; s -&gt; (s -&gt; Pair b s) -&gt; x)<br />    -&gt;  st<br />        x<br />        (   \(s : *)<br />        -&gt;  \(seed : s)<br />        -&gt;  \(step : s -&gt; Pair a s)<br />        -&gt;  S<br />            s<br />            seed<br />            (\(seed@1 : s) -&gt; first a b s f (step seed@1))<br />        )<br />    )<br />)<br /><br />-- id<br />(\(a : *) -&gt; \(va : a) -&gt; va)<br /><br />-- (.)<br />(   \(a : *)<br />-&gt;  \(b : *)<br />-&gt;  \(c : *)<br />-&gt;  \(f : b -&gt; c)<br />-&gt;  \(g : a -&gt; b)<br />-&gt;  \(va : a)<br />-&gt;  f (g va)<br />)<br /><br />-- Pair<br />(\(a : *) -&gt; \(b : *) -&gt; forall (x : *) -&gt; (a -&gt; b -&gt; x) -&gt; x)<br /><br />-- P<br />(   \(a : *)<br />-&gt;  \(b : *)<br />-&gt;  \(va : a)<br />-&gt;  \(vb : b)<br />-&gt;  \(x : *)<br />-&gt;  \(P : a -&gt; b -&gt; x)<br />-&gt;  P va vb<br />)<br /><br />-- first<br />(   \(a : *)<br />-&gt;  \(b : *)<br />-&gt;  \(c : *)<br />-&gt;  \(f : a -&gt; b)<br />-&gt;  \(p : forall (x : *) -&gt; (a -&gt; c -&gt; x) -&gt; x)<br />-&gt;  \(x : *)<br />-&gt;  \(Pair : b -&gt; c -&gt; x)<br />-&gt;  p x (\(va : a) -&gt; \(vc : c) -&gt; Pair (f va) vc)<br />)</code></pre><p>Both <code>example@1</code> and <code>example@2</code> will generate alpha-equivalent code:</p><pre><code>$ morte &lt; example1.mt<br />∀(a : *) → (∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (a → <br />s → x) → x) → x) → x) → ∀(x : *) → (∀(s : *) → s → (s → ∀(x<br /> : *) → (a → s → x) → x) → x) → x<br /><br />λ(a : *) → λ(st : ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) →<br /> (a → s → x) → x) → x) → x) → st<br /><br />$ morte &lt; example2.mt<br />∀(a : *) → (∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (a → <br />s → x) → x) → x) → x) → ∀(x : *) → (∀(s : *) → s → (s → ∀(x<br /> : *) → (a → s → x) → x) → x) → x<br /><br />λ(a : *) → λ(va : ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) →<br /> (a → s → x) → x) → x) → x) → va</code></pre><p>Similarly, <code>example@3</code> and <code>example@4</code> will generate alpha-equivalent code:</p><pre><code>$ morte &lt; example3.mt<br />∀(a : *) → ∀(b : *) → ∀(c : *) → (b → c) → (a → b) → (∀(x : <br />*) → (∀(s : *) → s → (s → ∀(x : *) → (a → s → x) → x) → x) →<br /> x) → ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (c → s → x)<br /> → x) → x) → x<br /><br />λ(a : *) → λ(b : *) → λ(c : *) → λ(f : b → c) → λ(g : a → b)<br /> → λ(st : ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (a → s <br />→ x) → x) → x) → x) → λ(x : *) → λ(S : ∀(s : *) → s → (s → ∀<br />(x : *) → (c → s → x) → x) → x) → st x (λ(s : *) → λ(seed : <br />s) → λ(step : s → ∀(x : *) → (a → s → x) → x) → S s seed (λ(<br />seed@1 : s) → λ(x : *) → λ(Pair : c → s → x) → step seed@1 x<br /> (λ(va : a) → Pair (f (g va)))))<br /><br />$ morte &lt; example4.mt<br />∀(a : *) → ∀(b : *) → ∀(c : *) → (b → c) → (a → b) → (∀(x : <br />*) → (∀(s : *) → s → (s → ∀(x : *) → (a → s → x) → x) → x) →<br /> x) → ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (c → s → x)<br /> → x) → x) → x<br /><br />λ(a : *) → λ(b : *) → λ(c : *) → λ(f : b → c) → λ(g : a → b)<br /> → λ(va : ∀(x : *) → (∀(s : *) → s → (s → ∀(x : *) → (a → s <br />→ x) → x) → x) → x) → λ(x : *) → λ(S : ∀(s : *) → s → (s → ∀<br />(x : *) → (c → s → x) → x) → x) → va x (λ(s : *) → λ(seed : <br />s) → λ(step : s → ∀(x : *) → (a → s → x) → x) → S s seed (λ(<br />seed@1 : s) → λ(x : *) → λ(Pair : c → s → x) → step seed@1 x<br /> (λ(va : a) → Pair (f (g va))))</code></pre><p>We inadvertently proved stream fusion for free, but we're still not done, yet! Everything we learn about recursive and corecursive sequences can be applied to model recursive and corecursive effects!</p><h4 id="effects">Effects</h4><p>I will conclude this post by showing how to model both recursive and corecursive programs that have side effects. The recursive program will echo ninety-nine lines from <code>stdin</code> to <code>stdout</code>. The equivalent Haskell program is in the comment header:</p><pre><code>-- recursive.mt<br /><br />-- The Haskell code we will translate to Morte:<br />--<br />--     import Prelude hiding (<br />--         (+), (*), IO, putStrLn, getLine, (&gt;&gt;=), (&gt;&gt;), return )<br />-- <br />--     -- Simple prelude<br />--<br />--     data Nat = Succ Nat | Zero<br />--<br />--     zero :: Nat<br />--     zero = Zero<br />--<br />--     one :: Nat<br />--     one = Succ Zero<br />--<br />--     (+) :: Nat -&gt; Nat -&gt; Nat<br />--     Zero   + n = n<br />--     Succ m + n = m + Succ n<br />--<br />--     (*) :: Nat -&gt; Nat -&gt; Nat<br />--     Zero   * n = Zero<br />--     Succ m * n = n + (m * n)<br />--<br />--     foldNat :: Nat -&gt; (a -&gt; a) -&gt; a -&gt; a<br />--     foldNat  Zero    f x = x<br />--     foldNat (Succ m) f x = f (foldNat m f x)<br />--<br />--     data IO r<br />--         = PutStrLn String (IO r)<br />--         | GetLine (String -&gt; IO r)<br />--         | Return r<br />--<br />--     putStrLn :: String -&gt; IO U<br />--     putStrLn str = PutStrLn str (Return Unit)<br />--<br />--     getLine :: IO String<br />--     getLine = GetLine Return<br />--<br />--     return :: a -&gt; IO a<br />--     return = Return<br />--<br />--     (&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b<br />--     PutStrLn str io &gt;&gt;= f = PutStrLn str (io &gt;&gt;= f)<br />--     GetLine k       &gt;&gt;= f = GetLine (\str -&gt; k str &gt;&gt;= f)<br />--     Return r        &gt;&gt;= f = f r<br />--<br />--     -- Derived functions<br />--<br />--     (&gt;&gt;) :: IO U -&gt; IO U -&gt; IO U<br />--     m &gt;&gt; n = m &gt;&gt;= \_ -&gt; n<br />--<br />--     two :: Nat<br />--     two = one + one<br />--<br />--     three :: Nat<br />--     three = one + one + one<br />--<br />--     four :: Nat<br />--     four = one + one + one + one<br />--<br />--     five :: Nat<br />--     five = one + one + one + one + one<br />--<br />--     six :: Nat<br />--     six = one + one + one + one + one + one<br />--<br />--     seven :: Nat<br />--     seven = one + one + one + one + one + one + one<br />--<br />--     eight :: Nat<br />--     eight = one + one + one + one + one + one + one + one<br />--<br />--     nine :: Nat<br />--     nine = one + one + one + one + one + one + one + one + one<br />--<br />--     ten :: Nat<br />--     ten = one + one + one + one + one + one + one + one + one + one<br />--<br />--     replicateM_ :: Nat -&gt; IO U -&gt; IO U<br />--     replicateM_ n io = foldNat n (io &gt;&gt;) (return Unit)<br />--<br />--     ninetynine :: Nat<br />--     ninetynine = nine * ten + nine<br />--<br />--     main_ :: IO U<br />--     main_ = getLine &gt;&gt;= putStrLn<br /><br />-- "Free" variables<br />(   \(String : *   )<br />-&gt;  \(U : *)<br />-&gt;  \(Unit : U)<br /><br />    -- Simple prelude<br />-&gt;  (   \(Nat : *)<br />    -&gt;  \(zero : Nat)<br />    -&gt;  \(one : Nat)<br />    -&gt;  \((+) : Nat -&gt; Nat -&gt; Nat)<br />    -&gt;  \((*) : Nat -&gt; Nat -&gt; Nat)<br />    -&gt;  \(foldNat : Nat -&gt; forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />    -&gt;  \(IO : * -&gt; *)<br />    -&gt;  \(return : forall (a : *) -&gt; a -&gt; IO a)<br />    -&gt;  \((&gt;&gt;=)<br />        :   forall (a : *)<br />        -&gt;  forall (b : *)<br />        -&gt;  IO a<br />        -&gt;  (a -&gt; IO b)<br />        -&gt;  IO b<br />        )<br />    -&gt;  \(putStrLn : String -&gt; IO U)<br />    -&gt;  \(getLine : IO String)<br /><br />        -- Derived functions<br />    -&gt;  (   \((&gt;&gt;) : IO U -&gt; IO U -&gt; IO U)<br />        -&gt;  \(two   : Nat)<br />        -&gt;  \(three : Nat)<br />        -&gt;  \(four  : Nat)<br />        -&gt;  \(five  : Nat)<br />        -&gt;  \(six   : Nat)<br />        -&gt;  \(seven : Nat)<br />        -&gt;  \(eight : Nat)<br />        -&gt;  \(nine  : Nat)<br />        -&gt;  \(ten   : Nat)<br />        -&gt;  (   \(replicateM_ : Nat -&gt; IO U -&gt; IO U)<br />            -&gt;  \(ninetynine : Nat)<br /><br />            -&gt;  replicateM_ ninetynine ((&gt;&gt;=) String U getLine putStrLn)<br />            )<br /><br />            -- replicateM_<br />            (   \(n : Nat)<br />            -&gt;  \(io : IO U)<br />            -&gt;  foldNat n (IO U) ((&gt;&gt;) io) (return U Unit)<br />            )<br /><br />            -- ninetynine<br />            ((+) ((*) nine ten) nine)<br />        )<br /><br />        -- (&gt;&gt;)<br />        (   \(m : IO U)<br />        -&gt;  \(n : IO U)<br />        -&gt;  (&gt;&gt;=) U U m (\(_ : U) -&gt; n)<br />        )<br /><br />        -- two<br />        ((+) one one)<br /><br />        -- three<br />        ((+) one ((+) one one))<br /><br />        -- four<br />        ((+) one ((+) one ((+) one one)))<br /><br />        -- five<br />        ((+) one ((+) one ((+) one ((+) one one))))<br /><br />        -- six<br />        ((+) one ((+) one ((+) one ((+) one ((+) one one)))))<br /><br />        -- seven<br />        ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one one))))))<br /><br />        -- eight<br />        ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one one)))))))<br />        -- nine<br />        ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one one))))))))<br /><br />        -- ten<br />        ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one ((+) one one)))))))))<br />    )<br /><br />    -- Nat<br />    (   forall (a : *)<br />    -&gt;  (a -&gt; a)<br />    -&gt;  a<br />    -&gt;  a<br />    )<br /><br />    -- zero<br />    (   \(a : *)<br />    -&gt;  \(Succ : a -&gt; a)<br />    -&gt;  \(Zero : a)<br />    -&gt;  Zero<br />    )<br /><br />    -- one<br />    (   \(a : *)<br />    -&gt;  \(Succ : a -&gt; a)<br />    -&gt;  \(Zero : a)<br />    -&gt;  Succ Zero<br />    )<br /><br />    -- (+)<br />    (   \(m : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />    -&gt;  \(n : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />    -&gt;  \(a : *)<br />    -&gt;  \(Succ : a -&gt; a)<br />    -&gt;  \(Zero : a)<br />    -&gt;  m a Succ (n a Succ Zero)<br />    )<br /><br />    -- (*)<br />    (   \(m : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<blank" >15 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class=" thing id-t3_2gbne7 odd&#32; link self" onclick="click_thing(this)" data-fullname="t3_2gbne7" data-ups="?" data-downs="?" ><p class="parent"></p><span class="rank">25</span><div class="midcol unvoted" ><div class="arrow up login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="upvote" tabindex="0" ></div><div class="score dislikes">6</div><div class="score unvoted">7</div><div class="score likes">8</div><div class="arrow down login-required" onclick="$(this).vote(r.config.vote_hash, null, event)" role="button" aria-label="downvote" tabindex="0" ></div></div><div class="entry unvoted"><p class="title"><a class="title may-blank " href="/r/haskell/comments/2gbne7/i_found_a_way_to_implement_a_very_unsafe_law_of/" tabindex="1" >I found a way to implement a (very unsafe) 'law of the excluded middle' function in haskell. Just how unsafe is this?</a>&#32;<span class="domain">(<a href="/r/haskell/">self.haskell</a>)</span></p><div class="expando-button collapsed selftext" onclick="expando_child(this)"></div><p class="tagline">submitted&#32;<time title="Sat Sep 13 22:22:10 2014 UTC" datetime="2014-09-13T22:22:10+00:00" class="live-timestamp">3 days ago</time>&#32;<time class="edited-timestamp" title="last edited 3 days ago" datetime="2014-09-13T23:10:12+00:00">*</time>&#32;by&#32;<a href="http://www.reddit.com/user/sebzim4500" class="author may-blank id-t2_5a7wc" >sebzim4500</a><span class="userattrs"></span></p><ul class="flat-list buttons"><li class="first"><a href="http://www.reddit.com/r/haskell/comments/2gbne7/i_found_a_way_to_implement_a_very_unsafe_law_of/" class="comments may-blank" >17 comments</a></li><li class="share"><span class="share-button toggle" style="" ><a class="option active login-required" href="#" tabindex="100" >share</a><a class="option " href="#">cancel</a></span></li></ul><div class="expando" style='display: none'><span class="error">loading...</span></div></div><div class="child" ></div><div class="clearleft"></div></div><div class="clearleft"></div><div class="nav-buttons"><span class="nextprev">view more:&#32;<a href="http://www.reddit.com/r/haskell/?count=25&amp;after=t3_2gbne7" rel="nofollow next" >next &rsaquo;</a></span></div></div></div></div><div class="footer-parent"><div by-zero class="footer rounded"><div class="col"><ul class="flat-vert hover" ><li class="flat-vert title">about</li><li ><a href="http://www.reddit.com/blog/" class="choice" >blog</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/about/" class="choice" >about</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/about/team/" class="choice" >team</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/code/" class="choice" >source code</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/advertising/" class="choice" >advertise</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/r/redditjobs/" class="choice" >jobs</a></li></ul></div><div class="col"><ul class="flat-vert hover" ><li class="flat-vert title">help</li><li ><a href="http://www.reddit.com/wiki/" class="choice" >wiki</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/wiki/faq" class="choice" >FAQ</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/wiki/reddiquette" class="choice" >reddiquette</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/rules/" class="choice" >rules</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/contact/" class="choice" >contact us</a></li></ul></div><div class="col"><ul class="flat-vert hover" ><li class="flat-vert title">tools</li><li ><a href="http://i.reddit.com" class="choice" >mobile</a></li><li ><span class="separator"></span><a href="https://addons.mozilla.org/firefox/addon/socialite/" class="choice" >firefox extension</a></li><li ><span class="separator"></span><a href="https://chrome.google.com/webstore/detail/algjnflpgoopkdijmkalfcifomdhmcbe" class="choice" >chrome extension</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/r/haskell/buttons/" class="choice" >buttons</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/r/haskell/widget/" class="choice" >widget</a></li></ul></div><div class="col"><ul class="flat-vert hover" ><li class="flat-vert title">&lt;3</li><li ><a href="http://www.reddit.com/gold/about/" class="buygold choice" >reddit gold</a></li><li ><span class="separator"></span><a href="http://www.reddit.com/store/" class="choice" >store</a></li><li ><span class="separator"></span><a href="http://redditgifts.com" class="choice" >redditgifts</a></li><li ><span class="separator"></span><a href="http://reddit.tv" class="choice" >reddit.tv</a></li><li ><span class="separator"></span><a href="http://radioreddit.com" class="choice" >radio reddit</a></li></ul></div></div><p class="bottommenu">Use of this site constitutes acceptance of our&#32;<a href="http://www.reddit.com/help/useragreement" >User Agreement</a>&#32;and&#32;<a href="http://www.reddit.com/help/privacypolicy" >Privacy Policy</a>. &copy; 2014 reddit inc. All rights reserved.</p><p class="bottommenu">REDDIT and the ALIEN Logo are registered trademarks of reddit inc.</p></div><div class="login-popup cover-overlay" style="display: none"><div class="cover" onclick="return hidecover(this)"></div><div class="popup"><a href="#" onclick="return hidecover(this)" class="hidecover">close this window</a><h1 class="cover-msg">you'll need to login or register to do that</h1><div class="login-form-section divide register"><h3>create a new account</h3><p class="tagline">all it takes is a username and password</p><div class="registration-info"><div class="md wiki"><h3>privacy philosophy</h3>
<ul>
<li>we limit data collected about you and your use of the platform,</li>
<li>your personal information is never for sale,</li>
<li>we use and disclose information to prevent people from abusing the platform, but</li>
<li>we never disclose it for any other reason unless required by law.</li>
</ul>
<p>for more information, see our <a href="/help/privacypolicy" rel="nofollow" target="_blank">privacy policy</a>.</p>
</div>
</div><form id="login_reg" method="post" action="https://ssl.reddit.com/r/haskell/post/reg" class="user-form register-form"><input type="hidden" name="op" value="reg" /><div><ul><li class="name-entry"><label for="user_reg">username:</label><input value="" name="user" id="user_reg" type="text" maxlength="20" tabindex="2" autofocus /><span class="throbber"></span><span class="notice-taken">try another</span><span class="notice-available">available!</span><span class="error BAD_USERNAME field-user" style="display:none"></span><span class="error USERNAME_TAKEN field-user" style="display:none"></span><span class="error USERNAME_TAKEN_DEL field-user" style="display:none"></span></li><li><label for="email_reg">account recovery email: &nbsp;<i>(optional)</i></label><input value="" name="email" id="email_reg" type="email" maxlength="50" tabindex="2"/><label for="email_reg" class="note">we only send email at your request</label><span class="error BAD_EMAILS field-email" style="display:none"></span></li><li><label for="passwd_reg">password:</label><input id="passwd_reg" name="passwd" type="password" tabindex="2"/><span class="error BAD_PASSWORD field-passwd" style="display:none"></span></li><li><label for="passwd2_reg">verify password:</label><input name="passwd2" id="passwd2_reg" type="password" tabindex="2"/><span class="error BAD_PASSWORD_MATCH field-passwd2" style="display:none"></span></li><li><table><tr><td></td><td><input name="iden" value="7OrIUM1CrHt68MEF2XD9pz4CqygPrED6" type="hidden"/><img class="capimage" alt="visual CAPTCHA" src="//www.redditstatic.com/kill.png" /></td></tr><tr><td align="right"></td><td><input class="captcha cap-text" id="captcha_" name="captcha" type="text" size="30" placeholder="type the letters from the image above" tabindex="2" /></td><td><span class="error BAD_CAPTCHA field-captcha" style="display:none"></span></td></tr></table></li><li><input type="checkbox" name="rem" id="rem_reg" tabindex="2" /><label for="rem_reg" class="remember">remember me</label></li></ul><p class="submit"><button type="submit" class="button" tabindex="2">create account</button><span class="throbber"></span><span class="status"></span><span class="error RATELIMIT field-ratelimit" style="display:none"></span><span class="error RATELIMIT field-vdelay" style="display:none"></span></p></div></form><p><span class="orangered">is it really that easy? only one way to find out...</span></p></div><div class="login-form-section login"><h3>login</h3><p class="tagline">already have an account and just want to login?</p><form id="login_login" method="post" action="https://ssl.reddit.com/r/haskell/post/login" class="user-form login-form"><input type="hidden" name="op" value="login" /><div><ul><li class="name-entry"><label for="user_login">username:</label><input value="" name="user" id="user_login" type="text" maxlength="20" tabindex="3" autofocus /></li><li><label for="passwd_login">password:</label><input id="passwd_login" name="passwd" type="password" tabindex="3"/><span class="error WRONG_PASSWORD field-passwd" style="display:none"></span></li><li><input type="checkbox" name="rem" id="rem_login" tabindex="3" /><label for="rem_login" class="remember">remember me</label></li><li><a class="recover-password" href="/password">recover password</a></li></ul><p class="submit"><button type="submit" class="button" tabindex="3">login</button><span class="throbber"></span><span class="status"></span></p></div></form></div><div class="clear"></div></div></div><div class="lang-popup cover-overlay" style="display: none"><div class="cover" onclick="return hidecover(this)"></div><div class="popup"><a href="#" onclick="return hidecover(this)" class="hidecover">close this window</a><form action="http://www.reddit.com/post/unlogged_options" method="post" class="pretty-form short-text"><input type="hidden" name="uh" value="" /><table class="content preftable"><tr><th>interface language</th><td class="prefright"><select id="lang" name="lang"><option selected='selected' value="en">English [en]</option><option value="ar">العربية [ar]</option><option value="be">Беларуская мова [be]</option><option value="bg">български език [bg]</option><option value="bs">Bosanski [bs]</option><option value="ca">català [ca]</option><option value="cs">česky [cs]</option><option value="da">dansk [da]</option><option value="de">Deutsch [de]</option><option value="el">Ελληνικά [el]</option><option value="en-au">English (Australia) [en-au]</option><option value="en-ca">English (Canadian) [en-ca]</option><option value="en-gb">English (Great Britain) [en-gb]</option><option value="en-us">English [en-us]</option><option value="eo">Esperanto [eo]</option><option value="es">español [es]</option><option value="es-ar">español [es-ar]</option><option value="et">eesti keel [et]</option><option value="eu">Euskara [eu]</option><option value="fa">فارسی [fa]</option><option value="fi">suomi [fi]</option><option value="fr">français [fr]</option><option value="gd">Gàidhlig [gd]</option><option value="he">עברית [he]</option><option value="hi">मानक हिन्दी [hi]</option><option value="hr">hrvatski [hr]</option><option value="hu">Magyar [hu]</option><option value="hy">Հայերեն լեզու [hy]</option><option value="id">Bahasa Indonesia [id]</option><option value="is">íslenska [is] (*)</option><option value="it">italiano (Italy) [it]</option><option value="ja">日本語 [ja]</option><option value="kn_IN">ಕನ್ನಡ [kn_IN]</option><option value="ko">한국어 [ko]</option><option value="la">Latin [la]</option><option value="leet">1337 [leet]</option><option value="lol">LOL [lol]</option><option value="lt">lietuvių kalba [lt]</option><option value="lv">latviešu valoda [lv]</option><option value="nl">Nederlands [nl]</option><option value="nn">Nynorsk [nn]</option><option value="no">Norsk [no]</option><option value="pir">Arrrrrrrr! [pir]</option><option value="pl">polski [pl]</option><option value="pt">português [pt] (*)</option><option value="pt-pt">português [pt-pt]</option><option value="pt_BR">português brasileiro [pt_BR]</option><option value="ro">română [ro]</option><option value="ru">русский [ru]</option><option value="sk">slovenčina [sk]</option><option value="sl">slovenščina [sl]</option><option value="sr">српски језик [sr]</option><option value="sr-la">Srpski [sr-la]</option><option value="sv">Svenska [sv]</option><option value="ta">தமிழ் [ta]</option><option value="th">ภาษาไทย [th]</option><option value="tr">Türkçe [tr]</option><option value="uk">українська мова [uk]</option><option value="vi">Tiếng Việt [vi]</option><option value="zh">中文 [zh]</option></select>&#32;<span class="little gray hover">(*) incomplete &#32;<a href="http://www.reddit.com/r/i18n/wiki/getting_started">volunteer to translate</a></span></td></tr><tr><td><input type="submit" class="btn" value="save options"/></td></tr></table></form></div></div><p class="debuginfo"><span class="icon">&pi;</span>&nbsp;<span class="content">Rendered by PID 8212 on&#32; app-219 &#32;at 2014-09-17 12:34:37.228177+00:00 running f8bfedc country code: GB.</span></p><script type="text/javascript" src="//www.redditstatic.com/reddit.en.39xfwxyPLKU.js"></script></body></html>r />    -&gt;  \(n : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />    -&gt;  \(a : *)<br />    -&gt;  \(Succ : a -&gt; a)<br />    -&gt;  \(Zero : a)<br />    -&gt;  m a (n a Succ) Zero<br />    )<br /><br />    -- foldNat<br />    (   \(n : forall (a : *) -&gt; (a -&gt; a) -&gt; a -&gt; a)<br />    -&gt;  n<br />    )<br /><br />    -- IO<br />    (   \(r : *)<br />    -&gt;  forall (x : *)<br />    -&gt;  (String -&gt; x -&gt; x)<br />    -&gt;  ((String -&gt; x) -&gt; x)<br />    -&gt;  (r -&gt; x)<br />    -&gt;  x<br />    )<br /><br />    -- return<br />    (   \(a : *)<br />    -&gt;  \(va : a)<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; x -&gt; x)<br />    -&gt;  \(GetLine : (String -&gt; x) -&gt; x)<br />    -&gt;  \(Return : a -&gt; x)<br />    -&gt;  Return va<br />    )<br /><br />    -- (&gt;&gt;=)<br />    (   \(a : *)<br />    -&gt;  \(b : *)<br />    -&gt;  \(m : forall (x : *)<br />        -&gt;  (String -&gt; x -&gt; x)<br />        -&gt;  ((String -&gt; x) -&gt; x)<br />        -&gt;  (a -&gt; x)<br />        -&gt;  x<br />        )<br />    -&gt;  \(f : a<br />        -&gt;  forall (x : *)<br />        -&gt; (String -&gt; x -&gt; x)<br />        -&gt; ((String -&gt; x) -&gt; x)<br />        -&gt; (b -&gt; x)<br />        -&gt; x<br />        )<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; x -&gt; x)<br />    -&gt;  \(GetLine : (String -&gt; x) -&gt; x)<br />    -&gt;  \(Return : b -&gt; x)<br />    -&gt;  m x PutStrLn GetLine (\(va : a) -&gt; f va x PutStrLn GetLine Return)<br />    )<br /><br />    -- putStrLn<br />    (   \(str : String)<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; x -&gt; x  )<br />    -&gt;  \(GetLine  : (String -&gt; x) -&gt; x)<br />    -&gt;  \(Return   : U -&gt; x)<br />    -&gt;  PutStrLn str (Return Unit)<br />    )<br /><br />    -- getLine<br />    (   \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; x -&gt; x  )<br />    -&gt;  \(GetLine  : (String -&gt; x) -&gt; x)<br />    -&gt;  \(Return   : String -&gt; x)<br />    -&gt; GetLine Return<br />    )<br />)</code></pre><p>This program will compile to a completely unrolled read-write loop, as most recursive programs will:</p><pre><code>$ morte &lt; recursive.mt<br />∀(String : *) → ∀(U : *) → U → ∀(x : *) → (String → x → x) →<br /> ((String → x) → x) → (U → x) → x<br /><br />λ(String : *) → λ(U : *) → λ(Unit : U) → λ(x : *) → λ(PutStr<br />Ln : String → x → x) → λ(GetLine : (String → x) → x) → λ(Ret<br />urn : U → x) → GetLine (λ(va : String) → PutStrLn va (GetLin<br />e (λ(va@1 : String) → PutStrLn va@1 (GetLine (λ(va@2 : Strin<br />g) → PutStrLn va@2 (GetLine (λ(va@3 : String) → PutStrLn ...<br /> &lt;snip&gt;<br />... GetLine (λ(va@92 : String) → PutStrLn va@92 (GetLine (λ(<br />va@93 : String) → PutStrLn va@93 (GetLine (λ(va@94 : String)<br /> → PutStrLn va@94 (GetLine (λ(va@95 : String) → PutStrLn va@<br />95 (GetLine (λ(va@96 : String) → PutStrLn va@96 (GetLine (λ(<br />va@97 : String) → PutStrLn va@97 (GetLine (λ(va@98 : String)<br /> → PutStrLn va@98 (Return Unit))))))))))))))))))))))))))))))<br />))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))<br />))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))<br />))))))))))))))))))))))))))))))))))))))))))))))))</code></pre><p>In contrast, if we encode the effects corecursively we can express a program that echoes indefinitely from <code>stdin</code> to <code>stdout</code>:</p><pre><code>-- corecursive.mt<br /><br />-- data IOF r s<br />--     = PutStrLn String s<br />--     | GetLine (String -&gt; s)<br />--     | Return r<br />--<br />-- data IO r = forall s . MkIO s (s -&gt; IOF r s)<br />--<br />-- main = MkIO<br />--     Nothing<br />--     (maybe (\str -&gt; PutStrLn str Nothing) (GetLine Just))<br /><br />(   \(String : *)<br />-&gt;  (   \(Maybe : * -&gt; *)<br />    -&gt;  \(Just : forall (a : *) -&gt; a -&gt; Maybe a)<br />    -&gt;  \(Nothing : forall (a : *) -&gt; Maybe a)<br />    -&gt;  \(  maybe<br />        :   forall (a : *)<br />        -&gt;  Maybe a<br />        -&gt;  forall (x : *)<br />        -&gt;  (a -&gt; x)<br />        -&gt;  x<br />        -&gt;  x<br />        )<br />    -&gt;  \(IOF : * -&gt; * -&gt; *)<br />    -&gt;  \(  PutStrLn<br />        :   forall (r : *)<br />        -&gt;  forall (s : *)<br />        -&gt;  String<br />        -&gt;  s<br />        -&gt;  IOF r s<br />        )<br />    -&gt;  \(  GetLine<br />        :   forall (r : *)<br />        -&gt;  forall (s : *)<br />        -&gt;  (String -&gt; s)<br />        -&gt;  IOF r s<br />        )<br />    -&gt;  \(  Return<br />        :   forall (r : *)<br />        -&gt;  forall (s : *)<br />        -&gt;  r<br />        -&gt;  IOF r s<br />        )<br />    -&gt;  (   \(IO : * -&gt; *)<br />        -&gt;  \(  MkIO<br />            :   forall (r : *)<br />            -&gt;  forall (s : *)<br />            -&gt;  s<br />            -&gt;  (s -&gt; IOF r s)<br />            -&gt;  IO r<br />            )<br />        -&gt;  (   \(main : forall (r : *) -&gt; IO r)<br />            -&gt;  main<br />            )<br /><br />            -- main<br />            (   \(r : *)<br />            -&gt;  MkIO<br />                r<br />                (Maybe String)<br />                (Nothing String)<br />                (   \(m : Maybe String)<br />                -&gt;  maybe<br />                        String<br />                        m<br />                        (IOF r (Maybe String))<br />                        (\(str : String) -&gt;<br />                            PutStrLn<br />                                r<br />                                (Maybe String)<br />                                str<br />                                (Nothing String)<br />                        )<br />                        (GetLine r (Maybe String) (Just String))<br />                )<br />            )<br />        )<br /><br />        -- IO<br />        (   \(r : *)<br />        -&gt;  forall (x : *)<br />        -&gt;  (forall (s : *) -&gt; s -&gt; (s -&gt; IOF r s) -&gt; x)<br />        -&gt;  x<br />        )<br /><br />        -- MkIO<br />        (   \(r : *)<br />        -&gt;  \(s : *)<br />        -&gt;  \(seed : s)<br />        -&gt;  \(step : s -&gt; IOF r s)<br />        -&gt;  \(x : *)<br />        -&gt;  \(k : forall (s : *) -&gt; s -&gt; (s -&gt; IOF r s) -&gt; x)<br />        -&gt;  k s seed step<br />        )<br />    )<br /><br />    -- Maybe<br />    (\(a : *) -&gt; forall (x : *) -&gt; (a -&gt; x) -&gt; x -&gt; x)<br /><br />    -- Just<br />    (   \(a : *)<br />    -&gt;  \(va : a)<br />    -&gt;  \(x : *)<br />    -&gt;  \(Just : a -&gt; x)<br />    -&gt;  \(Nothing : x)<br />    -&gt;  Just va<br />    )<br /><br />    -- Nothing<br />    (   \(a : *)<br />    -&gt;  \(x : *)<br />    -&gt;  \(Just : a -&gt; x)<br />    -&gt;  \(Nothing : x)<br />    -&gt;  Nothing<br />    )<br /><br />    -- maybe<br />    (   \(a : *)<br />    -&gt;  \(m : forall (x : *) -&gt;  (a -&gt; x) -&gt;  x-&gt; x)<br />    -&gt;  m<br />    )<br /><br />    -- IOF<br />    (   \(r : *)<br />    -&gt;  \(s : *)<br />    -&gt;  forall (x : *)<br />    -&gt;  (String -&gt; s -&gt; x)<br />    -&gt;  ((String -&gt; s) -&gt; x)<br />    -&gt;  (r -&gt; x)<br />    -&gt;  x<br />    )<br /><br />    -- PutStrLn<br />    (   \(r : *)<br />    -&gt;  \(s : *)<br />    -&gt;  \(str : String)<br />    -&gt;  \(vs : s)<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; s -&gt; x)<br />    -&gt;  \(GetLine : (String -&gt; s) -&gt; x)<br />    -&gt;  \(Return : r -&gt; x)<br />    -&gt;  PutStrLn str vs<br />    )<br /><br />    -- GetLine<br />    (   \(r : *)<br />    -&gt;  \(s : *)<br />    -&gt;  \(k : String -&gt; s)<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; s -&gt; x)<br />    -&gt;  \(GetLine : (String -&gt; s) -&gt; x)<br />    -&gt;  \(Return : r -&gt; x)<br />    -&gt;  GetLine k<br />    )<br /><br />    -- Return<br />    (   \(r : *)<br />    -&gt;  \(s : *)<br />    -&gt;  \(vr : r)<br />    -&gt;  \(x : *)<br />    -&gt;  \(PutStrLn : String -&gt; s -&gt; x)<br />    -&gt;  \(GetLine : (String -&gt; s) -&gt; x)<br />    -&gt;  \(Return : r -&gt; x)<br />    -&gt;  Return vr<br />    )<br /><br />)</code></pre><p>This compiles to a state machine that we can unfold one step at a time:</p><pre><code>$ morte &lt; corecursive.mt<br />∀(String : *) → ∀(r : *) → ∀(x : *) → (∀(s : *) → s → (s → ∀<br />(x : *) → (String → s → x) → ((String → s) → x) → (r → x) → <br />x) → x) → x<br /><br />λ(String : *) → λ(r : *) → λ(x : *) → λ(k : ∀(s : *) → s → (<br />s → ∀(x : *) → (String → s → x) → ((String → s) → x) → (r → <br />x) → x) → x) → k (∀(x : *) → (String → x) → x → x) (λ(x : *)<br /> → λ(Just : String → x) → λ(Nothing : x) → Nothing) (λ(m : ∀<br />(x : *) → (String → x) → x → x) → m (∀(x : *) → (String → (∀<br />(x : *) → (String → x) → x → x) → x) → ((String → ∀(x : *) →<br /> (String → x) → x → x) → x) → (r → x) → x) (λ(str : String) <br />→ λ(x : *) → λ(PutStrLn : String → (∀(x : *) → (String → x) <br />→ x → x) → x) → λ(GetLine : (String → ∀(x : *) → (String → x<br />) → x → x) → x) → λ(Return : r → x) → PutStrLn str (λ(x : *)<br /> → λ(Just : String → x) → λ(Nothing : x) → Nothing)) (λ(x : <br />*) → λ(PutStrLn : String → (∀(x : *) → (String → x) → x → x)<br /> → x) → λ(GetLine : (String → ∀(x : *) → (String → x) → x → <br />x) → x) → λ(Return : r → x) → GetLine (λ(va : String) → λ(x <br />: *) → λ(Just : String → x) → λ(Nothing : x) → Just va))</code></pre><p>I don't expect you to understand that output other than to know that we can translate the output to any backend that provides functions, and primitive read/write operations.</p><h4 id="conclusion">Conclusion</h4><p>If you would like to use Morte, you can find the library on both <a href="https://github.com/Gabriel439/Haskell-Morte-Library">Github</a> and <a href="http://hackage.haskell.org/package/morte">Hackage</a>. I also provide a <a href="http://hackage.haskell.org/package/morte-1.0.1/docs/Morte-Tutorial.html">Morte tutorial</a> that you can use to learn more about the library.</p><p>Morte is dependently typed in theory, but in practice I have not exercised this feature so I don't understand the implications of this. If this turns out to be a mistake then I will downgrade Morte to System Fw, which has higher-kinds and polymorphism, but no dependent types.</p><p>Additionally, Morte might be usable to transmit code in a secure and typed way in distributed environment or to share code between diverse functional language by providing a common intermediate language. However, both of those scenarios require additional work, such as establishing a shared set of foreign primitives and creating Morte encoders/decoders for each target language.</p><p>Also, there are additional optimizations which Morte might implement in the future. For example, Morte could use free theorems (equalities you deduce from the types) to simplify some code fragments even further, but Morte currently does not do this.</p><p>My next goals are:</p><ul class="incremental"><li>Add a back-end to compile Morte to LLVM</li><li>Add a front-end to desugar a medium-level Haskell-like language to Morte</li></ul><p>Once those steps are complete then Morte will be a usable intermediate language for writing super-optimizable programs.</p><p>Also, if you're wondering, the name <a href="https://en.wikipedia.org/wiki/Morte">Morte</a> is a tribute to a talking skull from the game <a href="https://en.wikipedia.org/wiki/Planescape:_Torment">Planescape: Torment</a>, since the Morte library is a "bare-bones" calculus of constructions.</p><h4 id="literature">Literature</h4><p>If this topic interests you more, you may find the following links helpful, in roughly increasing order of difficulty:</p><ul class="incremental"><li><a href="http://blog.sigfpe.com/2007/07/data-and-codata.html">Data and Codata</a> - A blog post by Dan Piponi introducing the notions of data and codata</li><li><a href="https://en.wikipedia.org/wiki/Church_encoding">Church encoding</a> - A wikipedia article on church encoding (converting things to lambda expressions)</li><li><a href="http://www.jucs.org/jucs_10_7/total_functional_programming">Total Functional Programming</a> - A paper by D. A. Turner on total programming using data and codata</li><li><a href="http://homepages.inf.ed.ac.uk/wadler/papers/free-rectypes/free-rectypes.txt">Recursive types for free!</a> - An unpublished draft by Philip Wadler about F-algebras and F-coalgebras</li><li><a href="http://bartoszmilewski.com/2013/06/10/understanding-f-algebras/">Understanding F algebras</a> - A blog post by Bartosz Milewski</li><li><a href="http://okmij.org/ftp/tagless-final/course/Boehm-Berarducci.html">Beyond Church encoding: Boehm-Berarducci isomorphism of algebraic data types and polymorphic lambda-terms</a> - Oleg Kiselyov's collection of notes on Boehm-Berarducci encoding, a more complete version of Church encoding</li><li><a href="https://en.wikipedia.org/wiki/F-algebra">F-algebras</a> and <a href="https://en.wikipedia.org/wiki/F-coalgebra">F-coalgebras</a> - wikipedia articles that are short, sweet, and utterly impenetrable unless you already understand the subject</li></ul></div>






<p class="date">
<a href="http://www.haskellforall.com/2014/09/morte-intermediate-language-for-super.html">by Gabriel Gonzalez (noreply@blogger.com) at September 12, 2014 11:38 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://kenta.blogspot.com/search/label/haskell" title="Ken's blog">Ken T Takusagawa</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-6757805.post-4968562781478659811">
<blockquote>
<h1 class="entry"><a href="http://kenta.blogspot.com/2014/09/prbwmqwj-functions-to-modify-record.html">[prbwmqwj] Functions to modify a record</a></h1>
<div class="entry">
<p dir="ltr">Haskell could use some new syntax LAMBDA_RECORD_MODIFY which could be used as follows:</p>  <p dir="ltr">import qualified Control.Monad.State as State;<br />  data Record { field :: Int };<br />  ... State.modify $ LAMBDA_RECORD_MODIFY { field = ... };</p>  <p dir="ltr">which is equivalent to</p>  <p dir="ltr">State.modify $ \x -&gt; x { field = ... }</p>  <p dir="ltr">but not having to <a href="http://kenta.blogspot.com/2010/05/zklkghch-naming-things.html">name</a> the lambda parameter "x" (twice).</p>  <p dir="ltr">I suspect this is one of the things lenses are trying to do.</p></div>






<p class="date">
<a href="http://kenta.blogspot.com/2014/09/prbwmqwj-functions-to-modify-record.html">by Ken (noreply@blogger.com) at September 12, 2014 03:43 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 11, 2014</h2>

<div class="channelgroup">







<h3><a href="http://ghc.haskell.org/trac/ghc/blog" title="GHC - Blog">The GHC Team</a></h3>

<div class="entrygroup" id="http://ghc.haskell.org/trac/ghc/blog/simonpj/StaticPointers">
<blockquote>
<h1 class="entry"><a href="http://ghc.haskell.org/trac/ghc/blog/simonpj/StaticPointers">Static pointers and serialisation</a></h1>
<div class="entry">
<p>
This longish post gives Simon's reflections on the implementation of Cloud-Haskell-style static pointers and serialiation.  See also <a href="http://ghc.haskell.org/trac/ghc/wiki/StaticPointers" class="wiki">StaticPointers</a>.
</p>
<p>
Much of what is suggested here is implemented, in some form, in two existing projects
</p>
<ul><li><strong>Cloud Haskell libraries</strong> <a href="https://hackage.haskell.org/package/distributed-static" class="ext-link"><span class="icon">​</span>distributed-static</a> and <a href="https://hackage.haskell.org/package/rank1dynamic" class="ext-link"><span class="icon">​</span>rank1dynamic</a>.  Background in the paper <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/parallel/" class="ext-link"><span class="icon">​</span>Towards Haskell in the Cloud</a>.
</li></ul><ul><li><strong>HdpH libraries</strong> <a href="https://hackage.haskell.org/package/hdph" class="ext-link"><span class="icon">​</span>hdph</a> and <a href="https://hackage.haskell.org/package/hdph-closure" class="ext-link"><span class="icon">​</span>hdph-closure</a>. Background in the paper <a href="http://www.dcs.gla.ac.uk/~pmaier/papers/Maier_Trinder_IFL2011_XT.pdf" class="ext-link"><span class="icon">​</span>Implementing a high-level distributed-memory parallel Haskell in Haskell</a>
</li></ul><p>
My goal here is to identify the smallest possible extension to GHC, with
the smallest possible trusted code base, that would enable these
libraries to be written in an entirely type-safe way.
</p>
<hr />
<h1 id="Background">Background</h1>
<h2 id="Background:thetrustedcodebase">Background: the trusted code base</h2>
<p>
The implementation <tt>Typeable</tt> class, and its associated functions, in
GHC offers a <strong>type-safe</strong> abstraction, in the classic sense that
"well typed programs won't go wrong".  For example, we in <tt>Data.Typeable</tt> we have
</p>
<pre class="wiki">cast :: forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</pre><p>
We expect <tt>cast</tt> to be type-safe: if <tt>cast</tt> returns a value <tt>Just x</tt> then we really do know
that <tt>x :: b</tt>.  Let's remind ourselves of class <tt>Typeable</tt>:
</p>
<pre class="wiki">class Typeable a where
  typeRep :: proxy a -&gt; TypeRep
</pre><p>
(It's not <em>quite</em> this, but close.)  The <tt>proxy a</tt> argument is
just a proxy for <em>type</em> argument; its value is never inspected
and you can always pass bottom.
</p>
<p>
Under the hood, <tt>cast</tt> uses <tt>typeRep</tt> to get the runtime <tt>TypeRep</tt> for
<tt>a</tt> and <tt>b</tt>, and compares them, thus:
</p>
<pre class="wiki">cast :: forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
cast x = if typeRep (Proxy :: Proxy a) == typeRep (Proxy :: Proxy b)
           then Just (unsafeCoerce x)
           else Nothing
</pre><p>
Although <tt>cast</tt> is written in Haskell, it uses <tt>unsafeCoerce</tt>.  For it
to truly be type-safe, it must trust the <tt>Typeable</tt> instances.  If the
user could write a <tt>Typeable</tt> instance, they could write a bogus one, and
defeat type safety.  So only GHC is allowed write <tt>Typeable</tt> instances.
</p>
<p>
In short, <tt>cast</tt> and the <tt>Typeable</tt> instances are part of the <strong>trusted code base</strong>, or <strong>TCB</strong>:
</p>
<ul><li>The TCB should be as small as possible
</li><li>The TCB should have a small, well-defined, statically-typed API used by client code
</li><li>Client code is un-trusted; if the client code is well-typed, and the TCB is implemented correctly, nothing can go wrong
</li></ul><h2 id="BackgroundTypeableaandTypeRep">Background <tt>Typeable a</tt> and <tt>TypeRep</tt></h2>
<p>
I'll use the <tt>Typeable a</tt> type class and values of type <tt>TypeRep</tt> more or less interchangeably. As you can see from the definition of class <tt>Typeable</tt> above, its payload is simply a constant function returning a <tt>TypeRep</tt>.  So you can think of a <tt>Typeable a</tt> as simply a type-tagged version of <tt>TypeRep</tt>.
</p>
<p>
Of course, a <tt>Typeable a</tt> is a type class thing, which is hard to pass around explicitly like a value, but that is easily fixed using the "Dict Trick",
well known in Haskell folk lore:
</p>
<pre class="wiki">data Dict (c :: Constraint) where
  Dict :: forall c. c =&gt; Dict c
</pre><p>
Now a value of type <tt>Dict (Typeable a)</tt> is an ordinary value that embodies a <tt>Typeable a</tt> dictionary.  For example:
</p>
<pre class="wiki">f :: Dict (Typeable a) -&gt; Dict (Typeable b) -&gt; a -&gt; Maybe b
f Dict Dict val = cast val
</pre><p>
The pattern-matches against the <tt>Dict</tt> constructor brings the <tt>Typeable</tt> dictionaries
into scope, so they can be used to discharge the constraint arising from the call to <tt>cast</tt>.
</p>
<h2 id="Background:serialisation">Background: serialisation</h2>
<p>
I'm going to assume a a type class <tt>Serialisable</tt>, something like this:
</p>
<pre class="wiki">class Serialisable a where
  encode :: a -&gt; ByteString
  decode :: ByteString -&gt; Maybe (a, ByteString)
</pre><p>
'll use "encode" and "decode" as synonyms for "serialise" and "deserialise", because the former are easier to pronounce.
</p>
<p>
Here's an interesting question: are instances of <tt>Serialisable</tt> part of the TCB?  No, they are not.
Here is a tricky case:
</p>
<pre class="wiki">  decode (encode [True,False]) :: Maybe (Int, ByteString)
</pre><p>
Here I have encode a <tt>[Bool]</tt> into a <tt>ByteString</tt>, and then decoded an <tt>Int</tt> from that <tt>ByteString</tt>.  This may
be naughty or undesirable, but it cannot seg-fault: it is type-safe in the sense above.   You can
think of it like this: a decoder is simply a parser for the bits in the <tt>ByteString</tt>, so a decoder
for (say) <tt>Int</tt> can fail to parse a full <tt>Int</tt> (returning <tt>Nothing</tt>), but it can't return a non-<tt>Int</tt>.
</p>
<p>
For the naughtiness, one could imagine that a Cloud Haskell library
might send fingerprints or <tt>TypeReps</tt> or whatnot to eliminate
potential naughtiness. But even then it is very valuable if the
type-safety of the system does not rely on the CH library.  Type
safety depends only on the correctness of the (small) TCB;
naughtiness-safety might additionally depend on the correctness of the
CH library.
</p>
<h2 id="Background:staticpointers">Background: static pointers</h2>
<p>
I'm taking for granted the basic design of the Cloud Haskell paper.
That is,
</p>
<ul><li>A type constructor <tt>StaticPtr :: * -&gt; *</tt>. Intuitively, a value of type <tt>StaticPtr t</tt> is represented by a static code pointer to a value of type <tt>t</tt>.  Note "code pointer" not "heap pointer".  That's the point!
</li></ul><ul><li>A language construct <tt>static &lt;expr&gt;</tt>, whose type is <tt>StaticPtr t</tt> if <tt>&lt;expr&gt;</tt> has type <tt>t</tt>.
</li></ul><ul><li>In <tt>static &lt;expr&gt;</tt>, the free variables of <tt>&lt;expr&gt;</tt> must all be bound at top level. The implementation almost certainly works by giving <tt>&lt;expr&gt;</tt> a top-level definition with a new name, <tt>static34 = &lt;expr&gt;</tt>.
</li></ul><ul><li>A function <tt>unStatic :: StaticPtr a -&gt; a</tt>, to unwrap a static pointer.
</li></ul><ul><li><tt>Static</tt> values are serialisable.  Something like <tt>instance Serialisable (StaticPtr a)</tt>.  (This will turn out to be not quite right.)  Operationally this works by serialising the code pointer, or top-level name (e.g <tt>"Foo.static34"</tt>).
</li></ul><p>
All of this is built-in.  It is OK for the implementation of <tt>StaticPtr</tt> to be part of the TCB.
But our goal is that <em>no other code need be in the TCB</em>.
</p>
<p>
<strong>A red herring</strong>.  I'm not going to address the question of how to serialise a static pointer.  One method would be to serialise a machine address, but that only works if the encoding and decoding ends are running identical binaries.  But that's easily fixed: encode a static as the <em>name</em> of the static value e.g. "function <tt>foo</tt> from module <tt>M</tt> in package <tt>p</tt>".  Indeed, I'll informally assume an implementation of this latter kind.
</p>
<p>
In general, I will say that what we ultimately serialise is a <tt>StaticName</tt>. You can think of a <tt>StaticName</tt> as package/module/function triple, or something like that. The implementation of <tt>StaticName</tt> is certainly not part of the client-visible API for <tt>StaticPtr</tt>; indeed, the type <tt>StaticName</tt> is not part of the API either.  But it gives us useful vocabulary.
</p>
<hr />
<h1 id="Serialisingstaticpointers">Serialising static pointers</h1>
<p>
We can see immediately that we cannot expect to have <tt>instance Serialisable (Static a)</tt>,
which is what the Cloud Haskell paper proposed.  If we had such an instance we would have
</p>
<pre class="wiki">encodeStatic :: forall a. StaticPtr a -&gt; ByteString
decodeStatic :: forall a. ByteString -&gt; Maybe (StaticPtr a, ByteString)
</pre><p>
And it's immediately apparent that <tt>decodeStatic</tt> <em>cannot</em> be right.
I could get a <tt>ByteString</tt> from anywhere, apply <tt>decodeStatic</tt> to it,
and thereby get a <tt>StaticPtr a</tt>.  Then use
<tt>unStatic</tt> and you have a value of type <tt>a</tt>, for, <em>for any type <tt>a</tt></em>!!
</p>
<p>
Plainly, what we need is (just in the case of <tt>cast</tt>) to do a dynamic typecheck, thus:
</p>
<pre class="wiki">decodeStatic :: forall a. Typeable a
                       =&gt; ByteString -&gt; Maybe (StaticPtr a, ByteString)
</pre><p>
Let's think operationally for a moment:
</p>
<ul><li>GHC collects all the <tt>StaticPtr</tt> values in a table, the <strong>static pointer table</strong> or <strong>SPT</strong>.  Each row contains
<ul><li>The <tt>StaticName</tt> of the value
</li><li>A pointer to closure for the value itself
</li><li>A pointer to its <tt>TypeRep</tt>
</li></ul></li></ul><ul><li><tt>decodeStatic</tt> now proceeds like this:
<ul><li>Parse a <tt>StaticName</tt> from the <tt>ByteString</tt> (failure =&gt; <tt>Nothing</tt>)
</li><li>Look it up in table (not found =&gt; <tt>Nothing</tt>)
</li><li>Compare the <tt>TypeRep</tt> passed to <tt>decodeStatic</tt> (via the <tt>Typeable a</tt> dictionary) with the one ine the table (not equal =&gt; <tt>Nothing</tt>)
</li><li>Return the value
</li></ul></li></ul><p>
<strong>Side note.</strong> Another possibility is for <tt>decodeStatic</tt> not to take a <tt>Typeable a</tt> context but instead for <tt>unStatic</tt> to do so:: <tt>unStatic :: Typeable a =&gt; StaticPtr a -&gt; Maybe a</tt>.  But that seems a mess.  Apart from anything else, it would mean that a value of type <tt>StaticPtr a</tt> might or might not point to a value of type <tt>a</tt>, so there's no point in having the type parameter in the first place. <strong>End of side note.</strong>
</p>
<p>
This design has some useful consequences that are worth calling out:
</p>
<ul><li>A <tt>StaticPtr</tt> is serialised simply to the <tt>StaticName</tt>; <em>the serialised form does not need to contain a <tt>TypeRep</tt></em>.  Indeed it would not even be type-safe to serialise a <tt>StaticPtr</tt> to a pair of a <tt>StaticName</tt> and a <tt>TypeRep</tt>, trusting that the <tt>TypeRep</tt> described the type of the named function. Why not?  Think back to "Background: serialisation" above, and imagine we said
<pre class="wiki">decode (encode ["wibble", "wobble"])
  :: Typeable a =&gt; Maybe (StaticPtr a, ByteString)
</pre>Here we create an essentially-garbage <tt>ByteString</tt> by encoding a <tt>[String]</tt>, and try to decode it.  If, by chance, we successfully parse a valid <tt>StaticName</tt> and <tt>TypeRep</tt>, there is absolutely no reason to suppose that the <tt>TypeRep</tt> will describe the type of the function. <br /><br />
Instead, the <tt>TypeRep</tt> of the static pointer lives in the SPT, securely put there when the SPT was created.  Not only is this type-safe, but it also saves bandwidth by not transmitting<tt>TypeReps</tt>.
</li></ul><ul><li>Since clients can effectively fabricate a <tt>StaticName</tt> (by supplying <tt>decodeStatic</tt> with a bogus <tt>ByteString</tt>, a <tt>StaticName</tt> is untrusted.  That gives the implementation a good deal of wiggle room for how it chooses to implement static names.  Even a simple index in the range 0..N would be type-safe! <br /><br />
The motivation for choosing a richer representation for <tt>StaticName</tt> (eg package/module/name) is not type-safety but rather resilience to change.  For example, the Haskell programs at the two ends could be quite different, provided only that they agreed about what to call the static pointers that they want to exchange.
</li></ul><h2 id="Staticsandexistentials">Statics and existentials</h2>
<p>
Here is something very reasonable:
</p>
<pre class="wiki">data StaticApp b where
  SA :: StaticPtr (a-&gt;b) -&gt; StaticPtr a -&gt; StaticApp b
unStaticApp :: StaticApp a -&gt; a
unStaticApp (SA f a) = unStatic f (unStatic a)
</pre><p>
(We might want to add more constructors, but I'm going to focus only on <tt>SA</tt>.)
A <tt>SA</tt> is just a pair of <tt>StaticPtr</tt>s, one for a function and one for an argument.  We can securely unwrap it with <tt>unStaticApp</tt>.
</p>
<p>
Now, here is the question: can we serialise <tt>StaticApp</tt>s?  Operationally, of course yes: to serialise a <tt>SA</tt>, just serialise the two <tt>StaticPtrs</tt> it contains, and dually for deserialisation.   But, as before, deserialisation is the hard bit.  We seek:
</p>
<pre class="wiki">decodeSA :: Typeable b =&gt; ByteString -&gt; Maybe (StaticApp b, ByteString)
</pre><p>
But how can we write <tt>decodeSA</tt>?  Here is the beginning of an attempt:
</p>
<pre class="wiki">decodeSA :: Typeable b =&gt; ByteString -&gt; Maybe (StaticApp b, ByteString)
decodeSA bs
  = case decodeStatic bs :: Maybe (StaticPtr (a-&gt;b)) of
      Nothing -&gt; Nothing
      Just (fun, bs1) -&gt; ...
</pre><p>
and you can immediately see that we are stuck.  Type variable <tt>b</tt> is not in scope.
More concretely, we need a <tt>Typeable (a-&gt;b)</tt> to pass in to <tt>decodeStatic</tt>,
but we only have a <tt>Typeable b</tt> to hand.
</p>
<p>
What can we do?  Tantalisingly, we know that if <tt>decodeStatic</tt> succeeds in parsing a static <tt>StaticName</tt> from <tt>bs</tt> then, when we look up that <tt>StaticName</tt> in the Static Pointer Table, we'll find a <tt>TypeRep</tt> for the value.  So rather than passing a <tt>Typeable</tt> dictionary into <tt>decodeStatic</tt>, we'd like to get one out!
</p>
<p>
With that in mind, here is a new type signature for <tt>decodeStatic</tt> that returns
both pieces:
</p>
<pre class="wiki">data DynStaticPtr where
  DSP :: Typeable a =&gt; StaticPtr a -&gt; DynStaticPtr
decodeStatic :: ByteString -&gt; Maybe (DynStaticPtr, ByteString)
</pre><p>
(The name <tt>DynStaticPtr</tt> comes from the fact that this data type is extremely similar to the library definition of <tt>Dynamic</tt>.)
</p>
<p>
Operationally, <tt>decodeStaticK bs fail cont</tt> works like this;
</p>
<ul><li>Parse a <tt>StaticName</tt> from <tt>bs</tt> (failure =&gt; return Nothing)
</li><li>Look it up in the SPT (not found =&gt; return Nothing)
</li><li>Return the <tt>TypeRep</tt> and  the value found in the SPT, paired up with <tt>DSP</tt>. (Indeed the SPT could contain the <tt>DynStaticPtr</tt> values directly.)
</li></ul><p>
For the construction of <tt>DynStaticPtr</tt> to be type-safe, we need to know that the
<tt>TypeRep</tt> passed really is a <tt>TypeRep</tt> for the value; so the construction
of the SPT is (unsurprisingly) part of the TCB.
</p>
<p>
Now we can write <tt>decodeSA</tt> (the monad is just the <tt>Maybe</tt> monad, nothing fancy):
</p>
<pre class="wiki">decodeSA :: forall b. Typeable b =&gt; ByteString -&gt; Maybe (StaticApp b, ByteString)
decodeSA bs
  = do { (DSP (fun :: StaticPtr tfun), bs1) &lt;- decodeStatic bs
       ; (DSP (arg :: StaticPtr targ), bs2) &lt;- decodeStatic bs1
            -- At this point we have
            --     Typeable b      (from caller)
            --     Typeable tfun   (from first DSP)
            --     Typeable targ   (from second DSP)
       ; fun' :: StaticPtr (targ-&gt;b) &lt;- cast fun
       ; return (SA fun' arg, bs2) }
</pre><p>
The call to <tt>cast</tt> needs <tt>Typeable tfun</tt>, and <tt>Typeable (targ-&gt;b)</tt>. The
former is bound by the first <tt>DSP</tt> pattern match.  The latter is
constructed automatically from <tt>Typeable targ</tt> and <tt>Typeable b</tt>, both
of which we have.  Bingo!
</p>
<p>
Notice that <em><tt>decodeSA</tt> is not part of the TCB</em>.  Clients can freely write code like <tt>decodeSA</tt> and be sure that it is type-safe.
</p>
<hr />
<h1 id="Fromstaticpointerstoclosures">From static pointers to closures</h1>
<p>
The original Cloud Haskell paper defines closures like this:
</p>
<pre class="wiki">data Closure a where
  Clo :: StaticPtr (ByteString -&gt; a) -&gt; ByteString -&gt; Closure a
</pre><p>
It is easy to define
</p>
<pre class="wiki">unClo :: Closure a -&gt; a
unClo (Clo s e) = unStatic s e
</pre><h2 id="SidenoteonHdpH">Side note on HdpH</h2>
<p>
HdpH refines the Cloud Haskell <tt>Closure</tt> in (at least) two ways.   I think (but I am not certain) that this declaration captures the essence:
</p>
<pre class="wiki">data Closure a where
  Clo :: StaticPtr (ByteString -&gt; a) -&gt; Put () -&gt; a -&gt; Closure a
</pre><p>
The refinements are:
</p>
<ul><li>The extra argument of type 'a' to avoid costs when we build a closure and then unwrap it with <tt>unClo</tt> locally, or repeatedly.
</li></ul><ul><li>The use of <tt>Put ()</tt> rather than a <tt>ByteString</tt> for the serialised environment, to avoid repeated copying when doing nested serialisation.
</li></ul><p>
Both are importnat, but they are orthogonal to the discussion about static types, so I'll use the CH definition from here on.
</p>
<h2 id="Serialisingclosures">Serialising closures</h2>
<p>
Just as in the case of <tt>StaticPtr</tt>, it is immediately clear that we
cannot expect to have
</p>
<pre class="wiki">decodeClo :: ByteString -&gt; Maybe (Closure a, ByteString)
</pre><p>
Instead we must play the same trick, and attempt to define
</p>
<pre class="wiki">data DynClosure where
  DC :: Typeable a =&gt; Closure a -&gt; DynClosure
decodeClo :: ByteString -&gt; Maybe (DynClosure, ByteString)
</pre><p>
But there's an immediate problem in writing <tt>decodeClo</tt>:
</p>
<pre class="wiki">decodeClo bs
  = do { (DSP (fun :: StaticPtr tfun), bs1) &lt;- decodeStatic bs
       ; (env, bs2)                         &lt;- decodeByteString bs1
       ; return (DC (Clo fun env), bs2) }  -- WRONG
</pre><p>
This won't typecheck because <tt>DC</tt> needs <tt>Typeable </tt>a<tt>, but we only have </tt>Typeable (ByteString -&gt; a)`.
</p>
<p>
This is Jolly Annoying.  I can see three ways to make progress:
</p>
<ul><li><strong>Plan A</strong>: Provide some (type-safe) way to decompose <tt>TypeReps</tt>, to get from <tt>Typeable (a-&gt;b)</tt> to <tt>Typeable b</tt> (and presumably <tt>Typeable a</tt> as well).
</li><li><strong>Plan C</strong>: Serialise a <tt>TypeRep a</tt> with every <tt>Closure a</tt>.
</li><li><strong>Plan C</strong>: Generalise <tt>StaticPtr</tt>
</li></ul><p>
I like Plan C best.  They are each discussed next.
</p>
<h3 id="PlanA:DecomposingTypeRep">Plan A: Decomposing <tt>TypeRep</tt></h3>
<p>
At the moment, GHC provides statically-typed ways to <em>construct</em> and <em>compare</em> a <tt>TypeRep</tt> (via <tt>cast</tt>), but no way to <em>decompose</em> one, at least not in a type-safe way.
It is tempting to seek this function as part of the TCB:
</p>
<pre class="wiki">class Typeable a where
  typeRep :: proxy a -&gt; TypeRep
  decomposeTypeRep :: DecompTR a
data DecompTR a where
  TRApp :: (Typeable p, Typeable q) =&gt; DecompTR (p q)
  TRCon :: TyCon -&gt; DecompTR a
</pre><p>
This isn't a bad idea, but it does mean that <tt>Typeable a</tt> <em>must</em> be implemented (and presumably serialised) using a tree, whereas the current API would allow an implementation consisting only of a fingerprint.
</p>
<p>
(Thought experiment: maybe a <tt>Typeable a</tt>, and <tt>Dict (Typeable a)</tt> can be represented as a tree, but a <tt>TypeRep</tt> could be just a fingerprint?)
</p>
<h3 id="PlanB:serialiseTypeRepwithClosure">Plan B: serialise <tt>TypeRep</tt> with <tt>Closure</tt></h3>
<p>
Since we need a <tt>Typeable a</tt> at the far end, we could just serialise it directly
with the <tt>Closure</tt>, like this:
</p>
<pre class="wiki">encodeClo :: forall a. Typeable a =&gt; Closure a -&gt; ByteString
encodeClo (Clo fun env)
  =  encodeTypeable (proxy :: a)
  ++ encodeStatic fun
  ++ encodeByteString env
</pre><p>
Here I am assuming (as part of the TBC)
</p>
<pre class="wiki">encodeTypeable :: Typeable a =&gt; proxy a -&gt; ByteString
decodeTypeable :: ByteString -&gt; Maybe (DynTypeable, ByteString)
data DynTypeable where
  DT :: Typeable a =&gt; proxy a -&gt; DynTypeable
</pre><p>
which serialises a <tt>TypeRep</tt>.  (Or, operationally, perhaps just its fingerprint.)
Now I think we can write <tt>decodeClo</tt>:
</p>
<pre class="wiki">decodeClo :: ByteString -&gt; Maybe (DynClosure, ByteString)
decodeClo bs
  = do { (DT (_ :: Proxy a),           bs1)  &lt;- decodeTypeable
       ; (DSP (fun :: StaticPtr tfun), bs2)  &lt;- decodeStatic bs1
       ; (env, bs3)                          &lt;- decodeByteString bs2
       ; fun' :: StaticPtr (ByteString -&gt; a) &lt;- cast fun
       ; return (DC (Clo fun' env), bs2) }  -- WRONG
</pre><p>
But this too is annoying: we have to send these extra <tt>TypeRep</tt>s when morally they are already sitting there in the SPT.
</p>
<h3 id="PlanC:GeneralisingStaticPtr">Plan C: Generalising <tt>StaticPtr</tt></h3>
<p>
Our difficulty is that we are deserialising <tt>StaticPtr (ByteString -&gt; a)</tt> but we want to be given <tt>Typeable a</tt> not <tt>Typeable (ByteString -&gt; a)</tt>.  So perhaps we can decompose the type into a type constructor and type argument, like this:
</p>
<pre class="wiki">data StaticPtr (f :: *-&gt;*) (a :: *)
unStatic :: StaticPtr f a -&gt; f a
decodeStatic :: ByteString -&gt; Maybe (DynStaticPtr, ByteString)
data DynStaticPtr where
  DS :: (Typeable f, Typeable a) =&gt; StaticPtr (f a) -&gt; DynStaticPtr
</pre><p>
Each row of the SPT contains:
</p>
<ul><li>The <tt>StaticName</tt>
</li><li>The value of type <tt>f a</tt>
</li><li>The <tt>Typeable f</tt> dictionary
</li><li>The <tt>Typeable a</tt> dictionary
</li></ul><p>
Now we can define closures thus:
</p>
<pre class="wiki">data Closure a where
  Clo :: StaticPtr (ByteString -&gt;) a -&gt; ByteString -&gt; Closure a
</pre><p>
and these are easy to deserialise:
</p>
<pre class="wiki">decodeClo :: ByteString -&gt; Maybe (DynClosure, ByteString)
decodeClo bs
  = do { (DSP (fun :: StaticPtr f a), bs1) &lt;- decodeStatic bs
       ; (env, bs2)                        &lt;- decodeByteString bs1
           -- Here we have Typeable f, Typeable a
       ; fun' :: StaticPtr (ByteString -&gt;) a &lt;- cast fun
           -- This cast checks that f ~ (ByteString -&gt;)
           -- Needs Typeable f, Typealbe (ByteString -&gt;)
       ; return (DC (Clo fun env), bs2) }
           -- DC needs Typeable a
</pre><p>
I like this a lot better, but it has knock on effects.
</p>
<ul><li>The old <tt>StaticPtr a</tt> is now <tt>StaticPtr Id a</tt>.
</li></ul><ul><li>What becomes of our data type for <tt>StaticApply</tt>?   Perhpas
<pre class="wiki">data StaticApp f b where
  SA :: StaticPtr f (a-&gt;b) -&gt; StaticPtr f b -&gt; StaticApp f b
unStaticApp :: Applicative =&gt; StaticApp f b -&gt; f b
</pre></li></ul><p>
<strong>ToDo: ...I have not yet followed through all the details</strong>
</p>
<h2 id="Applyingclosures">Applying closures</h2>
<p>
Can we write <tt>closureApply</tt>?  I'm hoping for a structure like this:
</p>
<pre class="wiki">closureApply :: Closure (a-&gt;b) -&gt; Closure a -&gt; Closure b
closureApply fun arg = Clo (static caStatic) (fun, arg)
caStatic :: ByteString -&gt; b  -- WRONG
caStatic bs = do { ((fun,arg), bs1) &lt;- decode bs
                 ; return (unClo fun (unClo arg), bs1) }
</pre><p>
This is obviously wrong. <tt>caStatic</tt> clearly cannot have that type.  It would
at least need to be
</p>
<pre class="wiki">caStatic :: Typeable b =&gt; ByteString -&gt; b
</pre><p>
and now there is the thorny question of where the <tt>Typeable b</tt> dictionary comes from.
</p>
<p>
<strong>ToDo: ...I have stopped here for now</strong>
</p>
<hr />
<h1 id="Polymorphismandserialisation">Polymorphism and serialisation</h1>
<p>
For this section I'll revert to the un-generalised single-parameter <tt>StaticPtr</tt>.
</p>
<h2 id="Parametricpolymorphism">Parametric polymorphism</h2>
<p>
Consider these definitions:
</p>
<pre class="wiki">rs1 :: Static ([Int] -&gt; [Int])
rs1 = static reverse
rs2 :: Static ([Bool] -&gt; [Bool])
rs2 = static reverse
rs3 :: forall a. Typeable a =&gt; Static ([a] -&gt; [a])
rs3 = static reverse
</pre><p>
The first two are clearly fine. The SPT will get one row for each of the two monomorphic calls to reverse, one with a <tt>TypeRep</tt> of <tt>[Int] -&gt; [Int]</tt> and one with a <tt>TypeRep</tt> of <tt>[Bool] -&gt; [Bool]</tt>.
</p>
<p>
But <em>both will have the same code pointer</em>, namely the code for the polymorpic <tt>reverse</tt> function.  Could we share just one <tt>StaticName</tt> for all instantiations of <tt>reverse</tt>, perhaps including <tt>rs3</tt> as well?
</p>
<p>
I think we can.  The story would be this:
</p>
<ul><li>The SPT has a row for <tt>reverse</tt>, containing
<ul><li>The <tt>StaticName</tt> for <tt>reverse</tt>
</li><li>A pointer to the code for <tt>reverse</tt> (or, more precisely, its static closure).
</li><li>A function of type <tt>TypeRep -&gt; TypeRep</tt> that, given the <tt>TypeRep</tt> for <tt>a</tt> returns a <tt>TypeRep</tt> for <tt>[a] -&gt; [a]</tt>.
</li></ul></li></ul><ul><li>When we serialise a <tt>StaticPtr</tt> we send
<ul><li>The <tt>StaticName</tt> of the (polymorphic) function
</li><li>A list of the <tt>TypeRep</tt>s of the type arguments of the function
</li></ul></li></ul><ul><li>The rule for <tt>static &lt;expr&gt;</tt> becomes this: the free <em>term</em> variables <tt>&lt;expr&gt;</tt> must all be top level, but it may have free <em>type</em> variables, provided they are all <tt>Typeable</tt>.
</li></ul><p>
All of this is part of the TCB, of course.
</p>
<h2 id="Type-classpolymorphism">Type-class polymorphism</h2>
<p>
Consider <tt>static sort</tt> where <tt>sort :: Ord a =&gt; [a] -&gt; [a]</tt>.  Can we make such a <tt>StaticPtr</tt>.  After all, <tt>sort</tt> gets an implicit value argument, namely an <tt>Ord a</tt> dictionary.  If that dictionary can be defined at top level, well and good, so this should be OK:
</p>
<pre class="wiki">ss1 :: StaticPtr ([Int] -&gt; [Int])
ss1 = static sort
</pre><p>
But things go wrong as soon as you have polymorphism:
</p>
<pre class="wiki">ss2 :: forall a. Ord a =&gt; StaticPtr ([a] -&gt; [a])
ss2 = static sort  -- WRONG
</pre><p>
Now, clearly, the dictionary is a non-top-level free variable of the call to <tt>sort</tt>.
</p>
<p>
We might consider letting you write this:
</p>
<pre class="wiki">ss3 :: forall a. StaticPtr (Ord a =&gt; [a] -&gt; [a])
ss3 = static sort   -- ???
</pre><p>
so now the <tt>static</tt> wraps a function expeting a dictionary.  But that edges us uncomforatbly close to impredicative types, which is known to contain many dragons.
</p>
<p>
A simpler alternative is to use the Dict Trick (see Background above):
</p>
<pre class="wiki">ss4 :: forall a. StaticPtr (Dict (Ord a) -&gt; [a] -&gt; [a])
ss4 = static sortD
sortD :: forall a. Dict (Ord a) -&gt; [a] -&gt; [a]
sortD Dict xs = sort xs
</pre><p>
Now, at the call side, when we unwrap the <tt>StaticPtr</tt>, we need to supply an explicit <tt>Ord</tt> dictionary, like this:
</p>
<pre class="wiki">...(unStatic ss4 Dict)....
</pre><p>
For now, I propose to deal with type classes via the Dict Trick, which is entirely end-user programmable, leaving only parametric polymorphism for built-in support.
</p></div>






<p class="date">
<a href="http://ghc.haskell.org/trac/ghc/blog/simonpj/StaticPointers">by simonpj at September 11, 2014 01:34 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.yesodweb.com/" title="Yesod Web Framework Blog">Yesod Web Framework</a></h3>

<div class="entrygroup" id="http://www.yesodweb.com/blog/2014/09/clarification-previous-blog-post">
<blockquote>
<h1 class="entry"><a href="http://www.yesodweb.com/blog/2014/09/clarification-previous-blog-post">Clarification of previous blog post</a></h1>
<div class="entry">
<p>I've heard that <a href="http://www.yesodweb.com/blog/2014/09/misassigned-credit-for-conduit">my previous blog
post</a> has
caused a bit of confusion, as sarcasm doesn't really come across in text very
well. So let me elaborate (and of course, in the process, kill the joke):</p><p>Some years back, Erik found a case that was quite difficult to implement using
enumerator. After we cracked our heads on it for long enough, some of us (I
don't actually remember who was involved) decided to work on a new streaming
library. That library ended up being called conduit (thanks to Yitz for the
naming idea). It turns out that most people are unaware of that history, so
when at ICFP, I casually mentioned that Erik was the cause of conduit coming
into existence, some people were surprised. Erik <b>jokingly</b> chastised me for
not giving him enough credit. In response, I decided to write an over-the-top
post giving Erik <b>all</b> credit for conduit. I say over the top, since I made
it seem like there was some large amount of blame being heaped on as well.</p><p>So to be completely clear:</p><ul><li>Erik and I are good friends, and this was just a bit of an inside joke turned public.</li><li>No one has said <i>anything</i> offensive to me at all about conduit. There are obviously differing opinions out there about the best library for a job, but there's nothing offensive about it, just healthy discussion around a complicated topic. My purpose in making a big deal about it was <i>not</i> to express frustration at anyone attacking me, but rather to just play up the joke a bit more.</li></ul><p>My apologies to anyone who was confused, upset, or worried by the previous
post, it was completely unintentional.</p></div>






<p class="date">
<a href="http://www.yesodweb.com/blog/2014/09/clarification-previous-blog-post">September 11, 2014 12:00 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="https://www.fpcomplete.com/school" title="FP Complete» News/Blog">FP Complete</a></h3>

<div class="entrygroup" id="https://www.fpcomplete.com/blog/2014/09/hiring-haskell-web-ui-dev">
<blockquote>
<h1 class="entry"><a href="https://www.fpcomplete.com/blog/2014/09/hiring-haskell-web-ui-dev">We're hiring: Haskell web UI developer</a></h1>
<div class="entry">
<p>FP Complete is looking to expand its Haskell development team. We’re looking
for a Haskeller with a strong background in web UI development. This position
will encompass both work on our core products- such as FP Haskell Center and
School of Haskell- as well as helping customers develop frontends to their
Haskell applications.</p><p>We will want you to start right away. The will be a contractor position, full
time for at least 3 months, with the intention to continue long-term on a more
or less full-time basis. Additionally, while the main focus of the position
will be UI development, there will be many opportunities to expand into other
areas of focus. </p><p>This is a telecommute position: you can work from home or wherever you choose,
with little or no travel. Location in North America is ideal; you will work
with colleagues who are on North American and European hours.</p><p>Skills required:</p><ul><li>Strong Haskell coding skills.</li><li>Experience with creating HTML/CSS/Javascript web applications (fat clients a plus).</li><li>Ideally: experience with both Yesod and Fay for server and client side coding, respectively. (Perk: you’ll get a chance to work with the authors of both tools.)</li><li>Experience deploying applications into production, especially at large scale, is a plus.</li><li>Ability to interact with a distributed development team, and to manage your time without an in-person supervisor</li><li>Ability to work with clients on gathering requirements</li><li>General source control/project skills: Git, issue tracking</li><li>Ability to communicate clearly in issues, bug reports and emails</li><li>Proficient on a Linux system</li><li>Plus: experience with deployment, Docker, and/or CoreOS</li></ul><p>Please send resume or CV to
<a href="mailto:michael@fpcomplete.com">michael@fpcomplete.com</a>. Any existing work-
either a running website or an open source codebase- which you can include
links to will be greatly appreciated as well.</p></div>






<p class="date">
<a href="https://www.fpcomplete.com/blog/2014/09/hiring-haskell-web-ui-dev">September 11, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 10, 2014</h2>

<div class="channelgroup">







<h3><a href="http://wadler.blogspot.com/" title="Wadler's Blog">Philip Wadler</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-9757377.post-2088787706064496254">
<blockquote>
<h1 class="entry"><a href="http://wadler.blogspot.com/2014/09/scots-voting-no-to-independence-would.html">Scots voting no to independence would be an astonishing act of self-harm</a></h1>
<div class="entry">
<span style="background-color: white; color: #222222; font-family: arial;"></span><br /><div style="clear: both; font-size: small; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-jSpA_iGiKCA/VBAAke5dsMI/AAAAAAAAMZg/-_PntFQYg9Y/s1600/Alex-Salmond-And-Alistair-011.jpg"><img width="400" src="http://3.bp.blogspot.com/-jSpA_iGiKCA/VBAAke5dsMI/AAAAAAAAMZg/-_PntFQYg9Y/s1600/Alex-Salmond-And-Alistair-011.jpg" border="0" height="240" /></a></div><div style="clear: both; font-size: small; text-align: center;" class="separator"><br /></div><div style="clear: both; text-align: left;" class="separator"><span style="font-family: Arial, Helvetica, sans-serif;">George Monbiot writes stirring stuff on indy. Well-reasoned and well-documented.</span></div><blockquote class="tr_bq">Imagine the question posed the other way round. An independent nation is asked to decide whether to surrender its sovereignty to a larger union. It would be allowed a measure of autonomy, but key aspects of its governance would be handed to another nation. It would be used as a military base by the dominant power and yoked to an economy over which it had no control. ...<span style="line-height: 18.9871444702148px;"> Most nations faced even with such catastrophes choose to retain their independence – in fact, will fight to preserve it – rather than surrender to a dominant foreign power.</span><span style="line-height: 18.9871444702148px;">...</span>The fears the no campaigners have worked so hard to stoke are – by comparison with what the Scots are being asked to lose – mere shadows. As Adam Ramsay points out in his treatise Forty-Two Reasons to Support Scottish Independence, there are plenty of nations smaller than Scotland <a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://commonwealth-publishing.com/?p=255" title="">that possess their own currencies and thrive</a>. Most of the world’s prosperous nations are small: <a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://www.english.plaidcymru.org/uploads/downloads/Flotilla_Effect_-_Adam_Price_and_Ben_Levinger.pdf" title="">there are no inherent disadvantages to downsizing</a>.<br />Remaining in the UK carries as much risk and uncertainty as leaving. England’s housing bubble could blow at any time. We might leave the European Union.<br />...<br /><span style="line-height: 18.9871444702148px;">How is the argument altered by the fact that Scotland is considering whether to gain independence rather than whether to lose it? It’s not. Those who would vote no – now, </span><a style="background-color: transparent; border-collapse: collapse; color: #005689; line-height: 18.9871444702148px; margin: 0px; padding: 0px; text-decoration: none;" href="http://www.theguardian.com/politics/2014/sep/02/scottish-independence-yes-campaign-poll-boost" title="">a new poll suggests, a rapidly diminishing majority </a><span style="line-height: 18.9871444702148px;">– could be suffering from system justification.</span><a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://onlinelibrary.wiley.com/doi/10.1111/j.2044-8309.1994.tb01008.x/abstract" title="">System justification</a> is defined as the “process by which existing social arrangements are legitimised, even at the expense of personal and group interest”. It consists of a desire to defend the status quo, regardless of its impacts. It has been demonstrated in a large body of experimental work, which has produced the following surprising results.<br />System justification becomes stronger when social and economic inequality is more extreme. This is because people try to rationalise their disadvantage by <a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://www.psych.nyu.edu/jost/Jost,%20Banaji,%20&amp;%20Nosek%20%282004%29%20A%20Decade%20of%20System%20Justificati.pdf" title="">seeking legitimate reasons for their position</a>. In some cases disadvantaged people are more likely than the privileged to support the status quo. <a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://www.bm.ust.hk/~mgmt/staff/papers/Bilian/EuroJSocPsy_2003_33_13.pdf" title="">One study found </a>that US citizens on low incomes were more likely than those on high incomes to believe that economic inequality is legitimate and necessary.<br />It explains why women in experimental studies pay themselves less than men, why people in low-status jobs believe their work is worth less than those in high-status jobs, even when they’re performing the same task, and <a style="border-collapse: collapse; color: #005689; margin: 0px; padding: 0px; text-decoration: none;" href="http://www.psych.nyu.edu/jost/Jost,%20Banaji,%20&amp;%20Nosek%20%282004%29%20A%20Decade%20of%20System%20Justificati.pdf" title="">why people accept domination by another group</a>. It might help to explain why so many people in Scotland are inclined to vote no.<br />...<br /><span style="line-height: 18.9871444702148px;">To deny this to yourself, to remain subject to the whims of a distant and uncaring elite, to succumb to the bleak, deferential negativity of the no campaign, to accept other people’s myths in place of your own story: that would be an astonishing act of self-repudiation and self-harm. Consider yourselves independent and work backwards from there; then ask why you would sacrifice that freedom.</span></blockquote><div style="font-family: Arial, Helvetica, sans-serif;"><a href="http://www.theguardian.com/commentisfree/2014/sep/02/scots-independence-england-scotland" class="link-text">Scots voting no to independence would be an astonishing act of self-harm</a></div><br /><br /><div><div style="font-family: Arial, Helvetica, sans-serif;"><a href="http://www.theguardian.com/commentisfree/2014/sep/09/yes-vote-in-scotland-most-dangerous-thing-of-all-hope" class="link-text">A yes vote in Scotland would unleash the most dangerous thing of all - hope</a></div></div><br /><br /><div style="font-family: Arial, Helvetica, sans-serif;">(Monbiot is also the author of <a href="http://www.monbiot.com/2006/11/07/heat/">Heat</a>, my favorite book on climate change.)</div><div><br /></div></div>






<p class="date">
<a href="http://wadler.blogspot.com/2014/09/scots-voting-no-to-independence-would.html">by Philip Wadler (noreply@blogger.com) at September 10, 2014 02:38 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://izbicki.me" title="Mike Izbicki's blog posts">Mike Izbicki</a></h3>

<div class="entrygroup" id="http://izbicki.me/blog/polymorphism-in-haskell-vs-c%2B%2B.html">
<blockquote>
<h1 class="entry"><a href="http://izbicki.me/blog/polymorphism-in-haskell-vs-c%2B%2B.html">Polymorphism in Haskell vs C++</a></h1>
<div class="entry">
<h1>Polymorphism in Haskell vs C++</h1>
<div class="info">
    
        posted on 2014-09-10
    
    
        by <a href="https://github.com/jduga002">Jonathan Dugan</a>
    
</div>

<p><a href="https://en.wikipedia.org/wiki/Parametric_polymorphism">Parametric polymorphism</a> is when you write one function that works on many data types. In C++, this is pretty confusing, but it’s really easy in Haskell. Let’s take a look at an example.</p>
<p>Let’s say we want a function that calculates the volume of a box. In C++, we’d use templates so that our function works with any numeric type:</p>
<pre><code>template&lt;typename T&gt;
T boxVolume(T length, T width, T height)
{
    return length * width * height;
}</code></pre>
<p>Templates have an awkward syntax, but that isn’t too much of a hassle. C++ has much bigger problems. What if in the course of writing your program, you accidentally pass in some strings to this function?</p>
<pre><code>int main()
{
    cout &lt;&lt; boxVolume("oops","no","strings") &lt;&lt; endl;
}</code></pre>
<p>We get this error when we compile with <code>g++</code>:</p>
<pre><code>test.cpp: In instantiation of _T boxVolume(T, T, T) [with T = const    char*]_:
test.cpp:22:47:   required from here
test.cpp:8:19: error: invalid operands of types _const char*_ and _const char*_ to binary
_operator*_
    return length * width * height;</code></pre>
<p>This error message is a little hard to understand because of the templates. If we had written our function to use <code>double</code>s instead of templates:</p>
<pre><code>double boxVolume(double length, double width, double height)
{
    return length * width * height;
}</code></pre>
<p>We would get this simpler error message:</p>
<pre><code>test.cpp: In function _int main()_:
test.cpp:22:47: error: cannot convert _const char*_ to _double_ for argument _1_ to _double
boxVolume(double, double, double)_
    cout &lt;&lt; boxVolume("oops","nope","bad!") &lt;&lt; endl;</code></pre>
<p>We see that this error is shorter and easier to use, as it clearly tells us we cannot pass string literals to our function. Plus there is no superfluous comment about our “instantiation” of <code>boxVolume</code>.</p>
<p>Now let’s try to write a polymorphic <code>boxVolume</code> in Haskell:</p>
<pre><code>boxVolume :: a -&gt; a -&gt; a -&gt; a
boxVolume length width height = length * width * height</code></pre>
<p>When we try to compile, we get the error:</p>
<pre><code>test.hs:2:50:
    No instance for (Num a) arising from a use of `*'
    Possible fix:
      add (Num a) to the context of
        the type signature for boxVolume :: a -&gt; a -&gt; a -&gt; a
    In the expression: length * width * height
    In an equation for `boxVolume':
        boxVolume length width height = length * width * height</code></pre>
<p>Uh-oh! An error message! What went wrong? It says that we tried to use the <code>*</code> operator without declaring our parameters as an instance of the <code>Num</code> type class.</p>
<p>But what is a type class? This leads us to <a href="https://en.wikipedia.org/wiki/Ad_hoc_polymorphism">ad hoc polymorphism</a>, also known as function overloading. Ad hoc polymorphism is when a function can be applied to different argument types, each with a different implementation. For example, the STL classes stack and queue each have their own push and pop functions, which, although they have the same names, do different things:</p>
<pre><code>stack&lt;int&gt; s;
queue&lt;int&gt; q;

s.push(1); q.push(1);
s.push(2); q.push(2);
s.push(3); q.push(3);

s.pop(); q.pop();</code></pre>
<p>After the above code is executed, the stack <code>s</code> will be left with the numbers <code>1,2</code> while the queue <code>q</code> will be left with the numbers <code>2,3</code>. The function <code>pop</code> behaves differently on stacks and queues: calling <code>pop</code> on a stack removes the item added last, while calling <code>pop</code> on a queue removes the item added first.</p>
<p>Haskell does not support function overloading, except through type classes. For example, if we were to specifically declare our own <code>Stack</code> and <code>Queue</code> classes with <code>push</code> and <code>pop</code> functions:</p>
<pre><code>data Stack = Stack  [Int] deriving Show
data Queue = Queue [Int] deriving Show

push :: Stack -&gt; Int -&gt; Stack
push (Stack xs) x = Stack (x:xs)

pop :: Stack -&gt; Stack
pop (Stack []) = Stack []
pop (Stack xs) = Stack (tail xs)

push :: Queue -&gt; Int -&gt; Queue
push (Queue xs) x = Queue (x:xs)

pop :: Queue -&gt; Queue
pop (Queue []) = Queue []
pop (Queue xs) = Queue (init xs)</code></pre>
<p>It results in a compiler error:</p>
<pre><code>stack.hs:11:1:
    Duplicate type signatures for `push'
    at stack.hs:4:1-4
       stack.hs:11:1-4

stack.hs:12:1:
    Multiple declarations of `push'
    Declared at: stack.hs:5:1
                 stack.hs:12:1

stack.hs:14:1:
    Duplicate type signatures for `pop'
    at stack.hs:7:1-3
       stack.hs:14:1-3

stack.hs:15:1:
    Multiple declarations of `pop'
    Declared at: stack.hs:8:1
                 stack.hs:15:1</code></pre>
<p>Changing the names of our push and pop functions to, say, <code>stackPush</code>, <code>stackPop</code>, <code>queuePush</code>, and <code>queuePop</code> would let the program compile.</p>
<p>A more generic way, however, is to create a type class. Let’s make a <code>Sequence</code> type class that implements our <code>push</code> and <code>pop</code> functions.</p>
<pre><code>class Sequence s where
    push :: s -&gt; Int -&gt; s
    pop :: s -&gt; s</code></pre>
<p>This type class declaration says that any data type that is an instance of this <code>Sequence</code> type class can use the <code>push</code> and <code>pop</code> operations, or, in other words, can add and remove an <code>Int</code>. By making our <code>Stack</code> and <code>Queue</code> instances of the <code>Sequence</code> type class, both data types can have their own implementations of the <code>push</code> and <code>pop</code> functions!</p>
<pre><code>instance Sequence Stack where
    push (Stack xs) x = Stack (x:xs)
    pop (Stack []) = Stack []
    pop (Stack xs) = Stack (tail xs)

instance Sequence Queue where
    push (Queue xs) x = Queue (x:xs)
    pop (Queue []) = Queue []
    pop (Queue xs) = Queue (init xs)</code></pre>
<p>Replacing our function definitions with these instantiations of the Sequence type class lets our program compile.</p>
<p>Type classes are also an important part of using templates in function definitions. In our function <code>boxVolume</code>, we got an error because we tried to use the <code>*</code> operation without declaring the type variable <code>a</code> as an instance of the <code>Num</code> type class. The <code>Num</code> type class is basically for anything that acts like a number, such as <code>Int</code>, <code>Float</code>, and <code>Double</code>, and it lets you use the common operations of <code>+</code>, <code>-</code>, and <code>*</code>.</p>
<p>Let’s change our function to declare that <code>a</code> is a <code>Num</code>:</p>
<pre><code>boxVolume :: (Num a) =&gt; a -&gt; a -&gt; a -&gt; a
boxVolume length width height = length * width * height</code></pre>
<p>This is called adding a class constraint. Whenever we want to declare a template function that relies on other functions, we have to add a class constraint that tells both the user and the compiler which types of data can be put into the function.</p>
<p>If we were to call <code>boxVolume</code> on strings, we would get this simple error message:</p>
<pre><code>ghci&gt; boxVolume "a" "b" "c"

&lt;interactive&gt;:14:1:
    No instance for (Num [Char]) arising from a use of `boxVolume'
    Possible fix: add an instance declaration for (Num [Char])
    In the expression: boxVolume "a" "b" "c"
    In an equation for `it': it = boxVolume "a" "b" "c"</code></pre>
<p>The compiler tells us it can’t evaluate this function because strings aren’t numbers! If we really wanted to, we could make <code>String</code> an instance of the <code>Num</code> type class, and then this function would work! (Of course, why you would want to do that is beyond me.) That’s the power of parametric polymorphism combined with type classes.</p>
<p>So there you have it. In C++, although we can easily implement ad hoc polymorphism through function overloading, parametric polymorphism is a tricky beast. This is made easier in Haskell, especially with the use of type classes. Type classes guarantee that data passed in to functions will work, and guide the user into what they can pass into a function. Use type classes to your advantage when you next write a Haskell program!</p></div>






<p class="date">
<a href="http://izbicki.me/blog/polymorphism-in-haskell-vs-c%2B%2B.html">September 10, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 09, 2014</h2>

<div class="channelgroup">







<h3><a href="http://idontgetoutmuch.wordpress.com" title="Idontgetoutmuch's Weblog">Dominic Steinitz</a></h3>

<div class="entrygroup" id="http://idontgetoutmuch.wordpress.com/?p=752">
<blockquote>
<h1 class="entry"><a href="http://idontgetoutmuch.wordpress.com/2014/09/09/fun-with-extended-kalman-filters-4/">Fun with (Extended Kalman) Filters</a></h1>
<div class="entry">
<h1 id="summary">Summary</h1>
<p>An extended Kalman filter in Haskell using <a href="https://www.haskell.org/ghc/docs/latest/html/users_guide/type-level-literals.html">type level literals</a> and automatic differentiation to provide some guarantees of correctness.</p>
<h1 id="population-growth">Population Growth</h1>
<p>Suppose we wish to model population growth of bees via the <a href="http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth">logistic equation</a></p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++%5Cdot%7Bp%7D+%26+%3D+rp%5CBig%281+-+%5Cfrac%7Bp%7D%7Bk%7D%5CBig%29++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  \dot{p} &amp; = rp\Big(1 - \frac{p}{k}\Big)  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  \dot{p} &amp; = rp\Big(1 - \frac{p}{k}\Big)  \end{aligned}  " /></div>
<p>We assume the growth rate <img src="http://s0.wp.com/latex.php?latex=r&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="r" class="latex" title="r" /> is unknown and drawn from a normal distribution <img src="http://s0.wp.com/latex.php?latex=%7B%5Ccal%7BN%7D%7D%28%5Cmu_r%2C+%5Csigma_r%5E2%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="{\cal{N}}(\mu_r, \sigma_r^2)" class="latex" title="{\cal{N}}(\mu_r, \sigma_r^2)" /> but the carrying capacity <img src="http://s0.wp.com/latex.php?latex=k&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="k" class="latex" title="k" /> is known and we wish to estimate the growth rate by observing noisy values <img src="http://s0.wp.com/latex.php?latex=y_i&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="y_i" class="latex" title="y_i" /> of the population at discrete times <img src="http://s0.wp.com/latex.php?latex=t_0+%3D+0%2C+t_1+%3D+%5CDelta+T%2C+t_2+%3D+2%5CDelta+T%2C+%5Cldots&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="t_0 = 0, t_1 = \Delta T, t_2 = 2\Delta T, \ldots" class="latex" title="t_0 = 0, t_1 = \Delta T, t_2 = 2\Delta T, \ldots" />. Note that <img src="http://s0.wp.com/latex.php?latex=p_t&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p_t" class="latex" title="p_t" /> is entirely deterministic and its stochasticity is only as a result of the fact that the unknown parameter of the logistic equation is sampled from a normal distribution (we could for example be observing different colonies of bees and we know from the literature that bee populations obey the logistic equation and each colony will have different growth rates).</p>
<h2 id="haskell-preamble">Haskell Preamble</h2>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: green;">{-# OPTIONS_GHC -Wall                     #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-name-shadowing  #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-type-defaults   #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-unused-do-bind  #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-orphans         #-}</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: green;">{-# LANGUAGE DataKinds                    #-}</span>
&gt; <span style="color: green;">{-# LANGUAGE ScopedTypeVariables          #-}</span>
&gt; <span style="color: green;">{-# LANGUAGE RankNTypes                   #-}</span>
&gt; <span style="color: green;">{-# LANGUAGE BangPatterns                 #-}</span>
&gt; <span style="color: green;">{-# LANGUAGE TypeOperators                #-}</span>
&gt; <span style="color: green;">{-# LANGUAGE TypeFamilies                 #-}</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">module</span> FunWithKalman3 <span style="color: blue; font-weight: bold;">where</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> GHC.TypeLits
&gt; <span style="color: blue; font-weight: bold;">import</span> Numeric.LinearAlgebra.Static
&gt; <span style="color: blue; font-weight: bold;">import</span> Data.Maybe <span style="color: red;">(</span> fromJust <span style="color: red;">)</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> Numeric.AD
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> Data.Random.Source.PureMT
&gt; <span style="color: blue; font-weight: bold;">import</span> Data.Random
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> Control.Monad.State
&gt; <span style="color: blue; font-weight: bold;">import</span> <span style="color: blue; font-weight: bold;">qualified</span> Control.Monad.Writer <span style="color: blue; font-weight: bold;">as</span> W
&gt; <span style="color: blue; font-weight: bold;">import</span> Control.Monad.Loops
</code></pre>
<h2 id="logistic-equation">Logistic Equation</h2>
<p>The logistic equation is a well known example of a <a href="http://en.wikipedia.org/wiki/Dynamical_system">dynamical system</a> which has an analytic solution</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++p+%3D+%5Cfrac%7Bkp_0%5Cexp+rt%7D%7Bk+%2B+p_0%28%5Cexp+rt+-+1%29%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  p = \frac{kp_0\exp rt}{k + p_0(\exp rt - 1)}  " class="latex" title="\displaystyle  p = \frac{kp_0\exp rt}{k + p_0(\exp rt - 1)}  " /></div>
<p>Here it is in Haskell</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; logit <span style="color: red;">::</span> Floating a <span style="color: red;">=&gt;</span> a <span style="color: red;">-&gt;</span> a <span style="color: red;">-&gt;</span> a <span style="color: red;">-&gt;</span> a
&gt; logit p0 k x <span style="color: red;">=</span> k * p0 * <span style="color: red;">(</span>exp x<span style="color: red;">)</span> / <span style="color: red;">(</span>k + p0 * <span style="color: red;">(</span>exp x <span style="color: green;">-</span> <span class="hs-num">1</span><span style="color: red;">)</span><span style="color: red;">)</span>
</code></pre>
<p>We observe a noisy value of population at regular time intervals (where <img src="http://s0.wp.com/latex.php?latex=%5CDelta+T&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Delta T" class="latex" title="\Delta T" /> is the time interval)</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++p_i+%26%3D+%5Cfrac%7Bkp_0%5Cexp+r%5CDelta+T+i%7D%7Bk+%2B+p_0%28%5Cexp+r%5CDelta+T+i+-+1%29%7D+%5C%5C++y_i+%26%3D+p_i+%2B+%5Cepsilon_i++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  p_i &amp;= \frac{kp_0\exp r\Delta T i}{k + p_0(\exp r\Delta T i - 1)} \\  y_i &amp;= p_i + \epsilon_i  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  p_i &amp;= \frac{kp_0\exp r\Delta T i}{k + p_0(\exp r\Delta T i - 1)} \\  y_i &amp;= p_i + \epsilon_i  \end{aligned}  " /></div>
<p>Using the <a href="http://www.math.harvard.edu/archive/118r_spring_05/presentations/intro.pdf">semi-group property</a> of our dynamical system, we can re-write this as</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++p_i+%26%3D+%5Cfrac%7Bkp_%7Bi-1%7D%5Cexp+r%5CDelta+T%7D%7Bk+%2B+p_%7Bi-1%7D%28%5Cexp+r%5CDelta+T+-+1%29%7D+%5C%5C++y_i+%26%3D+p_i+%2B+%5Cepsilon_i++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  p_i &amp;= \frac{kp_{i-1}\exp r\Delta T}{k + p_{i-1}(\exp r\Delta T - 1)} \\  y_i &amp;= p_i + \epsilon_i  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  p_i &amp;= \frac{kp_{i-1}\exp r\Delta T}{k + p_{i-1}(\exp r\Delta T - 1)} \\  y_i &amp;= p_i + \epsilon_i  \end{aligned}  " /></div>
<p>To convince yourself that this re-formulation is correct, think of the population as starting at <img src="http://s0.wp.com/latex.php?latex=p_0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p_0" class="latex" title="p_0" />; after 1 time step it has reached <img src="http://s0.wp.com/latex.php?latex=p_1&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p_1" class="latex" title="p_1" /> and and after two time steps it has reached <img src="http://s0.wp.com/latex.php?latex=p_2&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p_2" class="latex" title="p_2" /> and this ought to be the same as the point reached after 1 time step starting at <img src="http://s0.wp.com/latex.php?latex=p_1&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p_1" class="latex" title="p_1" />, for example</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; oneStepFrom0<span style="color: red;">,</span> twoStepsFrom0<span style="color: red;">,</span> oneStepFrom1 <span style="color: red;">::</span> Double
&gt; oneStepFrom0  <span style="color: red;">=</span> logit <span class="hs-num">0.1</span> <span class="hs-num">1.0</span> <span style="color: red;">(</span><span class="hs-num">1</span> * <span class="hs-num">0.1</span><span style="color: red;">)</span>
&gt; twoStepsFrom0 <span style="color: red;">=</span> logit <span class="hs-num">0.1</span> <span class="hs-num">1.0</span> <span style="color: red;">(</span><span class="hs-num">1</span> * <span class="hs-num">0.2</span><span style="color: red;">)</span>
&gt; oneStepFrom1  <span style="color: red;">=</span> logit oneStepFrom0 <span class="hs-num">1.0</span> <span style="color: red;">(</span><span class="hs-num">1</span> * <span class="hs-num">0.1</span><span style="color: red;">)</span>
</code></pre>
<pre><code><span style="color: gray;">ghci&gt; </span>twoStepsFrom0
  0.11949463171139338

<span style="color: gray;">ghci&gt; </span>oneStepFrom1
  0.1194946317113934
</code></pre>
<p>We would like to infer the growth rate not just be able to predict the population so we need to add another variable to our model.</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++r_i+%26%3D+r_%7Bi-1%7D+%5C%5C++p_i+%26%3D+%5Cfrac%7Bkp_%7Bi-1%7D%5Cexp+r_%7Bi-1%7D%5CDelta+T%7D%7Bk+%2B+p_%7Bi-1%7D%28%5Cexp+r_%7Bi-1%7D%5CDelta+T+-+1%29%7D+%5C%5C++y_i+%26%3D+%5Cbegin%7Bbmatrix%7D0+%26+1%5Cend%7Bbmatrix%7D%5Cbegin%7Bbmatrix%7Dr_i+%5C%5C+p_i%5Cend%7Bbmatrix%7D+%2B+%5Cbegin%7Bbmatrix%7D0+%5C%5C+%5Cepsilon_i%5Cend%7Bbmatrix%7D++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  r_i &amp;= r_{i-1} \\  p_i &amp;= \frac{kp_{i-1}\exp r_{i-1}\Delta T}{k + p_{i-1}(\exp r_{i-1}\Delta T - 1)} \\  y_i &amp;= \begin{bmatrix}0 &amp; 1\end{bmatrix}\begin{bmatrix}r_i \\ p_i\end{bmatrix} + \begin{bmatrix}0 \\ \epsilon_i\end{bmatrix}  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  r_i &amp;= r_{i-1} \\  p_i &amp;= \frac{kp_{i-1}\exp r_{i-1}\Delta T}{k + p_{i-1}(\exp r_{i-1}\Delta T - 1)} \\  y_i &amp;= \begin{bmatrix}0 &amp; 1\end{bmatrix}\begin{bmatrix}r_i \\ p_i\end{bmatrix} + \begin{bmatrix}0 \\ \epsilon_i\end{bmatrix}  \end{aligned}  " /></div>
<h1 id="extended-kalman">Extended Kalman</h1>
<p>This is almost in the form suitable for estimation using a Kalman filter but the dependency of the state on the previous state is non-linear. We can modify the Kalman filter to create the extended Kalman filter (<a href="http://en.wikipedia.org/wiki/Extended_Kalman_filter">EKF</a>) by making a linear approximation.</p>
<p>Since the measurement update is trivially linear (even in this more general form), the measurement update step remains unchanged.</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++%5Cboldsymbol%7Bv%7D_i+%26+%5Ctriangleq++%5Cboldsymbol%7By%7D_i+-+%5Cboldsymbol%7Bg%7D%28%5Chat%7B%5Cboldsymbol%7Bx%7D%7D%5E%5Cflat_i%29+%5C%5C++%5Cboldsymbol%7BS%7D_i+%26+%5Ctriangleq++%5Cboldsymbol%7BG%7D_i+%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D%5E%5Cflat_i++%5Cboldsymbol%7BG%7D_i%5E%5Ctop+%2B+%5Cboldsymbol%7B%5CSigma%7D%5E%7B%28y%29%7D_i+%5C%5C++%5Cboldsymbol%7BK%7D_i+%26+%5Ctriangleq+%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D%5E%5Cflat_i++%5Cboldsymbol%7BG%7D_i%5E%5Ctop%5Cboldsymbol%7BS%7D%5E%7B-1%7D_i+%5C%5C++%5Chat%7B%5Cboldsymbol%7Bx%7D%7D%5Ei+%26%5Ctriangleq+%5Chat%7B%5Cboldsymbol%7Bx%7D%7D%5E%5Cflat_i+%2B+%5Cboldsymbol%7BK%7D_i%5Cboldsymbol%7Bv%7D_i+%5C%5C++%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D_i+%26%5Ctriangleq+%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D%5E%5Cflat_i+-+%5Cboldsymbol%7BK%7D_i%5Cboldsymbol%7BS%7D_i%5Cboldsymbol%7BK%7D%5E%5Ctop_i++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  \boldsymbol{v}_i &amp; \triangleq  \boldsymbol{y}_i - \boldsymbol{g}(\hat{\boldsymbol{x}}^\flat_i) \\  \boldsymbol{S}_i &amp; \triangleq  \boldsymbol{G}_i \hat{\boldsymbol{\Sigma}}^\flat_i  \boldsymbol{G}_i^\top + \boldsymbol{\Sigma}^{(y)}_i \\  \boldsymbol{K}_i &amp; \triangleq \hat{\boldsymbol{\Sigma}}^\flat_i  \boldsymbol{G}_i^\top\boldsymbol{S}^{-1}_i \\  \hat{\boldsymbol{x}}^i &amp;\triangleq \hat{\boldsymbol{x}}^\flat_i + \boldsymbol{K}_i\boldsymbol{v}_i \\  \hat{\boldsymbol{\Sigma}}_i &amp;\triangleq \hat{\boldsymbol{\Sigma}}^\flat_i - \boldsymbol{K}_i\boldsymbol{S}_i\boldsymbol{K}^\top_i  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  \boldsymbol{v}_i &amp; \triangleq  \boldsymbol{y}_i - \boldsymbol{g}(\hat{\boldsymbol{x}}^\flat_i) \\  \boldsymbol{S}_i &amp; \triangleq  \boldsymbol{G}_i \hat{\boldsymbol{\Sigma}}^\flat_i  \boldsymbol{G}_i^\top + \boldsymbol{\Sigma}^{(y)}_i \\  \boldsymbol{K}_i &amp; \triangleq \hat{\boldsymbol{\Sigma}}^\flat_i  \boldsymbol{G}_i^\top\boldsymbol{S}^{-1}_i \\  \hat{\boldsymbol{x}}^i &amp;\triangleq \hat{\boldsymbol{x}}^\flat_i + \boldsymbol{K}_i\boldsymbol{v}_i \\  \hat{\boldsymbol{\Sigma}}_i &amp;\triangleq \hat{\boldsymbol{\Sigma}}^\flat_i - \boldsymbol{K}_i\boldsymbol{S}_i\boldsymbol{K}^\top_i  \end{aligned}  " /></div>
<p>By Taylor we have</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cboldsymbol%7Ba%7D%28%5Cboldsymbol%7Bx%7D%29+%5Capprox+%5Cboldsymbol%7Ba%7D%28%5Cboldsymbol%7Bm%7D%29+%2B+%5Cboldsymbol%7BA%7D_%7B%5Cboldsymbol%7Bx%7D%7D%28%5Cboldsymbol%7Bm%7D%29%5Cdelta%5Cboldsymbol%7Bx%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \boldsymbol{a}(\boldsymbol{x}) \approx \boldsymbol{a}(\boldsymbol{m}) + \boldsymbol{A}_{\boldsymbol{x}}(\boldsymbol{m})\delta\boldsymbol{x}  " class="latex" title="\displaystyle  \boldsymbol{a}(\boldsymbol{x}) \approx \boldsymbol{a}(\boldsymbol{m}) + \boldsymbol{A}_{\boldsymbol{x}}(\boldsymbol{m})\delta\boldsymbol{x}  " /></div>
<p>where <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7BA%7D_%7B%5Cboldsymbol%7Bx%7D%7D%28%5Cboldsymbol%7Bm%7D%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{A}_{\boldsymbol{x}}(\boldsymbol{m})" class="latex" title="\boldsymbol{A}_{\boldsymbol{x}}(\boldsymbol{m})" /> is the Jacobian of <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7Ba%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{a}" class="latex" title="\boldsymbol{a}" /> evaluated at <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7Bm%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{m}" class="latex" title="\boldsymbol{m}" /> (for the exposition of the extended filter we take <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7Ba%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{a}" class="latex" title="\boldsymbol{a}" /> to be vector valued hence the use of a bold font). We take <img src="http://s0.wp.com/latex.php?latex=%5Cdelta%5Cboldsymbol%7Bx%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\delta\boldsymbol{x}" class="latex" title="\delta\boldsymbol{x}" /> to be normally distributed with mean of 0 and ignore any difficulties there may be with using Taylor with stochastic variables.</p>
<p>Applying this at <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7Bm%7D+%3D+%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{m} = \hat{\boldsymbol{x}}_{i-1}" class="latex" title="\boldsymbol{m} = \hat{\boldsymbol{x}}_{i-1}" /> we have</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cboldsymbol%7Bx%7D_i+%3D+%5Cboldsymbol%7Ba%7D%28%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D%29+%2B+%5Cboldsymbol%7BA%7D_%7B%5Cboldsymbol%7Bx%7D%7D%28%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D%29%28%5Cboldsymbol%7Bx%7D_%7Bi-1%7D+-+%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D%29+%2B+%5Cboldsymbol%7B%5Cepsilon%7D_i++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \boldsymbol{x}_i = \boldsymbol{a}(\hat{\boldsymbol{x}}_{i-1}) + \boldsymbol{A}_{\boldsymbol{x}}(\hat{\boldsymbol{x}}_{i-1})(\boldsymbol{x}_{i-1} - \hat{\boldsymbol{x}}_{i-1}) + \boldsymbol{\epsilon}_i  " class="latex" title="\displaystyle  \boldsymbol{x}_i = \boldsymbol{a}(\hat{\boldsymbol{x}}_{i-1}) + \boldsymbol{A}_{\boldsymbol{x}}(\hat{\boldsymbol{x}}_{i-1})(\boldsymbol{x}_{i-1} - \hat{\boldsymbol{x}}_{i-1}) + \boldsymbol{\epsilon}_i  " /></div>
<p>Using the same reasoning as we did as for Kalman filters and writing <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7BA%7D_%7Bi-1%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{A}_{i-1}" class="latex" title="\boldsymbol{A}_{i-1}" /> for <img src="http://s0.wp.com/latex.php?latex=%5Cboldsymbol%7BA%7D_%7B%5Cboldsymbol%7Bx%7D%7D%28%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\boldsymbol{A}_{\boldsymbol{x}}(\hat{\boldsymbol{x}}_{i-1})" class="latex" title="\boldsymbol{A}_{\boldsymbol{x}}(\hat{\boldsymbol{x}}_{i-1})" /> we obtain</p>
<div style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle++%5Cbegin%7Baligned%7D++%5Chat%7B%5Cboldsymbol%7Bx%7D%7D%5E%5Cflat_i+%26%3D++%5Cboldsymbol%7Ba%7D%28%5Chat%7B%5Cboldsymbol%7Bx%7D%7D_%7Bi-1%7D%29+%5C%5C++%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D%5E%5Cflat_i+%26%3D+%5Cboldsymbol%7BA%7D_%7Bi-1%7D++%5Chat%7B%5Cboldsymbol%7B%5CSigma%7D%7D_%7Bi-1%7D++%5Cboldsymbol%7BA%7D_%7Bi-1%7D%5E%5Ctop++%2B+%5Cboldsymbol%7B%5CSigma%7D%5E%7B%28x%29%7D_%7Bi-1%7D++%5Cend%7Baligned%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle  \begin{aligned}  \hat{\boldsymbol{x}}^\flat_i &amp;=  \boldsymbol{a}(\hat{\boldsymbol{x}}_{i-1}) \\  \hat{\boldsymbol{\Sigma}}^\flat_i &amp;= \boldsymbol{A}_{i-1}  \hat{\boldsymbol{\Sigma}}_{i-1}  \boldsymbol{A}_{i-1}^\top  + \boldsymbol{\Sigma}^{(x)}_{i-1}  \end{aligned}  " class="latex" title="\displaystyle  \begin{aligned}  \hat{\boldsymbol{x}}^\flat_i &amp;=  \boldsymbol{a}(\hat{\boldsymbol{x}}_{i-1}) \\  \hat{\boldsymbol{\Sigma}}^\flat_i &amp;= \boldsymbol{A}_{i-1}  \hat{\boldsymbol{\Sigma}}_{i-1}  \boldsymbol{A}_{i-1}^\top  + \boldsymbol{\Sigma}^{(x)}_{i-1}  \end{aligned}  " /></div>
<h2 id="haskell-implementation">Haskell Implementation</h2>
<p>Note that we pass in the Jacobian of the update function as a function itself in the case of the extended Kalman filter rather than the matrix representing the linear function as we do in the case of the <a href="http://idontgetoutmuch.wordpress.com/2014/08/06/fun-with-kalman-filters-part-ii/">classical Kalman filter</a>.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; k<span style="color: red;">,</span> p0 <span style="color: red;">::</span> Floating a <span style="color: red;">=&gt;</span> a
&gt; k <span style="color: red;">=</span> <span class="hs-num">1.0</span>
&gt; p0 <span style="color: red;">=</span> <span class="hs-num">0.1</span> * k
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; r<span style="color: red;">,</span> deltaT <span style="color: red;">::</span> Floating a <span style="color: red;">=&gt;</span> a
&gt; r <span style="color: red;">=</span> <span class="hs-num">10.0</span>
&gt; deltaT <span style="color: red;">=</span> <span class="hs-num">0.0005</span>
</code></pre>
<p>Relating <a href="https://hackage.haskell.org/package/ad">ad</a> and <a href="https://hackage.haskell.org/package/hmatrix">hmatrix</a> is somewhat unpleasant but this can probably be ameliorated by defining a suitable datatype.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; a <span style="color: red;">::</span> R <span class="hs-num">2</span> <span style="color: red;">-&gt;</span> R <span class="hs-num">2</span>
&gt; a rpPrev <span style="color: red;">=</span> rNew # pNew
&gt;   <span style="color: blue; font-weight: bold;">where</span>
&gt;     <span style="color: red;">(</span>r<span style="color: red;">,</span> pPrev<span style="color: red;">)</span> <span style="color: red;">=</span> headTail rpPrev
&gt;     rNew <span style="color: red;">::</span> R <span class="hs-num">1</span>
&gt;     rNew <span style="color: red;">=</span> konst r
&gt; 
&gt;     <span style="color: red;">(</span>p<span style="color: red;">,</span>  <span style="color: blue; font-weight: bold;">_</span><span style="color: red;">)</span> <span style="color: red;">=</span> headTail pPrev
&gt;     pNew <span style="color: red;">::</span> R <span class="hs-num">1</span>
&gt;     pNew <span style="color: red;">=</span> fromList $ <span style="color: red;">[</span>logit p k <span style="color: red;">(</span>r * deltaT<span style="color: red;">)</span><span style="color: red;">]</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; bigA <span style="color: red;">::</span> R <span class="hs-num">2</span> <span style="color: red;">-&gt;</span> Sq <span class="hs-num">2</span>
&gt; bigA rp <span style="color: red;">=</span> fromList $ concat $ j <span style="color: red;">[</span>r<span style="color: red;">,</span> p<span style="color: red;">]</span>
&gt;   <span style="color: blue; font-weight: bold;">where</span>
&gt;     <span style="color: red;">(</span>r<span style="color: red;">,</span> ps<span style="color: red;">)</span> <span style="color: red;">=</span> headTail rp
&gt;     <span style="color: red;">(</span>p<span style="color: red;">,</span>  <span style="color: blue; font-weight: bold;">_</span><span style="color: red;">)</span> <span style="color: red;">=</span> headTail ps
&gt;     j <span style="color: red;">=</span> jacobian <span style="color: red;">(</span><span style="color: red;">\</span><span style="color: red;">[</span>r<span style="color: red;">,</span> p<span style="color: red;">]</span> <span style="color: red;">-&gt;</span> <span style="color: red;">[</span>r<span style="color: red;">,</span> logit p k <span style="color: red;">(</span>r * deltaT<span style="color: red;">)</span><span style="color: red;">]</span><span style="color: red;">)</span>
</code></pre>
<p>For some reason, hmatrix with static guarantees does not yet provide an inverse function for matrices.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; inv <span style="color: red;">::</span> <span style="color: red;">(</span>KnownNat n<span style="color: red;">,</span> <span style="color: red;">(</span><span class="hs-num">1</span> &lt;=? n<span style="color: red;">)</span> <span style="color: red;">~</span> <span style="color: teal;">'</span>True<span style="color: red;">)</span> <span style="color: red;">=&gt;</span> Sq n <span style="color: red;">-&gt;</span> Sq n
&gt; inv m <span style="color: red;">=</span> fromJust $ linSolve m eye
</code></pre>
<p>Here is the extended Kalman filter itself. The type signatures on the expressions inside the function are not necessary but did help the implementor discover a bug in the mathematical derivation and will hopefully help the reader.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; outer <span style="color: red;">::</span>  <span style="color: blue; font-weight: bold;">forall</span> m n . <span style="color: red;">(</span>KnownNat m<span style="color: red;">,</span> KnownNat n<span style="color: red;">,</span>
&gt;                         <span style="color: red;">(</span><span class="hs-num">1</span> &lt;=? n<span style="color: red;">)</span> <span style="color: red;">~</span> <span style="color: teal;">'</span>True<span style="color: red;">,</span> <span style="color: red;">(</span><span class="hs-num">1</span> &lt;=? m<span style="color: red;">)</span> <span style="color: red;">~</span> <span style="color: teal;">'</span>True<span style="color: red;">)</span> <span style="color: red;">=&gt;</span>
&gt;           R n <span style="color: red;">-&gt;</span> Sq n <span style="color: red;">-&gt;</span>
&gt;           L m n <span style="color: red;">-&gt;</span> Sq m <span style="color: red;">-&gt;</span>
&gt;           <span style="color: red;">(</span>R n <span style="color: red;">-&gt;</span> R n<span style="color: red;">)</span> <span style="color: red;">-&gt;</span> <span style="color: red;">(</span>R n <span style="color: red;">-&gt;</span> Sq n<span style="color: red;">)</span> <span style="color: red;">-&gt;</span> Sq n <span style="color: red;">-&gt;</span>
&gt;           <span style="color: red;">[</span>R m<span style="color: red;">]</span> <span style="color: red;">-&gt;</span>
&gt;           <span style="color: red;">[</span><span style="color: red;">(</span>R n<span style="color: red;">,</span> Sq n<span style="color: red;">)</span><span style="color: red;">]</span>
&gt; outer muPrior sigmaPrior bigH bigSigmaY
&gt;       littleA bigABuilder bigSigmaX ys <span style="color: red;">=</span> result
&gt;   <span style="color: blue; font-weight: bold;">where</span>
&gt;     result <span style="color: red;">=</span> scanl update <span style="color: red;">(</span>muPrior<span style="color: red;">,</span> sigmaPrior<span style="color: red;">)</span> ys
&gt; 
&gt;     update <span style="color: red;">::</span> <span style="color: red;">(</span>R n<span style="color: red;">,</span> Sq n<span style="color: red;">)</span> <span style="color: red;">-&gt;</span> R m <span style="color: red;">-&gt;</span> <span style="color: red;">(</span>R n<span style="color: red;">,</span> Sq n<span style="color: red;">)</span>
&gt;     update <span style="color: red;">(</span>xHatFlat<span style="color: red;">,</span> bigSigmaHatFlat<span style="color: red;">)</span> y <span style="color: red;">=</span>
&gt;       <span style="color: red;">(</span>xHatFlatNew<span style="color: red;">,</span> bigSigmaHatFlatNew<span style="color: red;">)</span>
&gt;       <span style="color: blue; font-weight: bold;">where</span>
&gt; 
&gt;         v <span style="color: red;">::</span> R m
&gt;         v <span style="color: red;">=</span> y <span style="color: green;">-</span> <span style="color: red;">(</span>bigH #&gt; xHatFlat<span style="color: red;">)</span>
&gt; 
&gt;         bigS <span style="color: red;">::</span> Sq m
&gt;         bigS <span style="color: red;">=</span> bigH &lt;&gt; bigSigmaHatFlat &lt;&gt; <span style="color: red;">(</span>tr bigH<span style="color: red;">)</span> + bigSigmaY
&gt; 
&gt;         bigK <span style="color: red;">::</span> L n m
&gt;         bigK <span style="color: red;">=</span> bigSigmaHatFlat &lt;&gt; <span style="color: red;">(</span>tr bigH<span style="color: red;">)</span> &lt;&gt; <span style="color: red;">(</span>inv bigS<span style="color: red;">)</span>
&gt; 
&gt;         xHat <span style="color: red;">::</span> R n
&gt;         xHat <span style="color: red;">=</span> xHatFlat + bigK #&gt; v
&gt; 
&gt;         bigSigmaHat <span style="color: red;">::</span> Sq n
&gt;         bigSigmaHat <span style="color: red;">=</span> bigSigmaHatFlat <span style="color: green;">-</span> bigK &lt;&gt; bigS &lt;&gt; <span style="color: red;">(</span>tr bigK<span style="color: red;">)</span>
&gt; 
&gt;         bigA <span style="color: red;">::</span> Sq n
&gt;         bigA <span style="color: red;">=</span> bigABuilder xHat
&gt; 
&gt;         xHatFlatNew <span style="color: red;">::</span> R n
&gt;         xHatFlatNew <span style="color: red;">=</span> littleA xHat
&gt; 
&gt;         bigSigmaHatFlatNew <span style="color: red;">::</span> Sq n
&gt;         bigSigmaHatFlatNew <span style="color: red;">=</span> bigA &lt;&gt; bigSigmaHat &lt;&gt; <span style="color: red;">(</span>tr bigA<span style="color: red;">)</span> + bigSigmaX
</code></pre>
<p>Now let us create some sample data.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; obsVariance <span style="color: red;">::</span> Double
&gt; obsVariance <span style="color: red;">=</span> <span class="hs-num">1e-2</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; bigSigmaY <span style="color: red;">::</span> Sq <span class="hs-num">1</span>
&gt; bigSigmaY <span style="color: red;">=</span> fromList <span style="color: red;">[</span>obsVariance<span style="color: red;">]</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; nObs <span style="color: red;">::</span> Int
&gt; nObs <span style="color: red;">=</span> <span class="hs-num">300</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; singleSample <span style="color: red;">::</span> Double <span style="color: red;">-&gt;</span> RVarT <span style="color: red;">(</span>W.Writer <span style="color: red;">[</span>Double<span style="color: red;">]</span><span style="color: red;">)</span> Double
&gt; singleSample p0 <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
&gt;   epsilon <span style="color: red;">&lt;-</span> rvarT <span style="color: red;">(</span>Normal <span class="hs-num">0.0</span> obsVariance<span style="color: red;">)</span>
&gt;   <span style="color: blue; font-weight: bold;">let</span> p1 <span style="color: red;">=</span> logit p0 k <span style="color: red;">(</span>r * deltaT<span style="color: red;">)</span>
&gt;   lift $ W.tell <span style="color: red;">[</span>p1 + epsilon<span style="color: red;">]</span>
&gt;   return p1
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; streamSample <span style="color: red;">::</span> RVarT <span style="color: red;">(</span>W.Writer <span style="color: red;">[</span>Double<span style="color: red;">]</span><span style="color: red;">)</span> Double
&gt; streamSample <span style="color: red;">=</span> iterateM_ singleSample p0
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; samples <span style="color: red;">::</span> <span style="color: red;">[</span>Double<span style="color: red;">]</span>
&gt; samples <span style="color: red;">=</span> take nObs $ snd $
&gt;           W.runWriter <span style="color: red;">(</span>evalStateT <span style="color: red;">(</span>sample streamSample<span style="color: red;">)</span> <span style="color: red;">(</span>pureMT <span class="hs-num">3</span><span style="color: red;">)</span><span style="color: red;">)</span>
</code></pre>
<div style="text-align: center;">
<p><img src="https://idontgetoutmuch.files.wordpress.com/2014/09/8b49cfe564bc8a1e.png?w=640" alt="" /></p>
</div>
<p>We created our data with a growth rate of</p>
<pre><code><span style="color: gray;">ghci&gt; </span>r
  10.0
</code></pre>
<p>but let us pretend that we have read the literature on growth rates of bee colonies and we have some big doubts about growth rates but we are almost certain about the size of the colony at <img src="http://s0.wp.com/latex.php?latex=t%3D0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="t=0" class="latex" title="t=0" />.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; muPrior <span style="color: red;">::</span> R <span class="hs-num">2</span>
&gt; muPrior <span style="color: red;">=</span> fromList <span style="color: red;">[</span><span class="hs-num">5.0</span><span style="color: red;">,</span> <span class="hs-num">0.1</span><span style="color: red;">]</span>
&gt; 
&gt; sigmaPrior <span style="color: red;">::</span> Sq <span class="hs-num">2</span>
&gt; sigmaPrior <span style="color: red;">=</span> fromList <span style="color: red;">[</span> <span class="hs-num">1e2</span><span style="color: red;">,</span> <span class="hs-num">0.0</span>
&gt;                       <span style="color: red;">,</span> <span class="hs-num">0.0</span><span style="color: red;">,</span> <span class="hs-num">1e-10</span>
&gt;                       <span style="color: red;">]</span>
</code></pre>
<p>We only observe the population and not the rate itself.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; bigH <span style="color: red;">::</span> L <span class="hs-num">1</span> <span class="hs-num">2</span>
&gt; bigH <span style="color: red;">=</span> fromList <span style="color: red;">[</span><span class="hs-num">0.0</span><span style="color: red;">,</span> <span class="hs-num">1.0</span><span style="color: red;">]</span>
</code></pre>
<p>Strictly speaking this should be 0 but this is close enough.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; bigSigmaX <span style="color: red;">::</span> Sq <span class="hs-num">2</span>
&gt; bigSigmaX <span style="color: red;">=</span> fromList <span style="color: red;">[</span> <span class="hs-num">1e-10</span><span style="color: red;">,</span> <span class="hs-num">0.0</span>
&gt;                      <span style="color: red;">,</span> <span class="hs-num">0.0</span><span style="color: red;">,</span> <span class="hs-num">1e-10</span>
&gt;                      <span style="color: red;">]</span>
</code></pre>
<p>Now we can run our filter and watch it switch away from our prior belief as it accumulates more and more evidence.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; test <span style="color: red;">::</span> <span style="color: red;">[</span><span style="color: red;">(</span>R <span class="hs-num">2</span><span style="color: red;">,</span> Sq <span class="hs-num">2</span><span style="color: red;">)</span><span style="color: red;">]</span>
&gt; test <span style="color: red;">=</span> outer muPrior sigmaPrior bigH bigSigmaY
&gt;        a bigA bigSigmaX <span style="color: red;">(</span>map <span style="color: red;">(</span>fromList . return<span style="color: red;">)</span> samples<span style="color: red;">)</span>
</code></pre>
<div style="text-align: center;">
<p><img src="https://idontgetoutmuch.files.wordpress.com/2014/09/b8e8f61e2eba6510.png?w=640" alt="" /></p>
</div>
<div style="text-align: center;">
<p><img src="https://idontgetoutmuch.files.wordpress.com/2014/09/7a283f6a9b890016.png?w=640" alt="" /></p>
</div>
<div class="references"></div><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/idontgetoutmuch.wordpress.com/752/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/idontgetoutmuch.wordpress.com/752/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=idontgetoutmuch.wordpress.com&amp;blog=2944309&amp;post=752&amp;subd=idontgetoutmuch&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://idontgetoutmuch.wordpress.com/2014/09/09/fun-with-extended-kalman-filters-4/">by Dominic Steinitz at September 09, 2014 08:28 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.yesodweb.com/" title="Yesod Web Framework Blog">Yesod Web Framework</a></h3>

<div class="entrygroup" id="http://www.yesodweb.com/blog/2014/09/misassigned-credit-for-conduit">
<blockquote>
<h1 class="entry"><a href="http://www.yesodweb.com/blog/2014/09/misassigned-credit-for-conduit">Misassigned credit for conduit</a></h1>
<div class="entry">
<p>When I was at ICFP last week, it became clear that I had made a huge mistake in
the past three years. A few of us were talking, including Erik de Castro Lopo,
and when I mentioned that he was the original inspiration for creating the
conduit package, everyone else was surprised. So firstly: Erik, I apologize for
not making it clear that you initially kicked off development by finding some
fun corner cases in enumerator that were difficult to debug.</p><p>So to rectify that, I think it's only fair that I write the following:</p><ul><li>conduit is entirely Erik's fault.</li><li>If you love conduit, write Erik a thank you email.</li><li>More importantly, if you hate conduit, there's no need to complain to me anymore. Erik presumably will be quite happy to receive all such further communications.</li><li>In other words, it's not my company, I just work here.</li></ul><p>Thanks Erik :)</p><p><b>UPDATE</b> Please also read my <a href="http://www.yesodweb.com/blog/2014/09/clarification-previous-blog-post">follow-up blog
post</a> clarifying this one, just
in case you're confused.</p></div>






<p class="date">
<a href="http://www.yesodweb.com/blog/2014/09/misassigned-credit-for-conduit">September 09, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 08, 2014</h2>

<div class="channelgroup">







<h3><a href="http://ghc.haskell.org/trac/ghc/blog" title="GHC - Blog">The GHC Team</a></h3>

<div class="entrygroup" id="http://ghc.haskell.org/trac/ghc/blog/HIW2014">
<blockquote>
<h1 class="entry"><a href="http://ghc.haskell.org/trac/ghc/blog/HIW2014">Haskell Implementors Workshop 2014 videos available!</a></h1>
<div class="entry">
<p>
Without further ado, here's the <a href="http://www.youtube.com/playlist?list=PL4UWOFngo5DW6nKDjK0UB5Oy9zmdWdo7K" class="ext-link"><span class="icon">​</span>HIW 2014 Youtube Playlist</a> (kindly provided by Malcolm Wallace)
</p></div>






<p class="date">
<a href="http://ghc.haskell.org/trac/ghc/blog/HIW2014">by hvr at September 08, 2014 03:55 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://lambda.jstolarek.com" title="Yet Another Lambda Blog">Jan Stolarek</a></h3>

<div class="entrygroup" id="http://lambda.jstolarek.com/?p=1551">
<blockquote>
<h1 class="entry"><a href="http://lambda.jstolarek.com/2014/09/promoting-functions-to-type-families-in-haskell/">Promoting functions to type families in Haskell</a></h1>
<div class="entry">
<p style="text-align: justify;">It’s been very quiet on the blog these past few months not because I’m spending less time on functional programming but precisely for the opposite reason. Since January I’ve been working together with <a href="http://www.cis.upenn.edu/~eir/">Richard Eisenberg</a> to extend his <a href="http://hackage.haskell.org/package/singletons"><code>singletons</code></a> library. This work was finished in June and last Friday I gave a talk about our research on <a href="http://www.haskell.org/haskell-symposium/2014/">Haskell Symposium 2014</a>. This was the first time I’ve been to the ICFP and Haskell Symposium. It was pretty cool to finally meet all these people I know only from IRC. I also admit that the atmosphere of the conference quite surprised me as it often felt like some sort of fan convention rather than the biggest event in the field of functional programming.</p>
<p style="text-align: justify;">The paper Richard and I published is titled <a href="http://ics.p.lodz.pl/~stolarek/_media/pl:research:eisenberg_stolarek_promotion.pdf">“Promoting Functions to Type Families in Haskell”</a>. This work is based on Richard’s earlier paper <a href="http://www.cis.upenn.edu/~eir/papers/2012/singletons/paper.pdf">“Dependently typed programming with singletons”</a> presented two years ago on Haskell Symposium. Back then Richard presented the <code>singletons</code> library that uses Template Haskell to generate singleton types and functions that operate on them. Singleton types are types that have only one value (aside from bottom) which allows to reason about runtime values during compilation (some introduction to singletons can be found in <a href="http://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/">this post</a> on Richard’s blog). This smart encoding allows to simulate some of the features of dependent types in Haskell. In our current work we extended promotion capabilities of the library. Promotion is only concerned with generating type-level definitions from term-level ones. Type-level language in GHC has become quite expressive during the last couple of years but it is still missing many features available in the term-level language. Richard and I have found ways to encode almost all of these missing features using the already existing type-level language features. What this means is that you can write normal term-level definition and then our library will automatically generate an equivalent type family. You’re only forbidden from using infinite terms, the <code>do</code>-notation, and decomposing <code>String</code> literals to <code>Char</code>s. Numeric literals are also very problematic and the support is very limited but some of the issues can be worked around. What is really cool is that our library allows you to have partial application at the type level, which GHC normally prohibits.</p>
<p style="text-align: justify;">You can learn more by <a href="https://www.youtube.com/watch?v=J47OTYArG08">watching my talk on YouTube</a>, <a href="http://ics.p.lodz.pl/~stolarek/_media/pl:research:eisenberg_stolarek_promotion.pdf">reading the paper</a> or the <a href="https://github.com/goldfirere/singletons/blob/master/README.md"><code>singletons</code> documentation</a>. Here I’d like to add a few more information that are not present in the paper. So first of all the paper was concerned only with promotion and didn’t say anything about singletonization. But as we enabled more and more language constructs to be promoted we also made them singletonizable. So almost everything that can be promoted can also be singletonized. The most notable exception to this rule are type classes, which are not yet implemented at the moment.</p>
<p style="text-align: justify;">An interesting issue was raised by <a href="https://personal.cis.strath.ac.uk/adam.gundry/">Adam Gundry</a> in a question after the talk: what about difference between lazy term-level semantics and strict type-level semantics? You can listen to my answer in the video but I’ll elaborate some more on this here. At one point during our work we were wondering about this issue and decided to demonstrate an example of an algorithm that crucially relies on laziness to work, ie. fails to work with strict semantics. I think it’s not straightforward to come up with such an algorithm but luckily I recalled the backwards state monad from Philip Wadler’s paper “The essence of functional programming”<sup><a href="http://lambda.jstolarek.com/2014/09/promoting-functions-to-type-families-in-haskell/#footnote_0_1551" title="The awful truth is that this monad does not really work with the released version of singletons. I only realized that when I was writing this post. See issue #94 on singletons bug tracker. " class="footnote-link footnote-identifier-link" id="identifier_0_1551">1</a></sup>. Bind operator of that monad looks like this (definition copied from the paper):</p>

<div class="wp_syntax"><table><tbody><tr><td class="code"><pre style="font-family: monospace;" class="haskell">m `bindS` k <span style="color: #339933; font-weight: bold;">=</span> \s2 <span style="color: #339933; font-weight: bold;">-&gt;</span> <span style="color: #06c; font-weight: bold;">let</span> <span style="color: green;">(</span>a<span style="color: #339933; font-weight: bold;">,</span>s0<span style="color: green;">)</span> <span style="color: #339933; font-weight: bold;">=</span> m s1
                         <span style="color: green;">(</span>b<span style="color: #339933; font-weight: bold;">,</span>s1<span style="color: green;">)</span> <span style="color: #339933; font-weight: bold;">=</span> k a s2
                     <span style="color: #06c; font-weight: bold;">in</span>  <span style="color: green;">(</span>b<span style="color: #339933; font-weight: bold;">,</span>s0<span style="color: green;">)</span></pre></td></tr></tbody></table></div>

<p style="text-align: justify;">The tricky part here is that the output of call to <code>m</code> becomes input to call to <code>k</code>, while the output of call to <code>k</code> becomes the input of <code>m</code>. Implementing this in a strict language does not at all look straightforward. So I promoted that definition expecting it to fail spectacularly but to my surprised it worked perfectly fine. After some investigation I understood what’s going on. Type-level computations performed by GHC are about constraint solving. It turns out that GHC is able to figure out in which order to solve these constraints and get the result. It’s exactly analogous to what happens with the term-level version at runtime: we have an order of dependencies between the closures and there is a way in which we can run these closures to get the final result.</p>
<p style="text-align: justify;">All of this work is a small part of a larger endeavour to push Haskell’s type system towards dependent types. With singletons you can write type-level functions easily by writing their definitions using the term-level language and then promoting these definitions. And then you can singletonize your functions to work on singleton types. There were two other talks about dependent types during the conference: Stephanie Weirich’s <a href="https://www.youtube.com/watch?v=rhWMhTjQzsU">“Depending on Types”</a> keynote lecture during ICPF and Richard’s <a href="https://www.youtube.com/watch?v=O805YjOsQjI">“Dependent Haskell”</a> talk during Haskell Implementators Workshop. I encourage everyone interested in Haskell’s type system to watch both of these talks.</p>
<ol class="footnotes"><li class="footnote" id="footnote_0_1551">The awful truth is that this monad does not really work with the released version of <code>singletons</code>. I only realized that when I was writing this post. See issue <a href="https://github.com/goldfirere/singletons/issues/94">#94</a> on <code>singletons</code> bug tracker. </li></ol></div>






<p class="date">
<a href="http://lambda.jstolarek.com/2014/09/promoting-functions-to-type-families-in-haskell/">by Jan Stolarek at September 08, 2014 11:02 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 07, 2014</h2>

<div class="channelgroup">







<h3><a href="http://neilmitchell.blogspot.com/" title="Neil Mitchell's Haskell Blog">Neil Mitchell</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-7094652.post-6273210663500888526">
<blockquote>
<h1 class="entry"><a href="http://neilmitchell.blogspot.com/2014/09/shake-in-wild.html">Shake in the wild</a></h1>
<div class="entry">
<p><em>Summary: I spotted a few things using Shake, which I had nothing to do with.</em></p><p>In the past few days I have come across several things using the <a href="https://github.com/ndmitchell/shake#readme">Shake build system</a>. I wasn't involved in any of them, and haven't (yet) tried any of them out, but they certainly look cool.</p><p><strong>ToolCabal</strong></p><p>Tibor Bremer from Utrecht University gave a talk at the <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014#Extending_Cabal_with_Plugins.2C_Preprocessors_and_Multi-target_Compilers">Haskell Implementors Workshop 2014</a> about his <a href="https://github.com/TiborIntelSoft/ToolCabal">ToolCabal</a> project. This project replaces the "build a package" part of Cabal with something more flexible, supporting multiple simultaneous targets and more flexible preprocessors - all built on top of Shake. It doesn't attempt to tackle dependency resolution yet. There is a video of the talk:</p>&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="315" src="https://www.youtube.com/embed/VUyIu2T1Qss" width="420"&gt;&lt;/iframe&gt;<br /><p><strong>Samplecount</strong></p><p>The folks at <a href="http://samplecount.com/">Samplecount</a> have written several Shake based things. None are yet on <a href="http://hackage.haskell.org/">Hackage</a>, so I suspect they are somewhat prototypes, but they look like they're already used quite seriously.</p><ul><li><a href="https://github.com/samplecount/shake-cabal-build">shake-cabal-build</a> to make it easier to build your Shake build systems with Cabal. Shake build systems need to be compiled with GHC, for which I usually use <code>ghc --make</code>, but this project explains how to get things building with Cabal - important if your build system pulls in other libraries.</li><li><a href="https://github.com/samplecount/shake-language-c">shake-language-c</a> is a project to simplify building C/C++ projects with Shake. From the docs:</li></ul><blockquote><p>shake-language-c is a cross-platform build system based on the Shake Haskell library. The focus is on cross-compilation of C, C++ and Objective C source code to various target platforms. Currently supported target platforms are iOS, Android NDK, Google Portable Native Client, MacOS X, Linux and Windows (MinGW). Supported host platforms are MacOS X, Linux and Windows.</p></blockquote><ul><li><a href="https://github.com/samplecount/methcla">methcla</a> is their mobile sound engine, which is built using <a href="https://github.com/samplecount/methcla">this Shake script</a>, which (unsurprisingly) uses shake-language-c and shake-cabal-build.</li></ul></div>






<p class="date">
<a href="http://neilmitchell.blogspot.com/2014/09/shake-in-wild.html">by Neil Mitchell (noreply@blogger.com) at September 07, 2014 09:02 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://blog.ezyang.com" title="Inside 206-105">Edward Z. Yang</a></h3>

<div class="entrygroup" id="http://blog.ezyang.com/?p=9251">
<blockquote>
<h1 class="entry"><a href="http://feedproxy.google.com/~r/ezyang/~3/XdBqn3UxVRI/">Haskell Implementor’s Workshop ’14</a></h1>
<div class="entry">
<div class="document">



<p>This year at ICFP, we had some blockbuster attendance to the <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014" class="reference external">Haskell Implementor's Workshop</a> (at times, it was standing room only). I had the pleasure of presenting the work I had done over the summer on Backpack.</p>
<div class="outer-image"><div class="inner-image"><img src="http://blog.ezyang.com/img/backpack-ufo.png" alt="/img/backpack-ufo.png" /></div></div>
<p>You can <a href="http://web.mit.edu/~ezyang/Public/hiw14-backpack-slides.pdf" class="reference external">grab the slides</a> or <a href="https://www.youtube.com/watch?v=0dF9zuwTSTc" class="reference external">view the presentation itself</a> (thank you ICFP organizers for being incredibly on-the-ball with videos this year!)  The talk intersects a little bit with my blog post <a href="http://blog.ezyang.com/2014/08/a-taste-of-cabalized-backpack/" class="reference external">A taste of Cabalized Backpack</a>, but there are more pictures, and I also emphasize (perhaps a little too much) the long term direction we are headed in.</p>
<div class="outer-image"><div class="inner-image"><img src="http://blog.ezyang.com/img/backpack-schema.png" alt="/img/backpack-schema.png" /></div></div>
<p>There were a lot of really nice talks at HiW. Here are some of my personal highlights:</p>
<ul class="simple">
<li><a href="https://www.youtube.com/watch?v=O805YjOsQjI" class="reference external">Richard Eisenberg: Dependent Haskell</a></li>
<li><a href="https://www.youtube.com/watch?v=SqCZRtfmfdM" class="reference external">Alejandro Serrano: Interactive features in ghc-mod (lightning talk)</a> (Heavily based off of Idris-mode)</li>
<li><a href="https://www.youtube.com/watch?v=rdVqQUOvxSU" class="reference external">Lennart Augustsson: Better type-error messages (lightning talk)</a> (Why isn’t this in GHC? The big problem is that the data type representing types is the <em>same</em> as the internal data type for types in Core. Tracking locations should be strictly at the surface syntax, so we’d have to refactor the frontend first.)</li>
<li><a href="https://www.youtube.com/watch?v=iRq0LDFSP24&amp;list=PL4UWOFngo5DW6nKDjK0UB5Oy9zmdWdo7K&amp;index=22" class="reference external">Michael Adams: Extending "Optimize your SYB" (lightning talk)</a> (In the original paper, they suggest speedups can be gained by aggressively evaluating expressions of type <tt class="docutils literal">TypeRep</tt>, <tt class="docutils literal">TyCon</tt>, <tt class="docutils literal">Data</tt> and <tt class="docutils literal">Typeable</tt> at compile time. Michael was wondering if there were any other types which should receive similar treatment. One audience-member suggested <tt class="docutils literal">Int</tt> (i.e. to get rid of boxing), but I don’t find that very convincing.)</li>
</ul>
</div>
<img width="1" src="http://feeds.feedburner.com/~r/ezyang/~4/XdBqn3UxVRI" height="1" /></div>






<p class="date">
<a href="http://feedproxy.google.com/~r/ezyang/~3/XdBqn3UxVRI/">by Edward Z. Yang at September 07, 2014 01:05 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://izbicki.me" title="Mike Izbicki's blog posts">Mike Izbicki</a></h3>

<div class="entrygroup" id="http://izbicki.me/blog/videoguide-for-github-vim-bash.html">
<blockquote>
<h1 class="entry"><a href="http://izbicki.me/blog/videoguide-for-github-vim-bash.html">Getting started with GitHub, vim, and bash</a></h1>
<div class="entry">
<h1>Getting started with GitHub, vim, and bash</h1>
<div class="info">
    
        posted on 2014-09-07
    
    
        by <a href="https://github.com/rgosh001">Rashid Goshtasbi</a> and <a href="https://github.com/kryne001">Kyler Rynear</a>
    
</div>

<p>Learning to use <code>git</code>, <code>vim</code>, and <code>bash</code> was hard for us. These tools are so different than the tools we used when we first learned to program. And they’re confusing! But our professor made us use them… and eventually… after we learned the tools… we discovered that we really like them! So we’ve put together a simple video guide to help you learn and enjoy these tools too. We did this as part of the CS100 open source software development class at UC Riverside.</p>
<p><em><a href="https://www.youtube.com/watch?v=bap-NSjgPFg&amp;list=PLQ6W7BIxh4zsJgGwZr-cpHCB_EjyY1NFK">Click here</a> to watch the full playlist on YouTube.</em></p>
<h2 id="getting-started-with-github">Getting Started with GitHub</h2>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/bap-NSjgPFg?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>This video shows you step by step how to create an account on GitHub. Then we see how to create our first repository called <code>test</code>, and transfer it from GitHub onto our local machine using the <code>git clone</code> command.</p>
<h3 id="creating-a-file-pushing-to-github-and-pulling-from-github">Creating a file, pushing to GitHub, and pulling from GitHub</h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/UrLkCZaXg9o?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>How do we create files and upload them to GitHub? The <code>touch &lt;filename&gt;</code> command will create an empty file for you. The <code>vim &lt;filename&gt;</code> command will open a file in an advanced text editor that <a href="https://izbicki.me/blog/category/computer-science/feed#vim">we talk about farther down the page</a>. The <code>git push</code> command sends these files from your local machine up to GitHub, and the <code>git pull</code> command downloads files from GitHub and saves them to your local computer.</p>
<h3 id="branches"><a name="branch">Branches</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/E8-hUsR7IXA?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>Branches let you work on files without messing up your original code. When you finish your changes, you can merge them into the <code>master</code> branch. This is the best part of version control.</p>
<h3 id="tags"><a name="tags">Tags</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/WKG1u4Y_f3s?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>Most programs have different versions, for example: 1.0, 1.1, 1.2, 2.1 and 2.2.1. The <code>git tag</code> command let’s you create these versions. They’re just like a checkpoint in a Mario game!</p>
<h3 id="forking-pull-requests"><a name="fork">Forking &amp; Pull Requests</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/tTnL84EvJTM?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>Let’s say you want to contribute to an open source project, but you don’t have permission. In order to contribute to someone else’s repository, you must first “fork” it to create a repo that you do have push permission on. Then you issue a pull request through the GitHub website. This tells the owner of the original repo that you’ve made some changes they can incorporate.</p>
<h3 id="the-readme.md-file"><a name="readme">The <code>README.md</code> file</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/4UTSEKzsSvM?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p><code>README.md</code> files are how you document your projects. The <code>README.md</code> should explain your program, give installation instructions, and list known bugs. Basically, it explains to someone else who has absolutely no idea what your program does or how to code, but it enables the user to understand the concepts and basic directions to execute your program. The <code>.md</code> extension at the end of the filename indicates that the file uses markdown formatting. This is a simple way to create nice looking documentation.</p>
<h2 id="learning-vim"><a name="vim">Learning vim</a></h2>
<p><code>vim</code> is an advanced text editor for Unix operating systems. It’s powerful, but all the commands are intimidating for first time users. Even though it’s hard to get used to at first, these videos will help you learn some of the basic commands and get comfortable with <code>vim</code>.</p>
<h3 id="getting-started">Getting Started</h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/szTtE60fIt8?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>It was difficult at first trying to transverse my code while using <code>vim</code>. I was so used to being able to use my mouse and simply click where I wanted to go. There are many ways to maneuver inside of <code>vim</code>. Some may just use the <code>h,j,k,l</code>, <code>up, down, left, right arrow keys</code>, or the <code>w, e, b</code> keys to move. You can also press <code>gg</code> to go to the top of the code, <code>G</code> to go to the bottom of it, and <code>(any number)G</code> to go to the line number typed before the capital G.)</p>
<p>Cutting, copying, and pasting took a while to get used to when using <code>vim</code>. Sometimes there was something I wanted in my code that was in the instructions for the assignment. In order to paste I would use the <code>p</code> command, but I could not paste things from outside of <code>vim</code> into it. If I had something copied outside of <code>vim</code>, then to paste it into <code>vim</code> I would right click and just click paste. This would paste it wherever the cursor currently is. If you right click to copy, then it will not affect what is copied by using the commands <code>y</code> to copy or the commands <code>d</code> or <code>x</code> to cut. If those commands are used, the just clicking <code>p</code> will paste them. There are other ways to store more than one thing while copying or cutting, but these two ways were the most helpful as I learned how to use <code>vim</code>.</p>
<p>Another personal favorite features of <code>vim</code>, are the <code>shift-a</code> (takes you to the end of the line and into insert mode) and the <code>shift-i</code> (takes you to the beginning of the line and into insert mode) command. You can also press <code>a</code> to append after the cursor position, as well as <code>i</code> to insert before the current cursor position</p>
<p><code>vim</code> also allows you to use the <code>v</code> or <code>shift-v</code> keys to highlight certain text or lines of code. You can then use other <code>vim</code> commands such as the copy, paste and delete keys to perform your needed actions.</p>
<h3 id="indentation">Indentation</h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/uuztdE_gixs?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>At first it felt very time consuming to indent multiple lines. I felt this way until I found about the <code>V</code> command. <code>V</code> lets users highlight a line and pressing up or down can highlight as many lines as they desire. All that was left to do was to type <code>&gt;</code> after everything I wanted to indent was highlighted and it all would indented once to the right. Typing <code>&lt;</code> would instead indent it to the left if I ever wanted to do that.</p>
<h3 id="deletion">Deletion</h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/x0BMbS2kWYc" width="697.6"&gt;&lt;/iframe&gt;


<p>There are two commands for deleting single character. <code>x</code> deletes the character that the cursor is on and moves the cursor to the right; and <code>X</code> deletes the character that the cursor is on and moves the cursor to the left.</p>
<p>The <code>d</code> command is a more powerful way to delete. <code>d</code> can be used with many different things after it. <code>dd</code> will delete the entire line. <code>d$</code> will delete the rest of the current line. <code>de</code> will delete from where the cursor is up until the end of the word.</p>
<h3 id="replacing"><a name="replace">Replacing</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/d-quT7u3f_o" width="697.6"&gt;&lt;/iframe&gt;

<p>Lower case <code>r</code> can replace one letter while upper case <code>R</code> can replace one letter with many.</p>
<p>There are three <code>c</code> commands that I regularly use for replacement: <code>ce</code> , which deletes up until the end of the word that the cursor is currently on, then allows you to insert immediately; <code>c$</code> , which deletes from where the cursor is up until the end of the line, then allows you to insert immediately; and <code>cc</code> , which deletes the whole line that the cursor is on and allows you to insert immediately at the beginning of the line.</p>
<h3 id="customizing-your-vim-editor-with-the-.vimrc-file"><a name="vimrc">Customizing your vim editor with the .vimrc file</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/VhAiVux6GBg?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>Ever wondered how’ve we get our <code>vim</code> editor to work in the way we have it versus the default editor? <code>vim</code> has a file where you can setup it’s defaults such as auto parentheses, auto-indent, and much more. By watching our video above, you can easily create new defaults for your <code>vim</code> editor that can cut time spent formating your text to spend more on coding.</p>
<h2 id="learning-the-terminal">Learning The Terminal</h2>
<p>One of the best features of Unix operating systems is the powerful terminal they provide.</p>
<h3 id="the-ls-command"><a name="ls">The <code>ls</code> command</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/xSSahh5HbUY?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>The <code>ls</code> command is one of the most used terminal commands.</p>
<p>The basic <code>ls</code> command, when run, displays the contents within the current working directory. Passing in a directory name as an argument will display the contents of that directory. It is also possible to pass in a path for a directory to display any directory, regardless of the directory the user is currently in.</p>
<p>If the <code>-a</code> flag is passed in with <code>ls</code>, all items in the current working directory prepended with a <code>.</code> are also displayed, along with the rest of the items.</p>
<p>Passing in the <code>-l</code> flag prints information for each item in the directory in a series of columns on a single line. The first column displays the read, write, and executable permissions for the main user, the group the current user is in, and any user in that order. The next column shows the owner of the item and the next column shows the group owner. The fourth column displays the size, in bytes, of the item. The fifth column displays the moment the item was created, and the last column displays the name of the item.</p>
<p>If the <code>-R</code> flag is passed in, the command will display the contents of the current directory, and then recursively enter every directory within the current directory and display the contents of that directory, then keep going into every directory until there are no more directories in the current directory it is in.</p>
<p>All these options are combinable for different uses. For example, I could use the <code>-l</code> and <code>-a</code> flags to display the information for the items prepended with a <code>.</code> , or use <code>-R</code> and <code>-l</code> together.</p>
<h3 id="the-cd-and-mv-commands"><a name="cdmv">The <code>cd</code> and <code>mv</code> commands</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/1s5TiFbETh4?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;
 
<p>The <code>cd</code> and <code>mv</code> commands are crucial commands in order to actually use the terminal. Without cd, I would forever be stuck in their home directory. The <code>mv</code> command is necessary for moving files from one section of the hard drive. The <code>cd</code> command by itself will change the current working directory to the home directory. If passed a directory name that is within the current working directory, the current working directory will be changed to the name of the passed in directory. <code>cd</code> will also take a path as an argument. When a path is passed in, the current working directory will be changed to the directory specified by the path. When <code>cd</code> is passed with <code>..</code>, the directory will go backwards, the directory that the current directory is in.</p>
<p>The <code>mv</code> command will move an item within a certain directory to the directory passed in.</p>
<p>If the destination argument is not a path, the command will look for the destination in the current working directory. The destination argument can be a path, so I can move the item to any directory in the hard drive.</p>
<h3 id="recording-terminal-sessions-via-scripts"><a name="script">Recording terminal sessions via scripts</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/ZnIrku27C94?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>With the <code>script</code> command you can record the commands you run in your terminal into a file. By just typing <code>script file_name_here</code>, you can start a script. Also, you don’t need to worry about making a file beforehand, because when you specify the filename, it will make once for you in that name. Then when you’re done, type <code>exit</code> and your terminal will say your script session has ended and re-state the filename in which it recorded all your commands in.</p>
<h3 id="how-to-ssh-into-well-server"><a name="ssh">How To SSH (into well server)</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/Letf4txWPic?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>Computer Science students have the ability to log into the school’s server using the <code>ssh</code> command. The way to do access the terminal is to type into the command terminal the following text:</p>
<pre><code>ssh your_NetId@bell.cs.ucr.edu</code></pre>
<p>If it is your first time entering the terminal, you will be asked to trust the encryption that the server uses, then prompted to enter the password associated with your NetID. Once doing all those steps, you will be brought to your home directory on the server. To exit the server, type <code>exit</code> into the command prompt and press enter.</p>
<p>A useful command that moves files to and from the remote server onto your home computer is the <code>scp</code> command. To put items from your home computer to the school’s server, type into the command prompt:</p>
<pre><code>scp filename/absolute_path your_NetID@bell.cs.ucr.edu:absolute_path</code></pre>
<p>To move items from the remote server onto your home computer, type into the command prompt:</p>
<pre><code>scp your_NetID@bell.cs.ucr.edu:absolute_path absolute_path</code></pre>
<h3 id="spectacle-app-using-the-terminal-and-vim-in-one-screen"><a name="spectacle">Spectacle App: Using the terminal and <code>vim</code> in one screen</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/j1fnYZp4foI?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>One of the first things I noticed about <code>vim</code> that I initially disliked was that it took over the terminal when I used it. Users with Windows 7 &amp; above automatically have this ability by dragging your screen to the left or right border of your screen. Unfortunately, OS X users don’t have this built in ability. To get around this, OS X users can install the Spectacle App which will enable you to organize multiple windows on your screen with a touch of a buttom. To get around this issue, I started using two terminals instead of just one while I was programming. I would run <code>vim</code> using the first terminal and would run the executable in the second. It was as simple as using <code>:w</code> to save on <code>vim</code> instead of using <code>:wq</code> to save and quit. I could now test my code without ever having to close <code>vim</code>.</p>
<h3 id="perror"><a name="perror">perror</a></h3>
&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="419.65" src="https://www.youtube.com/embed/GsoVzP3sRsA?rel=0&amp;amp;vq=hd1080" width="697.6"&gt;&lt;/iframe&gt;

<p>When programming for unix based operating systems (which is a primary component of CS100), system calls are a prominent component for code. The <code>perror</code> function captures the error value (if returned) from the system call and prints to stdout an error message based on the system call and the type of error. It takes in one c-string argument, which is a message the user can pass in.</p></div>






<p class="date">
<a href="http://izbicki.me/blog/videoguide-for-github-vim-bash.html">September 07, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 06, 2014</h2>

<div class="channelgroup">







<h3><a href="http://www.joachim-breitner.de//blog" title="nomeata’s mind shares">Joachim Breitner</a></h3>

<div class="entrygroup" id="http://www.joachim-breitner.de/blog/658-ICFP_2014">
<blockquote>
<h1 class="entry"><a href="http://www.joachim-breitner.de/blog/658-ICFP_2014">ICFP 2014</a></h1>
<div class="entry">
<p>Another on-my-the-journey-back blog post; this time from the Frankfurt Airport Train Station – my flight was delayed (if I knew that I could have watched the remaining Lightning Talks), and so was my train, but despite 5min of running through the Airport just not enough. And now that the free 30 Minutes of Railway Station Internet are used up, I have nothing else to do but blog...</p>
  <p>Last week I was attending <a href="http://icfpconference.org/icfp2014/index.html">ICFP 2014 </a> in Gothenburg, followed by the <a href="http://www.haskell.org/haskell-symposium/2014/schedule.html">Haskell Symposium</a> and the <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014">Haskell Implementors Workshop</a>. The justification to attend was <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/coercible.pdf">the paper on Safe Coercions</a> (joint work with Richard Eisenberg, Simon Peyton Jones and Stephanie Weirich), although Richard got to hold the talk, and did so quite well. So I got to leisurely attend the talks, while fighting the jet-lag that I brought <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014">from Portland</a>.
  </p>
  <p>There were – as expected – quite a few interesting talks. Among them <a href="http://dl.acm.org/authorize?N87643">the first keynote, Kathleen Fisher</a> on the need for formal methods in cars and toy-quadcopters and unmanned battle helicopters, which made me conclude that my Isabelle skills might eventually become relevant in practical applications. And did you know that if someone gains access to your car’s electronics, they can make the seat belt pull you back hard?
  </p>
  <p><a href="http://dl.acm.org/authorize?N87763">Stefanie Weirich’s keynote</a> (and the subsequent related talks <a href="http://dl.acm.org/citation.cfm?id=2633361">by Jan Stolarek</a> and <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014#Dependent_Haskell">Richard Eisenberg</a>) on what a dependently typed Haskell would look like and what we could use it for was mouth-watering. I am a bit worried that Haskell will be become a bit obscure for newcomers and people that simply don’t want to think about types too much, on the other hand it seems that Haskell as we know it will always stay there, just as a subset of the language.
  </p>
  <p>
  Similarly interesting were refinement types for Haskell (talks <a href="http://dl.acm.org/authorize?N87776">by Niki Vazou</a> and <a href="http://www.youtube.com/watch?v=vqvNQixKr6w">by Eric Seidel</a>), in the form of <a href="goto.ucsd.edu/index.html">LiquidTypes</a>, something that I have not paid attention to yet. It seems to be a good way for more high assurance in Haskell code.</p>
  <p>
  Finally, the <a href="http://www.haskell.org/haskellwiki/HaskellImplementorsWorkshop/2014">Haskell Implementors Workshop</a> had a truckload of exciting developments in and around Haskell: More on GHCJS, Partial type signatures, interactive type-driven development like we know it from Agda, the new Haskell module system and amazing user-defined error messages – the latter unfortunately only in <a href="http://www.cs.uu.nl/wiki/bin/view/Helium/WebHome">Helium</a>, at least for now.
  </p>
  <p>
  But it’s not the case that I only sat and listened. During the Haskell Implementors Workshop I held a talk “Contributing to GHC” with a live demo of me fixing <a href="http://hackage.haskell.org/trac/ghc/ticket/9556">a (tiny) bug in GHC</a>, with the aim of getting more people to hack on GHC (<a href="http://joachim-breitner.de/publications/ContributingToGHC_HIW2014_2014-09-08.pdf">slides</a>, <a href="http://www.youtube.com/watch?v=tq2Mo7NsO5w">video</a>). The main message here is that it is not that big of deal. And despite me not actually saying much interesting in the talk, I got good feedback afterwards. So if it now actually motivates someone to contribute to GHC, I’m even more happier.
  </p>
  <p>
  And then there is of course the Hallway Track. I discussed the issues with fusing a left fold (unfortunately, without a great solution). In order to tackle this problem more systematically, John Wiegley and I created the beginning of a “<a href="http://github.com/nomeata/list-fusion-lab">List Fusion Lab</a>”, i.e. a bunch of list benchmark and the possibility to compare various implementations (e.g. with different RULES) and various compilers. With that we can hopefully better assess the effect of a change to the list functions.
  </p>
  <p>
  PS: The next train is now also delayed, so I’ll likely miss my tram and arrive home even later...
  </p>
  <p>
  PPS: I really have to update my 10 year old picture on my homepage (or redesign it completely). Quite a few people knew my name, but expected someone with shoulder-long hair...
  </p>
  <p>
  PPPS: Haskell is really becoming mainstream: I just talked to a randomly chosen person (the boy sitting next to me in the train), and he is a Haskell enthusiast, building a structured editor for Haskell together with his brother. And all that as a 12th-grader...
  </p></div>






<p class="date">
<a href="http://www.joachim-breitner.de/blog/658-ICFP_2014">by Joachim Breitner (mail@joachim-breitner.de) at September 06, 2014 10:46 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://twdkz.wordpress.com" title="twdkz">Tim Docker</a></h3>

<div class="entrygroup" id="http://twdkz.wordpress.com/?p=113">
<blockquote>
<h1 class="entry"><a href="http://twdkz.wordpress.com/2014/09/06/a-new-charting-api/">A New Charting API</a></h1>
<div class="entry">
<p>One of the challenges with building a library like <a href="https://github.com/timbod7/haskell-chart">Chart</a> is the tension between ease of use and flexibility. Users want to produce charts with a minimum of code up front, but later want to refine the details. The chart library addresses this through the use of "defaulted records" using <a href="https://hackage.haskell.org/package/data-default-class-0.0.1/docs/Data-Default-Class.html">Data.Default.Class</a>. Because such records are often nested, we rely on the somewhat intimidating <a href="https://hackage.haskell.org/package/lens-1.2">lens</a> library to modify the default values. We end up with code to create chart elements like this:</p>
<pre><code>sinusoid2 = plot_points_title .~ "fn(x)"
          $ plot_points_values .~ mydata
          $ plot_points_style . point_color .~ opaque red
          $ def</code></pre>
<p>This is much simpler and cleaner that the corresponding code using native record accessors, but it still has a certain amount of syntactic overhead.</p>
<p>I’ve added a simple state monad to the library to further clean up the syntax. The state of the monad is the value being constructed, allowing the use of the monadic lens operators. The above code sample becomes:</p>
<pre><code>sinusoid2 = execEC $ do
    plot_points_title .= "fn(x)" 
    plot_points_values .= mydata
    plot_points_style . point_color .= opaque red</code></pre>
<p>This may seem only a minor syntactic improvement, but it adds up over an typical chart definition.</p>
<p>A few other changes further reduce the clutter in charting code:</p>
<ul>
<li>A new <a href="https://hackage.haskell.org/package/Chart-1.3/docs/Graphics-Rendering-Chart-Easy.html">Easy</a> module that includes helper functions and key dependencies</li>
<li>Simpler "toFile" functions in the rendering backends</li>
<li>Automatic sequencing of colours for successive plots</li>
</ul>
<p>All this means that a simple plot can now be a one liner:</p>
<pre><code>import Graphics.Rendering.Chart.Easy
import Graphics.Rendering.Chart.Backend.Cairo

mydata :: [Double,Double]
mydata = ...

main = toFile def "test.png" $ plot $ points "lines" mydata</code></pre>
<p>But this extends naturally to more complex charts. The code differences between the new stateful API versus the existing API can been seen in <a href="https://github.com/timbod7/haskell-chart/wiki/example-2">this example</a>.</p>
<p>The stateful API is available in <a href="https://hackage.haskell.org/package/Chart">chart v1.3</a> It is a thin layer over the existing API – both will be continue to be available in the future.</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/twdkz.wordpress.com/113/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/twdkz.wordpress.com/113/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=twdkz.wordpress.com&amp;blog=33863535&amp;post=113&amp;subd=twdkz&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://twdkz.wordpress.com/2014/09/06/a-new-charting-api/">by Tim Docker at September 06, 2014 05:34 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 04, 2014</h2>

<div class="channelgroup">







<h3><a href="http://blog.ezyang.com" title="Inside 206-105">Edward Z. Yang</a></h3>

<div class="entrygroup" id="http://blog.ezyang.com/?p=9229">
<blockquote>
<h1 class="entry"><a href="http://feedproxy.google.com/~r/ezyang/~3/3rp1-wUzebg/">Open type families are not modular</a></h1>
<div class="entry">
<div class="document">



<p>One of the major open problems for building a module system in Haskell
is the treatment of type classes, which I have <a href="http://blog.ezyang.com/2014/07/type-classes-confluence-coherence-global-uniqueness/" class="reference external">discussed previously</a>
on this blog.  I've noted how the current mode of use in type classes in
Haskell assume “global uniqueness”, which is inherently anti-modular;
breaking this assumption risks violating the encapsulation of many
existing data types.</p>
<p>As if we have a choice.</p>
<p>In fact, our hand is forced by the presence of <strong>open type families</strong>
in Haskell, which are feature many similar properties to type classes,
but with the added property that global uniqueness is <em>required</em> for
type safety.  We don't have a choice (unless we want type classes
with associated types to behave differently from type classes): we
have to figure out how to reconcile the inherent non-modularity of
type families with the Backpack module system.</p>
<p>In this blog post, I want to carefully lay out why open type families
are <em>inherently</em> unmodular and propose some solutions for managing this
unmodularity.  If you know what the problem is, you can skip the first
two sections and go straight to the proposed solutions section.</p>
<hr class="docutils" />
<p>Before we talk about open type family instances, it's first worth
emphasizing the (intuitive) fact that a signature of a module is supposed
to be able to <em>hide</em> information about its implementation.  Here's a simple
example:</p>

<pre class="literal-block">module A where
    x :: Int

module B where
    import A
    y = 0
    z = x + y
</pre>
<p>Here, <tt class="docutils literal">A</tt> is a signature, while <tt class="docutils literal">B</tt> is a module which imports the
signature.  One of the points of a module system is that we should be
able to type check <tt class="docutils literal">B</tt> with respect to <tt class="docutils literal">A</tt>, without knowing anything
about what module we actually use as the implementation. Furthermore,
if this type checking succeeds, then for <em>any</em> implementation which
provides the interface of <tt class="docutils literal">A</tt>, the combined program should also type
check.  This should hold even if the implementation of <tt class="docutils literal">A</tt> defines other
identifiers not mentioned in the signature:</p>

<pre class="literal-block">module A where
    x = 1
    y = 2
</pre>
<p>If <tt class="docutils literal">B</tt> had directly imported this implementation, the identifier <tt class="docutils literal">y</tt>
would be ambiguous; but the signature <em>filtered out</em> the declarations so
that <tt class="docutils literal">B</tt> only sees the identifiers in the signature.</p>
<hr class="docutils" />
<p>With this in mind, let's now consider the analogous situation with
open type families.  Assuming that we have some type family <tt class="docutils literal">F</tt> defined
in the prelude, we have the same example:</p>

<pre class="literal-block">module A where
    type instance F Int
    f :: F Bool

module B where
    import A
    type instance F Bool = Int -&gt; Bool
    x = f 2
</pre>
<p>Now, should the following module <tt class="docutils literal">A</tt> be a permissible implementation
of the signature?</p>

<pre class="literal-block">module A where
    type instance F Int = Int
    type instance F Bool = Int
    f = 42
</pre>
<p>If we view this example with the glasses off, we might conclude that it
is a permissible implementation.  After all, the implementation of <tt class="docutils literal">A</tt>
provides an extra type instance, yes, but when this happened previously
with a (value-level) declaration, it was hidden by the signature.</p>
<p>But if put our glasses on and look at the example as a whole, something
bad has happened: we're attempting to use the integer 42 as a function
from integers to booleans.  The trouble is that <tt class="docutils literal">F Bool</tt> has been
given different types in the module <tt class="docutils literal">A</tt> and module <tt class="docutils literal">B</tt>, and this is
unsound...  like, <em>segfault</em> unsound.  And if we think about it some
more, this should not be surprising: we already knew it was unsound to
have overlapping type families (and eagerly check for this), and
signature-style hiding is an easy way to allow overlap to sneak in.</p>
<p>The distressing conclusion: <strong>open type families are not modular.</strong></p>
<hr class="docutils" />
<p>So, what does this mean?  Should we throw our hands up and give up
giving Haskell a new module system?  Obviously, we’re not going
to go without a fight. Here are some ways to counter the problem.</p>
<div class="section" id="the-basic-proposal-require-all-instances-in-the-signature">
<h3>The basic proposal: require all instances in the signature</h3>
<p>The simplest and most straightforward way to solve the unsoundness is to
require that a signature mention all of the family instances that are
<em>transitively</em> exported by the module.  So, in our previous example, the
implementation of <tt class="docutils literal">A</tt> does not satisfy the signature because it has an
instance which is not mentioned in the signature, but would satisfy this
signature:</p>

<pre class="literal-block">module A where
    type instance F Int
    type instance F Bool
</pre>
<p>While at first glance this might not seem too onerous, it's important to
note that this requirement is <em>transitive</em>.  If <tt class="docutils literal">A</tt> happens to import
another module <tt class="docutils literal">Internal</tt>, which itself has its own type family
instances, <em>those must be represented in the signature as well.</em>  (It's
easy to imagine this spinning out of control for type classes, where any
of the forty imports at the top of your file may be bringing in any
manner of type classes into scope.) There are two major user-visible
consequences:</p>
<ol class="arabic simple">
<li>Module imports are <em>not</em> an implementation detail—you need to replicate
this structure in the signature file, and</li>
<li>Adding instances is <em>always</em> a backwards-incompatible change (there
is no weakening).</li>
</ol>
<p>Of course, as Richard pointed out to me, this is <em>already</em> the case for
Haskell programs (and you just hoped that adding that one extra instance
was "OK").</p>
<p>Despite its unfriendliness, this proposal serves as the basis for the
rest of the proposals, which you can conceptualize as trying to characterize,
“When can I avoid having to write all of the instances in my signature?”</p>
</div>
<div class="section" id="extension-1-the-orphan-restriction">
<h3>Extension 1: The orphan restriction</h3>
<p>Suppose that I write the following two modules:</p>

<pre class="literal-block">module A where
    data T = T
    type instance F T = Bool

module B where
    import A
    type instance F T = Int -&gt; Int
</pre>
<p>While it is true that these two type instances are overlapping and
rightly rejected, they are not equally at fault:
in particular, the instance in module <tt class="docutils literal">B</tt> is an <em>orphan</em>.  An orphan
instance is an instance for type class/family <tt class="docutils literal">F</tt> and data type <tt class="docutils literal">T</tt>
(it just needs to occur anywhere on the left-hand side) which lives in a
module that defines neither.  (<tt class="docutils literal">A</tt> is not an orphan since the instance
lives in the same module as the definition of data type <tt class="docutils literal">T</tt>).</p>
<p>What we might wonder is, “If we disallowed all orphan instances, could
this rule out the possibility of overlap?”  The answer is, “Yes! (...with
some technicalities).”  Here are the rules:</p>
<ol class="arabic simple">
<li>The signature must mention all what we will call <em>ragamuffin instances</em> transitively
exported by implementations being considered.  An instance of a
family <tt class="docutils literal">F</tt> is a <em>ragamuffin</em> if it is not defined with the family
definition, or with the type constructor at the head in the first
parameter. (Or some specific parameter, decided on a per-family basis.)
All orphan instances are ragamuffins, but not all ragamuffins are
orphans.</li>
<li>A signature exporting a type family must mention <em>all</em> instances which
are defined in the same module as the definition of the type family.</li>
<li>It is strictly optional to mention non-ragamuffin instances in
a signature.</li>
</ol>
<p>(Aside: I don't think this is the most flexible version of the rule
that is safe, but I do believe it is the most straightforward.)
The whole point of these rules is to make it impossible to write an
overlapping instance, while only requiring local checking when an
instance is being written.  Why did we need to strengthen the orphan
condition into a ragamuffin condition to get this non-overlap?  The
answer is that absence of orphans does not imply absence of overlap, as
this simple example shows:</p>

<pre class="literal-block">module A where
    data A = A
    type instance F A y = Int

module B where
    data B = B
    type instance F x B = Bool -&gt; Bool
</pre>
<p>Here, the two instances of <tt class="docutils literal">F</tt> are overlapping, but neither are
orphans (since their left-hand sides mention a data type which was
defined in the module.)  However, the <tt class="docutils literal">B</tt> instance is a ragamuffin
instance, because <tt class="docutils literal">B</tt> is not mentioned in the first argument of
<tt class="docutils literal">F</tt>. (Of course, it doesn't really matter if you check the first
argument or the second argument, as long as you're consistent.)</p>
<p>Another way to think about this rule is that open type family instances
are not standalone instances but rather metadata that is associated with
a type constructor <em>when it is constructed</em>.  In this way,
non-ragamuffin type family instances are modular!</p>
<p>A major downside of this technique, however, is that it doesn't really
do anything for the legitimate uses of orphan instances in the Haskell
ecosystem: when third-parties defined both the type family (or type
class) and the data type, and you need the instance for your own purposes.</p>
</div>
<div class="section" id="extension-2-orphan-resolution">
<h3>Extension 2: Orphan resolution</h3>
<p>This proposal is based off of one that Edward Kmett has been floating
around, but which I've refined.  The motivation is to give a better
story for offering the functionality of orphan instances without gunking
up the module system.  The gist of the proposal is to allow the package
manager to selectively enable/disable orphan definitions; however, to
properly explain it, I'd like to do first is describe a few situations
involving orphan type class instances. (The examples use type classes
rather than type families because the use-cases are more clear. If
you imagine that the type classes in question have associated types,
then the situation is the same as that for open type families.)</p>
<p>The story begins with a third-party library which defined a data type <tt class="docutils literal">T</tt>
but did not provide an instance that you needed:</p>

<pre class="literal-block">module Data.Foo where
    data Foo = Foo

module MyApp where
    import Data.Foo
    fooString = show Foo -- XXX no instance for Show
</pre>
<p>If you really need the instance, you might be tempted to just go ahead and define it:</p>

<pre class="literal-block">module MyApp where
    import Data.Foo
    instance Show Foo where -- orphan
        show Foo = "Foo"
    fooString = show Foo
</pre>
<p>Later, you upgrade <tt class="docutils literal">Data.Foo</tt> to version 1.0.0,  which does define
a <tt class="docutils literal">Show</tt> instance, and now your  overlapping instance error! Uh oh.</p>
<p>How do we get ourselves out of the mess?  A clue is how many package authors
currently “get out of jail” by using preprocessor macros:</p>

<pre class="literal-block">{-# LANGUAGE CPP #-}
module MyApp where
    import Data.Foo
#if MIN_VERSION_foo(1,0,0)
    instance Show Foo where -- orphan
        show Foo = "Foo"
#endif
    fooString = show Foo
</pre>
<p>Morally, we'd like to hide the orphan instance when the real instance
is available: there are two variations of <tt class="docutils literal">MyApp</tt> which we want to
transparently switch between: one which defines the orphan instance,
and one which does not and uses the non-orphan instance defined in
the <tt class="docutils literal">Data.Foo</tt>.  The choice depends on which <tt class="docutils literal">foo</tt> was chosen,
a decision made by the package manager.</p>
<p>Let's mix things up a little. There is no reason the instance has to be
a non-orphan coming from <tt class="docutils literal">Data.Foo</tt>.  Another library might have
defined its own orphan instance:</p>

<pre class="literal-block">module MyOtherApp where
    import Data.Foo
    instance Show Foo where ... -- orphan
    otherFooString = show Foo

module MyApp where
    import Data.Foo
    instance Show Foo where ... -- orphan
    fooString = show Foo

module Main where
    import MyOtherApp
    import MyApp
    main = print (fooString ++ otherFooString ++ show Foo)
</pre>
<p>It's a bit awful to get this to work with preprocessor macros, but
there are <em>two</em> ways we can manually resolve the overlap: we can erase the
orphan instance from <tt class="docutils literal">MyOtherApp</tt>, or we can erase the orphan instance
from <tt class="docutils literal">MyApp</tt>.  A priori, there is no reason to prefer one or the
other.  However, depending on which one is erased, <tt class="docutils literal">Main</tt> may have to
be compiled <em>differently</em> (if the code in the instances is different).
Furthermore, we need to setup a <em>new</em> (instance-only) import between the
module who defines the instance to the module whose instance was erased.</p>
<p>There are a few takeaways from these examples.  First, the most natural
way of resolving overlapping orphan instances is to simply “delete” the
overlapping instances; however, which instance to delete is a global
decision.  Second, <em>which</em> overlapping orphan instances are enabled
affects compilation: you may need to add module dependencies to be able
to compile your modules.  Thus, we might imagine that a solution allows
us to do both of these, without modifying source code.</p>
<p>Here is the game plan: as before, packages can define orphan instances.
However, the list of orphan instances a package defines is part of the
metadata of the package, and the instance itself may or may not be used
when we actually compile the package (or its dependencies).  When we do
dependency resolution on a set of packages, we have to consider the set
of orphan instances being provided and only enable a set which is
non-overlapping, the so called <strong>orphan resolution</strong>.  Furthermore, we
need to add an extra dependency from packages whose instances were
disabled to the package who is the sole definer of an instance (this
might constrain which orphan instance we can actually pick as the
canonical instance).</p>
<p>The nice thing about this proposal is that it solves an already existing
pain point for type class users, namely defining an orphan type class
instance without breaking when upstream adds a proper instance.  But you
might also think of it as a big hack, and it requires cooperation from
the package manager (or some other tool which manages the orphan resolution).</p>
<hr class="docutils" />
<p>The extensions to the basic proposal are not mutually exclusive, but
it's an open question whether or not the complexity they incur are
worth the benefits they bring to existing uses of orphan instances.
And of course, there may other ways of solving the problem
which I have not described here, but this smorgasbord seems to be the
most plausible at the moment.</p>
<p>At ICFP, I had an interesting conversation with Derek Dreyer, where he
mentioned that when open type families were originally going into GHC,
he had warned Simon that they were not going to be modular.  With the
recent addition of closed type families, many of the major use-cases for
open type families stated in the original paper have been superseded.
However, even if open type families had never been added to Haskell, we
still might have needed to adopt these solutions: the <em>global uniqueness
of instances</em> is deeply ingrained in the Haskell community, and even if
in some cases we are lax about enforcing this constraint, it doesn't
mean we should actively encourage people to break it.</p>
<p>I have a parting remark for the ML community, as type classes make their
way in from Haskell: when you do get type classes in your language,
don’t make the same mistake as the Haskell community and start using
them to enforce invariants in APIs.  This way leads to the global
uniqueness of instances, and the loss of modularity may be too steep a
price to pay.</p>
<hr class="docutils" />
<p><em>Postscript.</em> One natural thing to wonder, is if overlapping type family instances are OK if one of the instances “is not externally visible.” Of course, the devil is in the details; what do we mean by external visibility of type family instances of <tt class="docutils literal">F</tt>?</p>
<p>For some definitions of visibility, we can find an equivalent, local transformation which has the same effect.  For example, if we never use the instance <em>at all</em>, it certainly OK to have overlap. In that case, it would also have been fine to delete the instance altogether.  As another example, we could require that there are no (transitive) mentions of the type family <tt class="docutils literal">F</tt> in the signature of the module. However, eliminating the mention of the type family requires knowing enough parameters and equations to reduce: in which case the type family could have been replaced with a local, closed type family.</p>
<p>One definition that definitely does <em>not</em> work is if <tt class="docutils literal">F</tt> can be mentioned with some unspecified type variables. Here is a function which coerces an <tt class="docutils literal">Int</tt> into a function:</p>
<pre class="literal-block">module A where
  type instance F Int = Int
  f :: Typeable a =&gt; a -&gt; F a
  f x = case eqT of
    Just Refl -&gt; x :: Int
    Nothing -&gt; undefined

module ASig where
  f :: Typeable a =&gt; a -&gt; F a

module B where
  import ASig
  type instance F Int = Bool -&gt; Bool
  g :: Bool
  g = f 0 True -- oops
</pre>
<p>...the point being that, even if a signature doesn't directly mention the overlapping instance <tt class="docutils literal">F Int</tt>, type refinement (usually by some GADT-like structure) can mean that an offending instance can be used internally.</p>
</div>
</div>
<img width="1" src="http://feeds.feedburner.com/~r/ezyang/~4/3rp1-wUzebg" height="1" /></div>






<p class="date">
<a href="http://feedproxy.google.com/~r/ezyang/~3/3rp1-wUzebg/">by Edward Z. Yang at September 04, 2014 10:12 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://ro-che.info/" title="Roman Cheplyaka">Roman Cheplyaka</a></h3>

<div class="entrygroup" id="http://ro-che.info//articles/2014-09-05-dependent-haskell.html">
<blockquote>
<h1 class="entry"><a href="http://feedproxy.google.com/~r/RomanCheplyaka/~3/_j2L8NOWuWc/2014-09-05-dependent-haskell">Dependent Haskell</a></h1>
<div class="entry">
<p>Emulating dependent types (and, more generally, advanced type-level programming) has been a hot topic in the Haskell community recently. Some incredible work has been done in this direction: GADTs, open and closed type families, singletons, etc. The plan is to copy even more features to the type level, like type classes and GADTs, and simplify the promotion of value-level functions.</p>
<p>On the other hand, there’s a good deal of scepticism around this idea. «If you want to program like in Agda, why don’t you program in Agda?»</p>


<p>First, libraries. It took us many years to arrive at the state of hackage that is suitable for industrial usage — and we still don’t have satisfactory answers to many problems. My guess is that it will take at least as long as that for the dependently typed community to arrive at this point — not only because of the smaller community, but also because they will look for even more type-safe solutions, which is naturally a harder problem.</p>
<p>Making your code extremely type-safe is quite hard (or else it would not be worth an ICFP talk). In a real-world application, you’d probably have just a few places where it’s worth the effort. But if you write the whole application in a dependently-typed language, you pay the price for your whole codebase. The price includes, for instance, the absence of type inference.</p>
<p>The compilation problem is not solved either. In particular, there are concerns about type erasure in both Agda and Idris. <del>This is not unsolvable, just hasn’t been done yet.</del></p>
<p>So maybe you could write some parts in Agda/Idris and the rest in Haskell? Neither Agda nor Idris has a good story for that. For instance, Agda can generate Haskell code, but interfacing with Haskell won’t be very smooth. And the differences in languages mean that it probably won’t ever be effortless.</p>
<p>Don’t get me wrong, I am very enthusiastic about these (and future) languages. However, it doesn’t seem like they will be ready for production usage anytime soon. At the same time, you can satisfy the majority of your dependently typed needs in Haskell <strong>right now</strong>, no hidden charges. Isn’t that cool?</p>
<h2 id="disclaimer">Disclaimer</h2>
<p>I am no expert in Agda/Idris. The above is my impression from talking to different people at ICFP and participating in tutorials on these two languages given by their corresponding authors. I’ll gladly accept rebuttals.</p>
<h2 id="updates">Updates</h2>
<p>There’s a discussion happening on <a href="http://www.reddit.com/r/haskell/comments/2flour/dependent_haskell/">/r/haskell</a>, where people dispute many of my points. I encourage you to read that discussion and make your own conclusions.</p>
<p>In particular, it has been pointed out that erasure is not as big of a problem as I thought initially. Still, it’ll take quite some time (and non-trivial systems built with dependent types) for us to be able to trust Idris/Agda compilers as much as we now trust GHC.</p><img width="1" src="http://feeds.feedburner.com/~r/RomanCheplyaka/~4/_j2L8NOWuWc" height="1" /></div>






<p class="date">
<a href="http://feedproxy.google.com/~r/RomanCheplyaka/~3/_j2L8NOWuWc/2014-09-05-dependent-haskell">September 04, 2014 10:00 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.skybluetrades.net" title="Sky Blue Trades RSS feed.">Ian Ross</a></h3>

<div class="entrygroup" id="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/index.html">
<blockquote>
<h1 class="entry"><a href="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/index.html">Non-diffusive atmospheric flow #5: pre-processing</a></h1>
<div class="entry">
<h1><a href="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/index.html">Non-diffusive atmospheric flow #5: pre-processing</a></h1>
<h4 class="postdate">September  4, 2014</h4>

<p><strong>Note: there are a couple of earlier articles that I didn’t tag as “haskell” so they didn’t appear in Planet Haskell. They don’t contain any Haskell code, but they cover some background material that’s useful to know (<a href="http://www.skybluetrades.net/blog/posts/2014/08/29/data-analysis-ao1-3/index.html">#3</a> talks about reanalysis data and what <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> is, and <a href="http://www.skybluetrades.net/blog/posts/2014/09/01/data-analysis-ao1-4/index.html">#4</a> displays some of the characteristics of the data we’re going to be using). If you find terms here that are unfamiliar, they might be explained in one of these earlier articles.</strong></p>
<p><em>The code for this post is available in a <a href="https://gist.github.com/ian-ross/ed3a21f6238719d4aaeb">Gist</a>.</em></p>
<p>Before we can get into the “main analysis”, we need to do some pre-processing of the <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> data. In particular, we are interested in large-scale spatial structures, so we want to subsample the data spatially. We are also going to look only at the Northern Hemisphere winter, so we need to extract temporal subsets for each winter season. (The reason for this is that winter is the season where we see the most interesting changes between persistent flow regimes. And we look at the Northern Hemisphere because it’s where more people live, so it’s more familiar to more people.) Finally, we want to look at variability about the seasonal cycle, so we are going to calculate “anomalies” around the seasonal cycle.</p>
<p>We’ll do the spatial and temporal subsetting as one pre-processing step and then do the anomaly calculation seperately, just for simplicity.</p>


<h3 id="spatial-and-temporal-subsetting">Spatial and temporal subsetting</h3>
<p>The title of the <a href="http://journals.ametsoc.org/doi/full/10.1175/1520-0469%282004%29061%3C2384%3AONDILA%3E2.0.CO%3B2">paper we’re trying to follow</a> is “Observed Nondiffusive Dynamics in <strong>Large-Scale</strong> Atmospheric Flow”, so we need to decide what we mean by “large-scale” and to subset our data accordingly. The <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> data from the NCEP reanalysis dataset is at 2.5° × 2.5° resolution, which turns out to be a little finer than we need, so we’re going to extract data on a 5° × 5° grid instead. We’ll also extract only the Northern Hemisphere data, since that’s what we’re going to work with.</p>
<p>For the temporal subsetting, we need to take 181 days of data for each year starting on 1 November each year. Since the data starts at the beginning of 1948 and goes on to August 2014 (which is when I’m writing this), we’ll have 66 years of data, from November 1948 until April 2014. As usual when handling dates, there’s some messing around because of leap years, but here it basically just comes down to which day of the year 1 November is in a given year, so it’s not complicated.</p>
<p>The <a href="http://www.esrl.noaa.gov/psd/cgi-bin/db_search/DBSearch.pl?Dataset=NCEP+Reanalysis+Daily+Averages+Pressure+Level&amp;Variable=Geopotential+height&amp;group=0&amp;submit=Search">daily NCEP reanalysis geopotential height data</a> comes in one file per year, with all the pressure levels used in the dataset bundled up in each file. That means that the geopotential height variable in each file has coordinates: time, level, latitude, longitude, so we need to slice out the 500 mb level as we do the other subsetting.</p>
<p>All this is starting to sound kind of complicated, and this brings us to a regrettable point about dealing with this kind of data – it’s messy and there’s a lot of boilerplate code to read and manipulate coordinate metadata. This is true pretty much whatever language you use for processing these multi-dimensional datasets and it’s kind of unavoidable. The trick is to try to restrict this inconvenient stuff to the pre-processing phase by using a consistent organisation of your data for the later analyses. We’re going to do that here by storing all of our <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> anomaly data in a single NetCDF file, with 181-day long winter seasons back-to-back for each year. This will make time and date processing trivial.</p>
<p>The code for the data subsetting is in the <a href="https://gist.github.com/ian-ross/ed3a21f6238719d4aaeb#file-subset-hs">subset.hs</a> program in the Gist. We’ll deal with it in a few bites.</p>
<p>Skipping the imports that we need, as well as a few “helper” type synonym definitions, the first thing that we need to do it open one of the input NCEP NetCDF files to extract the coordinate metadata information. This listing shows how we do this:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="kw">Right</span> refnc <span class="ot">&lt;-</span> openFile <span class="fu">$</span> indir <span class="fu">&lt;/&gt;</span> <span class="st">"hgt.1948.nc"</span>
  <span class="kw">let</span> <span class="kw">Just</span> nlat <span class="fu">=</span> ncDimLength <span class="fu">&lt;$&gt;</span> ncDim refnc <span class="st">"lat"</span>
      <span class="kw">Just</span> nlon <span class="fu">=</span> ncDimLength <span class="fu">&lt;$&gt;</span> ncDim refnc <span class="st">"lon"</span>
      <span class="kw">Just</span> nlev <span class="fu">=</span> ncDimLength <span class="fu">&lt;$&gt;</span> ncDim refnc <span class="st">"level"</span>
  <span class="kw">let</span> (<span class="kw">Just</span> lonvar) <span class="fu">=</span> ncVar refnc <span class="st">"lon"</span>
      (<span class="kw">Just</span> latvar) <span class="fu">=</span> ncVar refnc <span class="st">"lat"</span>
      (<span class="kw">Just</span> levvar) <span class="fu">=</span> ncVar refnc <span class="st">"level"</span>
      (<span class="kw">Just</span> timevar) <span class="fu">=</span> ncVar refnc <span class="st">"time"</span>
      (<span class="kw">Just</span> zvar) <span class="fu">=</span> ncVar refnc <span class="st">"hgt"</span>
  <span class="kw">Right</span> lon <span class="ot">&lt;-</span> get refnc<span class="ot"> lonvar ::</span> <span class="dt">SVRet</span> <span class="dt">CFloat</span>
  <span class="kw">Right</span> lat <span class="ot">&lt;-</span> get refnc<span class="ot"> latvar ::</span> <span class="dt">SVRet</span> <span class="dt">CFloat</span>
  <span class="kw">Right</span> lev <span class="ot">&lt;-</span> get refnc<span class="ot"> levvar ::</span> <span class="dt">SVRet</span> <span class="dt">CFloat</span></code></pre>
<p>We open the first of the NetCDF files (I’ve called the directory where I’ve stored these things <code>indir</code>) and use the <code>hnetcdf</code> <code>ncDim</code> and <code>ncVar</code> functions to get the dimension and variable metadata for the latitude, longitude, level and time dimensions; we then read the complete contents of the “coordinate variables” (for level, latitude and longitude) as Haskell values (here, <code>SVRet</code> is a type synonym for a storable vector wrapped up in the way that’s returned from the <code>hnetcdf</code> <code>get</code> functions).</p>
<p>Once we have the coordinate variable values, we need to find the index ranges to use for subsetting. For the spatial subsetting, we find the start and end ranges for the latitudes that we want (17.5°N-87.5°N) and for the level, we find the index of the 500 mb level:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="kw">let</span> late <span class="fu">=</span> vectorIndex <span class="kw">LT</span> <span class="dt">FromEnd</span> lat <span class="dv">17</span><span class="fu">.</span><span class="dv">5</span>
      lats <span class="fu">=</span> vectorIndex <span class="kw">GT</span> <span class="dt">FromStart</span> lat <span class="dv">87</span><span class="fu">.</span><span class="dv">5</span>
      levi <span class="fu">=</span> vectorIndex <span class="kw">GT</span> <span class="dt">FromStart</span> lev <span class="dv">500</span><span class="fu">.</span><span class="dv">0</span></code></pre>
<p>using a helper function to find the correspondence between coordinate values and indexes:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IndexStart</span> <span class="fu">=</span> <span class="dt">FromStart</span> <span class="fu">|</span> <span class="dt">FromEnd</span>

<span class="ot">vectorIndex ::</span> (<span class="dt">SV.Storable</span> a, <span class="kw">Ord</span> a)
            <span class="ot">=&gt;</span> <span class="dt">Ordering</span> <span class="ot">-&gt;</span> <span class="dt">IndexStart</span> <span class="ot">-&gt;</span> <span class="dt">SV.Vector</span> a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span>
vectorIndex o s v val <span class="fu">=</span> <span class="kw">case</span> (go o, s) <span class="kw">of</span>
  (<span class="kw">Nothing</span>, _) <span class="ot">-&gt;</span> (<span class="fu">-</span><span class="dv">1</span>)
  (<span class="kw">Just</span> i, <span class="dt">FromStart</span>) <span class="ot">-&gt;</span> i
  (<span class="kw">Just</span> i, <span class="dt">FromEnd</span>) <span class="ot">-&gt;</span> SV.length v <span class="fu">-</span> <span class="dv">1</span> <span class="fu">-</span> i
  <span class="kw">where</span> go <span class="kw">LT</span> <span class="fu">=</span> SV.findIndex (<span class="fu">&gt;=</span> val) vord
        go <span class="kw">GT</span> <span class="fu">=</span> SV.findIndex (<span class="fu">&lt;=</span> val) vord
        vord <span class="fu">=</span> <span class="kw">case</span> s <span class="kw">of</span>
          <span class="dt">FromStart</span> <span class="ot">-&gt;</span> v
          <span class="dt">FromEnd</span> <span class="ot">-&gt;</span> SV.reverse v</code></pre>
<p>For the temporal subsetting, we just work out what day of the year 1 November is for leap and non-leap years – since November and December together are 61 days, for each winter season we need those months plus the first 120 days of the following year:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="kw">let</span> inov1non <span class="fu">=</span> <span class="dv">305</span> <span class="fu">-</span> <span class="dv">1</span>
      <span class="co">-- ^ Index of 1 November in non-leap years.</span>
      wintertsnon <span class="fu">=</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">119</span>] <span class="fu">++</span> [inov1non<span class="fu">..</span><span class="dv">365</span><span class="fu">-</span><span class="dv">1</span>]
      <span class="co">-- ^ Indexes of all winter days for non-leap years.</span>
      inov1leap <span class="fu">=</span> <span class="dv">305</span> <span class="fu">+</span> <span class="dv">1</span> <span class="fu">-</span> <span class="dv">1</span>
      <span class="co">-- ^ Index of 1 November in leap years.</span>
      wintertsleap <span class="fu">=</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">119</span>] <span class="fu">++</span> [inov1leap<span class="fu">..</span><span class="dv">366</span><span class="fu">-</span><span class="dv">1</span>]
      <span class="co">-- ^ Indexes of all winter days for leap years.</span>
      winterts1948 <span class="fu">=</span> [inov1leap<span class="fu">..</span><span class="dv">366</span><span class="fu">-</span><span class="dv">1</span>]
      winterts2014 <span class="fu">=</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">119</span>]
      <span class="co">-- ^ Indexes for winters in start and end years.</span></code></pre>
<p>This is kind of hokey, and in some cases you do need to do more sophisticated date processing, but this does the job here.</p>
<p>Once we have all this stuff set up, the critical part of the subsetting is easy – for each input data file, we figure out what range of days we need to read, then use a single call the <code>getS</code> from <code>hnetcdf</code> (“get slice”):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">        forM_ winterts <span class="fu">$</span> \it <span class="ot">-&gt;</span> <span class="kw">do</span>
          <span class="co">-- Read a slice of a single time-step of data: Northern</span>
          <span class="co">-- Hemisphere (17.5-87.5 degrees), 5 degree resolution, 500</span>
          <span class="co">-- mb level only.</span>
          <span class="kw">let</span> start <span class="fu">=</span> [it, levi, lats, <span class="dv">0</span>]
              count <span class="fu">=</span> [<span class="dv">1</span>, <span class="dv">1</span>, (late <span class="fu">-</span> lats) <span class="ot">`div`</span> <span class="dv">2</span> <span class="fu">+</span> <span class="dv">1</span>, nlon <span class="ot">`div`</span> <span class="dv">2</span>]
              stride <span class="fu">=</span> [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>]
          <span class="kw">Right</span> slice <span class="ot">&lt;-</span> getS nc zvar start count<span class="ot"> stride ::</span> <span class="dt">RepaRet2</span> <span class="dt">CShort</span></code></pre>
<p>Here, we have a set of start indexes, a set of counts and a set of strides, one for each dimension in our input variable. Since the input geopotential height files have dimensions of time, level, latitude and longitude, we have four entries in each of our <code>start</code>, <code>count</code> and <code>stride</code> lists. The start values are the current day from the list of days we need (called <code>it</code> in the code), the level we’re interested in (<code>levi</code>), the start latitude index (<code>lats</code>) and zero, since we’re going to get the whole range of longitude. The count list gets a single time step, a single level, and a number of latitude and longitude values based on taking every other entry in each direction (since we’re subsetting from a spatial resolution of 2.5° × 2.5° to a resolution of 5° × 5°). Finally, for the stride list, we use a stride of one for the time and level directions (which doesn’t really matter anyway, since we’re only reading a single entry in each of those directions) and a stride of two in the latitude and longitude directions (which gives us the “every other one” subsetting in those directions).</p>
<p>All of the other code in the subsetting program is involved in setting up the output file and writing the <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> slices out. Setting up the output file is slightly tedious (this is very common when dealing with NetCDF files – there’s always lots of metadata to be managed), but it’s made a little simpler by copying attributes from one of the input files, something that doing this in Haskell makes quite a bit easier than in Fortran or C. The next listing shows how the <code>NcInfo</code> for the output file is created, which can then be passed to the <code>hnetcdf</code> <code>withCreateFile</code> function to actually create the output file:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="kw">let</span> outlat <span class="fu">=</span> SV.fromList <span class="fu">$</span> <span class="fu">map</span> (lat <span class="fu">SV.!</span>) [lats,lats<span class="fu">+</span><span class="dv">2</span><span class="fu">..</span>late]
      outlon <span class="fu">=</span> SV.fromList <span class="fu">$</span> <span class="fu">map</span> (lon <span class="fu">SV.!</span>) [<span class="dv">0</span>,<span class="dv">2</span><span class="fu">..</span>nlon<span class="fu">-</span><span class="dv">1</span>]
      noutlat <span class="fu">=</span> SV.length outlat
      noutlon <span class="fu">=</span> SV.length outlon
      outlatdim <span class="fu">=</span> <span class="dt">NcDim</span> <span class="st">"lat"</span> noutlat <span class="kw">False</span>
      outlatvar <span class="fu">=</span> <span class="dt">NcVar</span> <span class="st">"lat"</span> <span class="dt">NcFloat</span> [outlatdim] (ncVarAttrs latvar)
      outlondim <span class="fu">=</span> <span class="dt">NcDim</span> <span class="st">"lon"</span> noutlon <span class="kw">False</span>
      outlonvar <span class="fu">=</span> <span class="dt">NcVar</span> <span class="st">"lon"</span> <span class="dt">NcFloat</span> [outlondim] (ncVarAttrs lonvar)
      outtimedim <span class="fu">=</span> <span class="dt">NcDim</span> <span class="st">"time"</span> <span class="dv">0</span> <span class="kw">True</span>
      outtimeattrs <span class="fu">=</span> foldl' (<span class="fu">flip</span> M.delete) (ncVarAttrs timevar)
                     [<span class="st">"actual_range"</span>]
      outtimevar <span class="fu">=</span> <span class="dt">NcVar</span> <span class="st">"time"</span> <span class="dt">NcDouble</span> [outtimedim] outtimeattrs
      outz500attrs <span class="fu">=</span> foldl' (<span class="fu">flip</span> M.delete) (ncVarAttrs zvar)
                     [<span class="st">"actual_range"</span>, <span class="st">"level_desc"</span>, <span class="st">"valid_range"</span>]
      outz500var <span class="fu">=</span> <span class="dt">NcVar</span> <span class="st">"z500"</span> <span class="dt">NcShort</span>
                   [outtimedim, outlatdim, outlondim] outz500attrs
      outncinfo <span class="fu">=</span>
        emptyNcInfo (outdir <span class="fu">&lt;/&gt;</span> <span class="st">"z500-subset.nc"</span>) <span class="fu">#</span>
        addNcDim outlatdim <span class="fu">#</span> addNcDim outlondim <span class="fu">#</span> addNcDim outtimedim <span class="fu">#</span>
        addNcVar outlatvar <span class="fu">#</span> addNcVar outlonvar <span class="fu">#</span> addNcVar outtimevar <span class="fu">#</span>
        addNcVar outz500var</code></pre>
<p>Although we can mostly just copy the coordinate variable attributes from one of the input files, we do need to do a little bit of editing of the attributes to remove some things that aren’t appropriate for the output file. Some of these things are just conventions, but there are some tools that may look at these attributes (<code>actual_range</code>, for example) and may complain if the data doesn’t match the attribute. It’s easier just to remove the suspect ones here.</p>
<p>This isn’t pretty Haskell by any means, and the <code>hnetcdf</code> library could definitely do with having some higher-level capabilities to help with this kind of file processing. I may add some based on the experimentation I’m doing here – I’m developing <code>hnetcdf</code> in parallel with writing this!</p>
<p>Anyway, the result of running the subsetting program is a single NetCDF file containing 11946 days (66 × 181) of <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> data at a spatial resolution of 5° × 5°. We can then pass this on to the next step of our processing.</p>
<h3 id="seasonal-cycle-removal">Seasonal cycle removal</h3>
<p>In almost all investigations in climate science, the annual seasonal cycle stands out as the largest form of variability (not always true in the tropics, but in the mid-latitudes and polar regions that we’re looking at here, it’s more or less always true). The problem, of course, is that the seasonal cycle just isn’t all that interesting. We learn about the difference between summer and winter when we’re children, and although there is much more to say about seasonal variations and how they interact with other phenomena in the climate system, much of the time they just get in the way of seeing what’s going on with those other phenomena.</p>
<p>So what do we do? We “get rid” of the seasonal cycle by looking at what climate scientists call “anomalies”, which are basically just differences between the values of whatever variable we’re looking at and values from a “typical” year. For example, if we’re interested in daily temperatures in Innsbruck over the course of the twentieth century, we construct a “typical” year of daily temperatures, then for each day of our 20th century time series, we subtract the “typical” temperature value for that day of the year from the measured temperature value to give a daily anomaly. Then we do whatever analysis we want based on those anomalies, perhaps looking for inter-annual variability on longer time scales, or whatever.</p>
<p>This approach is very common, and it’s what we’re going to do for our Northern Hemisphere winter-time <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> data here. To do this, we need to do two things: we need to calculate a “typical” annual cycle, and we need to subtract that typical annual cycle from each year of our data.</p>
<p>OK, so what’s a “typical” annual cycle? First, let’s say a word about what we mean by “annual cycle” in this case. We’re going to treat each spatial point in our data independently, trusting to the natural spatial correlation in the geopotential height to smooth out any shorter-term spatial inhomogeneities in the typical patterns. We then do some sort of averaging in time to generate a “typical” annual cycle at each spatial point. It’s quite common to use the mean annual cycle over a fixed period for this purpose (a period of 30 years is common: 1960-1990, say). In our case, we’re going to use the mean annual cycle across all 66 years of data that we have. Here’s how we calculate this mean annual cycle (this is from the <a href="https://gist.github.com/ian-ross/ed3a21f6238719d4aaeb#file-seasonal-cycle-hs">seasonal-cycle.hs</a> program in the Gist):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="co">-- Each year has 181 days, so 72 x 15 x 181 = 195480 data values.</span>
  <span class="kw">let</span> ndays <span class="fu">=</span> <span class="dv">181</span>
      nyears <span class="fu">=</span> ntime <span class="ot">`div`</span> ndays

  <span class="co">-- Use an Int array to accumulate values for calculating mean annual</span>
  <span class="co">-- cycle.  Since the data is stored as short integer values, this is</span>
  <span class="co">-- enough to prevent overflow as we accumulate the 2014 - 1948 = 66</span>
  <span class="co">-- years of data.</span>
  <span class="kw">let</span> sh <span class="fu">=</span> <span class="dt">Repa.Z</span> <span class="fu">Repa.:.</span> ndays <span class="fu">Repa.:.</span> nlat <span class="fu">Repa.:.</span> nlon
      slicecount <span class="fu">=</span> [ndays, nlat, nlon]
      zs <span class="fu">=</span> <span class="fu">take</span> (<span class="fu">product</span> slicecount) (<span class="fu">repeat</span> <span class="dv">0</span>)
      <span class="fu">init</span> <span class="fu">=</span> Repa.fromList sh<span class="ot"> zs ::</span> <span class="dt">FArray3</span> <span class="dt">Int</span>

  <span class="co">-- Computation to accumulate a single year's data.</span>
  <span class="kw">let</span> doone current y <span class="fu">=</span> <span class="kw">do</span>
        <span class="co">-- Read one year's data.</span>
        <span class="kw">let</span> start <span class="fu">=</span> [(y <span class="fu">-</span> <span class="dv">1948</span>) <span class="fu">*</span> ndays, <span class="dv">0</span>, <span class="dv">0</span>]
        <span class="kw">Right</span> slice <span class="ot">&lt;-</span> getA innc z500var start<span class="ot"> slicecount ::</span> <span class="dt">RepaRet3</span> <span class="dt">CShort</span>
        <span class="fu">return</span> <span class="fu">$!</span>
          Repa.computeS <span class="fu">$</span> current <span class="fu">Repa.+^</span> (Repa.map <span class="fu">fromIntegral</span> slice)

  <span class="co">-- Accumulate all data.</span>
  total <span class="ot">&lt;-</span> foldM doone <span class="fu">init</span> [<span class="dv">1948</span><span class="fu">..</span><span class="dv">2013</span>]

  <span class="co">-- Calculate the final mean annual cycle.</span>
  <span class="kw">let</span> mean <span class="fu">=</span> Repa.computeS <span class="fu">$</span>
             Repa.map (<span class="fu">fromIntegral</span> <span class="fu">.</span> (<span class="ot">`div`</span> nyears))<span class="ot"> total ::</span> <span class="dt">FArray3</span> <span class="dt">CShort</span></code></pre>
<p>Since each year of data has 181 days, a full year’s data has 72 × 15 × 181 data values (72 longitude points, 15 latitude points, 181 days), i.e. 195,480 values. In the case here, since we have 66 years of data, there are 12,901,680 data values altogether. That’s a small enough number that we could probably slurp the whole data set into memory in one go for processing. However, we’re not going to do that, because there are plenty of cases in climate data analysis where the data sets are significantly larger than this, and you need to do “off-line” processing, i.e. to read data from disk piecemeal for processing.</p>
<p>We do a monadic fold (using the standard <code>foldM</code> function) over the list of years of data, and for each year we read a single three-dimensional slice of data representing the whole year and add it to the current accumulated sum of all the data. (This is what the <code>doone</code> function does: the only slight wrinkle here is that we need to deal with conversion from the short integer values stored in the data file to the Haskell <code>Int</code> values that we use in the accumulator. Otherwise, it’s just a question of applying Repa’s element-wise addition operator to the accumulator array and the year’s data.) Once we’ve accumulated the total values across all years, we divide by the number of years and convert back to short integer values, giving a short integer valued array containing the mean annual cycle – a three-dimensional array with one entry for each day in our 181-day winter season and for each latitude and longitude in the grid we’re using.</p>
<p>Once we have the mean annual cycle with which we want to calculate anomalies, determining the anomalies is simply a matter of subtracting the mean annual cycle from each year’s data, matching up longitude, latitude and day of year for each data point. The next listing shows the main loop that does this, reading a single day of data at a time, then subtracting the appropriate slice of the mean annual cycle to produce anomaly values (Repa’s <code>slice</code> function is handy here) and writing these to an output NetCDF file:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">      <span class="kw">let</span> count <span class="fu">=</span> [<span class="dv">1</span>, nlat, nlon]
      forM_ [<span class="dv">0</span><span class="fu">..</span>ntime<span class="fu">-</span><span class="dv">1</span>] <span class="fu">$</span> \it <span class="ot">-&gt;</span> <span class="kw">do</span>
        <span class="co">-- Read time slice.</span>
        <span class="kw">Right</span> slice <span class="ot">&lt;-</span> getA innc z500var [it, <span class="dv">0</span>, <span class="dv">0</span>]<span class="ot"> count ::</span> <span class="dt">RepaRet2</span> <span class="dt">CShort</span>

        <span class="co">-- Calculate anomalies and write out.</span>
        <span class="kw">let</span> sl <span class="fu">=</span> <span class="dt">Repa.Z</span> <span class="fu">Repa.:.</span> (it <span class="ot">`mod`</span> <span class="dv">181</span>) <span class="fu">Repa.:.</span> <span class="dt">Repa.All</span> <span class="fu">Repa.:.</span> <span class="dt">Repa.All</span>
            anom <span class="fu">=</span> Repa.computeS <span class="fu">$</span>
                   slice <span class="fu">Repa.-^</span> (Repa.slice mean sl)<span class="ot"> ::</span> <span class="dt">FArray2</span> <span class="dt">CShort</span>
        putA outnc outz500var [it, <span class="dv">0</span>, <span class="dv">0</span>] count anom</code></pre>
<p>The only thing we have to be a little bit careful about when we create the final anomaly output file is that we need to remove some of the attributes from the <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> variable: because we’re now working with differences between actual values and our “typical” annual cycle, we no longer need the <code>add_offset</code> and <code>scale_factor</code> attributes that are used to convert from the stored short integer values to floating point geopotential height values. Instead, the values that we store in the anomaly file are the actual geopotential height anomaly values in metres.</p>
<p>After doing all this pre-processing, what we end up with is a single NetCDF file containing 66 winter seasons of daily <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> anomalies for the region we’re interested in. The kind of rather boring data processing we’ve had to do to get to this point is pretty typical for climate data processing – you almost always need to do some sort of subsetting of your data, you often want to remove signals that aren’t interesting (like the annual cycle here, although things can get much more complicated than that). This kind of thing is unavoidable, and the best that you can really do is to try to organise things so that you do the pre-processing once and end up with data in a format that’s then easy to deal with for further processing. That’s definitely the case here, where we have fixed-length time series (181 days per winter) for each year, so we don’t need to do any messing around with dates.</p>
<p>In other applications, pre-processing can be a <em>much</em> bigger job. For functional brain imaging applications, for example, as well as extracting a three-dimensional image from the output of whatever (MRI or CT) scanner you’re using, you often need to do something about the low signal-to-noise ratios that you get, you need to compensate for subject motion in the scanner during the measurements, you need to compensate for time-varying physiological nuisance signals (breathing and heart beat), you need to spatially warp images to match an atlas image to enable inter-subject comparison, and so on. And all that is before you get to doing whatever statistical analysis you’re really interested in.</p>
<p>We will look at some of these “warts and all” pre-processing cases for other projects later on, but for now the small amount of pre-processing we’ve had to do here is enough. Now we can start with the “main analysis”.</p>
<p>Before we do that though, let’s take a quick look at what these anomaly values look like. The two figures below show anomaly plots for the same time periods for which the original <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> data is shown in the plots in <a href="http://www.skybluetrades.net/blog/posts/2014/09/01/data-analysis-ao1-4/index.html">this earlier article</a>. The “normal” anomaly plots are a bit more variable than the original <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>Z</mi><mn>500</mn></msub></mrow></math> plots, but the persistent pattern over the North Atlantic during the blocking episode in the second set of plots is quite clear. This gives us some hope that we’ll be able to pick out these persistent patterns in the data relatively easily.</p>
<p>First, the “normal” anomalies:</p>
<br />
<div class="img-center">
<a href="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/z500-normal-anomaly-snapshots.png"><img src="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/z500-normal-anomaly-snapshots.png" alt="Normal Z500 anomaly snapshots" /></a>
</div>
<p><br /></p>
<p>then the “blocking” anomalies:</p>
<br />
<div class="img-center">
<a href="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/z500-blocking-anomaly-snapshots.png"><img src="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/z500-blocking-anomaly-snapshots.png" alt="Blocking Z500 anomaly snapshots" /></a>
</div>
<p><br /></p>

<div class="tags"><span class="tag"><a href="http://www.skybluetrades.net/blog/tags/data-analysis.html">data-analysis</a></span> <span class="tag"><a href="http://www.skybluetrades.net/blog/tags/haskell.html">haskell</a></span></div>


<div id="livefyre-comments"></div>
&lt;script src="http://zor.livefyre.com/wjs/v3.0/javascripts/livefyre.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
(function () {
    var articleId = fyre.conv.load.makeArticleId(null);
    fyre.conv.load({}, [{
        el: 'livefyre-comments',
        network: "livefyre.com",
        siteId: "290329",
        articleId: articleId,
        signed: false,
        collectionMeta: {
            articleId: articleId,
            url: fyre.conv.load.makeCollectionUrl(),
        }
    }], function() {});
}());
&lt;/script&gt;</div>






<p class="date">
<a href="http://www.skybluetrades.net/blog/posts/2014/09/04/data-analysis-ao1-5/index.html">September 04, 2014 12:54 PM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>September 01, 2014</h2>

<div class="channelgroup">







<h3><a href="http://logicaltypes.blogspot.com/" title="Typed Logic">Douglas M. Auclair (geophf)</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-4650294074444534066.post-4575977025827035113">
<blockquote>
<h1 class="entry"><a href="http://logicaltypes.blogspot.com/2014/09/august-haskell-daily-puzzles-and.html">August Haskell Daily puzzles and solutions</a></h1>
<div class="entry">
<br /><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><b>August, 2014</b></div></div><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><b><br /></b></div></div><div><ul><li>August 1st, 2014: "<a href="http://lpaste.net/108559">But programming isn't math, so</a> ..." Today's #haskell problem? 'Fix' yesterday's solution to be less ... 'icky.' http://lpaste.net/108559 <a href="http://lpaste.net/108576">π, fast</a> (So you're not eating π? ... okay: 'quickly.') A solution set to today's exercises with Wow-o-wow results. http://lpaste.net/108576</li><li><u>Bonus</u>: August 1st, 2014: This is <a href="http://lpaste.net/108562">Embarrassing(ly parallel)</a> to have π in da face!  http://lpaste.net/108562</li><li><a href="http://lpaste.net/108733">A-to-the-ST for da D-down-low-on-the-SL</a>. Today's #haskell exercise is write your own language, then some rules. Yeah. http://lpaste.net/108733. <a href="http://lpaste.net/108758">LAWLZ</a>! NAND on the A-to-the-ST! http://lpaste.net/108758 A solution to the first 2 exercises to today's problem. YMMV: not pretty nor generic.</li><li><a href="http://lpaste.net/108820">Baby needs a new pair of shoes!</a> And you need a new daily #haskell problem to solve. http://lpaste.net/108820 Done! ;) Love is the <a href="http://lpaste.net/108829">Universal Language</a>. No, wait. We were talking about Money, yes? Me confused. Solution to today's exercise http://lpaste.net/108829. I have a <a href="http://lpaste.net/108871">Yen for Thinking Japanese</a>, or so I think so ... a solution to the bonus #haskell exercise http://lpaste.net/108871</li><li><a href="http://lpaste.net/108901">Bayes was a man of letters</a>. A Bayesian classifier for letter-recognition? Sure, let's give it a go for today's #haskell exercise. http://lpaste.net/108901 So now we know 'M' looks like 'W' to some peeps but 'B', 'I', 'O' check out fine, so <a href="http://lpaste.net/108916">WE ARE READING WITH HASKELL</a>! YAY http://lpaste.net/108916 ... added definitions to do test runs over the entire data set and then did various runs, tweaking the system. Results noted. Informative.</li><li>Today's #haskell exercise. An <a href="http://lpaste.net/108989">expert system for blood donation</a>. I use the term 'expert' loosely, eh? ;) http://lpaste.net/108989 Have at it! "<a href="http://lpaste.net/108994">I vant to drinq yur bloot! Bwa-hahaha!</a>" Okay. That quote is just ... creepy. A solution to today's exercise is at http://lpaste.net/108994</li><li><a href="http://lpaste.net/109043">Veni, Vidi, ... Duci</a>? http://lpaste.net/109043 Today's #haskell exercise. It is a relief to know that no tactical nukes were launched by testing the solution to today's #haskell exercise. http://lpaste.net/109061 or <a href="http://lpaste.net/109061">How do you count Mississippi's in Roman numerals?</a></li><li>August 11th, 2014, Monday: You've heard of 'Rock Management'? How about <a href="http://lpaste.net/109188">ROCK LOBSTERS</a>! GIVE ME A ROCK, NAOW!!!1!!!!11! Today's #haskell exercise http://lpaste.net/109188 </li><li>August 12th, 2014, Tuesday: <a href="http://lpaste.net/109219">To Fract or Not to Fract</a>: why are we even considering this question? Today's #haskell exercise http://lpaste.net/109219 </li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://2.bp.blogspot.com/-Z4tKhLjivbs/U-miR1C-REI/AAAAAAAAATY/rQYFpEebI9k/s1600/800px-SpectrumAnalyzerDisplay.png"><img src="http://2.bp.blogspot.com/-Z4tKhLjivbs/U-miR1C-REI/AAAAAAAAATY/rQYFpEebI9k/s1600/800px-SpectrumAnalyzerDisplay.png" style="cursor: move;" border="0" width="320" height="240" /></a></div><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><br /></div><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: left;" class="separator"></div><ul><li>Ooh! Bonus problem? On a Tuesday? Wowsers! Today's #haskell #bonus problem: "<a href="http://lpaste.net/109205">Continuum spectrum maximum... uh, 'thing'um</a>" http://lpaste.net/109205</li><li>August 13th, 2014, Wednesday. No problem! (literally), but: "<a href="http://lpaste.net/109341">Fract! The Cylons!</a>" No... wait: Starbuck used a different word. A solution to yesterday's fracting problem is at http://lpaste.net/109341</li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://1.bp.blogspot.com/-m2ZzFc24eQo/U-wwq3eilPI/AAAAAAAAATo/3GLYtUHM7EI/s1600/a-flatliner.png"><img src="http://1.bp.blogspot.com/-m2ZzFc24eQo/U-wwq3eilPI/AAAAAAAAATo/3GLYtUHM7EI/s1600/a-flatliner.png" style="cursor: move;" border="0" width="320" height="210" /></a></div><div style="text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #292f33; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 20px;" class="Apple-style-span">Flatliners. No fracting, no 'peak'ing, just a baseline data set of </span></div></div><div style="text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #292f33; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 20px;" class="Apple-style-span">initializeSpectrum defined with flatline function.</span></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://1.bp.blogspot.com/-stpG4LOg010/U-wyBDw3UTI/AAAAAAAAATw/KxSv44BseM4/s1600/b-twinpeaks.png"><img src="http://1.bp.blogspot.com/-stpG4LOg010/U-wyBDw3UTI/AAAAAAAAATw/KxSv44BseM4/s1600/b-twinpeaks.png" style="cursor: move;" border="0" width="320" height="230" /></a></div><div style="text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #292f33; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 20px;" class="Apple-style-span">Twin Peaks. Still not fracted, but data set with two spikes </span></div></div><div style="text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #292f33; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 20px;" class="Apple-style-span">rolled into the base data set with smoothSpike fn </span></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://4.bp.blogspot.com/-ALeZnRM0MCg/U-wynQTOjgI/AAAAAAAAAT4/dkEAEM6zOgA/s1600/c-fracted.png"><img src="http://4.bp.blogspot.com/-ALeZnRM0MCg/U-wynQTOjgI/AAAAAAAAAT4/dkEAEM6zOgA/s1600/c-fracted.png" style="cursor: move;" border="0" width="320" height="197" /></a></div><div style="text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #292f33; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 20px;" class="Apple-style-span">Fracted. Data set with peaks, fracted using the frackedSpike function</span></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><ul><li>August 14th, 2014, Thursday: <a href="http://lpaste.net/109349">Pining for that next fibo date-time before 2584</a>. Today's #haskell problem inspired by <a href="https://twitter.com/AlgebraFact">@AlgebraFact </a>http://lpaste.net/109349. Updated problem. Tightened up return value, removing unnecessary semideterminism. So, it gives, leik, a septatuple answer, leik. ... Yeah. Time keeps flowing like a (Fibonacci) river, to the sea. http://lpaste.net/109389 <a href="http://lpaste.net/109389">A solution to  the 'next Fibonacci' problem</a> posted today.</li><li>Hail, Eris! or the <a href="http://lpaste.net/109350">Law of Fives</a> or today's #haskell problem (implementing a Ripple-down rule set). Do it to it! http://lpaste.net/109350. One of three-parter solution to today's problem: <a href="http://lpaste.net/109458">Forall Existential(ism)</a> http://lpaste.net/109458 A solution allowing forall-quantified values. Two of the three-part solution: <a href="http://lpaste.net/109433">All you need is fnord</a> (la-di-da-di-dah)! Rippling down (and accumulating fired) rules http://lpaste.net/109433. Third of three-part solution: <a href="http://lpaste.net/109473">RippleDownRuleto ergo sum</a>, adding rules to the RDR system http://lpaste.net/109473.  Updated the 3rd solution to the RDR (Writer monad definition) to ripple down to left and right, fixing inconsistency in rule findings.</li><li>August 18th, 2014: What's FP good for? Crypto and <a href="http://lpaste.net/109553">technical (financial) indicators</a>. Why? Um, let's do today's #haskell exercise! http://lpaste.net/109553. <a href="http://lpaste.net/109597">Full on, all the way! Double Rain</a>-... wait: line-graph. Solution to today's #haskell exercise http://lpaste.net/109597</li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://4.bp.blogspot.com/-9YnITcrk9_U/U_Kf4zEtc6I/AAAAAAAAAUI/DEIIpA-Wd1s/s1600/Picture%2B12.png"><img src="http://4.bp.blogspot.com/-9YnITcrk9_U/U_Kf4zEtc6I/AAAAAAAAAUI/DEIIpA-Wd1s/s1600/Picture%2B12.png" style="cursor: move;" border="0" width="320" height="257" /></a></div><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><ul><li>August 19th, 2014: What does it all mean? All the way! No, wait: this is just today's #haskell exercise (<a href="http://lpaste.net/109617">backtesting SMA indicator</a> ). http://lpaste.net/109617 <a href="http://lpaste.net/109687">Take the monoid and run(State-WriterT)</a>, or WAAH! WAAH! I lost 100 corn chips on my investment strategy or, solution: http://lpaste.net/109687 But, as solace, it does come with a pretty picture, illustrating today's solution. Ooh! </li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://1.bp.blogspot.com/-ijjMKo6M3vc/U_TFY5dL1nI/AAAAAAAAAUY/rmuhpjHLkHc/s1600/sma-1yr.png"><img src="http://1.bp.blogspot.com/-ijjMKo6M3vc/U_TFY5dL1nI/AAAAAAAAAUY/rmuhpjHLkHc/s1600/sma-1yr.png" style="cursor: move;" border="0" width="320" height="191" /></a></div><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div></div><ul><li>August 20th, 2014: Next up for today's #haskell exercise is the <a href="http://lpaste.net/109689">Exponential Moving Average</a>. http://lpaste.net/109689 A solution to the E(xponential)M(oving)A(verage) #haskell problem: <a href="http://lpaste.net/109707">Stately Conformance</a> http://lpaste.net/109707 </li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-6EhKrJPIn4A/U_TWTf_DxWI/AAAAAAAAAUo/SXSFLRvfPXI/s1600/emas.png"><img src="http://3.bp.blogspot.com/-6EhKrJPIn4A/U_TWTf_DxWI/AAAAAAAAAUo/SXSFLRvfPXI/s1600/emas.png" style="cursor: move;" border="0" width="320" height="237" /></a></div><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><ul><li>August 21st, 2014: <a href="http://lpaste.net/109749">My Jeans</a>. No ... I meant: 'GENES'! That's it. Today's #haskell exercise. http://lpaste.net/109749 A solution to (not even CLOSE to) 'yesterday's' #haskell exercise: <a href="http://lpaste.net/110330">Nature or Nurture</a>? We present a genetic algorithm http://lpaste.net/110330</li><li>August 22nd, 2014: Today's (much delayed) #haskell problem: the <a href="http://lpaste.net/109817">Silver Ratio</a> http://lpaste.net/109817 (from <a href="http://lpaste.net/109817">@AlgebraFact </a>) <a href="http://lpaste.net/109831">Every cloud has a silver lining</a> .. Every Haskell problem has a solution. (sometimes) (except noncomputable problems) http://lpaste.net/109831</li></ul><div style="clear: both; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em;" href="http://3.bp.blogspot.com/-JphRvg3ORAM/U_eBUNhvBVI/AAAAAAAAAU4/Uryrbntvr6w/s1600/ammann_scaling_bb.png"><img src="http://3.bp.blogspot.com/-JphRvg3ORAM/U_eBUNhvBVI/AAAAAAAAAU4/Uryrbntvr6w/s1600/ammann_scaling_bb.png" style="cursor: move;" border="0" width="320" height="320" /></a></div><div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><ul><li>August 25th, 2014: <a href="http://lpaste.net/109980/">LYADCFGG</a>! Today's #haskell exercise? (automated/learned) Document classification. http://lpaste.net/109980/</li><li>August 26th, 2014: "Join me, Luke, on the Dark Side of the Force, and help me go #<a href="http://lpaste.net/110062">FORTH</a> to solve today's #haskell exercise! MWA-HAHA!" http://lpaste.net/110062 The <a href="http://lpaste.net/edit/110085">World's smallest DSL</a>: Forth. A solution to today's #haskell exercise http://lpaste.net/edit/110085</li><li>August 28th, 2014: "As I compose this #haskell problem ... <a href="http://lpaste.net/110135">p.s. I love you</a> ... You! You! You!" #1960s #song http://lpaste.net/110135 A little card logic problem. Oh, NOES! LOOK OUT! IT'S A <a href="http://lpaste.net/110334">CARD-#SHARKNADO</a>! Nah, it's just 'today's #haskell solution, is all http://lpaste.net/110334</li></ul><div style="margin-left: 1em; margin-right: 1em; text-align: center;"><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><a style="margin-left: 1em; margin-right: 1em;" href="http://4.bp.blogspot.com/-87JdXMVzHZU/VARFIhz3ZHI/AAAAAAAAAVI/S0UIlphz4uk/s1600/Picture%2B5.png"><img src="http://4.bp.blogspot.com/-87JdXMVzHZU/VARFIhz3ZHI/AAAAAAAAAVI/S0UIlphz4uk/s1600/Picture%2B5.png" style="cursor: move;" border="0" width="170" height="320" /></a> </div></div><ul><li>August 29th, 2014: <a href="http://lpaste.net/110171">Groovitudes! WordNet Themes!</a> or: today's #haskell exercise http://lpaste.net/110171 A 3x3 matrix has 36 possible solutions. A 5x5 matrix? Over 200M poss solutions? YIKES! A solution to the <a href="http://lpaste.net/110293">themed-words</a> http://lpaste.net/110293</li></ul></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><b>Notes</b></div><ul><li>The Forth language problem solution given on August 26th gives a very snazzy RPN ('reverse Polish notation') calculator, but that's all it does the ':'-defining word needs access and look-ahead to the program parsed stream, and that's a bit more to ask than pushing and popping stack operators.</li><li>For the August 29th problem(WordNet themes) the raw generated solution set is over 209M possibilities. My little Haskell program was not finished scanning them over four hours when I killed the process. However, my dear wife solved the problem in under five minutes. Setting aside the fact that she's a genius, the program needs to be better. It needs to use the ontology of English-language words to eliminate fruitless endeavors during their generation, not afterwards during the test phase.</li></ul></div></div>






<p class="date">
<a href="http://logicaltypes.blogspot.com/2014/09/august-haskell-daily-puzzles-and.html">by geophf (noreply@blogger.com) at September 01, 2014 10:11 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.yesodweb.com/" title="Yesod Web Framework Blog">Yesod Web Framework</a></h3>

<div class="entrygroup" id="http://www.yesodweb.com/blog/2014/09/planning-yesod-1-4">
<blockquote>
<h1 class="entry"><a href="http://www.yesodweb.com/blog/2014/09/planning-yesod-1-4">Planning Yesod 1.4</a></h1>
<div class="entry">
<p>Now that <a href="http://www.yesodweb.com/blog/2014/08/announcing-persistent-2">persistent 2.0 is out the
door</a>, it's time
to start talking about Yesod version 1.4. First question you might ask: what
happened to Yesod 1.3? Answer: a few of the Yesod libraries (e.g., yesod-auth)
are already on version 1.3, so to avoid confusion, we're jumping straight to
1.4.</p><p>Second question: what are we planning on breaking this time? Answer: hopefully
nothing! The main purpose of this release is actually to just remove some
backwards-compatibility hacks in the Yesod codebase for older versions of
dependencies, like shakespeare pre-2.0, conduit pre-1.2, WAI pre-3.0, and
persistent pre-2.0.</p><p>There are few exceptions to this, which should hopefully have minimal impact on
users. You can see these in <a href="https://github.com/yesodweb/yesod/wiki/Detailed-change-list#yesod-14">the detailed change
list</a>.
One change I'd like to call out is the updated routing system. This is a
fundamental change to how yesod-routes works. The generated code is
<i>drastically</i> simpler as a result. Instead of constructing a data structure
that allows for efficient pattern matching of the request path and then
attempting to parse the resulting pieces, the new code simply generates a
series of clauses, one for each route, and ensures proper parsing using view
patterns. In my initial benchmarking, this made routing twice as fast as Yesod
1.2. I would release this as part of 1.2, but it introduces a new requirement
on the <code>ViewPatterns</code> language extension. So instead, I held it off for the 1.4
release.</p><p>If there are other breaking changes that people would like to propose, now's
the time to do it. But be aware that I'll likely push back hard on any
breakage. If there's a very good reason for it, we can do it. But I'd rather
keep stability wherever possible.</p><p>There's one exception to that rule, which is the purpose of the rest of this
blog post: the scaffolded site. Making changes to the scaffolded site never
breaks existing application, and therefore we can be much more liberal about
changing things there. There <i>is</i> a downside in terms of education: all
existing tutorials on the scaffolding would need to be updated. But one of my
points below addresses that.</p><p>So here are my proposed scaffolding changes:</p><ul><li>Let's move away from config files towards <a href="http://12factor.net/config">environment variables</a> for configuration. A config file is still a convenient way to record configuration, but injecting that configuration through environment variables means configuration can also be stored in a database or elsewhere and injected through environment variables the same way.</li><li>Along the same lines, we would no longer need a command line argument to indicate which environment we're in (devel vs production, etc). All such settings would be controlled via environment variables.</li><li>To allow for easy development, we would have a single <code>YESOD_DEVEL</code> environment variables which would indicate if we're currently in development. If so, it would apply a number of default environment variable values to avoid the need to set these in your shell manually.</li><li>Finally, and I expect this to be controversial: let's use classy-prelude-yesod in the <code>Import</code> module, instead of just taking <code>Prelude</code> with a few objectionable functions filtered out.</li></ul><p>This is just a first pass at a scaffolding cleanup, I'm sure there are other improvements that can be made as well.</p><p>I don't have a specific date on a Yesod 1.4 release, but I'm not expecting it
to be a long development process. The vast majority of the work is already done
(on the yesod-1.4 branch), and that codebase is already being used extensively
in <a href="https://www.fpcomplete.com">a rather large Yesod application</a>, so I'm not
too worried about regressions having slipped in.</p></div>






<p class="date">
<a href="http://www.yesodweb.com/blog/2014/09/planning-yesod-1-4">September 01, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 30, 2014</h2>

<div class="channelgroup">







<h3><a href="http://www.joachim-breitner.de//blog" title="nomeata’s mind shares">Joachim Breitner</a></h3>

<div class="entrygroup" id="http://www.joachim-breitner.de/blog/657-DebConf_14">
<blockquote>
<h1 class="entry"><a href="http://www.joachim-breitner.de/blog/657-DebConf_14">DebConf 14</a></h1>
<div class="entry">
<p>I’m writing this blog post on the plane from Portland towards Europe (<a href="https://www.joachim-breitner.de/blog/656-This_blog_goes_static">which I now can!</a>), using the remaining battery live after having watched one of the DebConf talks that I missed. (It was the systemd talk, which was good and interesting, but maybe I should have watched one of the power management talks, as my battery is running down faster than it should be, I believe.)
  </p>
  <p>I mostly enjoyed <a href="http://debconf14.debconf.org/">this year’s DebConf</a>. I must admit that I did not come very prepared: I had neither something urgent to hack on, nor important things to discuss with the other attendees, so in a way I had a slow start. I also felt a bit out of touch with the project, both personally and technically: In previous DebConfs, I had more interest in many different corners of the project, and also came with more naive enthusiasm. After more than 10 years in the project, I see a few things more realistic and also more relaxed, and don’t react on “Wouldn’t it be cool to have &lt;emph&gt;crazy idea&lt;/emph&gt;” very easily any more. And then I mostly focus on Haskell packaging (and related tooling, which sometimes is also relevant and useful to others) these days, which is not very interesting to most others.
  </p>
  <p>But in the end I did get to do some useful hacking, heard a few interesting talks and even got a bit excited: I created a new tool to schedule binNMUs for Haskell packages which is quite generic (configured by just a regular expression), so that it can and will be used by the OCaml team as well, and who knows who else will start using hash-based virtual ABI packages in the future... It runs via a cron job on people.debian.org to produce output <a href="https://people.debian.org/~nomeata/binNMUs-haskell.txt">for Haskell</a> and <a href="https://people.debian.org/~nomeata/binNMUs-ocaml.txt">for OCaml</a>, based on data pulled via HTTP. If you are a Debian developer and want up-to-date results, log into <tt>wuiet.debian.org</tt> and run <tt>~nomeata/binNMUs --sql</tt>; it then uses the projectb and wanna-build databases directly. Thanks to the ftp team for <a href="http://lists.debian.org/874mxc3x6p.fsf@deep-thought.43-1.org">opening up incoming.debian.org</a>, by the way!
  </p>
  <p>Unsurprisingly, I also held a <a href="//summit.debconf.org/debconf14/meeting/68/debian-haskell-group-bof/">talk on Haskell and Debian</a> (<a href="http://joachim-breitner.de/publications/DebianHaskell_DebConf14_2014-08-28.pdf">slides available</a>). I talked a bit too long and we had too little time for discussion, but in any case not all discussion would have fitted in 45 minutes. The question of which packages from Hackage should be added to Debian and which not is still undecided (which means we carry on packaging what we happen to want in Debian for whatever reason). I guess the better our tooling gets (see the next section), the more easily we can support more and more packages.
  </p>
  <p>I am quite excited by and supportive of Enrico’s agenda to remove boilerplate data from the debian/ directories and relying on autodebianization tools. We have such a tool for Haskell package, <a href="http://hackage.haskell.org/package/cabal-debian">cabal-debian</a>, but it is unofficial, i.e. neither created by us nor fully endorsed. I want to change that, so I got in touch with the upstream maintainer and we want to get it into shape for producing perfect Debian packages, if the upstream provided meta data is perfect. I’d like to see the Debian Haskell Group to follows Enrico’s plan to its extreme conclusion, and this way drive innovation in Debian in general. We’ll see how that goes.
  </p>
  <p>Besides all the technical program I enjoyed the obligatory games of Mao and Werewolves. I also got to dance! On Saturday night, I found a small but welcoming <a href="http://www.portlanddancing.com/moreinfo.aspx?moreinfo=3800">Swing-In-The-Park</a> event where I could dance a few steps of Lindy Hop. And on Tuesday night, Vagrant Cascadian took us (well, three of us) to a blues dancing night, which I greatly enjoyed: The style was so improvisation-friendly that despite having missed the introduction and never having danced Blues before I could jump right in. And in contrast to social dances in Germany, where it is often announced that the girls are also invited to ask the boys, but then it is still mostly the boys who have to ask, here I took only half a minute of standing at the side until I got asked to dance. In retrospect I should have skipped the HP reception and went there directly...
  </p>
  <p>I’m not heading home at the moment, but will travel directly to Göteborg to attend <a href="http://icfpconference.org/icfp2014/index.html">ICFP 2014</a>. I hope the (usually worse) west-to-east jet lag will not prevent me from enjoying that as much as I could.
  </p></div>






<p class="date">
<a href="http://www.joachim-breitner.de/blog/657-DebConf_14">by Joachim Breitner (mail@joachim-breitner.de) at August 30, 2014 03:10 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://lambda.xyz" title="Posts tagged ‘haskell’">Chris Wong</a></h3>

<div class="entrygroup" id="http://lambda.xyz/blog/hackage-part-4/">
<blockquote>
<h1 class="entry"><a href="http://lambda.xyz/blog/hackage-part-4/">Hackage update, part 4</a></h1>
<div class="entry">
<p>A lot has happened with Hackage since my <a href="http://lambda.xyz/blog/hackage-part-3/">last update</a>. Now that the Summer of Code is over, I’ll summarize the work I’ve done since then, and outline where this project will go next.</p>
<h1 id="whats-build-reporting">What’s “build reporting”?</h1>
<p>Since my project covered a few obscure parts of Hackage and Cabal, I think it’s worthwhile to clear some terminology first.</p>
<p>If you’ve uploaded a library to <a href="http://hackage.haskell.org/">Hackage</a> before, you may have noticed that the Haddock documentation does not appear straight away. Since building a package can be quite resource intensive, the job is handled by a dedicated <em>build bot</em>. This bot continually polls for new packages, invokes <code>cabal install</code> on them (with some special flags, which I’ll go into later), and uploads the result.</p>
<p>Of course, this process does not always succeed. If a package fails to compile, then it will not have any documentation either. This is clearly very inconvenient.</p>
<p>Fortunately, recent versions of <code>cabal</code> include a feature called <em>build reporting</em>. When invoked with the <code>--build-summary</code> option, <code>cabal</code> creates a file containing useful information about the build. Here’s an example using the <code>robot</code> package:</p>
<pre><code>$ cabal install robot --build-summary='$pkg.report'
...
$ cat robot.report
package: robot-1.3.0.1
os: linux
arch: x86_64
compiler: ghc-7.6.3
client: cabal-install-1.20.0.3
dependencies: xhb-0.5.2014.4.10 transformers-0.3.0.0
              exceptions-0.6.1 containers-0.5.0.0 base-4.6.0.1
install-outcome: InstallOk
docs-outcome: NotTried
tests-outcome: NotTried</code></pre>
<p>Since the build bot uses <code>cabal</code>, it has access to these reports as well. So whenever the bot completes a build — successful or not — it posts the corresponding report to Hackage. You can read these reports yourself via a special URL; for our <code>robot</code> example it’s <a href="http://hackage.haskell.org/package/robot-1.3.0.1/reports/">http://hackage.haskell.org/package/robot-1.3.0.1/reports/</a>.</p>
<p>In summary: if the docs for a package are missing, then the reports will tell us why. If there are no reports, then it must mean the build bot hasn’t attempted the package yet. All is fine and dandy, at least in theory.</p>
<h1 id="unfortunately">Unfortunately…</h1>
<p>… not all builds were reported. The gaps were in two places: <em>planning failures</em> and <em>package candidates</em>. My <a href="https://github.com/haskell/cabal/pull/2025">latest patch</a> to <code>cabal</code> fixed both these issues.</p>
<h2 id="reporting-planning-failures">Reporting planning failures</h2>
<p>A <em>planning failure</em> is when cabal-install cannot find a consistent set of dependencies to use. You can trigger a planning failure yourself:</p>
<pre><code>$ cabal install robot --constraint='robot &lt; 1.1' --constraint='robot &gt; 1.1'
cabal: Could not resolve dependencies:
...</code></pre>
<p>Since we can’t have a <code>robot</code> which is both older <em>and</em> newer than 1.1, the resolver fails.</p>
<p>Formerly, as dependency resolution ran early in the build process, any failures at this stage did not generate a corresponding report. So if the build bot encountered a planning failure, all the user saw was missing documentation, with no hints as to what went wrong.</p>
<p>The fix was mostly straightforward, save for one issue: since users can report their own builds, a naïve implementation would have lead to Hackage being swamped with frivolous reports. So this feature is guarded behind a flag (<code>--report-planning-failure</code>), and disabled by default.</p>
<h2 id="reporting-candidate-builds">Reporting candidate builds</h2>
<p>Hackage has a feature called <em>build candidates</em>. This lets package maintainers upload and test packages without publishing them to the main site.</p>
<p>Again, the problem was the lack of reporting: when a candidate was uploaded, the build bot would compile the package but not submit a report. This was a major issue, since this reporting was what motivated the feature in the first place.</p>
<p>After some digging, I traced this to <a href="https://github.com/haskell/cabal/issues/1189">a bug in <code>cabal</code></a>. A candidate is not published in the main package index (by definition), so it is impossible to refer to one by name (e.g. <code>hello-1.0</code>). So the build bot invokes <code>cabal</code> using the bare URL instead (e.g. <code>http://hackage.haskell.org/package/hello/candidates/hello-1.0.tar.gz</code>).</p>
<p>The problem was if only a URL was given, <code>cabal</code> considered it a “local” package and did not generate a report. The reason for this behavior is outside the scope of this post, but the fix was clear: change <code>cabal</code> to generate reports for all packages, no matter how they are specified on the command line.</p>
<h1 id="where-to-next">Where to next?</h1>
<p>Though the Summer of Code has ended, my work with Hackage has not. There are still many issues that need clearing up, especially with the <a href="https://github.com/haskell/hackage-server/labels/component:%20candidates">candidates feature</a>; I’ll continue hacking away at them in my spare time.</p>
<p>And lest I forget — many thanks to my mentor Duncan Coutts for his guidance throughout this project! I had plenty of fun this summer, and learned just as much.</p></div>






<p class="date">
<a href="http://lambda.xyz/blog/hackage-part-4/">August 30, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 29, 2014</h2>

<div class="channelgroup">







<h3><a href="http://www.yesodweb.com/" title="Yesod Web Framework Blog">Yesod Web Framework</a></h3>

<div class="entrygroup" id="http://www.yesodweb.com/blog/2014/08/announcing-persistent-2">
<blockquote>
<h1 class="entry"><a href="http://www.yesodweb.com/blog/2014/08/announcing-persistent-2">Announcing Persistent 2</a></h1>
<div class="entry">
<p>We are happy to announce the release of persistent 2.0</p><p>persistent 2.0 adds a flexible key type and makes some breaking changes. 2.0 is an unstable release that we want your feedback on for the soon to follow stable 2.1 release.</p><h2>New Features</h2><ul><li>type-safe composite primary and foreign keys</li><li>added an upsert operation (update or insert)</li><li>added an insertMany_ operation</li></ul><h2>Fixes</h2><ul><li>An <code>Id</code> suffix is no longer automatically assumed to be a Persistent type</li><li>JSON serialization
* MongoDB ids no longer have a prefix 'o' character.</li></ul><h1>Breaking changes</h1><ul><li>Use a simple ReaderT for the underlying connection</li><li>fix postgreSQL timezone storage</li><li>remove the type parameter from EntityDef and FieldDef</li></ul><h1>In depth</h1><h2>Composite keys</h2><p>The biggest limitation of data modeling with persistent is an assumption of a simple (for current SQL backends an auto-increment) primary key.
We learned from <a href="https://github.com/lykahb/groundhog">Groundhog</a> that a more flexible primary key type is possible. Persistent adds a similar flexible key type while maintaining its existing invariant that a Key is tied to a particular table.</p><p>To understand the changes to the <code>Key</code> data type, lets look at a change in the test suite for persistent 2.</p><pre><code class="diff">       i &lt;- liftIO $ randomRIO (0, 10000)
-      let k = Key $ PersistInt64 $ abs i
+      let k = PersonKey $ SqlBackendKey $ abs i</code></pre><p>Previously <code>Key</code> contained a <code>PersistValue</code>. This was not type safe. <code>PersistValue</code> is meant to serialize any basic Haskell type to the database, but a given table only allows specific values as the key.
Now we generate the <code>PersonKey</code> data constructor which specifies the Haskell key types.
<code>SqlBackendKey</code> is the default key type for SQL backends.</p><p>Now lets look at code from CompositeTest.hs</p><pre><code>mkPersist sqlSettings [persistLowerCase|
  Parent
      name  String maxlen=20
      name2 String maxlen=20
      age Int
      Primary name name2 age
      deriving Show Eq
  Child
      name  String maxlen=20
      name2 String maxlen=20
      age Int
      Foreign Parent fkparent name name2 age
      deriving Show Eq
|]
</code></pre><p>Here Parent has a composite primary key made up of 3 fields.
Child uses that as a foreign key.
The primary key of Child is the default key for the backend.</p><pre><code class="haskell">let parent = Parent "a1" "b1" 11
let child = Child "a1" "b1" 11
kp &lt;- insert parent
_ &lt;- insert child
testChildFkparent child @== parent</code></pre><h1>Future changes</h1><h2>Short-term improvements</h2><p>Before the 2.1 release I would like to look at doing some simple things to speed up model compilation a little bit.</p><ul><li>Speed up some of the compile-time persistent code (there is a lot of obviously naive code).</li><li>Reduce the size of Template Haskell generation (create a reference for each EntityDef and some other things rather than potentially repeatedly inlining it)</li></ul><h2>Medium-term improvement: better support for Haskell data types</h2><p>We want to add better support for modeling ADTs, particularly for MongoDB where this is actually very easy to do in the database itself. Persistent already support a <a href="https://github.com/yesodweb/persistent/blob/master/persistent-test/SumTypeTest.hs#L35">top-level entity Sum Type</a> and a simple field ADT that is just an enumeration.</p><p>Another pain point is serializing types not declared in the schema. The declaration syntax in groundhog is very verbose but allows for this. So one possibility would be to allow the current DRY persistent declaration style and also a groundhog declaration style.</p><h2>Long-term improvements: Projections</h2><p>It would be possible to add projections now as groundhog or esqueleto have done. However, the result is not as end-user friendly as we would like.
When the record namespace issue is dealt with in the GHC 7.10 release we plan on adding projections to persistent.</p><h2>Ongoing: Database specific functionality</h2><p>We always look forward to see more databases adapters for persistent.
In the last year, a <a href="http://hackage.haskell.org/package/persistent-redis">Redis</a> and <a href="https://github.com/gbwey/persistent-odbc">ODBC</a> adapter were added.</p><p>Every database is different though, and you also want to take advantage of your database-specific features.
<a href="http://hackage.haskell.org/package/esqueleto">esqueleto</a> and <a href="http://hackage.haskell.org/package/persistent-mongoDB">persistent-mongoDB</a> have shown how to build database specific features in a type-safe way on top of persistent.</p><h2>Organization</h2><p>Although the persistent code has no dependency on Yesod, I would like to make the infrastructure a little more independent of yesod. The first steps would be</p><ul><li>putting it under a different organization on github.</li><li>having a separate mail list (should stackoverflow be prioritized over e-mail?)</li></ul></div>






<p class="date">
<a href="http://www.yesodweb.com/blog/2014/08/announcing-persistent-2">August 29, 2014 09:46 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://antti-juhani.kaijanaho.fi/newblog" title="Antti-Juhani Kaijanaho » Haskell">Antti-Juhani Kaijanaho (ibid)</a></h3>

<div class="entrygroup" id="http://antti-juhani.kaijanaho.fi/newblog/?p=1631">
<blockquote>
<h1 class="entry"><a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1631">Licentiate Thesis is now publicly available</a></h1>
<div class="entry">
<p>My recently accepted Licentiate Thesis, which I<a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1614" title="A milestone toward a doctorate"> posted about</a> a couple of days ago, is now available in <a href="https://jyx.jyu.fi/dspace/handle/123456789/44131">JyX</a>.</p>
<p>Here is the abstract again for reference:</p>
<p>Kaijanaho, Antti-Juhani<br />
The extent of empirical evidence that could inform evidence-based design of programming languages. A systematic mapping study.<br />
Jyväskylä: University of Jyväskylä, 2014, 243 p.<br />
(Jyväskylä Licentiate Theses in Computing,<br />
ISSN 1795-9713; 18)<br />
ISBN 978-951-39-5790-2 (nid.)<br />
ISBN 978-951-39-5791-9 (PDF)<br />
Finnish summary</p>
<p><em>Background</em>: Programming language design is not usually informed by empirical studies. In other fields similar problems have inspired an evidence-based paradigm of practice. Central to it are secondary studies summarizing and consolidating the research literature. <em>Aims</em>: This systematic mapping study looks for empirical research that could inform evidence-based design of programming languages. <em>Method</em>: Manual and keyword-based searches were performed, as was a single round of snowballing. There were 2056 potentially relevant publications, of which 180 were selected for inclusion, because they reported empirical evidence on the efficacy of potential design decisions and were published on or before 2012. A thematic synthesis was created. <em>Results</em>: Included studies span four decades, but activity has been sparse until the last five years or so. The form of conditional statements and loops, as well as the choice between static and dynamic typing have all been studied empirically for efficacy in at least five studies each. Error proneness, programming comprehension, and human effort are the most common forms of efficacy studied. Experimenting with programmer participants is the most popular method. <em>Conclusions</em>: There clearly are language design decisions for which empirical evidence regarding efficacy exists; they may be of some use to language designers, and several of them may be ripe for systematic reviewing. There is concern that the lack of interest generated by studies in this topic area until the recent surge of activity may indicate serious issues in their research approach.</p>
<p>Keywords: programming languages, programming language design, evidence-based paradigm, efficacy, research methods, systematic mapping study, thematic synthesis</p></div>






<p class="date">
<a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1631">by Antti-Juhani Kaijanaho at August 29, 2014 08:45 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 28, 2014</h2>

<div class="channelgroup">







<h3><a href="http://functionaljobs.com/" title="Functional Jobs: Search 'haskell'">Functional Jobs</a></h3>

<div class="entrygroup" id="urn:uuid:c0f854cc-bcb9-3835-aef7-ce3092f7f77c">
<blockquote>
<h1 class="entry"><a href="http://functionaljobs.com/jobs/8737-senior-software-engineer-functional-at-mcgraw-hill-education">Senior Software Engineer (Functional) at McGraw-Hill Education (Full-time)</a></h1>
<div class="entry">
<p>This Senior Software Engineer position is with the new LearnSmart team at McGraw-Hill Education's new and growing Research &amp; Development center in Boston's Innovation District.  We make software that helps college students study smarter, earn better grades, and retain more knowledge.</p>

<p>The LearnSmart adaptive engine powers the products in our LearnSmart Advantage suite — LearnSmart, SmartBook, LearnSmart Achieve, LearnSmart Prep, and LearnSmart Labs. These products provide a personalized learning path that continuously adapts course content based on a student’s current knowledge and confidence level.</p>

<p>On our team, you'll get to:</p>

<ul>
<li>Move textbooks and learning into the digital era</li>
<li>Create software used by millions of students</li>
<li>Advance the state of the art in adaptive learning technology</li>
<li>Make a real difference in education</li>
</ul>

<p>Our team's products are built with Flow, a functional language in the ML family. Flow lets us write code once and deliver it to students on multiple platforms and device types. Other languages in our development ecosystem include especially JavaScript, but also C++, SWF (Flash), and Haxe.</p>

<p>If you're interested in functional languages like Scala, Swift, Erlang, Clojure, F#, Lisp, Haskell, and OCaml, then you'll enjoy learning Flow. We don't require that you have previous experience with functional programming, only enthusiasm for learning it. But if you do have some experience with functional languages, so much the better! (On-the-job experience is best, but coursework, personal projects, and open-source contributions count too.)</p>

<p>We require only that you:</p>

<ul>
<li>Have a solid grasp of CS fundamentals (languages, algorithms, and data structures)</li>
<li>Be comfortable moving between multiple programming languages</li>
<li>Be comfortable with modern software practices: version control (Git), test-driven development, continuous integration, Agile</li>
</ul>
<p>Get information on <a href="http://functionaljobs.com/jobs/8737-senior-software-engineer-functional-at-mcgraw-hill-education">how to apply</a> for this position.</p></div>






<p class="date">
<a href="http://functionaljobs.com/jobs/8737-senior-software-engineer-functional-at-mcgraw-hill-education">August 28, 2014 09:18 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://logicaltypes.blogspot.com/" title="Typed Logic">Douglas M. Auclair (geophf)</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-4650294074444534066.post-5884968863288884710">
<blockquote>
<h1 class="entry"><a href="http://logicaltypes.blogspot.com/2014/08/dylan-harsh-realities-of-market.html">Dylan: the harsh realities of the market</a></h1>
<div class="entry">
So, this is a little case study.<br /><br />I did everything for Dylan. And when I say everything, I mean <i>everything</i>.  Here's my resumé:<br /><br /><br /><ul><li>I got excited about Dylan as a user, and I used it. I bought an old Mac that I don't ever remember the designation for, it's so '90's old, and got the floppies for the Dylan IDE from Apple research.</li></ul><div>I'm not joking.</div><div><br /></div><div><ul><li>I integrated Dylan into my work at work, building an XML parser then open-sourcing it to the community under the (then) non-restrictive license. I think mine was the only XML parser that was industrial-strength for Dylan. Can't claim originality: I ported over the Common-LISP one, but it was a lot of (fun) work.</li><li>I made improvements to the gwydion-dylan compiler, including some library documentation (you can see my name right there, right in the compiler code), including some library functionality, did I work on the compiler itself? The Dylan syntax extensions or type system? I don't recall; if not in those places, I know I've looked at those guts: I had my fingers all over parts of the compiler.</li></ul><div>I was in the Dylan compiler code. For you ll-types ('little language') that's no big deal.</div><div><br /></div><div>But ask a software developer in industry if they've ever been in their compiler code. I have, too: I've found bugs in Java Sun-compiler that I fixed locally and reported up the chain.</div><ul><li>I taught a course at our community college on Dylan. I had five students from our company that made satellite mission software.</li><li>I <i>effing</i> had commercial licenses bought when the boss asked me: what do we have to do to get this (my system) done/integrated into the build. I put my job on the line, for Dylan. ... The boss bought the licenses: he'd rather spend the $x than spending six weeks to back-port down to Java or C++.</li><li>I built a rule-based man-power scheduling system that had previously took three administrative assistants three days each quarter to generate. My system did it, and printed out a PDF in less than one second. I sold it, so that means I started a commercial company and sold my software.</li></ul><div>I sold commercial Dylan software. That I wrote. Myself. And sold. Because people bought it. Because it was that good.</div></div><div><br /></div><div>Hells yeah.</div><div><br /></div><div>Question: what more could I have done?</div><div><br /></div><div>I kept Dylan alive for awhile. In industry. For real.</div><div><br /></div><div>So why is Dylan dead?</div><div><br /></div><div>That's not the question.</div><div><br /></div><div>Or, that question is answered over and over and over again.</div><div><br /></div><div>Good languages, beautiful languages, right-thing languages languish and die all the time.</div><div><br /></div><div>Dylan was the right-thing, and they (Apple) killed it in the lab, and for a reason.</div><div><br /></div><div>Who is Dylan for?</div><div><br /></div><div>That's not the question either. Because you get vague, general, useless answers.</div><div><br /></div><div>The question is to ask it like Paul Graham answered it for LISP.</div><div><br /></div><div>Lisp is a pointless, useless, weird language that nobody uses.</div><div><br /></div><div>But Paul and his partner didn't care. They didn't give a ...</div><div><br /></div><div>Something.</div><div><br /></div><div>... what anybody else thought. They knew that this language, the language they loved, was built and designed and made for them. <i>Just</i> them and <i>only</i> them, because the only other people who were using it were college kids on comp.lang.lisp asking for the answers for problem-set 3 on last night's homework.</div><div><br /></div><div>That's what Lisp was good for: nothing.</div><div>That's who Lisp was good for: nobody.</div><div><br /></div><div>Same <i>exact</i> scenario for Erlang. <i>Exactly </i>the same. Erlang was only good for Joe Armstrong and a couple of buddies/weirdos like him, you know: kooks, who believed that Erlang was the right-thing for what they were doing, because they were on a mission, see, and nothing nobody could say could stop them nor stand against them, and <i>all</i> who would rise up against them would fall.</div><div><br /></div><div><i>All.</i></div><div><i><br /></i></div><div>What made Lisp and Haskell and Erlang and Scala and Prolog (yes, Prolog, although you'll never hear that success story publicly, but $26M and three lives saved? Because of a Prolog system I wrote? And that's just one day in one month's report for data? I call that a success) work when nobody sane would say that these things would work?</div><div><br /></div><div>Well, it took a few crazy ones to say, no, not: <i>'say'</i> that it would work, but would <i>make</i> it work with their beloved programming language come hell or high water or, worse: indifferent silence, or ridicule, or pity from the rest of the world.</div><div><br /></div><div>That is the lesson of perl and python and all these other languages. They're not good for anything. They suck. And they suck in libraries and syntax and semantics and weirdness-factor and everything.</div><div><br /></div><div>But two, not one, but at least two people loved that language enough to risk everything, and ...</div><div><br /></div><div>They lost.</div><div><br /></div><div>Wait. What?</div><div><br /></div><div>Did you think I was going to paint the rosy picture and lie to you and say 'they won'?</div><div><br /></div><div>Because they didn't.</div><div><br /></div><div>Who uses Lisp commercially? Or Haskell, except some fringers, or Scala or Clojure or Erlang or Smalltalk or Prolog</div><div><br /></div><div>... or Dylan.</div><div><br /></div><div>These languages are defined, right there in the dictionary.</div><div><br /></div><div>Erlang: see 'career wrecker.'</div><div><br /></div><div>Nobody uses those languages nor admits to even touching them with a 10-foot (3-meter) pole. I had an intern from college. 'Yeah, we studied this weird language called ML in Comp.sci. Nobody uses it.'</div><div><br /></div><div>She was blown away when I started singing ML's praises and what it can do.</div><div><br /></div><div>A meta-language, and she called it useless? Seriously?</div><div><br /></div><div>Because that's what the mainstream sees.</div><div><br /></div><div>Newsflash. I'm sorry. Dylan, Haskell, Idris: these aren't main-stream, and they never will be.</div><div><br /></div><div>Algebraic types? Dependent types? You'll never see them. They're too ... research-y. They stink of academe, which is: they stink of uselessness-to-industry. You'll be dead and buried to see them in this form, even after they discover the eternity elixir. Sorry.</div><div><br /></div><div>Or you'll see them in Visual Basic as a new Type-class form that only a few Microserfs use because they happened to have written those extensions. Everybody else?</div><div><br /></div><div>Nah.</div><div><br /></div><div>Here's how Dylan will succeed, right now.</div><div><br /></div><div>Bruce and I will put our heads together, start a company, and we'll code something. Not for anybody else to use and to love and to cherish, just for us, only for us, and it will blow out the effing doors, and we'll be bought out for $40M because our real worth is $127M.</div><div><br /></div><div>And the first thing that Apple will do, after they bought us, is to show us the door, then convert the code into Java. Or Swift. Or Objective-C, or whatever.</div><div><br /></div><div>And that's how we'll win.</div><div><br /></div><div>Not the $40M. Not the lecture series on 'How to Make Functional Programming Work in Industry for Real' afterwards at FLoC and ICFP conferences with fan-bois and -girls wanting to talk to us afterwards and ask us how they can get a job doing functional programming.</div><div><br /></div><div>Not that.</div><div><br /></div><div>We'll win because we made something in Dylan, and it was real, and it worked, and it actually did something for enough people that we can now go to our graves knowing that we did something once with our lives (and we can do it again and again, too: there's no upper limit on the successes you're allowed to have, people) that meant something to some bodies. And we did that. With Dylan.</div><div><br /></div><div>Nyaah!</div><div><br /></div><div>I've done that several times already, by my counting: the Prolog project, the Dylan project, the Mercury project, and my writing.</div><div><br /></div><div>I'm ready to do that, again.</div><div><br /></div><div>Because, actually, fundamentally, doing something in this world and for it ... there's <i>nothing</i> like it.</div><div><br /></div><div>You write that research paper, and I come up to you, waving it in your face, demanding you implement your research because I <i>need</i> it to do my job in Industry?</div><div><br /></div><div>I've done that to three professors so far. Effing changed their world-view in that moment. "What?" they said, to a person, "somebody actually wants to use this?" The look of bemused surprise on their faces?<br /><br />It was sad, actually, because they <i>did</i> write something that somebody out there (moiself) needed, but they never knew that what they were doing meant something.<br /><br />And it did.</div><div><br /></div><div>Effing change your world-view. Your job? Your research? Your programming language?</div><div><br /></div><div>That's status quo, and that's good and necessary and dulce and de leche (or decorum, I forget which).</div><div><br /></div><div>But get up out of the level you're at, and do something with it so that that other person, slouched in their chair, sits up and takes notice, and a light comes over their face and they say, <i>'Ooh!</i> That does <i>that?</i> Wow!' and watch their world change, because of you and what you've done.</div><div><br /></div><div>Dylan is for nothing and for nobody.</div><div><br /></div><div>So is everything under the Sun, my friend.</div><div><br /></div><div>Put your hand to the plow, and with the sweat of your brow, <i>make</i> it yours for <i>this specific</i> thing.</div><div><br /></div><div>Regardless of the long hours, long months of unrewarded work, and regardless of the hecklers, naysayers, and concerned friends and parents, and regardless of the mountain of unpaid bills.</div><div><br /></div><div>You <i>make</i> it work, and you don't stop until it does.</div><div><br /></div><div>That's how I've won.</div><div><br /></div><div>Every time.</div></div>






<p class="date">
<a href="http://logicaltypes.blogspot.com/2014/08/dylan-harsh-realities-of-market.html">by geophf (noreply@blogger.com) at August 28, 2014 04:06 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.well-typed.com/blog/" title="Well-Typed Blog">Well-Typed.Com</a></h3>

<div class="entrygroup" id="http://www.well-typed.com/blog/97">
<blockquote>
<h1 class="entry"><a href="http://www.well-typed.com/blog/97">Dealing with Asynchronous Exceptions during Resource Acquisition</a></h1>
<div class="entry">
<h3 id="introduction">Introduction</h3>
<p>Consider the following code: we open a socket, compute with it, and finally close the socket again. The computation happens inside an exception handler (<code>try</code>), so even when an exception happens we still close the socket:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example1 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a 
example1 compute <span class="fu">=</span> <span class="kw">do</span> <span class="co">-- WRONG</span>
  s <span class="ot">&lt;-</span> openSocket 
  r <span class="ot">&lt;-</span> try <span class="fu">$</span> compute s
  closeSocket s
  <span class="kw">case</span> r <span class="kw">of</span>
    <span class="dt">Left</span> ex <span class="ot">-&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
    <span class="dt">Right</span> a <span class="ot">-&gt;</span> return a</code></pre>
<p>Although this code correctly deals with <em>synchronous</em> exceptions–exceptions that are the direct result of the execution of the program–it does not deal correctly with <em>asynchronous</em> exceptions–exceptions that are raised as the result of an external event, such as a signal from another thread. For example, in</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example2 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> (<span class="dt">Maybe</span> a)
example2 compute <span class="fu">=</span> timeout someTimeout <span class="fu">$</span> example1 compute</code></pre>
<p>it is possible that the timeout signal arrives after we have opened the socket but before we have installed the exception handler (or indeed, <em>after</em> we leave the scope of the exception handler but before we close the socket). In order to address this we have to control precisely where asynchronous exceptions can and cannot be delivered:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example3 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a
example3 compute <span class="fu">=</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    s <span class="ot">&lt;-</span> openSocket 
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> restore <span class="fu">$</span> compute s
    closeSocket s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span> ex <span class="ot">-&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> a <span class="ot">-&gt;</span> return a</code></pre>
<p>We <em>mask</em> asynchronous exceptions, and then <em>restore</em> them only inside the scope of the exception handler. This very common pattern is captured by the higher level combinator <code>bracket</code>, and we might rewrite the example as</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example4 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a
example4 <span class="fu">=</span> bracket openSocket closeSocket</code></pre>
<h3 id="allowing-asynchronous-exceptions-during-resource-acquisition">Allowing asynchronous exceptions during resource acquisition</h3>
<p>Suppose that we wanted to define a derived operation that opens a socket and performs some kind of handshake with the server on the other end:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">openHandshake ::</span> <span class="dt">IO</span> <span class="dt">Socket</span>
openHandshake <span class="fu">=</span> <span class="kw">do</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    s <span class="ot">&lt;-</span> openSocket
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> restore <span class="fu">$</span> handshake s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span>  ex <span class="ot">-&gt;</span> closeSocket s <span class="fu">&gt;&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> () <span class="ot">-&gt;</span> return s </code></pre>
<p>(These and the other examples can be defined in terms of <code>bracket</code> and similar, but we use <code>mask</code> directly so that it’s easier to see what is happening.) We might use <code>openHandshake</code> as follows:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example5 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a
example5 compute <span class="fu">=</span> <span class="kw">do</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    s <span class="ot">&lt;-</span> openHandshake 
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> restore <span class="fu">$</span> compute s
    closeSocket s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span> ex <span class="ot">-&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> a <span class="ot">-&gt;</span> return a</code></pre>
<p>There are no resource leaks in this code, but there is a different problem: we call <code>openHandshake</code> with asynchronous exceptions masked. Although <code>openHandshake</code> calls <code>restore</code> before doing the handshake, <code>restore</code> restores the masking state to that <em>of the enclosing context</em>. Hence the handshake with the server cannot be timed out. This may not be what we want–we may want to be able to interrupt <code>example5</code> with a timeout either during the handshake or during the argument computation.</p>
<p>Note that this is <strong>not</strong> a solution:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example6 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a 
example6 compute <span class="fu">=</span> <span class="kw">do</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    s <span class="ot">&lt;-</span> restore openHandshake <span class="co">-- WRONG</span>
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> restore <span class="fu">$</span> compute s
    closeSocket s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span> ex <span class="ot">-&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> a <span class="ot">-&gt;</span> return a</code></pre>
<p>Consider what might happen: if an asynchronous exception is raised after <code>openHandshake</code> returns the socket, but before we leave the scope of <code>restore</code>, the asynchronous exception will be raised and the socket will be leaked. Installing an exception handler does not help: since we don’t have a handle on the socket, we cannot release it.</p>
<h3 id="interruptible-operations">Interruptible operations</h3>
<p>Consider this definition from the standard libraries:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">withMVar ::</span> <span class="dt">MVar</span> a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">IO</span> b) <span class="ot">-&gt;</span> <span class="dt">IO</span> b
withMVar m io <span class="fu">=</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    a <span class="ot">&lt;-</span> takeMVar m
    b <span class="ot">&lt;-</span> restore (io a) <span class="ot">`onException`</span> putMVar m a
    putMVar m a
    return b</code></pre>
<p>This follows almost exactly the same pattern as the examples we have seen so far; we mask asynchronous exceptions, take the contents of the <code>MVar</code>, and then execute some operation <code>io</code> with the contents of the <code>MVar</code>, finally putting the contents of the <code>MVar</code> back when the computation completes or when an exception is raised.</p>
<p>An <code>MVar</code> acts as a lock, with <code>takeMVar</code> taking the role of acquiring the lock. This may, of course, take a long time if the lock is currently held by another thread. But we call <code>takeMVar</code> with asynchronous exceptions masked. Does this mean that the <code>takeMVar</code> cannot be timed out? No, it does not: <code>takeMVar</code> is a so-called <em>interruptible</em> operation. From the <a href="http://community.haskell.org/~simonmar/papers/async.pdf" title="Asynchronous Exceptions in Haskell">Asynchronous Exceptions in Haskell</a> paper:</p>
<blockquote>
Any operation which may need to wait indefinitely for a resource (e.g., <code>takeMVar</code>) may receive asynchronous exceptions even within an enclosing block, but only while the resource is unavailable. Such operations are termed <em>interruptible operations</em>. (..) <code>takeMVar</code> behaves atomatically when enclosed in <code>block</code>. The <code>takeMVar</code> may receive asynchronous exceptions right up until the point when it acquires the <code>MVar</code>, but not after.
</blockquote>

<p>(<code>block</code> has been replaced by <code>mask</code> since the publication of the paper, but the principle is the same.) Although the existence of interruptible operations makes understanding the semantics of <code>mask</code> harder, they are necessary: like in the previous section, wrapping <code>takeMVar</code> in <code>restore</code> is <em>not</em> safe. If we <em>really</em> want to mask asynchronous exceptions, even across interruptible operations, <code>Control.Exception</code> offers <a href="http://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Exception-Base.html#v:uninterruptibleMask"><code>uninterruptibleMask</code></a>.</p>
<h3 id="custom-interruptible-operations">Custom interruptible operations</h3>
<p>So an interruptible operation is one that can be interrupted by an asynchronous exception even when asynchronous exceptions are masked. Can we define our own interruptible operations? Yes, we can:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="co">-- | Open a socket and perform handshake with the server</span>
<span class="fu">--</span>
<span class="co">-- Note: this is an interruptible operation.</span>
<span class="ot">openHandshake' ::</span> <span class="dt">IO</span> <span class="dt">Socket</span>
openHandshake' <span class="fu">=</span> 
  mask_ <span class="fu">$</span> <span class="kw">do</span> 
    s <span class="ot">&lt;-</span> openSocket
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> unsafeUnmask <span class="fu">$</span> handshake s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span>  ex <span class="ot">-&gt;</span> closeSocket s <span class="fu">&gt;&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> () <span class="ot">-&gt;</span> return s </code></pre>
<p><code>unsafeUnmask</code> is defined in <code>GHC.IO</code>, and unmasks asynchronous exceptions, no matter what the enclosing context is. This is of course somewhat dangerous, because now calling <code>openHandshake'</code> inside a <code>mask</code> suddenly opens up the possibility of an asynchronous exception being raised; and the only way to know is to look at the implementation of <code>openHandshake'</code>, or its Haddock documentation. This is somewhat unsatisfactory, but exactly the same goes for <code>takeMVar</code> and any other interruptible operation, or any combinator that uses an interruptible operation under the hood. A sad state of affairs, perhaps, but one that we don’t currently have a better solution for.</p>
<p>Actually, using <code>unsafeUnmask</code> is a bit too crude. <code>Control.Exception</code> does not export it, but does export</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">allowInterrupt ::</span> <span class="dt">IO</span> ()
allowInterrupt <span class="fu">=</span> unsafeUnmask <span class="fu">$</span> return ()</code></pre>
<p>with documentation</p>
<blockquote>
<p>When invoked inside <code>mask</code>, this function allows a blocked asynchronous exception to be raised, if one exists. It is <strong>equivalent to performing an interruptible operation</strong>, but does not involve any actual blocking.</p>
When called outside <code>mask</code>, or inside <code>uninterruptibleMask</code>, this function has no effect.
</blockquote>

<p>(emphasis mine.) Sadly, <a href="https://ghc.haskell.org/trac/ghc/ticket/9516" title="unsafeUnmask unmasks even inside uninterruptibleMask">this documentation does not reflect the actual semantics</a>: <code>unsafeUnmask</code>, and as a consequence <code>allowInterrupt</code>, unmasks asynchronous exceptions no matter what the enclosing context is: even inside <code>uninterruptibleMask</code>. We can however define our own operator to do this:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">interruptible ::</span> <span class="dt">IO</span> a <span class="ot">-&gt;</span> <span class="dt">IO</span> a
interruptible act <span class="fu">=</span> <span class="kw">do</span>
  st <span class="ot">&lt;-</span> getMaskingState
  <span class="kw">case</span> st <span class="kw">of</span>
    <span class="dt">Unmasked</span>              <span class="ot">-&gt;</span> act
    <span class="dt">MaskedInterruptible</span>   <span class="ot">-&gt;</span> unsafeUnmask act
    <span class="dt">MaskedUninterruptible</span> <span class="ot">-&gt;</span> act </code></pre>
<p>where we call <code>unsafeUnmask</code> only if the enclosing context is <code>mask</code>, but not if it is <code>uninterruptibleMask</code> (TODO: What is the semantics when we nest these two?). We can use it as follows to define a better version of <code>openHandshake</code>:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="co">-- | Open a socket and perform handshake with the server</span>
<span class="fu">--</span>
<span class="co">-- Note: this is an interruptible operation.</span>
<span class="ot">openHandshake' ::</span> <span class="dt">IO</span> <span class="dt">Socket</span>
openHandshake' <span class="fu">=</span> 
  mask_ <span class="fu">$</span> <span class="kw">do</span> 
    s <span class="ot">&lt;-</span> openSocket
    r <span class="ot">&lt;-</span> try <span class="fu">$</span> interruptible <span class="fu">$</span> handshake s
    <span class="kw">case</span> r <span class="kw">of</span>
      <span class="dt">Left</span>  ex <span class="ot">-&gt;</span> closeSocket s <span class="fu">&gt;&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
      <span class="dt">Right</span> () <span class="ot">-&gt;</span> return s </code></pre>
<h3 id="resource-allocation-timeout">Resource allocation timeout</h3>
<p>If we wanted to timeout the allocation of the resource only, we might do</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example7 ::</span> (<span class="dt">Socket</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> a
example7 compute <span class="fu">=</span> <span class="kw">do</span>
  mask <span class="fu">$</span> \restore <span class="ot">-&gt;</span> <span class="kw">do</span>
    ms <span class="ot">&lt;-</span> timeout someTimeout <span class="fu">$</span> openHandshake'
    <span class="kw">case</span> ms <span class="kw">of</span>
      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> throwIO (userError <span class="st">"Server busy"</span>)
      <span class="dt">Just</span> s  <span class="ot">-&gt;</span> <span class="kw">do</span> r <span class="ot">&lt;-</span> try <span class="fu">$</span> restore <span class="fu">$</span> compute s
                    closeSocket s
                    <span class="kw">case</span> r <span class="kw">of</span>
                      <span class="dt">Left</span> ex <span class="ot">-&gt;</span> throwIO (<span class="ot">ex ::</span> <span class="dt">SomeException</span>)
                      <span class="dt">Right</span> a <span class="ot">-&gt;</span> return a</code></pre>
<p>Exceptions are masked when we enter the scope of the <code>timeout</code>, and are unmasked only once we are inside the exception handler in <code>openHandshake'</code>–in other words, if a timeout happens, we are guaranteed to clean up the socket. The surrounding <code>mask</code> is however necessary. For example, suppose we are writing some unit tests and we are testing <code>openHandshake'</code>. This is wrong:</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example8 ::</span> <span class="dt">IO</span> ()
example8 <span class="fu">=</span> <span class="kw">do</span> 
  ms <span class="ot">&lt;-</span> timeout someTimeout <span class="fu">$</span> openHandshake'
  <span class="kw">case</span> ms <span class="kw">of</span>
    <span class="dt">Just</span> s  <span class="ot">-&gt;</span> closeSocket s
    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> return ()</code></pre>
<p>Even if we are sure that the <code>example8</code> will not be interrupted by asynchronous exceptions, there is still a potential resource leak here: the timeout exception might be <em>raised</em> just after we leave the <code>mask_</code> scope from <code>openHandshake</code> but just <em>before</em> we leave the <code>timeout</code> scope. If we are sure we don’t need to worry about other asynchronous exceptions we can write</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example8 ::</span> <span class="dt">IO</span> ()
example8 <span class="fu">=</span> <span class="kw">do</span>
  s <span class="ot">&lt;-</span> mask_ <span class="fu">$</span> timeout someTimeout <span class="fu">$</span> openHandshake'
  <span class="kw">case</span> ms <span class="kw">of</span>
    <span class="dt">Just</span> s  <span class="ot">-&gt;</span> closeSocket s
    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> return ()</code></pre>
<p>although of course it might be better to simply write</p>
<pre class="sourceCode Haskell"><code class="sourceCode haskell"><span class="ot">example8 ::</span> <span class="dt">IO</span> ()
example8 <span class="fu">=</span> 
  bracket (timeout someTimeout <span class="fu">$</span> openHandshake')
          (\ms <span class="ot">-&gt;</span> <span class="kw">case</span> ms <span class="kw">of</span> <span class="dt">Just</span> s  <span class="ot">-&gt;</span> closeSocket s
                             <span class="dt">Nothing</span> <span class="ot">-&gt;</span> return ())
          (\_ <span class="ot">-&gt;</span> return ())</code></pre>
<h3 id="conclusions">Conclusions</h3>
<p>Making sure that resources are properly deallocated in the presence of asynchronous exceptions is difficult. It is very important to make sure that asynchronous exceptions are masked at crucial points; unmasking them at the point of calling a resource allocation function is not safe. If you nevertheless want to be able to timeout resource allocation, you need to make your resource allocation function interruptible.</p>
<p>For completeness’ sake, there are some other solutions that avoid the use of <code>unsafeUnmask</code>. One option is to thread the <code>restore</code> argument through (and compose multiple <code>restore</code> arguments if there are multiple nested calls to <code>mask</code>). This requires resource allocations to have a different signature, however, and it is very error prone: a single <code>mask</code> somewhere along the call chain where we forget to thread through the <code>restore</code> argument will mean the code is no longer interruptible. The other option is to run the code that we want to be interruptible in a separate thread, and wait for the thread to finish with, for example, a <code>takeMVar</code>. Getting this right is however no easy task, and it doesn’t change anything fundamentally anyway: rather than using <code>unsafeUnmask</code> we are now using a primitive interruptible operation; either way we introduce the possibility of exceptions even in the scope of <code>mask_</code>.</p>
<p>Finally, when your application does not fit the <code>bracket</code> pattern we have been using (implicitly or explicitly), you may want to have a look at <a href="http://hackage.haskell.org/package/resourcet" title="The resourcet package">resourcet</a> and <a href="http://hackage.haskell.org/package/pipes" title="The pipes package">pipes</a> or <a href="http://hackage.haskell.org/package/conduit" title="The conduit package">conduit</a>, or my talk <a href="https://skillsmatter.com/skillscasts/4230-lazy-io-and-alternatives-in-haskell" title="Lazy I/O and Alternatives in Haskell">Lazy I/O and Alternatives in Haskell</a>.</p></div>






<p class="date">
<a href="http://www.well-typed.com/blog/97">by edsko, duncan at August 28, 2014 03:48 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://mainisusuallyafunction.blogspot.com/" title="main is usually a function">Keegan McAllister</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-1563623855220143059.post-4580674045745301078">
<blockquote>
<h1 class="entry"><a href="http://mainisusuallyafunction.blogspot.com/2014/08/calling-rust-library-from-c-or-anything.html">Calling a Rust library from C (or anything else!)</a></h1>
<div class="entry">
<p>One reason I'm excited about <a href="http://www.rust-lang.org/">Rust</a> is that I can compile Rust code to a simple native-code library, without heavy runtime dependencies, and then call it from any language. Imagine writing performance-critical extensions for Python, Ruby, or Node in a safe, pleasant language that has <a href="http://doc.rust-lang.org/guide-lifetimes.html">static lifetime checking</a>, <a href="http://doc.rust-lang.org/tutorial.html#pattern-matching">pattern matching</a>, a <a href="http://doc.rust-lang.org/guide-macros.html">real macro system</a>, and other goodies like that. For this reason, when I started <a href="https://github.com/kmcallister/html5ever">html5ever</a> some six months ago, I wanted it to be more than another "Foo for BarLang" project. I want it to be <em>the</em> HTML parser of choice, for a wide variety of applications in any language.</p><p>Today I started work in earnest on the C API for html5ever. In only a few hours I had a working demo. And this is a fairly complicated library, with 5,000+ lines of code incorporating</p><ul class="incremental"><li>most of the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html">hilariously complicated parsing rules</a> in the HTML spec,</li><li>a <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/macros/src/match_token.rs">Rust syntax extension</a> for writing parse rules in a concise form that matches the spec,</li><li>compile-time <a href="https://github.com/sfackler/rust-phf">perfect hash maps</a> for string interning and named characters, and</li><li>lots and lots of generic code — if this library were written in C++, almost all of it would be in header files.</li></ul><p>It's pretty cool that we can use all this machinery from C, or any language that can call C. I'll describe first how to build and use the library, and then I'll talk about the implementation of the C API.</p><p>html5ever (for C or for Rust) is not finished yet, but if you're feeling adventurous, you are welcome to try it out! And I'd love to have more contributors. Let me know <a href="https://github.com/kmcallister/html5ever/issues">on GitHub</a> about any issues you run into.</p><h1 id="using-html5ever-from-c">Using html5ever from C</h1><p>Like most Rust libraries, html5ever builds with <a href="http://crates.io/">Cargo</a>.</p><pre><code>$ git clone https://github.com/kmcallister/html5ever<br />$ cd html5ever<br />$ git checkout dev<br />$ cargo build<br />    Updating git repository `https://github.com/sfackler/rust-phf`<br />   Compiling phf_mac v0.0.0 (https://github.com/sfackler/rust-phf#f21e2a41)<br />   Compiling html5ever-macros v0.0.0 (file:///tmp/html5ever)<br />   Compiling phf v0.0.0 (https://github.com/sfackler/rust-phf#f21e2a41)<br />   Compiling html5ever v0.0.0 (file:///tmp/html5ever)</code></pre><p>The C API isn't Cargo-ified yet, so we'll build it using the older Makefile-based system.</p><pre><code>$ mkdir build<br />$ cd build<br />$ ../configure<br />$ make libhtml5ever_for_c.a<br />rustc -D warnings -C rpath -L /tmp/html5ever/target -L /tmp/html5ever/target/deps \<br />  -o libhtml5ever_for_c.a --cfg for_c --crate-type staticlib /tmp/html5ever/src/lib.rs<br />warning: link against the following native artifacts when linking against this static library<br />note: the order and any duplication can be significant on some platforms, and so may need to be preserved<br />note: library: rt<br />note: library: dl<br />note: library: pthread<br />note: library: gcc_s<br />note: library: pthread<br />note: library: c<br />note: library: m</code></pre><p>Now we can build an <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/examples/capi/tokenize.c">example C program</a> using that library, and following the link instructions produced by <code>rustc</code>.</p><pre><code>$ H5E_PATH=/tmp/html5ever<br />$ gcc -Wall -o tokenize tokenize.c -I $H5E_PATH/capi -L $H5E_PATH/build \<br />  -lhtml5ever_for_c -lrt -ldl -lpthread -lgcc_s -lpthread -lc -lm<br /><br />$ ./tokenize 'Hello&amp;comma; &lt;i class=excellent&gt;world!&lt;/i&gt;'<br />CHARS : Hello<br />CHARS : ,<br />CHARS :  <br />TAG   : &lt;i&gt;<br />  ATTR: class="excellent"<br />CHARS : world!<br />TAG   : &lt;/i&gt;</code></pre><p>The build process is pretty standard for C; we just link a <code>.a</code> file and its dependencies. The biggest obstacle right now is that you won't find the Rust compiler in your distro's package manager, because the language is still changing so rapidly. But there's a ton of effort going into stabilizing the language for a Rust 1.0 release this year. It won't be too long before <code>rustc</code> is a reasonable build dependency.</p><p>Let's look at the C client code.</p><pre class="sourceCode c"><code class="sourceCode c"><span class="ot">#include &lt;stdio.h&gt;</span><br /><br /><span class="ot">#include "html5ever.h"</span><br /><br /><span class="dt">void</span> put_str(<span class="dt">const</span> <span class="dt">char</span> *x) {<br />    fputs(x, stdout);<br />}<br /><br /><span class="dt">void</span> put_buf(<span class="kw">struct</span> h5e_buf text) {<br />    fwrite(text.data, text.len, <span class="dv">1</span>, stdout);<br />}<br /><br /><span class="dt">void</span> do_start_tag(<span class="dt">void</span> *user, <span class="kw">struct</span> h5e_buf name, <span class="dt">int</span> self_closing, size_t num_attrs) {<br />    put_str(<span class="st">"TAG   : &lt;"</span>);<br />    put_buf(name);<br />    <span class="kw">if</span> (self_closing) {<br />        putchar('/');<br />    }<br />    put_str(<span class="st">"&gt;</span><span class="ch">\n</span><span class="st">"</span>);<br />}<br /><br /><span class="co">// ...</span><br /><br /><span class="kw">struct</span> h5e_token_ops ops = {<br />    .do_chars = do_chars,<br />    .do_start_tag = do_start_tag,<br />    .do_tag_attr = do_tag_attr,<br />    .do_end_tag = do_end_tag,<br />};<br /><br /><span class="kw">struct</span> h5e_token_sink sink = {<br />    .ops = &amp;ops,<br />    .user = NULL,<br />};<br /><br /><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[]) {<br />    <span class="kw">if</span> (argc &lt; <span class="dv">2</span>) {<br />        printf(<span class="st">"Usage: %s 'HTML fragment'</span><span class="ch">\n</span><span class="st">"</span>, argv[<span class="dv">0</span>]);<br />        <span class="kw">return</span> <span class="dv">1</span>;<br />    }<br /><br />    <span class="kw">struct</span> h5e_tokenizer *tok = h5e_tokenizer_new(&amp;sink);<br />    h5e_tokenizer_feed(tok, h5e_buf_from_cstr(argv[<span class="dv">1</span>]));<br />    h5e_tokenizer_end(tok);<br />    h5e_tokenizer_free(tok);<br />    <span class="kw">return</span> <span class="dv">0</span>;<br />}</code></pre><p>The <code>struct h5e_token_ops</code> contains pointers to callbacks. Any events we don't care to handle are left as NULL function pointers. Inside <code>main</code>, we create a tokenizer and feed it a string. html5ever for C uses a simple pointer+length representation of buffers, which is this <code>struct h5e_buf</code> you see being passed by value.</p><p>This demo only does tokenization, not tree construction. html5ever can perform both phases of parsing, but the API surface for tree construction is much larger and I didn't get around to writing C bindings yet.</p><h1 id="implementing-the-c-api">Implementing the C API</h1><p>Some parts of Rust's <a href="http://doc.rust-lang.org/std/index.html"><code>libstd</code></a> depend on runtime services, such as task-local data, that a C program may not have initialized. So the <a href="https://github.com/kmcallister/html5ever/commit/222affd0caa132eabb1f14f47b489c161f968b42">first step</a> in building a C API was to eliminate all <code>std::</code> imports. This isn't nearly as bad as it sounds, because large parts of <code>libstd</code> are just re-exports from other libraries like <a href="http://doc.rust-lang.org/core/index.html"><code>libcore</code></a> that we can use with no trouble. To be fair, I did write html5ever with the goal of a C API in mind, and I avoided features like threading that would be difficult to integrate. So your library might give you more trouble, depending on which Rust features you use.</p><p>The <a href="https://github.com/kmcallister/html5ever/commit/c30deff17923294c39890986099e3ead64be29e3">next step</a> was to add the <code>#![no_std]</code> crate attribute. This means we no longer import <a href="http://doc.rust-lang.org/std/prelude/index.html">the standard prelude</a> into every module. To compensate, I added <code>use core::prelude::*;</code> to most of my modules. This brings in <a href="http://doc.rust-lang.org/core/prelude/index.html">the parts of the prelude</a> that can be used without runtime system support. I also added many imports for ubiquitous types like <code>String</code> and <code>Vec</code>, which come from <code>libcollections</code>.</p><p>After that I had to <a href="https://github.com/kmcallister/html5ever/commit/89f2f45af0425271d4c79a73f00fd42eca00dad8">get rid of the last references to <code>libstd</code></a>. The biggest obstacle here involved macros and <a href="http://doc.rust-lang.org/tutorial.html#deriving-implementations-for-traits"><code>deriving</code></a>, which would produce references to names under <code>std::</code>. To work around this, I create <a href="https://github.com/kmcallister/html5ever/blob/89f2f45af0425271d4c79a73f00fd42eca00dad8/src/lib.rs#L87-L93">a fake little <code>mod std</code></a> which re-exports the necessary parts of <code>core</code> and <code>collections</code>. This is similar to <a href="https://github.com/rust-lang/rust/blob/0d3bd7720c50e3ada4bac77331d43926493be4fe/src/libstd/lib.rs#L273-L277"><code>libstd</code>'s "curious inner-module"</a>.</p><p>I also had to remove all uses of <code>format!()</code>, <code>println!()</code>, etc., or move them inside <code>#[cfg(not(for_c))]</code>. I needed to <a href="https://github.com/kmcallister/html5ever/blob/89f2f45af0425271d4c79a73f00fd42eca00dad8/src/macros.rs#L59-L69">copy in the <code>vec!()</code> macro</a> which is only provided by <code>libstd</code>, even though the <code>Vec</code> type is provided by <code>libcollections</code>. And I had to omit debug log messages when building for C; I did this with <a href="https://github.com/kmcallister/html5ever/blob/89f2f45af0425271d4c79a73f00fd42eca00dad8/src/macros.rs#L71-L90">conditionally-defined macros</a>.</p><p>With all this preliminary work done, it was time to write <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/src/for_c/tokenizer.rs">the C bindings</a>. Here's how the struct of function pointers looks on the Rust side:</p><pre class="rust"><code>#[repr(C)]<br />pub struct h5e_token_ops {<br />    do_start_tag: extern "C" fn(user: *mut c_void, name: h5e_buf,<br />        self_closing: c_int, num_attrs: size_t),<br />    <br />    do_tag_attr: extern "C" fn(user: *mut c_void, name: h5e_buf,<br />        value: h5e_buf),<br /><br />    do_end_tag:  extern "C" fn(user: *mut c_void, name: h5e_buf),<br /><br />    // ...<br />}</code></pre><p>The <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/src/for_c/tokenizer.rs#L49-L111">processing of tokens</a> is straightforward. We pattern-match and then call the appropriate function pointer, <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/src/for_c/tokenizer.rs#L53">unless</a> that pointer is NULL. (<b>Edit:</b> eddyb points out that storing NULL as an <code>extern "C" fn</code> is undefined behavior. Better to use <code>Option&lt;extern "C" fn ...&gt;</code>, which will optimize to the same one-word representation.) </p><p>To <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/src/for_c/tokenizer.rs#L115-L122">create a tokenizer</a>, we heap-allocate the Rust data structure in a <a href="http://doc.rust-lang.org/alloc/boxed/index.html"><code>Box</code></a>, and then <a href="http://doc.rust-lang.org/core/intrinsics/ffi.transmute.html">transmute</a> that to a raw C pointer. When the C client calls <code>h5e_tokenizer_free</code>, we transmute this pointer back to a box and <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/src/for_c/tokenizer.rs#L126">drop it</a>, which will invoke destructors and finally free the memory.</p><p>You'll note that the functions exported to C have several special annotations:</p><ul class="incremental"><li><code>#[no_mangle]</code>: skip <a href="http://en.wikipedia.org/wiki/Name_mangling">name mangling</a>, so we end up with a linker symbol named <code>h5e_tokenizer_free</code> instead of <code>_ZN5for_c9tokenizer18h5e_tokenizer_free</code>.</li><li><code>unsafe</code>: don't let Rust code call these functions unless it <a href="http://doc.rust-lang.org/rust.html#unsafe-blocks">promises to be careful</a>.</li><li><code>extern "C"</code>: make sure the exported function has a C-compatible <a href="http://en.wikipedia.org/wiki/Application_binary_interface">ABI</a>. The data structures similarly get a <code>#[repr(C)]</code> attribute.</li></ul><p>Then I wrote a <a href="https://github.com/kmcallister/html5ever/blob/cb98c0cb700835f7473a9fc09a7ee9564ef3c73e/capi/html5ever.h">C header file</a> matching this ABI:</p><pre class="sourceCode c"><code class="sourceCode c"><span class="kw">struct</span> h5e_buf {<br />    <span class="dt">unsigned</span> <span class="dt">char</span> *data;<br />    size_t len;<br />};<br /><br /><span class="kw">struct</span> h5e_buf h5e_buf_from_cstr(<span class="dt">const</span> <span class="dt">char</span> *str);<br /><br /><span class="kw">struct</span> h5e_token_ops {<br />    <span class="dt">void</span> (*do_start_tag)(<span class="dt">void</span> *user, <span class="kw">struct</span> h5e_buf name,<br />        <span class="dt">int</span> self_closing, size_t num_attrs);<br /><br />    <span class="dt">void</span> (*do_tag_attr)(<span class="dt">void</span> *user, <span class="kw">struct</span> h5e_buf name,<br />        <span class="kw">struct</span> h5e_buf value);<br /><br />    <span class="dt">void</span> (*do_end_tag)(<span class="dt">void</span> *user, <span class="kw">struct</span> h5e_buf name);<br /><br />    <span class="co">///</span> ...<br />};<br /><br /><span class="kw">struct</span> h5e_tokenizer;<br /><br /><span class="kw">struct</span> h5e_tokenizer *h5e_tokenizer_new(<span class="kw">struct</span> h5e_token_sink *sink);<br /><span class="dt">void</span> h5e_tokenizer_free(<span class="kw">struct</span> h5e_tokenizer *tok);<br /><span class="dt">void</span> h5e_tokenizer_feed(<span class="kw">struct</span> h5e_tokenizer *tok, <span class="kw">struct</span> h5e_buf buf);<br /><span class="dt">void</span> h5e_tokenizer_end(<span class="kw">struct</span> h5e_tokenizer *tok);</code></pre><p>One remaining issue is that Rust is hard-wired to use <a href="http://www.canonware.com/jemalloc/">jemalloc</a>, so linking html5ever will bring that in alongside the system's libc malloc. Having two separate malloc heaps will likely increase memory consumption, and it prevents us from doing fun things like allocating <code>Box</code>es in Rust that can be used and freed in C. Before Rust can really be a great choice for writing C libraries, we need a better solution for integrating the allocators.</p><p>If you'd like to talk about calling Rust from C, you can find me as <code>kmc</code> in <code>#rust</code> and <code>#rust-internals</code> on <code>irc.mozilla.org</code>. And if you run into any issues with html5ever, do let me know, preferably by <a href="https://github.com/kmcallister/html5ever/issues">opening an issue on GitHub</a>. Happy hacking!</p></div>






<p class="date">
<a href="http://mainisusuallyafunction.blogspot.com/2014/08/calling-rust-library-from-c-or-anything.html">by keegan (noreply@blogger.com) at August 28, 2014 06:18 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 27, 2014</h2>

<div class="channelgroup">







<h3><a href="http://moreindirection.blogspot.com/" title="more indirection">Bill Atkins</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-5428232882395758357.post-2533242441674101546">
<blockquote>
<h1 class="entry"><a href="http://moreindirection.blogspot.com/2014/08/nsnotificationcenter-swift-and-blocks.html">NSNotificationCenter, Swift and blocks</a></h1>
<div class="entry">
The conventional way to register observers with <span style="font-family: Courier New, Courier, monospace;">NSNotificationCenter</span> is to use the <a href="https://developer.apple.com/library/ios/documentation/general/conceptual/CocoaEncyclopedia/Target-Action/Target-Action.html" target="_blank">target-action pattern</a>. While this gets the job done, it's inherently not type-safe.<br /><br />For example, the following Swift snippet will compile perfectly:<br /><br /><div style="font-family: Menlo; font-size: 11px;">    NSNotificationCenter.defaultCenter().addObserver(<span style="color: #35568a;">self</span>, selector: Selector(<span style="color: #e82300;">"itemAdded:"</span>),</div><div style="font-family: Menlo; font-size: 11px;">      name: MyNotificationItemAdded, object: <span style="color: #35568a;">nil</span>)</div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: inherit;">even though at runtime it will fail unless </span><span style="font-family: Courier New, Courier, monospace;">self</span><span style="font-family: inherit;"> has a method named </span><span style="font-family: Courier New, Courier, monospace;">itemAdded </span><span style="font-family: inherit;">that takes exactly one parameter (leaving off that last colon in the selector will turn this line into a no-op). Plus, this method gives you no way to take advantages of Swift's closures, which would allow the observer to access local variables in the method that adds the observer and would eliminate the need to create a dedicated method to handle the event.</span></div><div><span style="font-family: inherit;"><br /></span></div><div>A better way to do this is to use blocks. And <span style="font-family: Courier New, Courier, monospace;">NSNotificationCenter</span><span style="font-family: inherit;"> does include a block-based API:</span></div><div><span style="font-family: inherit;"><br /></span></div><div><div style="font-family: Menlo; font-size: 11px;">    NSNotificationCenter.defaultCenter().addObserverForName(MyNotificationItemAdded, object: <span style="color: #35568a;">nil</span>, queue: <span style="color: #35568a;">nil</span>) { note <span style="color: #35568a;">in</span></div><div style="color: #cf8724; font-family: Menlo; font-size: 11px;"><span style="color: black;">      </span>// ...</div><div style="font-family: Menlo; font-size: 11px;">    }</div></div><div><br /></div><div>This is much nicer, especially with Swift's trailing closure syntax. There are no method names to be looked up at runtime, we can refer to local variables in the method that registered the observer and we can perform small bits of logic in reaction to events without having to create and name dedicated methods.</div><div><br /></div><div>The catch comes in resource management. It's very important that an object remove its event observers when it's deallocated, or else <span style="font-family: Courier New, Courier, monospace;">NSNotificationCenter</span> will try to invoke methods on invalid pointers.</div><div><br /></div><div>The traditional target-action method has the one advantage that we can easily handle this requirement with a single call in <span style="font-family: Courier New, Courier, monospace;">deinit</span>:</div><div><div style="color: #35568a; font-family: Menlo; font-size: 11px;"><span style="color: black;"><br /></span><span style="color: black;">  </span>deinit<span style="color: black;"> {</span></div><div style="font-family: Menlo; font-size: 11px;">    NSNotificationCenter.defaultCenter().removeObserver(<span style="color: #35568a;">self</span>)</div><div style="font-family: Menlo; font-size: 11px;">  }</div></div><div><br /></div><div>With the block API, however, since there is no explicit <span style="font-family: Courier New, Courier, monospace;">target</span> object, each call to <span style="font-family: Courier New, Courier, monospace;">addObserverForName</span><span style="font-family: inherit;"> returns "an opaque object to act as observer." So your observer class would need to track all of these objects and then remove them all from the notification center in </span><span style="font-family: Courier New, Courier, monospace;">deinit</span><span style="font-family: inherit;">, which is a pain.</span></div><div><span style="font-family: inherit;"><br /></span></div><div><span style="font-family: inherit;">In fact, the hassle of having to do bookkeeping on the observer objects almost cancels out the convenience of using </span>the<span style="font-family: inherit;"> block API. Frustrated </span>by this situation, I sat down and created a simple helper class, <span style="font-family: Courier New, Courier, monospace;">NotificationManager</span>:</div><div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;"><span style="color: #35568a;">class</span> NotificationManager {</div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">private</span> <span style="color: #35568a;">var</span> observerTokens: [<span style="color: #c35900;">AnyObject</span>] = []</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="color: #35568a; font-family: Menlo; font-size: 11px;"><span style="color: black;">  </span>deinit<span style="color: black;"> {</span></div><div style="font-family: Menlo; font-size: 11px;">    deregisterAll()</div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">func</span> deregisterAll() {</div><div style="font-family: Menlo; font-size: 11px;">    <span style="color: #35568a;">for</span> token <span style="color: #35568a;">in</span> observerTokens {</div><div style="font-family: Menlo; font-size: 11px;">      NSNotificationCenter.defaultCenter().removeObserver(token)</div><div style="font-family: Menlo; font-size: 11px;">    }</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;">    observerTokens = []</div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">func</span> registerObserver(name: <span style="color: #c35900;">String</span>!, block: (<span style="color: #c35900;">NSNotification</span>! -&gt; ()?)) {</div><div style="font-family: Menlo; font-size: 11px;">    <span style="color: #35568a;">let</span> newToken = NSNotificationCenter.defaultCenter().addObserverForName(name, object: <span style="color: #35568a;">nil</span>, queue: <span style="color: #35568a;">nil</span>) {note <span style="color: #35568a;">in</span></div><div style="font-family: Menlo; font-size: 11px;">      block(note)</div><div style="font-family: Menlo; font-size: 11px;">      ()</div><div style="font-family: Menlo; font-size: 11px;">    }</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;">    observerTokens.append(newToken)</div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;">  </div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">func</span> registerObserver(name: <span style="color: #c35900;">String</span>!, forObject object: <span style="color: #c35900;">AnyObject</span>!, block: (<span style="color: #c35900;">NSNotification</span>! -&gt; ()?)) {</div><div style="font-family: Menlo; font-size: 11px;">    <span style="color: #35568a;">let</span> newToken = NSNotificationCenter.defaultCenter().addObserverForName(name, object: object, queue: <span style="color: #35568a;">nil</span>) {note <span style="color: #35568a;">in</span></div><div style="font-family: Menlo; font-size: 11px;">      block(note)</div><div style="font-family: Menlo; font-size: 11px;">      ()</div><div style="font-family: Menlo; font-size: 11px;">    }</div><div style="font-family: Menlo; font-size: 11px;">    </div><div style="font-family: Menlo; font-size: 11px;">    observerTokens.append(newToken)</div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;"></div><div style="font-family: Menlo; font-size: 11px;">}</div><div style="font-family: Menlo; font-size: 11px;"><br /></div>First, this simple class provides a Swift-specialized API around <span style="font-family: Courier New, Courier, monospace;">NSNotificationCenter</span><span style="font-family: inherit;">.  It provides an additional convenience method without an </span><span style="font-family: Courier New, Courier, monospace;">object</span><span style="font-family: inherit;"> parameter (rarely used, in my experience) to make it easier to use trailing-closure syntax. But most importantly, it keeps track of the observer objects generated when observers are registered, and removes them when the object is deinit'd.</span><br /><span style="font-family: inherit;"><br /></span>A client of this class can simply keep a member variable of type <span style="font-family: Courier New, Courier, monospace;">NotificationManager</span><span style="font-family: inherit;"> and use it to register its observers. When the parent class is deallocated, the </span><span style="font-family: Courier New, Courier, monospace;">deinit</span><span style="font-family: inherit;"> method will automatically be called on its </span><span style="font-family: Courier New, Courier, monospace;">NotificationManager</span><span style="font-family: inherit;"> member variable, and its observers will be properly </span>disposed<span style="font-family: inherit;"> of:</span><br /><div style="font-family: Menlo; font-size: 11px;"><span style="color: #35568a;"><br /></span><span style="color: #35568a;">class</span> MyController: <span style="color: #c35900;">UIViewController</span> {</div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">private</span> <span style="color: #35568a;">let</span> notificationManager = NotificationManager()</div><div style="font-family: Menlo; font-size: 11px;">  </div><div style="color: #35568a; font-family: Menlo; font-size: 11px;"><span style="color: black;">  </span>override<span style="color: black;"> </span>init<span style="color: black;">() {</span></div><div style="font-family: Menlo; font-size: 11px;">    notificationManager.registerObserver(MyNotificationItemAdded) { note <span style="color: #35568a;">in</span></div><div style="font-family: Menlo; font-size: 11px;">      println(<span style="color: #e82300;">"item added!"</span>)</div><div style="font-family: Menlo; font-size: 11px;">    }</div><div style="font-family: Menlo; font-size: 11px;">    </div><div style="color: #35568a; font-family: Menlo; font-size: 11px;"><span style="color: black;">    </span>super<span style="color: black;">.</span>init<span style="color: black;">()</span></div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;">  </div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">required</span> <span style="color: #35568a;">init</span>(coder: <span style="color: #c35900;">NSCoder</span>) {</div><div style="color: #e82300; font-family: Menlo; font-size: 11px;"><span style="color: black;">    fatalError(</span>"decoding not implemented"<span style="color: black;">)</span></div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;">}</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div><span style="font-family: Times, Times New Roman, serif; font-size: small;">When the MyController instance is deallocated, its NotificationManager member variable will be automatically deallocated, triggering the call to deregisterAll that will remove the dead objects from NSNotificationCenter.</span></div><div style="font-size: 11px;"><span style="font-size: small;"><br /></span></div>In my apps, I add a notificationManager instance to my common <span style="font-family: Courier New, Courier, monospace;">UIViewController</span> base class so I don't have to explicitly declare the member variable in all of my controller subclasses.<br /><br />Another benefit of using my own wrapper around NSNotificationCenter is that I can add useful functionality, like group observers: an observer that's triggered when any one of a group of notifications are posted:<br /><br /><div style="font-family: Menlo; font-size: 11px;"><span style="color: #35568a;">struct</span> NotificationGroup {</div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">let</span> entries: [<span style="color: #c35900;">String</span>]</div><div style="font-family: Menlo; font-size: 11px;">  </div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">init</span>(<span style="color: #35568a;">_</span> newEntries: <span style="color: #c35900;">String</span>...) {</div><div style="font-family: Menlo; font-size: 11px;">    entries = newEntries</div><div style="font-family: Menlo; font-size: 11px;">  }</div><br /><div style="font-family: Menlo; font-size: 11px;">}</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;"><span style="color: #35568a;">extension</span> NotificationManager {</div><div style="font-family: Menlo; font-size: 11px;">  <span style="color: #35568a;">func</span> registerGroupObserver(group: <span style="color: #c35900;">NotificationGroup</span>, block: (<span style="color: #c35900;">NSNotification</span>! -&gt; ()?)) {</div><div style="font-family: Menlo; font-size: 11px;">    <span style="color: #35568a;">for</span> name <span style="color: #35568a;">in</span> group.entries {</div><div style="font-family: Menlo; font-size: 11px;">      registerObserver(name, block: block)</div><div style="font-family: Menlo; font-size: 11px;">    }</div><div style="font-family: Menlo; font-size: 11px;">  }</div><div style="font-family: Menlo; font-size: 11px;"></div><div style="font-family: Menlo; font-size: 11px;">}</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-size: 11px;"><span style="font-size: small;">This can be a great way to easily set up an event handler to run when, for example, an item is changed in any way at all:</span></div><div style="font-size: 11px;"><span style="font-size: small;"><br /></span></div><div style="font-family: Menlo; font-size: 11px;">   <span style="color: #35568a;">let</span> MyNotificationItemsChanged = NotificationGroup(</div><div style="font-family: Menlo; font-size: 11px;">      MyNotificationItemAdded,</div><div style="font-family: Menlo; font-size: 11px;">      MyNotificationItemDeleted,</div><div style="font-family: Menlo; font-size: 11px;">      MyNotificationItemMoved,</div><div style="font-family: Menlo; font-size: 11px;">      MyNotificationItemEdited</div><div style="font-family: Menlo; font-size: 11px;"></div><div style="font-family: Menlo; font-size: 11px;">    )</div><div style="font-family: Menlo; font-size: 11px;"><br /></div><div style="font-family: Menlo; font-size: 11px;">    notificationManager.registerGroupObserver(MyNotificationItemsChanged) { note <span style="color: #35568a;">in</span></div><div style="color: #cf8724; font-family: Menlo; font-size: 11px;"><span style="color: black;">      </span>// ...</div><div style="font-size: 11px;"></div><div style="font-family: Menlo; font-size: 11px;">    }</div></div><div><br /></div></div>






<p class="date">
<a href="http://moreindirection.blogspot.com/2014/08/nsnotificationcenter-swift-and-blocks.html">by More Indirection (noreply@blogger.com) at August 27, 2014 11:21 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://joyful.com" title="Joyful Systems blog">Simon Michael</a></h3>

<div class="entrygroup" id="http://joyful.com/blog/2014-05-03-creating-well-behaved-hakyll-blog-posts.html">
<blockquote>
<h1 class="entry"><a href="http://joyful.com/blog/2014-05-03-creating-well-behaved-hakyll-blog-posts.html">Creating well-behaved Hakyll blog posts</a></h1>
<div class="entry">
<p>Posts in a Hakyll-powered blog need to be created with care, if you want your feed to work well with clients and aggregators. There are many things to remember:</p>
<ul>
<li>If you have clones of your site, decide which one to work in and make sure it’s up to date</li>
<li>Create the file in the right place</li>
<li>Name it consistently (I use YYYY-MM-DD-url-safe-title.md)</li>
<li>In my setup, prefix it with _ if it’s a draft (I render but don’t publish those)</li>
<li>Set title, tags, and author with a metadata block</li>
<li>Set published time with metadata to get a more precise timestamp than Hakyll can guess from the filename. Include a time zone. Use the right format.</li>
<li>When moving a post from draft to published:
<ul>
<li>Update the published time</li>
<li>Update the file name if the title or publish date has changed</li>
</ul></li>
<li>If changing a post after it has been published: set updated time in the metadata</li>
<li>At some point, commit it to version control and sync it to other clones</li>
</ul>
<p>I find this makes blogging feel tedious, especially after an absence when I’ve forgotten the details. Case in point, I managed to share an ugly template post with Planet Haskell readers while working on this one.</p>
<p>So I’m trying out this bash shell script, maybe it will help. Adjust to suit your setup.<br /><em>(updated 2014/8/27)</em></p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># add to ~/.bashrc</span>

<span class="ot">BLOGDIR=</span>~/src/MYSITE.com/blog

<span class="co"># List recent blog posts.</span>
<span class="kw">alias</span> blog-ls=<span class="st">"ls </span><span class="ot">$BLOGDIR</span><span class="st"> | tail -10"</span>

<span class="co"># Create a new hakyll-compatible draft blog post.</span>
<span class="co"># blog-new ["The Title" ["tag1, tag2" ["Author Name"]]]</span>
<span class="kw">function</span><span class="fu"> blog-new()</span> <span class="kw">{</span>
<span class="kw">(</span>
    <span class="ot">TITLE=${1:-</span>Default Title<span class="ot">}</span>
    <span class="ot">TAGS=${2:-</span>defaulttag1, defaulttag2<span class="ot">}</span>
    <span class="ot">AUTHOR=${3:-</span>Default Author Name<span class="ot">}</span>
    <span class="ot">SLUG=${TITLE//</span> <span class="ot">/</span>-<span class="ot">}</span>
    <span class="ot">DATE=</span><span class="kw">`date</span> +<span class="st">"%Y-%m-%d"</span><span class="kw">`</span>
    <span class="ot">TIME=</span><span class="kw">`date</span> +<span class="st">"%Y-%m-%d %H:%M:%S%Z"</span><span class="kw">`</span>
    <span class="ot">FILE=</span>_<span class="ot">$DATE</span>-<span class="ot">$SLUG</span>.md
    <span class="kw">echo</span> creating <span class="ot">$BLOGDIR</span>/<span class="ot">$FILE</span>
    <span class="kw">cat</span> &lt;&lt;EOF &gt;&gt;<span class="ot">$BLOGDIR</span>/<span class="ot">$FILE</span> &amp;&amp; emacsclient -n <span class="ot">$BLOGDIR</span>/<span class="ot">$FILE</span>
---
title:     <span class="ot">$TITLE</span>
tags:      <span class="ot">$TAGS</span>
author:    <span class="ot">$AUTHOR</span>
published: <span class="ot">$TIME</span>
---

EOF
)
}</code></pre>
<p>An example:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">blog-new</span> <span class="st">'Scripted Hakyll blog post creation'</span> <span class="st">'hakyll, haskell'</span>
<span class="kw">creating</span> _2014-05-03-Scripted-Hakyll-blog-post-creation.md
<span class="kw">(file</span> opens in emacs, edit <span class="kw">&amp;</span> <span class="kw">save)</span>
$ <span class="kw">make</span>
<span class="kw">./site</span> build
<span class="kw">Initialising...</span>
  <span class="kw">Creating</span> store...
  <span class="kw">Creating</span> provider...
  <span class="kw">Running</span> rules...
<span class="kw">Checking</span> for out-of-date items
<span class="kw">Compiling</span>
  <span class="kw">updated</span> blog/_2014-05-03-Scripted-Hakyll-blog-post-creation.md
<span class="kw">Success</span></code></pre>
<p>See also <a href="http://joyful.com/blog/2014-05-06-well-behaved-hakyll-blog-posts-continued-hakyll.html">part 2</a>.</p></div>






<p class="date">
<a href="http://joyful.com/blog/2014-05-03-creating-well-behaved-hakyll-blog-posts.html">August 27, 2014 02:15 AM</a>
</p>
</blockquote>
</div>



<div class="entrygroup" id="http://joyful.com/blog/2014-05-06-well-behaved-hakyll-blog-posts-continued-hakyll.html">
<blockquote>
<h1 class="entry"><a href="http://joyful.com/blog/2014-05-06-well-behaved-hakyll-blog-posts-continued-hakyll.html">Well-behaved Hakyll blog posts, continued</a></h1>
<div class="entry">
<p>More <a href="http://joyful.com/blog/2014-05-03-creating-well-behaved-hakyll-blog-posts.html">hakyll blog fixes</a>:</p>
<p><strong>Ugly things showing on planets</strong></p>
<p>My posts were showing unwanted things on planet haskell - double heading, redundant date, tag links, and ugly disqus html. By comparing with Jasper Van der Jeugt’s blog, I found the problem: I was snapshotting content for the feed at the wrong time, after applying the post template:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">&gt;&gt;=</span> return <span class="fu">.</span> fmap demoteHeaders
<span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">"templates/post.html"</span>    (postCtx tags)
<span class="fu">&gt;&gt;=</span> saveSnapshot <span class="st">"content"</span>
<span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">"templates/default.html"</span> defaultContext</code></pre>
<p>Better:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">&gt;&gt;=</span> saveSnapshot <span class="st">"content"</span>  <span class="fu">--</span>
<span class="fu">&gt;&gt;=</span> return <span class="fu">.</span> fmap demoteHeaders
<span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">"templates/post.html"</span>    (postCtx tags)
<span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">"templates/default.html"</span> defaultContext</code></pre>
<p><strong>Manual feed publishing</strong></p>
<p>The main blog feed is now generated with a <code>_</code> prefix, and I must manually rename it (with <code>make feed</code>) to make it live it on Planet Haskell. This will hopefully reduce snafus (and not create new ones).</p>
<pre class="sourceCode diff"><code class="sourceCode diff">./site.hs 95
<span class="st">-    create ["blog.xml"] $ do</span>
<span class="ot">+    create ["_blog.xml"] $ do</span>

./Makefile 14
<span class="ot">+feed: _site/blog.xml</span>
<span class="ot">+</span>
<span class="ot">+_site/blog.xml: _site/_blog.xml</span>
<span class="ot">+	cp _site/_blog.xml _site/blog.xml</span>
<span class="ot">+</span></code></pre>
<p><strong>Better HTML titles</strong></p>
<p>Changed the “Joyful Systems” prefix to a suffix in the HTML page titles, making search results and browser tab names more useful.</p></div>






<p class="date">
<a href="http://joyful.com/blog/2014-05-06-well-behaved-hakyll-blog-posts-continued-hakyll.html">August 27, 2014 02:00 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="https://www.fpcomplete.com/school" title="FP Complete» News/Blog">FP Complete</a></h3>

<div class="entrygroup" id="https://www.fpcomplete.com/blog/2014/08/conduit-stream-fusion">
<blockquote>
<h1 class="entry"><a href="https://www.fpcomplete.com/blog/2014/08/conduit-stream-fusion">IAP: conduit stream fusion</a></h1>
<div class="entry">
<p>Both the changes described in this blog post, and in the <a href="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">previous blog
post</a>, are now
merged to the master branch of conduit, and have been released to Hackage as
conduit 1.2.0. That doesn't indicate stream fusion is complete (far from it!).
Rather, the optimizations we have so far are valuable enough that I want them
to be available immediately, and future stream fusion work is highly unlikely
to introduce further breaking changes. Having the code on Hackage will
hopefully also make it easier for others to participate in the discussion
around this code.</p><h2>Stream fusion</h2><p><a href="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">Last time</a>, I
talked about applying the codensity transform to speed up conduit. This greatly
increases performance when performing many monadic binds. However, this does
nothing to help us with speeding up the "categorical composition" of conduit,
where we connect two components of a pipeline together so the output from the
first flows into the second. conduit usually refers to this as <i>fusion</i>, but
given the topic at hand (stream fusion), I think that nomenclature will become
confusing. So let's stick to categorical composition, even though conduit isn't
actually a category.</p><p>Duncan Coutts, Roman Leshchinskiy and Don Stewart wrote <a href="http://metagraph.org/papers/stream_fusion.pdf">the stream fusion
paper</a>, and that technique has
become integral to getting high performance in the vector and text packages.
The paper is well worth the read, but for those unfamiliar with the technique,
let me give a very brief summary:</p><ul><li>GHC is very good at optimising non-recursive functions.</li><li>We express all of our streaming functions has a combination of some internal state, and a function to step over that state.</li><li>Stepping either indicates that the stream is complete, there's a new value and a new state, or there's a new state without a new value (this last case helps avoid recursion for a number of functions like <code>filter</code>).</li><li>A stream transformers (like <code>map</code>) takes a <code>Stream</code> as input and produces a new <code>Stream</code> as output.</li><li>The final consuming functions, like <code>fold</code>, are the only place where recursion happens. This allows all other components of the pipeline to be inlined, rewritten to more efficient formats, and optimized by GHC.</li></ul><p>Let's see how this looks compared to conduit.</p><h2>Data types</h2><p>I'm going to slightly rename data types from stream fusion to avoid conflicts
with existing conduit names. I'm also going to add an extra type parameter to
represent the final return value of a stream; this is a concept that exists in
conduit, but not common stream fusion.</p><pre><code class="haskell">data Step s o r
    = Emit s o
    | Skip s
    | Stop r
data Stream m o r = forall s. Stream
    (s -&gt; m (Step s o r))
    (m s)</code></pre><p>The <code>Step</code> datatype takes three parameters. <code>s</code> is the internal state used by
the stream, <code>o</code> is the type of the stream of values it generates, and <code>r</code> is
the final result value. The <code>Stream</code> datatype uses an existential to hide away
that internal state. It then consists of a step function that takes a state and
gives us a new <code>Step</code>, as well as an initial state value (which is a monadic
action, for cases where we want to do some initialization when starting a
stream).</p><p>Let's look at some functions to get a feel for what this programming style
looks like:</p><pre><code class="haskell">enumFromToS_int :: (Integral a, Monad m) =&gt; a -&gt; a -&gt; Stream m a ()
enumFromToS_int !x0 !y =
    Stream step (return x0)
  where
    step x | x &lt;= y    = return $ Emit (x + 1) x
           | otherwise = return $ Stop ()</code></pre><p>This function generates a stream of integral values from <code>x0</code> to <code>y</code>. The
internal state is the current value to be emitted. If the current value is less
than or equal to <code>y</code>, we emit our current value, and update our state to be the
next value. Otherwise, we stop.</p><p>We can also write a function that transforms an existing stream. <code>mapS</code> is
likely the simplest example of this:</p><pre><code class="haskell">mapS :: Monad m =&gt; (a -&gt; b) -&gt; Stream m a r -&gt; Stream m b r
mapS f (Stream step ms0) =
    Stream step' ms0
  where
    step' s = do
        res &lt;- step s
        return $ case res of
            Stop r -&gt; Stop r
            Emit s' a -&gt; Emit s' (f a)
            Skip s' -&gt; Skip s'</code></pre><p>The trick here is to make a function from one <code>Stream</code> to another. We unpack
the input <code>Stream</code> constructor to get the input step and state functions. Since
<code>mapS</code> has no state of its own, we simply keep the input state unmodified. We
then provide our modified <code>step'</code> function. This calls the input step function,
and any time it sees an <code>Emit</code>, applies the user-provided <code>f</code> function to the
emitted value.</p><p>Finally, let's consider the consumption of a stream with a strict left fold:</p><pre><code class="haskell">foldS :: Monad m =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; Stream m a () -&gt; m b
foldS f b0 (Stream step ms0) =
    ms0 &gt;&gt;= loop b0
  where
    loop !b s = do
        res &lt;- step s
        case res of
            Stop () -&gt; return b
            Skip s' -&gt; loop b s'
            Emit s' a -&gt; loop (f b a) s'</code></pre><p>We unpack the input <code>Stream</code> constructor again, get the initial state, and then
loop. Each loop, we run the input step function.</p><h2>Match and mismatch with conduit</h2><p>There's a simple, straightforward conversion from a <code>Stream</code> to a <code>Source</code>:</p><pre><code class="haskell">toSource :: Monad m =&gt; Stream m a () -&gt; Producer m a
toSource (Stream step ms0) =
    lift ms0 &gt;&gt;= loop
  where
    loop s = do
        res &lt;- lift $ step s
        case res of
            Stop () -&gt; return ()
            Skip s' -&gt; loop s'
            Emit s' a -&gt; yield a &gt;&gt; loop s'</code></pre><p>We extract the state, and then loop over it, calling <code>yield</code> for each emitted
value. And ignoring finalizers for the moment, there's even a way to convert a
<code>Source</code> into a <code>Stream</code>:</p><pre><code class="haskell">fromSource :: Monad m =&gt; Source m a -&gt; Stream m a ()
fromSource (ConduitM src0) =
    Stream step (return $ src0 Done)
  where
    step (Done ()) = return $ Stop ()
    step (Leftover p ()) = return $ Skip p
    step (NeedInput _ p) = return $ Skip $ p ()
    step (PipeM mp) = liftM Skip mp
    step (HaveOutput p _finalizer o) = return $ Emit p o</code></pre><p>Unfortunately, there's no straightforward conversion for <code>Conduit</code>s
(transformers) and <code>Sink</code>s (consumers). There's simply a mismatch in the
conduit world- which is fully continuation based- to the stream world- where
the upstream is provided in an encapsulated value. I <i>did</i> find a few
representations that mostly work, but the performance characteristics are
terrible.</p><p>If anyone has insights into this that I missed, please contact me, as this
could have an important impact on the future of stream fusion in conduit. But
for the remainder of this blog post, I will continue under the assumption that
only <code>Source</code> and <code>Stream</code> can be efficiently converted.</p><h2>StreamConduit</h2><p>Once I accepted that I wouldn't be able to convert a stream transformation into
a conduit transformation, I was left with a simple approach to start working on
fusion: have two representations of each function we want to be able to fuse.
The first representation would use normal conduit code, and the second would be
streaming. This looks like:</p><pre><code class="haskell">data StreamConduit i o m r = StreamConduit
    (ConduitM i o m r)
    (Stream m i () -&gt; Stream m o r)</code></pre><p>Notice that the second field uses the stream fusion concept of a
<code>Stream</code>-transforming function. At first, this may seem like it doesn't
properly address <code>Source</code>s and <code>Sink</code>s, since the former doesn't have an input
<code>Stream</code>, and the latter results in a single output value, not a <code>Stream</code>.
However, those are really just special cases of the more general form used
here. For <code>Source</code>s, we provide an empty input stream, and for <code>Sink</code>s, we
continue executing the <code>Stream</code> until we get a <code>Stop</code> constructor with the
final result. You can see both of these in the implementation of the
<code>connectStream</code> function (whose purpose I'll explain in a moment):</p><pre><code class="haskell">connectStream :: Monad m
              =&gt; StreamConduit () i    m ()
              -&gt; StreamConduit i  Void m r
              -&gt; m r
connectStream (StreamConduit _ stream) (StreamConduit _ f) =
    run $ f $ stream $ Stream emptyStep (return ())
  where
    emptyStep _ = return $ Stop ()
    run (Stream step ms0) =
        ms0 &gt;&gt;= loop
      where
        loop s = do
            res &lt;- step s
            case res of
                Stop r -&gt; return r
                Skip s' -&gt; loop s'
                Emit _ o -&gt; absurd o</code></pre><p>Notice how we've created an empty <code>Stream</code> using <code>emptyStep</code> and a dummy <code>()</code>
state. And on the <code>run</code> side, we loop through the results. The type system (via
the <code>Void</code> datatype) prevents the possibility of a meaningful <code>Emit</code>
constructor, and we witness this with the <code>absurd</code> function. For <code>Stop</code> we
return the final value, and <code>Skip</code> implies another loop.</p><h3>Fusing StreamConduit</h3><p>Assuming we have some functions that use <code>StreamConduit</code>, how do we get things
to fuse? We still need all of our functions to have a <code>ConduitM</code> type
signature, so we start off with a function to convert a <code>StreamConduit</code> into a
<code>ConduitM</code>:</p><pre><code class="haskell">unstream :: StreamConduit i o m r -&gt; ConduitM i o m r
unstream (StreamConduit c _) = c
{-# INLINE [0] unstream #-}</code></pre><p>Note that we hold off on any inlining until simplification phase 0. This is
vital to our next few rewrite rules, which is where all the magic happens.</p><p>The next thing we want to be able to do is categorically compose two
<code>StreamConduit</code>s together. This is easy to do, since a <code>StreamConduit</code> is made
up of <code>ConduitM</code>s which compose via the <code>=$=</code> operator, and <code>Stream</code>
transformers, which compose via normal function composition. This results in a
function:</p><pre><code class="haskell">fuseStream :: Monad m
           =&gt; StreamConduit a b m ()
           -&gt; StreamConduit b c m r
           -&gt; StreamConduit a c m r
fuseStream (StreamConduit a x) (StreamConduit b y) = StreamConduit (a =$= b) (y . x)
{-# INLINE fuseStream #-}</code></pre><p>That's very logical, but still not magical. The final trick is a rewrite rule:</p><pre><code class="haskell">{-# RULES "fuseStream" forall left right.
        unstream left =$= unstream right = unstream (fuseStream left right)
  #-}</code></pre><p>We're telling GHC that, if we see a composition of two streamable conduits,
then we can compose the stream versions of them and get the same result. But
this isn't enough yet; <code>unstream</code> will still end up throwing away the stream
version. We now need to deal with running these things. The first case we'll
handle is connecting two streamable conduits, which is where the
<code>connectStream</code> function from above comes into play. If you go back and look at
that code, you'll see that the <code>ConduitM</code> fields are never used. All that's
left is telling GHC to use <code>connectStream</code> when appropriate:</p><pre><code class="haskell">{-# RULES "connectStream" forall left right.
        unstream left $$ unstream right = connectStream left right
  #-}</code></pre><p>The next case we'll handle is when we connect a streamable source to a
non-streamable sink. This is less efficient than the previous case, since it
still requires allocating <code>ConduitM</code> constructors, and doesn't expose as many
opportunities for GHC to inline and optimize our code. However, it's still
better than nothing:</p><pre><code class="haskell">connectStream1 :: Monad m
               =&gt; StreamConduit () i    m ()
               -&gt; ConduitM      i  Void m r
               -&gt; m r
connectStream1 (StreamConduit _ fstream) (ConduitM sink0) =
    case fstream $ Stream (const $ return $ Stop ()) (return ()) of
        Stream step ms0 -&gt;
            let loop _ (Done r) _ = return r
                loop ls (PipeM mp) s = mp &gt;&gt;= flip (loop ls) s
                loop ls (Leftover p l) s = loop (l:ls) p s
                loop _ (HaveOutput _ _ o) _ = absurd o
                loop (l:ls) (NeedInput p _) s = loop ls (p l) s
                loop [] (NeedInput p c) s = do
                    res &lt;- step s
                    case res of
                        Stop () -&gt; loop [] (c ()) s
                        Skip s' -&gt; loop [] (NeedInput p c) s'
                        Emit s' i -&gt; loop [] (p i) s'
             in ms0 &gt;&gt;= loop [] (sink0 Done)
{-# INLINE connectStream1 #-}

{-# RULES "connectStream1" forall left right.
        unstream left $$ right = connectStream1 left right
  #-}</code></pre><p>There's a third case that's worth considering: a streamable sink and
non-streamable source. However, I ran into two problems when implementing such
a rewrite rule:</p><ul><li><p>GHC did not end up firing the rule.</p></li><li><p>There are some corner cases regarding finalizers that need to be dealt with.  In our previous examples, the upstream was always a stream, which has no concept of finalizers. But when the upstream is a conduit, we need to make sure to call them appropriately.</p></li></ul><p>So for now, fusion only works for cases where all of the functions can by
fused, or all of the functions before the <code>$$</code> operator can be fused.
Otherwise, we'll revert to the normal performance of conduit code.</p><h2>Benchmarks</h2><p>I took the benchmarks from our previous blog post and modified them slightly.
The biggest addition was including an example of <code>enumFromTo =$= map =$= map
=$= fold</code>, which really stresses out the fusion capabilities, and demonstrates
the performance gap stream fusion offers.</p><p>The other thing to note is that, in the "before fusion" benchmarks, the sum
results are skewed by the fact that we have the overly eager rewrite rules for
<code>enumFromTo $$ fold</code> (for more information, see the previous blog post). For
the "after fusion" benchmarks, there are no special-case rewrite rules in
place. Instead, the results you're seeing are actual artifacts of having a
proper fusion framework in place. In other words, you can expect this to
translate into real-world speedups.</p><p>You can compare <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/before-fusion.html">before
fusion</a>
and <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/after-fusion.html">after
fusion</a>.
Let me provide a few select comparisons:</p><table>
<thead>
<tr>
<th>Benchmark</th>
<th>Low level or vector</th>
<th>Before fusion</th>
<th>After fusion</th>
<th>Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<th>map + sum</th>
<td>5.95us</td>
<td>636us</td>
<td>5.96us</td>
<td style="color: green;">99%</td>
</tr>
<tr>
<th>monte carlo</th>
<td>3.45ms</td>
<td>5.34ms</td>
<td>3.70ms</td>
<td style="color: green;">71%</td>
</tr>
<tr>
<th>sliding window size 10, Seq</th>
<td>1.53ms</td>
<td>1.89ms</td>
<td>1.53ms</td>
<td style="color: green;">21%</td>
</tr>
<tr>
<th>sliding vector size 10, unboxed</th>
<td>2.25ms</td>
<td>4.05ms</td>
<td>2.33ms</td>
<td style="color: green;">42%</td>
</tr>
</tbody>
</table><p>Note at the map + sum benchmark is very extreme, since the inner loop is doing
very cheap work, so the conduit overhead dominated the analysis.</p><h2>Streamifying a conduit</h2><p>Here's an example of making a conduit function stream fusion-compliant, using
the <code>map</code> function:</p><pre><code class="haskell">mapC :: Monad m =&gt; (a -&gt; b) -&gt; Conduit a m b
mapC f = awaitForever $ yield . f
{-# INLINE mapC #-}

mapS :: Monad m =&gt; (a -&gt; b) -&gt; Stream m a r -&gt; Stream m b r
mapS f (Stream step ms0) =
    Stream step' ms0
  where
    step' s = do
        res &lt;- step s
        return $ case res of
            Stop r -&gt; Stop r
            Emit s' a -&gt; Emit s' (f a)
            Skip s' -&gt; Skip s'
{-# INLINE mapS #-}

map :: Monad m =&gt; (a -&gt; b) -&gt; Conduit a m b
map = mapC
{-# INLINE [0] map #-}
{-# RULES "unstream map" forall f.
    map f = unstream (StreamConduit (mapC f) (mapS f))
  #-}</code></pre><p>Notice the three steps here:</p><ul><li>Define a pure-conduit implementation (<code>mapC</code>), which looks just like conduit 1.1's <code>map</code> function.</li><li>Define a pure-stream implementation (<code>mapS</code>), which looks very similar to vector's <code>mapS</code>.</li><li>Define <code>map</code>, which by default simply reexposes <code>mapC</code>. But then, use an <code>INLINE</code> statement to delay inlining until simplification phase 0, and use a rewrite rule to rewrite <code>map</code> in terms of <code>unstream</code> and our two helper functions <code>mapC</code> and <code>mapS</code>.</li></ul><p>While tedious, this is all we need to do for each function to expose it to the fusion framework.</p><h2>Vector vs conduit, mapM style</h2><p>Overall, vector has been both the inspiration for the work I've done here, and
the bar I've used to compare against, since it is generally the fastest
implementation you can get in Haskell (and tends to be high-level code to
boot). However, there seems to be one workflow where conduit drastically
outperforms vector: chaining together monadic transformations.</p><p>I <a href="http://lpaste.net/109747">put together a benchmark</a> which does the same
enumFromTo+map+sum benchmark I demonstrated previously. But this time, I have
four versions: vector with pure functions, vector with IO functions, conduit
with pure functions, and conduit with IO functions. You can <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/mapm.html">see the results
here</a>,
the important takeaway is:</p><ul><li>Pure is always faster, since it exposes more optimizations to GHC.</li><li>vector and conduit pure are almost identical, at 57.7us and 58.1us.</li><li>Monadic conduit code does have a slowdown (86.3us). However, monadic vector code has a drastic slowdown (305us), presumably because monadic binds defeat its fusion framework.</li></ul><p>So there seems to be at least one workflow for which conduit's fusion framework
can outperform even vector!</p><h2>Downsides</h2><p>The biggest downside to this implementation of stream fusion is that we need to
write all of our algorithms twice. This can possibly be mitigated by having a
few helper functions in place, and implementing others in terms of those. For
example, <code>mapM_</code> can be implemented in terms <code>foldM</code>.</p><p>There's one exception to this: using the <code>streamSource</code> function, we
can convert a <code>Stream</code> into a <code>Source</code> without having to write our algorithm
twice. However, due to differences in how monadic actions are performed between
Stream and Conduit, this could introduce a performance degredation for pure
<code>Source</code>s. We can work around that with a special case function
<code>streamSourcePure</code> for the <code>Identity</code> monad as a base.</p><h2>Getting good performance</h2><p>In order to take advantage of the new stream fusion framework, try to follow
these guidelines:</p><ul><li>Use fusion functions whenever possible. Explicit usage of <code>await</code> and <code>yield</code> will immediately kick you back to non-fusion (the same as explicit pattern matching defeats list fusion).</li><li>If you absolutely cannot use an existing fusion function, consider writing your own fusion variant.</li><li>When mixing fusion and non-fusion, put as many fusion functions as possible together with the <code>$=</code> operator before the connect operator <code>$$</code>.</li></ul><h2>Next steps</h2><p>Even though this work is now publicly available on Hackage, there's still a lot
of work to be done. This falls into three main categories:</p><ul><li>Continue rewriting core library functions in streaming style. Michael Sloan has been working on a lot of these functions, and we're hoping to have almost all the combinators from Data.Conduit.List and Data.Conduit.Combinators done soon.</li><li>Research why rewrite rules and inlining don't play nicely together. In a number of places, we've had to explicitly use rewrite rules to force fusion to happen, when theoretically inlining should have taken care of it for us.</li><li>Look into any possible alternative formulations of stream fusion that provide better code reuse or more reliable rewrite rule firing.</li></ul><p>Community assistance on all three points, but especially 2 and 3, are much appreciated!</p></div>






<p class="date">
<a href="https://www.fpcomplete.com/blog/2014/08/conduit-stream-fusion">August 27, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 26, 2014</h2>

<div class="channelgroup">







<h3><a href="http://blog.ezyang.com" title="Inside 206-105">Edward Z. Yang</a></h3>

<div class="entrygroup" id="http://blog.ezyang.com/?p=9144">
<blockquote>
<h1 class="entry"><a href="http://feedproxy.google.com/~r/ezyang/~3/E0P5Is9KSsQ/">A taste of Cabalized Backpack</a></h1>
<div class="entry">
<div class="document">



<p>So perhaps you've <a href="http://blog.ezyang.com/2014/08/whats-a-module-system-good-for-anyway/" class="reference external">bought into modules and modularity</a> and want to get to using Backpack straightaway.  How can you do it? In this blog post, I want to give a tutorial-style taste of how to program Cabal in the Backpack style. None of these examples are executable, because only some of this system is in GHC HEAD--the rest are on branches awaiting code review or complete vaporware. However, we've got a pretty good idea how the overall design and user experience should go, and so the purpose of this blog post is to communicate that idea. Comments and suggestions would be much appreciated; while the design here is theoretically well-founded, for obvious reasons, we don't have much on-the-ground programmer feedback yet.</p>
<hr class="docutils" />
<div class="section" id="a-simple-package-in-today-s-cabal">
<h3>A simple package in today's Cabal</h3>
<p>To start, let's briefly review how Haskell modules and Cabal packages work today. Our running example will be the <tt class="docutils literal">bytestring</tt> package, although I'll inline, simplify and omit definitions to enhance clarity.</p>
<p>Let's suppose that you are writing a library, and you want to use efficient, packed strings for some binary processing you are doing. Fortunately for you, the venerable Don Stewart has already written a <tt class="docutils literal">bytestring</tt> package which implements this functionality for you.  This package consists of a few modules: an implementation of strict <tt class="docutils literal">ByteStrings</tt>...</p>

<pre class="literal-block">module Data.ByteString(ByteString, empty, singleton, ...) where
  data ByteString = PS !(ForeignPtr Word8) !Int !Int
  empty :: ByteString
  empty = PS nullForeignPtr 0 0
  ...
</pre>
<p>...and an implementation of lazy <tt class="docutils literal">ByteStrings</tt>:</p>

<pre class="literal-block">module Data.ByteString.Lazy(ByteString, empty, singleton, ...) where
  data ByteString = Empty | Chunk !S.ByteString ByteString
  empty :: ByteString
  empty = Empty
  ...
</pre>
<p>These modules are packaged up into a package which is specified using a Cabal file (for now, we'll ignore the ability to define libraries/executables in the same Cabal file and assume everything is in a library):</p>
<pre class="literal-block">name: bytestring
version: 0.10.4.0
build-depends: base &gt;= 4.2 &amp;&amp; &lt; 5, ghc-prim, deepseq
exposed-modules: Data.ByteString, Data.ByteString.Lazy, ...
other-modules: ...
</pre>
<p>We can then make a simple module and package which depends on the <tt class="docutils literal">bytestring</tt> package:</p>

<pre class="literal-block">module Utils where
  import Data.ByteString.Lazy as B
  blank :: IO ()
  blank = B.putStr B.empty
</pre>
<pre class="literal-block">name: utilities
version: 0.1
build-depends: base, bytestring &gt;= 0.10
exposed-modules: Utils
</pre>
<p>It's worth noting a few things about this completely standard module setup:</p>
<ol class="arabic simple">
<li>It's not possible to switch <tt class="docutils literal">Utils</tt> from using lazy <tt class="docutils literal">ByteStrings</tt> to strict <tt class="docutils literal">ByteStrings</tt> without literally editing the <tt class="docutils literal">Utils</tt> module.  And even if you do that, you can't have <tt class="docutils literal">Utils</tt> depending on strict <tt class="docutils literal">ByteString</tt>, and <tt class="docutils literal">Utils</tt> depending on lazy <tt class="docutils literal">ByteString</tt>, in the same program, without copying the entire module text. (This is not too surprising, since the code <em>really is</em> different.)</li>
<li>Nevertheless, there is some amount of indirection here: while <tt class="docutils literal">Utils</tt> includes a specific <tt class="docutils literal">ByteString</tt> module, it is unspecified <em>which</em> version of <tt class="docutils literal">ByteString</tt> it will be. If (hypothetically) the <tt class="docutils literal">bytestring</tt> library released a new version where lazy byte-strings were actually strict, the functionality of <tt class="docutils literal">Utils</tt> would change accordingly when the user re-ran dependency resolution.</li>
<li>I used a qualified import to refer to identifiers in <tt class="docutils literal">Data.ByteString.Lazy</tt>.  This is a pretty common pattern when developing Haskell code: we think of <tt class="docutils literal">B</tt> as an <em>alias</em> to the actual model.  Textually, this is also helpful, because it means I only have to edit the import statement to change which <tt class="docutils literal">ByteString</tt> I refer to.</li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="generalizing-utils-with-a-signature">
<h3>Generalizing Utils with a signature</h3>
<p>To generalize <tt class="docutils literal">Utils</tt> with some Backpack magic, we need to create a <em>signature</em> for <tt class="docutils literal">ByteString</tt>, which specifies what the interface of the module providing <tt class="docutils literal">ByteStrings</tt> is.  Here one such signature, which is placed in the file <tt class="docutils literal">Data/ByteString.hsig</tt> inside the <em>utilities</em> package:</p>

<pre class="literal-block">module Data.ByteString where
  import Data.Word
  data ByteString
  instance Eq ByteString
  empty :: ByteString
  singleton :: Word8 -&gt; ByteString
  putStr :: ByteString -&gt; IO ()
</pre>
<p>The format of a signature is essentially the same of that of an <tt class="docutils literal"><span class="pre">hs-boot</span></tt> file: we have normal Haskell declarations, but omitting the actual implementations of values.</p>
<p>The <tt class="docutils literal">utilities</tt> package now needs a new field to record signatures:</p>
<pre class="literal-block">name: utilities
indefinite: True
build-depends: base
exposed-modules: Utils
required-signatures: Data.ByteString
</pre>
<p>Notice that there have been three changes: (1) We've removed the direct dependency on the <tt class="docutils literal">bytestring</tt> package, (2) we've added a new field <strong>indefinite</strong>, which indicates that this indefinite package has signatures and cannot be compiled until those signatures are filled in with implementations (this field is strictly redundant, but is useful for documentation purposes, as we will see later), and (3) we have a new field <strong>required-signatures</strong> which simply lists the names of the signature files (also known as <strong>holes</strong>) that we need filled in.</p>
<p>How do we actually use the utilities package, then? Let's suppose our goal is to produce a new module, <tt class="docutils literal">Utils.Strict</tt>, which is <tt class="docutils literal">Utils</tt> but using strict <tt class="docutils literal">ByteStrings</tt> (which is exported by the bytestring package under the module name <tt class="docutils literal">Data.ByteString</tt>). To do this, we'll need to create a new package:</p>
<pre class="literal-block">name: strict-utilities
build-depends: utilities, bytestring
reexported-modules: Utils as Utils.Strict
</pre>
<p>That's it! <tt class="docutils literal"><span class="pre">strict-utilities</span></tt> exports a single module <tt class="docutils literal">Utils.Strict</tt> which is <tt class="docutils literal">utilities</tt> using <tt class="docutils literal">Data.ByteString</tt> from <tt class="docutils literal">bytestring</tt> (which is the strict implementation). This is called a <em>mix-in</em>: in the same dependency list, we simply mix together:</p>
<ul class="simple">
<li><tt class="docutils literal">utilities</tt>, which <em>requires</em> a module named <tt class="docutils literal">Data.ByteString</tt>, and</li>
<li><tt class="docutils literal">bytestring</tt>, which <em>supplies</em> a module named <tt class="docutils literal">Data.ByteString</tt>.</li>
</ul>
<p>Cabal automatically figures out that how to instantiate the utilities package by matching together <em>module names</em>. Specifically, the two packages above are connected through the module name <tt class="docutils literal">Data.ByteString</tt>. This makes for a very convenient (and as it turns out, expressive) mode of package instantiation. By the way, <strong>reexported-modules</strong> is a new (orthogonal) feature which lets us reexport a module from the current package or a dependency to the outside world under a different name. The modules that are exported by the package are the exposed-modules and the reexported-modules. The reason we distinguish them is to make clear which modules have source code in the package (exposed-modules).</p>
<p>Unusually, <tt class="docutils literal"><span class="pre">strict-utilities</span></tt> is a package that contains no code! Its sole purpose is to mix existing packages.</p>
<p>Now, you might be wondering: how do we instantiate utilities with the lazy <tt class="docutils literal">ByteString</tt> implementation? That implementation was put in <tt class="docutils literal">Data.ByteString.Lazy</tt>, so the names don't match up. In this case, we can use another new feature, module thinning and renaming:</p>
<pre class="literal-block">name: lazy-utilities
build-depends:
  utilities,
  bytestring (Data.ByteString.Lazy as Data.ByteString)
reexported-modules: Utils as Utils.Lazy
</pre>
<p>The <tt class="docutils literal">utilities</tt> dependency is business as usual, but <tt class="docutils literal">bytestring</tt> has a little parenthesized expression next to it. This expression is the <em>thinning and renaming</em> applied to the package import: it controls what modules are brought into the scope of the current package from a dependency, possibly renaming them to different names. When I write <tt class="docutils literal"><span class="pre">build-depends:</span> bytestring (Data.ByteString.Lazy as Data.ByteString)</tt>, I am saying "I depend on the <tt class="docutils literal">bytestring</tt> package, but please only make the <tt class="docutils literal">Data.ByteString.Lazy</tt> module available under the name <tt class="docutils literal">Data.ByteString</tt> when considering module imports, and ignore all the other exposed modules." In <tt class="docutils literal"><span class="pre">strict-utilities</span></tt>, you could have also written <tt class="docutils literal">bytestring (Data.ByteString)</tt>, because this is the only module that <tt class="docutils literal">utilities</tt> uses from <tt class="docutils literal">bytestring</tt>.</p>
<p>An interesting duality is that you can do the renaming the other way:</p>
<pre class="literal-block">name: lazy-utilities
build-depends:
  utilities (Utils, Data.ByteString as Data.ByteString.Lazy),
  bytestring
</pre>
<p>Instead of renaming the implementation, I renamed the hole! It's equivalent: the thing that matters it that the signature and implementation need to be mixed under the <em>same</em> name in order for linking (the instantiation of the signature with the implementation) to occur.</p>
<p>There are a few things to note about signature usage:</p>
<ol class="arabic">
<li><p class="first">If you are using a signature, there's not much point in also specifying an explicit import list when you import it: you are guaranteed to <em>only</em> see types and definitions that are in the signature (modulo type classes... a topic for another day). Signature files act like a type-safe import list which you can share across modules.</p>
</li>
<li><p class="first">A signature can, and indeed often must, import other modules.  In the type signature for <tt class="docutils literal">singleton</tt> in <tt class="docutils literal">Data/ByteString.hsig</tt>, we needed to refer to a type <tt class="docutils literal">Word8</tt>, so we must bring it into scope by importing <tt class="docutils literal">Data.Word</tt>.</p>
<p>Now, when we compile the signature in the <tt class="docutils literal">utilities</tt> package, we need to know where <tt class="docutils literal">Data.Word</tt> came from. It could have come from another signature, but in this case, it's provided by the <em>definite</em> package base: it's a proper concrete module with an implementation! Signatures can depend on implementations: since we can only refer to types from those modules, we are saying, in effect: any implementation of the <tt class="docutils literal">singleton</tt> function and any representation of the <tt class="docutils literal">ByteString</tt> type is acceptable, but regarding <tt class="docutils literal">Word8</tt> you must use the <em>specific</em> type from <tt class="docutils literal">Data.Word</tt> in <tt class="docutils literal">prelude</tt>.</p>
</li>
<li><p class="first">What happens if, independently of my packages <tt class="docutils literal"><span class="pre">strict-utilities</span></tt>, someone else also instantiatiates <tt class="docutils literal">utilities</tt> with <tt class="docutils literal">Data.ByteString</tt>? Backpack is clever enough to reuse the instantiation of <tt class="docutils literal">utilities</tt>: this property is called <strong>applicativity</strong> of the module system. The specific rule that we use to decide if the instantiation is the same is to look at how all of the holes needed by a <em>package</em> are instantiated, and if they are instantiated with precisely the same modules, the instantiated packages are considered type equal. So there is no need to actually create <tt class="docutils literal"><span class="pre">strict-utilities</span></tt> or <tt class="docutils literal"><span class="pre">lazy-utilities</span></tt>: you can just instantiate <tt class="docutils literal">utilities</tt> on the fly.</p>
</li>
</ol>
<p><strong>Mini-quiz:</strong> What does this package do?</p>
<pre class="literal-block">name: quiz-utilities
build-depends:
  utilities (Utils, Data.ByteString as B),
  bytestring (Data.ByteString.Lazy as B)
</pre>
</div>
<hr class="docutils" />
<div class="section" id="sharing-signatures">
<h3>Sharing signatures</h3>
<p>It's all very nice to be able to explicitly write a signature for <tt class="docutils literal">Data.ByteString</tt> in my package, but this could get old if I have to do this for every single package I depend on.  It would be much nicer if I could just put all my signatures in a package and include that when I want to share it. I want all of the Hackage mechanisms to apply to my signatures as well as my normal packages (e.g. versioning). Well, you can!</p>
<p>The author of <tt class="docutils literal">bytestring</tt> can write a <tt class="docutils literal"><span class="pre">bytestring-sig</span></tt> package which contains only signatures:</p>
<pre class="literal-block">name: bytestring-sig
version: 1.0
indefinite: True
build-depends: base
exposed-signatures: Data.ByteString
</pre>
<p>...and declare that the <tt class="docutils literal">bytestring</tt> package satisfies this signature:</p>
<pre class="literal-block">name: bytestring
implements: bytestring-sig-1.0
</pre>
<p>The implements fields is purely advisory: it offers a proactive check to library authors to make sure they aren't breaking compatibility with signatures, and it also helps Cabal offer suggestions for how to provide implementations for signatures.</p>
<p>Now, <tt class="docutils literal">utilities</tt> can include this package to indicate its dependence on the signature:</p>
<pre class="literal-block">name: utilities
indefinite: True
build-depends: base, bytestring-sig-1.0
exposed-modules: Utils
</pre>
<p>Unlike normal dependencies, signature dependencies should be <em>exact</em>: after all, while you might want an upgraded implementation, you don't want the signature to change on you!</p>
<p>Another interesting difference is that we specified the signatures using <strong>exposed-signatures</strong>, as opposed to <strong>required-signatures</strong>. We can summarize all of the fields as follows:</p>
<ol class="arabic simple">
<li><strong>exposed-modules</strong> says that there is a public module defined <em>in this package</em></li>
<li><strong>other-modules</strong> says that there is a private module defined in this package</li>
<li><strong>exposed-signatures</strong> says that there is a public signature defined in this package</li>
<li><strong>required-signatures</strong> says that there is a "private" signature defined in this package</li>
<li><strong>reexported-modules</strong> says that there is a public module or signature defined in a dependency.</li>
</ol>
<p>In this list, public means that it is available to clients. Notice the first four fields list all of the source code in this package.  Here is a simple example of a client:</p>
<pre class="literal-block">name: utilities-extras
indefinite: True
build-depends: utilities
exposed-modules: Utils.Extra
</pre>
<p><tt class="docutils literal">Utils/Extra.hs</tt> defined in this package can import <tt class="docutils literal">Utils</tt> (because it's exposed by <tt class="docutils literal">utilities</tt>) but can't import <tt class="docutils literal">Data.ByteString</tt> (because it's not exposed). Had we said <tt class="docutils literal"><span class="pre">reexported-modules:</span> Data.ByteString</tt> in <tt class="docutils literal">utilities</tt>, then <tt class="docutils literal">Data.ByteString</tt> would have been accessible.</p>
<p>Do note, however, that the package is still <em>indefinite</em> (since it depends on an indefinite package). Despite <tt class="docutils literal">Data.ByteString</tt> being "private" to <tt class="docutils literal">utilities</tt> (not importable), a client may still refer to it in a renaming clause in order to instantiate the module:</p>
<pre class="literal-block">name: utilities-extras-lazy
build-depends:
  utilities-extras (Data.ByteString as Data.ByteString.Lazy),
  bytestring
</pre>
<p>You can't "hide" holes altogether: that would be like saying, "I'm never going to say what the actual implementation is!" But you can choose not to directly rely on them.</p>
<p>By the way, if <tt class="docutils literal">Utils/Extra.hs</tt>, in <tt class="docutils literal"><span class="pre">utilities-extras</span></tt>, wanted to import <tt class="docutils literal">Data.ByteString</tt> (even though <tt class="docutils literal">utilities</tt> did not expose it),  <tt class="docutils literal"><span class="pre">utilities-extras</span></tt> simply needs directly depend on the signature package:</p>
<pre class="literal-block">name: utilities-extras
indefinite: True
build-depends: utilities, bytestring-sig == 1.0
exposed-modules: Utils.Extra
</pre>
<p>The <tt class="docutils literal">Data.ByteString</tt> hole from <tt class="docutils literal">utilities</tt> and the new hole included here are automatically checked for compatibility and linked together: you only need to provide one implementation for both of them.</p>
<p><strong>Mini-quiz:</strong> What does this package do? Specifically, if I include it in a package, what modules are available for import?</p>
<pre class="literal-block">name: attoparsec-sig
version: 1.0
indefinite: True
build-depends: base, bytestring-sig
exposed-signatures: Data.Attoparsec
</pre>
</div>
<hr class="docutils" />
<div class="section" id="summary">
<h3>Summary</h3>
<p>We've covered a lot of ground, but when it comes down to it, Backpack really comes together because of set of orthogonal features which interact in a good way:</p>
<ol class="arabic simple">
<li><strong>Module signatures</strong> (mostly implemented but needs lots of testing): the <em>heart</em> of a module system, giving us the ability to write <em>indefinite packages</em> and mix together implementations,</li>
<li><strong>Module reexports</strong> (fully implemented and in HEAD): the ability to take locally available modules and reexport them under a different name, and</li>
<li><strong>Module thinning and renaming</strong> (fully implemented and in code review): the ability to selectively make available modules from a dependency.</li>
</ol>
<p>To compile a Backpack package, we first run the traditional version dependency solving, getting exact versions for all packages involved, and then we calculate how to link the packages together. That's it! In a future blog post, I plan to more comprehensively describe the semantics of these new features, especially module signatures, which can be subtle at times. Also, note that I've said nothing about how to type-check against just a signature, without having any implementation in mind. As of right now, this functionality is vaporware; in a future blog post, I also plan on saying why this is so challenging.</p>
</div>
</div>
<img width="1" src="http://feeds.feedburner.com/~r/ezyang/~4/E0P5Is9KSsQ" height="1" /></div>






<p class="date">
<a href="http://feedproxy.google.com/~r/ezyang/~3/E0P5Is9KSsQ/">by Edward Z. Yang at August 26, 2014 10:01 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://cdsmith.wordpress.com" title="Sententia cdsmithus">Chris Smith</a></h3>

<div class="entrygroup" id="http://cdsmith.wordpress.com/2014/08/26/on-codeworld-and-haskell/">
<blockquote>
<h1 class="entry"><a href="http://cdsmith.wordpress.com/2014/08/26/on-codeworld-and-haskell/">On CodeWorld and Haskell</a></h1>
<div class="entry">
<p>I’ve been pouring a lot of effort into CodeWorld lately… and I wanted to write a sort of apology to the Haskell community.  Well, perhaps not an apology, because I believe I did the right thing.  But at the same time, I realize that decisions I’ve made haven’t been entirely popular among Haskell programmers.  I’d like to explain what happened, and try to make it up to you!</p>
<h1>What Happened</h1>
<p>Originally, I started this project using Haskell and the excellent <a href="http://gloss.ouroborus.net/">gloss package</a>, by Ben Lippmeier.  CodeWorld has been moving slowly further and further away from the rest of the Haskell community.  This has happened in a sequence of steps:</p>
<ol>
<li>Way back in 2011, I started “CodeWorld”, but at the time, I called it <a href="http://cdsmith.wordpress.com/2011/08/16/haskell-for-kids-week-1/">Haskell for Kids</a>.  At the time, I understood that the reasons I’d chosen Haskell as a language were not about cool stuff like type classes (<a href="http://cdsmith.wordpress.com/2009/07/23/the-magic-of-type-classes/">which I love</a>) and monads and categories and other commonplace uses of solid abstractions (<a href="http://cdsmith.wordpress.com/2011/07/30/arrow-category-applicative-part-i/">which fascinate me</a>).  Instead, I chose Haskell for the simple reason that it looked like math.  The rest of Haskell came with the territory.  I built <a href="https://github.com/cdsmith/gloss-web/">the first CodeWorld web site</a> in a weekend, and I had to settle on a language and accept all that came with it.</li>
<li>From the beginning, I made some changes for pedagogical reasons.  For example, gloss <a href="http://hackage.haskell.org/package/gloss-1.8.1.2/docs/Graphics-Gloss-Data-Picture.html#v:rotate">defines rotation to be clockwise</a>.  I insisted on rotation working in the counter-clockwise direction, because that’s the convention universally used in math.  Later, I <a href="https://github.com/google/codeworld/commit/ed9b654c63213cc8a5f27c00d4dcb1ac5e484568">resized the canvas to 20×20</a>, so that typical programs would need to use fractions and decimals, which is a middle school math education goal.  I made thes changes, even though they broke compatibility with a widely used package.  Sorry for anyone that’s struggled with this.</li>
<li>I rebranded “Haskell for Kids” as <a href="http://codeworld.info/">CodeWorld</a>, and stopped explicitly depending on gloss in favor of <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/Internal/Picture.hs">just reproducing its general approach</a> in a new Prelude.  This was a deliberate attempt to get away from focusing on the Haskell language and libraries, and also to the accompanying import statements and such.  This hid the ways that Haskell was a general purpose language with uses outside this toy environment.  That is unfortunate.</li>
<li>I <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/Prelude.hs">rewrote the Haskell Prelude</a>, to remove type classes.  Along the way, I <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/Internal/Num.hs">collapsed the whole numeric type class hierarchy into a single type</a>, and even got Luite (the author of GHCJS) to help me with some <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/Internal/DeepEq.hs">deep black magic</a> to implement <a href="https://github.com/google/codeworld/blob/master/codeworld-server/web/deep_eq.js">equality on arbitrary Haskell types without type classes</a>.  This threw away much of the beauty of Haskell… in favor of dramatically improved error messages, and fewer things you need to know to get started.  It was a real loss.</li>
<li>Finally, I commited the unforgivable sin.  I <a href="https://github.com/google/codeworld/commit/029587dbd5236bb849b9e2120c6349ac5562a490">dropped curried functions</a>, in favor of defining functions of multiple parameters using tuples.  This finally makes CodeWorld feel like a completely different language from Haskell.  That really sucks, and I know some people are frustrated.</li>
</ol>
<h1>Why It Happened?</h1>
<p>First, I want to point out some things that are <em>not</em> the reason for any of this:</p>
<ul>
<li>I did <em>not</em> do this because I think there’s something wrong with Haskell.  I love type classes.  I love currying, and especially love how it’s not just a convenient trick, but sometimes introduces whole new perspectives by <a href="https://hackage.haskell.org/package/base-4.7.0.1/docs/Data-List.html#v:map">viewing tedious functions of multiple parameters as simple, clean, and elegant higher-order functions</a>.</li>
<li>I also did <em>not</em> do this because I think anyone is incapable of learning full-fledged Haskell.  In fact, I taught full-fledged Haskell to middle schoolers for a year.  I know they can do it.</li>
</ul>
<p>So why did I do it?  Two reasons:</p>
<ul>
<li>Teaching mathematics has always been more important to me than teaching Haskell.  While Haskell is an awesome programming language, mathematics is just an awesome perspective on life.  For every student who benefits from learning an inspiring programming language, many students will benefit from learning that humanity has a method called mathematics for thinking about fundamental truths in a systematic, logical way that can capture things precisely.  So any time I have to choose between pushing students further toward their math education or away from it, I’ll choose toward it.</li>
<li>Details matter.  Even though I know kids are capable of a lot, they are capable of a lot more without artificial obstacles in their way.  I learned this the hard way teaching this class the first time.  The smallest little things, with absolutely no great significance as a language, matter a lot.  Having to put parentheses around negative numbers obscures students from reaching leaps of understanding.  Confusing error messages mean the difference between a student who spends a weekend learning, and one who gives up on Friday afternoon and doesn’t think about it until the next school day.  Different surface syntax means that a lot of kids never fully make the connection that functions here are the same thing as functions there.</li>
</ul>
<p>In the end, I do think these were the right decisions… despite the frustration they can cause for Haskell programmers who know there’s a better way.</p>
<h1>Making Up For It</h1>
<p>A couple weekends ago, though, I worked on something to hopefully restore some of this loss for Haskellers.  You see, all the changes I’ve made, in the end, come from replacing the Prelude module with my own alternative.  Specifically:</p>
<ol>
<li>I deliberately replaced functions from the Prelude with my modified versions.</li>
<li>Because I provided an alternative Prelude, I had to hide the <em>base</em> package, which made it impossible to import things like Control.Monad.  This was <em>not</em> a deliberate decision.  It just happened.</li>
</ol>
<p>So I fixed this.  I added to the <em>codeworld-base</em> package <a href="https://github.com/google/codeworld/commit/eabbaaf79ff330284e0256a4d61be3900b93c9a9">re-exports of all of the modules from <em>base</em></a>.  I renamed <i>Prelude</i> to <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/HaskellPrelude.hs">HaskellPrelude</a> in the process, so that it doesn’t conflict with my own Prelude.  And finally, I added a new module, <a href="https://github.com/google/codeworld/blob/master/codeworld-base/src/CodeWorld.hs">CodeWorld</a>, that exports all the really <em>new</em> stuff from CodeWorld like pictures, colors, and the interpreters for pictures, animations, simulations, etc.  The result is that you can now start your programs with the following:</p>
<pre>import Prelude()<br />import HaskellPrelude<br />import CodeWorld        -- If you still want to do pictures, etc.<br /><br />main = putStrLn "Hello, World"</pre>
<p>At this point, you can write any Haskell you like!  You aren’t even constrained to pure code, or safe code.  (The exception: TemplateHaskell is still rejected, since the compiler runs on the server, so TH code would execute code on the server.)</p>
<p>In fact, it’s even better!  You’re free to use GHCJS JavaScript foreign imports, to interact with the browser environment!  See <a href="http://codeworld.info/#PD8y4NCIxyl1vafBK2znHwA==">a brief example here.</a>  Now you’re out of the sandbox, and are free to play around however you like.</p>
<p>Right now, the CodeWorld module still uses uncurried functions and other CodeWorld conventions like Number for numbers, etc.  There’s no reason for this, and it’s something that I should probably change.  Anyone want to send a pull request?</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/cdsmith.wordpress.com/761/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/cdsmith.wordpress.com/761/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=cdsmith.wordpress.com&amp;blog=1158345&amp;post=761&amp;subd=cdsmith&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://cdsmith.wordpress.com/2014/08/26/on-codeworld-and-haskell/">by cdsmith at August 26, 2014 04:38 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://idontgetoutmuch.wordpress.com" title="Idontgetoutmuch's Weblog">Dominic Steinitz</a></h3>

<div class="entrygroup" id="http://idontgetoutmuch.wordpress.com/?p=730">
<blockquote>
<h1 class="entry"><a href="http://idontgetoutmuch.wordpress.com/2014/08/26/haskell-vectors-and-sampling-from-a-categorical-distribution/">Haskell Vectors and Sampling from a Categorical Distribution</a></h1>
<div class="entry">
<h1 id="introduction">Introduction</h1>
<p>Suppose we have a vector of weights which sum to 1.0 and we wish to sample n samples randomly according to these weights. There is a well known trick in <a href="http://en.wikipedia.org/wiki/MATLAB">Matlab</a> / <a href="http://en.wikipedia.org/wiki/GNU_Octave">Octave</a> using sampling from a uniform distribution.</p>
<pre class="sourceCode Matlab"><code class="sourceCode matlab">num_particles = <span class="fl">2</span>*<span class="fl">10</span>^<span class="fl">7</span>
likelihood = zeros(num_particles,<span class="fl">1</span>);
likelihood(:,<span class="fl">1</span>) = <span class="fl">1</span>/num_particles;
[_,index] = histc(rand(num_particles,<span class="fl">1</span>),[<span class="fl">0</span>;cumsum(likelihood/sum(likelihood))]);
s = sum(index);</code></pre>
<p>Using <em>tic</em> and <em>toc</em> this produces an answer with</p>
<pre><code>Elapsed time is 10.7763 seconds.</code></pre>
<h1 id="haskell">Haskell</h1>
<p>I could find no equivalent function in Haskell nor could I easily find a binary search function.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: green;">{-# OPTIONS_GHC -Wall                     #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-name-shadowing  #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-type-defaults   #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-unused-do-bind  #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span>
&gt; <span style="color: green;">{-# OPTIONS_GHC -fno-warn-orphans         #-}</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: green;">{-# LANGUAGE BangPatterns                 #-}</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> System.Random.MWC
&gt; <span style="color: blue; font-weight: bold;">import</span> <span style="color: blue; font-weight: bold;">qualified</span> Data.Vector.Unboxed <span style="color: blue; font-weight: bold;">as</span> V
&gt; <span style="color: blue; font-weight: bold;">import</span> Control.Monad.ST
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> <span style="color: blue; font-weight: bold;">qualified</span> Data.Vector.Algorithms.Search <span style="color: blue; font-weight: bold;">as</span> S
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; <span style="color: blue; font-weight: bold;">import</span> Data.Bits
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; n <span style="color: red;">::</span> Int
&gt; n <span style="color: red;">=</span> <span class="hs-num">2</span>*<span class="hs-num">10</span>^<span class="hs-num">7</span>
</code></pre>
<p>Let’s create some random data. For a change let’s use <a href="https://hackage.haskell.org/package/mwc-random">mwc-random</a> rather than <a href="https://hackage.haskell.org/package/random-fu">random-fu</a>.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; vs  <span style="color: red;">::</span> V.Vector Double
&gt; vs <span style="color: red;">=</span> runST <span style="color: red;">(</span>create &gt;&gt;= <span style="color: red;">(</span>asGenST $ <span style="color: red;">\</span>gen <span style="color: red;">-&gt;</span> uniformVector gen n<span style="color: red;">)</span><span style="color: red;">)</span>
</code></pre>
<p>Again, I could find no equivalent of <em>cumsum</em> but we can write our own.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; weightsV<span style="color: red;">,</span> cumSumWeightsV <span style="color: red;">::</span> V.Vector Double
&gt; weightsV <span style="color: red;">=</span> V.replicate n <span style="color: red;">(</span>recip $ fromIntegral n<span style="color: red;">)</span>
&gt; cumSumWeightsV <span style="color: red;">=</span> V.scanl <span style="color: red;">(</span>+<span style="color: red;">)</span> <span class="hs-num">0</span> weightsV
</code></pre>
<p>Binary search on a sorted vector is straightforward and a cumulative sum ensures that the vector is sorted.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; binarySearch <span style="color: red;">::</span> <span style="color: red;">(</span>V.Unbox a<span style="color: red;">,</span> Ord a<span style="color: red;">)</span> <span style="color: red;">=&gt;</span>
&gt;                 V.Vector a <span style="color: red;">-&gt;</span> a <span style="color: red;">-&gt;</span> Int
&gt; binarySearch vec x <span style="color: red;">=</span> loop <span class="hs-num">0</span> <span style="color: red;">(</span>V.length vec <span style="color: green;">-</span> <span class="hs-num">1</span><span style="color: red;">)</span>
&gt;   <span style="color: blue; font-weight: bold;">where</span>
&gt;     loop !l !u
&gt;       <span style="color: red;">|</span> u &lt;= l    <span style="color: red;">=</span> l
&gt;       <span style="color: red;">|</span> otherwise <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">let</span> e <span style="color: red;">=</span> vec V.! k <span style="color: blue; font-weight: bold;">in</span> <span style="color: blue; font-weight: bold;">if</span> x &lt;= e <span style="color: blue; font-weight: bold;">then</span> loop l k <span style="color: blue; font-weight: bold;">else</span> loop <span style="color: red;">(</span>k+<span class="hs-num">1</span><span style="color: red;">)</span> u
&gt;       <span style="color: blue; font-weight: bold;">where</span> k <span style="color: red;">=</span> l + <span style="color: red;">(</span>u - l<span style="color: red;">)</span> `shiftR` <span class="hs-num">1</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; indices <span style="color: red;">::</span> V.Vector Double <span style="color: red;">-&gt;</span> V.Vector Double <span style="color: red;">-&gt;</span> V.Vector Int
&gt; indices bs xs <span style="color: red;">=</span> V.map <span style="color: red;">(</span>binarySearch bs<span style="color: red;">)</span> xs
</code></pre>
<p>To see how well this performs, let’s sum the indices (of course, we wouldn’t do this in practice) as we did for the Matlab implementation.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; js <span style="color: red;">::</span> V.Vector Int
&gt; js <span style="color: red;">=</span> indices <span style="color: red;">(</span>V.tail cumSumWeightsV<span style="color: red;">)</span> vs
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; main <span style="color: red;">::</span> IO ()
&gt; main <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
&gt;   print $ V.foldl' <span style="color: red;">(</span>+<span style="color: red;">)</span> <span class="hs-num">0</span> js
</code></pre>
<p>Using <em>+RTS -s</em> we get</p>
<pre><code>Total   time   10.80s  ( 11.06s elapsed)</code></pre>
<p>which is almost the same as the Matlab version.</p>
<p>I did eventually find a binary search function in <a href="https://hackage.haskell.org/package/vector-algorithms">vector-algorithms</a> and since one should not re-invent the wheel, let us try using it.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; indices' <span style="color: red;">::</span> <span style="color: red;">(</span>V.Unbox a<span style="color: red;">,</span> Ord a<span style="color: red;">)</span> <span style="color: red;">=&gt;</span> V.Vector a <span style="color: red;">-&gt;</span> V.Vector a <span style="color: red;">-&gt;</span> V.Vector Int
&gt; indices' sv x <span style="color: red;">=</span> runST $ <span style="color: blue; font-weight: bold;">do</span>
&gt;   st <span style="color: red;">&lt;-</span> V.unsafeThaw <span style="color: red;">(</span>V.tail sv<span style="color: red;">)</span>
&gt;   V.mapM <span style="color: red;">(</span>S.binarySearch st<span style="color: red;">)</span> x
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell">&gt; main' <span style="color: red;">::</span> IO ()
&gt; main' <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
&gt;   print $  V.foldl' <span style="color: red;">(</span>+<span style="color: red;">)</span> <span class="hs-num">0</span> $ indices' cumSumWeightsV vs
</code></pre>
<p>Again using <em>+RTS -s</em> we get</p>
<pre><code>Total   time   11.34s  ( 11.73s elapsed)</code></pre>
<p>So the library version seems very slightly slower.</p>
<div class="references"></div><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/idontgetoutmuch.wordpress.com/730/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/idontgetoutmuch.wordpress.com/730/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=idontgetoutmuch.wordpress.com&amp;blog=2944309&amp;post=730&amp;subd=idontgetoutmuch&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://idontgetoutmuch.wordpress.com/2014/08/26/haskell-vectors-and-sampling-from-a-categorical-distribution/">by Dominic Steinitz at August 26, 2014 03:05 PM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 25, 2014</h2>

<div class="channelgroup">







<h3><a href="http://jozefg.bitbucket.org" title="Code and Co">Danny Gratzer</a></h3>

<div class="entrygroup" id="http://jozefg.bitbucket.org/posts/2014-08-25-dep-types-part-1.html">
<blockquote>
<h1 class="entry"><a href="http://jozefg.bitbucket.org/posts/2014-08-25-dep-types-part-1.html">Introduction to Dependent Types: Haskell on Steroids</a></h1>
<div class="entry">
<div class="info">
    Posted on August 25, 2014
    
</div>
<p>I’d like to start another series of blog posts. This time on something that I’ve wanted to write about for a while, dependent types.</p>
<p>There’s a noticeable lack of accessible materials introducing dependent types at a high level aimed at functional programmers. That’s what this series sets out help fill. Therefore, if you’re a Haskell programmer and don’t understand something, it’s a bug! Please comment so I can help make this a more useful resource for you :)</p>
<p>There are four parts to this series, each answering one question</p>
<ol style="">
<li>What are dependent types?</li>
<li>What does a dependently typed language look like?</li>
<li>What does it feel like to write programs with dependent types?</li>
<li>What does it mean to “prove” something?</li>
</ol>
<p>So first things first, what are dependent types? Most people by now have heard the unhelpful quick answer</p>
<blockquote>
<p>A dependent type is a type that depends on a value, not just other types.</p>
</blockquote>
<p>But that’s not helpful! What does this actually look like? To try to understand this we’re going to write some Haskell code that pushes us as close as we can get to dependent types in Haskell.</p>
<h2 id="kicking-ghc-in-the-teeth">Kicking GHC in the Teeth</h2>
<p>Let’s start with the flurry of extensions we need</p>
<pre><code>{-# LANGUAGE DataKinds            #-}
{-# LANGUAGE KindSignatures       #-}
{-# LANGUAGE GADTs                #-}
{-# LANGUAGE TypeFamilies         #-}
{-# LANGUAGE UndecidableInstances #-}</code></pre>
<p>Now our first definition is a standard formulation of natural numbers</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="kw">data</span> <span class="dt">Nat</span> <span class="fu">=</span> <span class="dt">Z</span> <span class="fu">|</span> <span class="dt">S</span> <span class="dt">Nat</span></code></pre>
<p>Here <code>Z</code> represents 0 and <code>S</code> means <code>+ 1</code>. So you should read <code>S Z</code> as 1, <code>S (S Z)</code> as 2 and so on and so on.</p>
<p>If you’re having some trouble, this function to convert an <code>Int</code> to a <code>Nat</code> might help</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="co">-- Naively assume n &gt;= 0</span>
<span class="ot">    toNat ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span>
    toNat <span class="dv">0</span> <span class="fu">=</span> <span class="dt">Z</span>
    toNat n <span class="fu">=</span> <span class="dt">S</span> (toNat <span class="fu">$</span> n <span class="fu">-</span> <span class="dv">1</span>)</code></pre>
<p>We can use this definition to formulate addition</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    plus ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span>
    plus <span class="dt">Z</span> n     <span class="fu">=</span> n
    plus (<span class="dt">S</span> n) m <span class="fu">=</span> <span class="dt">S</span> (plus n m)</code></pre>
<p>This definition proceeds by “structural induction”. That’s a scary word that pops up around dependent types. It’s not all that complicated, all that it means is that we use recursion only on <em>strictly smaller terms</em>.</p>
<p>There is a way to formally define smaller, if a term is a constructor applied to several (recursive) arguments. Any argument to the constructor is strictly smaller than the original terms. In a strict language if we restrict ourselves to only structural recursion we’re guaranteed that our function will terminate. This isn’t quite the case in Haskell since we have infinite structures.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    toInt ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="dt">Int</span>
    toInt (<span class="dt">S</span> n) <span class="fu">=</span> <span class="dv">1</span> <span class="fu">+</span> toInt n
    toInt <span class="dt">Z</span>     <span class="fu">=</span> <span class="dv">0</span>

    bigNumber <span class="fu">=</span> <span class="dt">S</span> bigNumber

    main <span class="fu">=</span> print (toInt bigNumber) <span class="co">-- Uh oh!</span></code></pre>
<p>Often people will cheerfully ignore this part of Haskell when talking about reasoning with Haskell and I’ll stick to that tradition (for now).</p>
<p>Now back to the matter at hand. Since our definition of <code>Nat</code> is quite straightforward, it get’s promoted to the <a href="http://jozefg.bitbucket.org/posts/2014-02-10-types-kinds-and-sorts.html">kind</a> level by <code>DataKinds</code>.</p>
<p>Now we can “reflect” values back up to this new kind with a second GADTed definition of natural numbers.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="kw">data</span> <span class="dt">RNat</span><span class="ot"> ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="fu">*</span> <span class="kw">where</span>
      <span class="dt">RZ</span><span class="ot"> ::</span> <span class="dt">RNat</span> <span class="dt">Z</span>
      <span class="dt">RS</span><span class="ot"> ::</span> <span class="dt">RNat</span> n <span class="ot">-&gt;</span> <span class="dt">RNat</span> (<span class="dt">S</span> n)</code></pre>
<p>Now, let’s precisely specify the somewhat handwavy term “reflection”. I’m using it in the imprecise sense meaning that we’ve lifted a value into something isomorphic at the type level. Later we’ll talk about reflection precisely mean lifting a value into the type level. That’s currently not possible since we can’t have values in our types!</p>
<p>What on earth could that be useful for? Well with this we can do something fancy with the definition of addition.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="kw">type</span> family <span class="dt">Plus</span> n<span class="ot"> m ::</span> <span class="dt">Nat</span> <span class="kw">where</span>
      <span class="dt">Plus</span> <span class="dt">Z</span> n     <span class="fu">=</span> n
      <span class="dt">Plus</span> (<span class="dt">S</span> n) m <span class="fu">=</span> <span class="dt">S</span> (<span class="dt">Plus</span> n m)</code></pre>
<p>Now we’ve reflected our definition of addition to the type family. More than that, what we’ve written above is fairly obviously correct. We can now force our value level definition of addition to respect this type family</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    plus' ::</span> <span class="dt">RNat</span> n <span class="ot">-&gt;</span> <span class="dt">RNat</span> m <span class="ot">-&gt;</span> <span class="dt">RNat</span> (<span class="dt">Plus</span> n m)
    plus' <span class="dt">RZ</span> n     <span class="fu">=</span> n
    plus' (<span class="dt">RS</span> n) m <span class="fu">=</span> <span class="dt">RS</span> (plus' n m)</code></pre>
<p>Now if we messed up this definition we’d get a type error!</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    plus' ::</span> <span class="dt">RNat</span> n <span class="ot">-&gt;</span> <span class="dt">RNat</span> m <span class="ot">-&gt;</span> <span class="dt">RNat</span> (<span class="dt">Plus</span> n m)
    plus' <span class="dt">RZ</span> n     <span class="fu">=</span> n
    plus' (<span class="dt">RS</span> n) m <span class="fu">=</span> plus' n m <span class="co">-- Unification error! n ~ S n</span></code></pre>
<p>Super! We know have types that express strict guarantees about our program. But how useable is this?</p>
<p>To put it to the test, let’s try to write some code that reads to integers for standard input and prints their sum.</p>
<p>We can easily do this with our normal <code>plus</code></p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    readNat ::</span> <span class="dt">IO</span> <span class="dt">Nat</span>
    readNat <span class="fu">=</span> toNat <span class="fu">&lt;$&gt;</span> readLn

<span class="ot">    main ::</span> <span class="dt">IO</span> ()
    main <span class="fu">=</span> plus <span class="fu">&lt;$&gt;</span> readNat <span class="fu">&lt;*&gt;</span> readNat</code></pre>
<p>Easy as pie! But what about <code>RNat</code>, how can we convert a <code>Nat</code> to an <code>RNat</code>? Well we could try something with type classes I guess</p>
<pre><code>class Reify a where
  type N
  reify :: a -&gt; RNat N</code></pre>
<p>But wait, that doesn’t work since we can only have once instance for all <code>Nat</code>s. What if we did the opposite</p>
<pre><code>class Reify (n :: Nat) where
  nat :: RNat n -&gt; Nat</code></pre>
<p>This let’s us go in the other direction.. but that doesn’t help us! In fact there’s no obvious way to propagate runtime values back into the types. We’re stuck.</p>
<h2 id="ghc-with-iron-dentures">GHC with Iron Dentures</h2>
<p>Now, if we could add some magical extension to GHC could we write something like above program? Yes of course! The key idea is to not reflect up our types with data kinds, but rather just allow the values to exist in the types on their own.</p>
<p>For these I propose two basic ideas</p>
<ol style="">
<li>A special reflective function type</li>
<li>Lifting expressions into types</li>
</ol>
<p>For our special function types, we allow the return <em>type</em> to use the supplied <em>value</em>. These are called pi types. We’ll give this the following syntax</p>
<pre><code>(x :: A) -&gt; B x</code></pre>
<p>Where <code>A :: *</code> and <code>B :: A -&gt; *</code> are some sort of type. Notice that that <code>A</code> in <code>B</code>’s kind isn’t the data kind promoted version, but just the goodness to honest normal value.</p>
<p>Now in order to allow <code>B</code> to actually make use of it’s supplied value, our second idea let’s normal types be indexed on values! Just like how GADTs can be indexed on types. We’ll call these GGADTs.</p>
<p>So let’s define a new version of <code>RNat</code></p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="kw">data</span> <span class="dt">RNat</span><span class="ot"> ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="fu">*</span> <span class="kw">where</span>
      <span class="dt">RZ</span><span class="ot"> ::</span> <span class="dt">RNat</span> <span class="dt">Z</span>
      <span class="dt">RS</span><span class="ot"> ::</span> <span class="dt">RNat</span> n <span class="ot">-&gt;</span> <span class="dt">RNat</span> (<span class="dt">S</span> n)</code></pre>
<p>This looks exactly like what we had before, but our semantics are different now. Those <code>Z</code>’s and <code>S</code>’s are meant to represent actual values, not members of some kind. There’s no promoting types to singleton kinds anymore, just plain old values being held in fancier types.</p>
<p>Because we can depend on normal values, we don’t even have to use our simple custom natural numbers.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="kw">data</span> <span class="dt">RInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="fu">*</span> <span class="kw">where</span>
      <span class="dt">RZ</span><span class="ot"> ::</span> <span class="dt">RInt</span> <span class="dv">0</span>
      <span class="dt">RS</span><span class="ot"> ::</span> <span class="dt">RInt</span> n <span class="ot">-&gt;</span> <span class="dt">RInt</span> (<span class="dv">1</span> <span class="fu">+</span> n)</code></pre>
<p>Notice that we allowed our types to call functions, like <code>+</code>. This can potentially be undecidable, something that we’ll address later.</p>
<p>Now we can write our function with a combination of these two ideas</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    toRInt ::</span> (<span class="ot">n ::</span> <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">RInt</span> n
    toRInt <span class="dv">0</span> <span class="fu">=</span> <span class="dt">RZ</span>
    toRInt n <span class="fu">=</span> <span class="dt">RS</span> (toRInt <span class="fu">$</span> n <span class="fu">-</span> <span class="dv">1</span>)</code></pre>
<p>Notice how we used pi types to change the return type dependent on the input <em>value</em>. Now we can feed this any old value, including ones we read from standard input.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    main <span class="fu">=</span> print <span class="fu">.</span> toInt <span class="fu">$</span> plus' <span class="fu">&lt;$&gt;</span> fmap toRInt readLn <span class="fu">&lt;*&gt;</span> fmap toRInt readLn</code></pre>
<p>Now, one might wonder how the typechecker could possibly know how to handle such things, after all how could it know what’ll be read from stdin!</p>
<p>The answer is that it doesn’t. When a value is reflected to the type level we can’t do anything with it. For example, if we had a type like</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">    (<span class="ot">n ::</span> <span class="dt">Int</span>) <span class="ot">-&gt;</span> (<span class="kw">if</span> n <span class="fu">==</span> <span class="dv">0</span> <span class="kw">then</span> <span class="dt">Bool</span> <span class="kw">else</span> ())</code></pre>
<p>Then we would have to pattern match on <code>n</code> at the value level to propagate information about <code>n</code> back to the type level.</p>
<p>If we did something like</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    foo ::</span> (<span class="ot">n ::</span> <span class="dt">Int</span>) <span class="ot">-&gt;</span> (<span class="kw">if</span> n <span class="fu">==</span> <span class="dv">0</span> <span class="kw">then</span> <span class="dt">Bool</span> <span class="kw">else</span> ())
    foo n <span class="fu">=</span> <span class="kw">case</span> n <span class="kw">of</span>
      <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dt">True</span>
      _ <span class="ot">-&gt;</span> ()</code></pre>
<p>Then the typechecker would see that we’re matching on <code>n</code>, so if we get into the <code>0 -&gt; ...</code> branch then <code>n</code> must be <code>0</code>. It can then reduce the return type to <code>if 0 == 0 then Bool else ()</code> and finally <code>Bool</code>. A very important thing to note here is that the typechecker <em>doesn’t evaluate the program</em>. It’s examining the function in isolation of all other values. This means we sometimes have to hold its hand to ensure that it can figure out that all branches have the correct type.</p>
<p>This means that when we use pi types we often have to pattern match on our arguments in order to help the typechecker figure out what’s going on.</p>
<p>To make this clear, let’s play the typechecker for this function. I’m reverting to the <code>Nat</code> type since it’s nicer for pattern matching.</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    toRNat ::</span> (<span class="ot">n ::</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> <span class="dt">RNat</span> n
    toRNat <span class="dt">Z</span> <span class="fu">=</span> <span class="dt">RZ</span> <span class="co">-- We know that n is `Z` in this branch</span>
    toRNat (<span class="dt">S</span> n) <span class="fu">=</span> <span class="dt">RS</span> (toRNat n <span class="co">{- This has the type RNat n' -}</span>)

<span class="ot">    p ::</span> (<span class="ot">n ::</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> (<span class="ot">m ::</span> <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">RNat</span> (plus n m)
    p <span class="dt">Z</span> m     <span class="fu">=</span> toRNat m
    p (<span class="dt">S</span> n) m <span class="fu">=</span> <span class="dt">RS</span> (toRNat n m)</code></pre>
<p>First the type checker goes through <code>toRNat</code>.</p>
<p>In the first branch we have <code>n</code> equals <code>Z</code>, so <code>RZ</code> trivially typechecks. Next we have the case <code>S n</code>.</p>
<ul>
<li>We know that <code>toRNat n</code> has the type <code>RNat n'</code> by induction</li>
<li>We also know that <code>S n' = n</code>.</li>
<li>Therefore <code>RS</code> builds us a term of type <code>RNat n</code>.</li>
</ul>
<p>Now for <code>p</code>. We start in much the same manner.</p>
<p>if we enter the <code>p Z m</code> case</p>
<ul>
<li>we know that <code>n</code> is <code>Z</code>.</li>
<li>we can reduce <code>plus n m</code> since <code>plus Z m</code> is by definition equal to <code>m</code> Look at the definition of <code>plus</code> to confirm this).</li>
<li>We know how to produce <code>RNat m</code> easily since we have a function <code>toRNat :: (n :: Nat) -&gt; RNat n</code>.</li>
<li>We can apply this to <code>m</code> and the resulting term has the type <code>RNat m</code>.</li>
</ul>
<p>In the <code>RS</code> case we know that we’re trying to produce a term of type <code>RNat (plus (S n) m)</code>.</p>
<ul>
<li>Now since we know that the constructor for the first argument of <code>plus</code>, we can reduce <code>plus (S n) m</code> to <code>S (plus n m)</code> by the definition of <code>plus</code>.</li>
<li>We’re looking to build a term of type <code>plus n m</code> and that’s as simple as a recursive call.</li>
<li>From here we just need to apply <code>RS</code> to give us <code>S (plus n m)</code></li>
<li>As we previously noted <code>S (plus n m)</code> is equal to <code>plus (S n) m</code></li>
</ul>
<p>Notice how as we stepped through this as the typechecker we never needed to do any arbitrary reductions. We only ever reduce definitions when we have the outer constructor (WHNF) of one of the arguments.</p>
<p>While I’m not actually proposing adding <code>{-# LANGUAGE PiTypes #-}</code> to GHC, it’s clear that with only a few orthogonal editions to system F we can get some seriously cool types.</p>
<h2 id="wrap-up">Wrap Up</h2>
<p>Believe or not we’ve just gone through two of the most central concepts in dependent types</p>
<ul>
<li>Indexed type families (GGADTs)</li>
<li>Dependent function types (Pi types)</li>
</ul>
<p>Not so bad was it? :) From here we’ll look in the next post how to translate our faux Haskell into actual Agda code. From there we’ll go through a few more detailed examples of pi types and GGADTs by poking through some of the Agda standard library.</p>
<p>Thanks for reading, I must run since I’m late for class. It’s an FP class ironically enough.</p>
<div id="disqus_thread"></div>
          &lt;script type="text/javascript"&gt;
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'codeco'; // required: replace example with your forum shortname
            
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          &lt;/script&gt;
          &lt;noscript&gt;Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>&lt;/noscript&gt;
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>






<p class="date">
<a href="http://jozefg.bitbucket.org/posts/2014-08-25-dep-types-part-1.html">August 25, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 24, 2014</h2>

<div class="channelgroup">







<h3><a href="http://serras-haskell-gsoc.blogspot.com/" title="Summers on Haskell and {Eclipse,Emacs}">Alejandro Serrano Mena</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-881207385008920659.post-5274075016873574339">
<blockquote>
<h1 class="entry"><a href="http://serras-haskell-gsoc.blogspot.com/2014/08/using-emacs-for-haskell-development.html">Using Emacs for Haskell development</a></h1>
<div class="entry">
<p>In the last months, the toolchain for using Haskell within Emacs has changed a lot, and has become a lot better. Apart from my <a href="http://serras-haskell-gsoc.blogspot.nl/2014/08/summer-of-code-on-emacs.html">additions to <tt>ghc-mod</tt></a>, new autocompletion packages such as <a href="https://github.com/iquiw/company-ghc"><tt>company-ghc</tt></a> have appeared.</p><p>In the past, I've felt that there was a need for a comprehensive article of all the available options for Haskell development in Emacs, including <tt>haskell-mode</tt>, <tt>ghc-mod</tt>, <tt>company-ghc</tt>, HaRe and <tt>structured-haskell-mode</tt>. To fill this gap, I have written a <a href="https://github.com/serras/emacs-haskell-tutorial/blob/master/tutorial.md">tutorial</a> covering installation, configuration and use of these tools, especially keeping an eye into making all of them work nicely when put together.</p><p>Hope it helps!</p></div>






<p class="date">
<a href="http://serras-haskell-gsoc.blogspot.com/2014/08/using-emacs-for-haskell-development.html">by Alejandro Serrano (noreply@blogger.com) at August 24, 2014 10:48 AM</a>
</p>
</blockquote>
</div>



<div class="entrygroup" id="tag:blogger.com,1999:blog-881207385008920659.post-3930689784630307512">
<blockquote>
<h1 class="entry"><a href="http://serras-haskell-gsoc.blogspot.com/2014/08/summer-of-code-on-emacs.html">Summer of Code on Emacs!</a></h1>
<div class="entry">
<p>This summer I've been participating in Google Summer of Code, as I did some years ago. My aim was the same: to make it easier for Haskell developers to interact with their code. But instead of Eclipse, I've focused on another very well-known editor: <a href="http://www.gnu.org/software/emacs/">Emacs</a>. In particular, I've been extending the already excellent <a href="http://www.mew.org/~kazu/proj/ghc-mod/en/">ghc-mod</a>.</p><p>During the last year I've turned increasingly jealous of the Emacs modes for <a href="http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.QuickGuideToEditingTypeCheckingAndCompilingAgdaCode">Agda</a> and <a href="https://github.com/idris-hackers/idris-mode">Idris</a>, two programming languages which resemble Haskell but add dependent types to the mix. Using those modes, you can work interactively with your code, write pattern matches automatically, refine certain parts of your code, ask the compiler what is the type that a certain code should have, and so on. Furthermore, since version 7.8 GHC includes <a href="https://www.haskell.org/ghc/docs/latest/html/users_guide/typed-holes.html">support for typed holes</a>, so it seemed like all the necessary infrastructure from the compiler was in place to do this.</p><p>Instead of a boring description of the outcome of the project, I have prepared a video demostration ;) </p><center>&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="450" src="http://www.youtube.com/embed/k4BzN_VM8ds" width="600"&gt;&lt;/iframe&gt;</center><p></p><p>As a summary, here is the list of new key bindings that you can use since the release (just a few days ago) of ghc-mod 5.0: </p><ul><li><b>C-u M-t</b>: create the skeleton of a function from its signature, or the skeleton of a type class instance from its declaration,</li><li><b>M-t</b>: perform case splitting on variables;</li><li><b>C-c M-n</b> and <b>C-c M-p</b>: navigate between typed holes in your program, to the next or the previous one, respectively;</li><li><b>C-c C-f</b>: refine a hole through an expression, including as much holes as needed to make it type check; </li><li><b>C-c C-a</b>: try automatic completion of a hole by calling Djinn.</li></ul><p></p><p>I would like to thank eveybody who has helped me during this summer, especially my mentor <a href="http://itu.dk/people/drc/">David Raymond Christiansen</a> (whose work in idris-mode is just amazing) and <a href="http://www.mew.org/~kazu/">Kazu Yamamoto</a>, the creator and maintainer of ghc-mod.</p></div>






<p class="date">
<a href="http://serras-haskell-gsoc.blogspot.com/2014/08/summer-of-code-on-emacs.html">by Alejandro Serrano (noreply@blogger.com) at August 24, 2014 09:09 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 23, 2014</h2>

<div class="channelgroup">







<h3><a href="http://antti-juhani.kaijanaho.fi/newblog" title="Antti-Juhani Kaijanaho » Haskell">Antti-Juhani Kaijanaho (ibid)</a></h3>

<div class="entrygroup" id="http://antti-juhani.kaijanaho.fi/newblog/?p=1614">
<blockquote>
<h1 class="entry"><a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1614">A milestone toward a doctorate</a></h1>
<div class="entry">
<p>Yesterday I received my official diploma for the degree of Licentiate of Philosophy.  The degree lies between a Master’s degree and a doctorate, and is not required; it consists of the coursework required for a doctorate, and a Licentiate Thesis, “in which the student demonstrates good conversance with the field of research and the capability of independently and critically applying scientific research methods” (official translation of the <a href="http://www.finlex.fi/fi/laki/kaannokset/2004/20040794">Government decree on university degrees 794/2004</a>, Section 23 Paragraph 2).</p>
<p>The title and abstract of my Licentiate Thesis follow:</p>
<blockquote><p>
Kaijanaho, Antti-Juhani<br />
The extent of empirical evidence that could inform evidence-based design of programming languages. A systematic mapping study.<br />
Jyväskylä: University of Jyväskylä, 2014, 243 p.<br />
(Jyväskylä Licentiate Theses in Computing,<br />
ISSN 1795-9713; 18)<br />
ISBN 978-951-39-5790-2 (nid.)<br />
ISBN 978-951-39-5791-9 (PDF)<br />
Finnish summary</p>
<p><em>Background</em>: Programming language design is not usually informed by empirical studies. In other fields similar problems have inspired an evidence-based paradigm of practice. Central to it are secondary studies summarizing and consolidating the research literature. <em>Aims</em>: This systematic mapping study looks for empirical research that could inform evidence-based design of programming languages. <em>Method</em>: Manual and keyword-based searches were performed, as was a single round of snowballing. There were 2056 potentially relevant publications, of which 180 were selected for inclusion, because they reported empirical evidence on the efficacy of potential design decisions and were published on or before 2012. A thematic synthesis was created. <em>Results</em>: Included studies span four decades, but activity has been sparse until the last five years or so. The form of conditional statements and loops, as well as the choice between static and dynamic typing have all been studied empirically for efficacy in at least five studies each. Error proneness, programming comprehension, and human effort are the most common forms of efficacy studied. Experimenting with programmer participants is the most popular method. <em>Conclusions</em>: There clearly are language design decisions for which empirical evidence regarding efficacy exists; they may be of some use to language designers, and several of them may be ripe for systematic reviewing. There is concern that the lack of interest generated by studies in this topic area until the recent surge of activity may indicate serious issues in their research approach.</p>
<p>Keywords: programming languages, programming language design, evidence-based paradigm, efficacy, research methods, systematic mapping study, thematic synthesis
</p></blockquote>
<p>A Licentiate Thesis is assessed by two examiners, usually drawn from outside of the home university; they write (either jointly or separately) a substantiated statement about the thesis, in which they suggest a grade.  The final grade is almost always the one suggested by the examiners.  I was very fortunate to have such prominent scientists as Dr. Stefan Hanenberg and Prof. Stein Krogdahl as the examiners of my thesis.  They recommended, and I received, the grade “very good” (4 on a scale of 1–5).</p>
<p>The thesis has been <del datetime="2014-08-29T08:24:55+00:00">accepted for publication</del> <ins datetime="2014-08-29T08:24:55+00:00">published</ins> in our faculty’s licentiate thesis series and <del datetime="2014-08-29T08:24:55+00:00">will in due course appear</del> <ins datetime="2014-08-29T08:24:55+00:00"><a href="https://jyx.jyu.fi/dspace/handle/123456789/44131">has appeared</a></ins> in our university’s electronic database (along with a very small number of printed copies).<del datetime="2014-08-29T08:24:55+00:00">  In the mean time, if anyone wants an electronic preprint, send me email at <a href="mailto:antti-juhani.kaijanaho@jyu.fi">antti-juhani.kaijanaho@jyu.fi</a>.</del></p>
&lt;figure class="wp-caption aligncenter" id="attachment_1622" style="width: 334px;"&gt;<a href="http://antti-juhani.kaijanaho.fi/newblog/wp-content/uploads/2014/08/pic-process.png"><img src="http://antti-juhani.kaijanaho.fi/newblog/wp-content/uploads/2014/08/pic-process.png" alt="Figure 1 of the thesis: an overview of the mapping process" width="334" class="size-full wp-image-1622" height="304" /></a>&lt;figcaption class="wp-caption-text"&gt;Figure 1 of the thesis: an overview of the mapping process&lt;/figcaption&gt;&lt;/figure&gt;
<p>As you can imagine, the last couple of months in the spring were very stressful for me, as I pressed on to submit this thesis. After submission, it took me nearly two months to recover (which certain people who emailed me on Planet Haskell business during that period certainly noticed).  It represents the fruit of almost four years of work (way more than normally is taken to complete a Licentiate Thesis, but never mind that), as I designed this study in Fall 2010.</p>
&lt;figure class="wp-caption aligncenter" id="attachment_1625" style="width: 330px;"&gt;<a href="http://antti-juhani.kaijanaho.fi/newblog/wp-content/uploads/2014/08/pic-coreyears.png"><img src="http://antti-juhani.kaijanaho.fi/newblog/wp-content/uploads/2014/08/pic-coreyears.png" alt="Figure 8 of the thesis: Core studies per publication year" width="330" class="size-full wp-image-1625" height="161" /></a>&lt;figcaption class="wp-caption-text"&gt;Figure 8 of the thesis: Core studies per publication year&lt;/figcaption&gt;&lt;/figure&gt;
<p>Recently, I have been writing in my blog a series of posts in which I have been trying to clear my head about certain foundational issues that irritated me during the writing of the thesis.  The thesis contains some of that, but that part of it is not very strong, as my examiners put it, for various reasons.  The posts have been a deliberately non-academic attempt to shape the thoughts into words, to see what they look like fixed into a tangible form.  (If you go read them, be warned: many of them are deliberately provocative, and many of them are intended as tentative in fact if not in phrasing; the series also is very incomplete at this time.)</p>
<p>I closed <a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1609" title="Philosophy matters">my previous post, the latest post in that series</a>, as follows:</p>
<blockquote><p>In fact, the whole of 20th Century philosophy of science is a big pile of failed attempts to explain science; not one explanation is fully satisfactory. [...] Most scientists enjoy not pondering it, for it’s a bit like being a cartoon character: so long as you don’t look down, you can walk on air.</p></blockquote>
<p>I wrote my Master’s Thesis <a href="http://users.jyu.fi/~antkaij/gradu.pdf">(PDF)</a> in 2002.  It was about the formal method called “B”; but I took a lot of time and pages to examine the history and content of formal logic.  My supervisor was, understandably, exasperated, but I did receive the highest possible grade for it (which I never have fully accepted I deserved).  The main reason for that digression: I looked down, and I just had to go poke the bridge I was standing on to make sure I was not, in fact, walking on air.  In the many years since, I’ve taken a lot of time to study foundations, first of mathematics, and more recently of science.  It is one reason it took me about eight years to come up with a doable doctoral project (and I am still amazed that my department kept employing me; but I suppose they like my teaching, as do I).  The other reason was, it took me that long to realize how to study the design of programming languages without going where everyone has gone before.</p>
<p>Debian people, if any are still reading, may find it interesting that I found significant use for the <tt>dctrl-tools</tt> toolset I have been writing for Debian for about fifteen years: I stored my data collection as a big pile of dctrl-format files.  I ended up making some changes to the existing tools (I should upload the new version soon, I suppose), and I wrote another toolset (unfortunately one that is not general purpose, like the <tt>dctrl-tools</tt> are) in the process.</p>
<p>For the Haskell people, I mainly have an apology for not attending to Planet Haskell duties in the summer; but I am back in business now.  I also note, somewhat to my regret, that I found very few studies dealing with Haskell.  I just checked; I mention Haskell several times in the background chapter, but it is not mentioned in the results chapter (because there were not studies worthy of special notice).</p>
<p>I am already working on extending this work into a doctoral thesis.  I expect, and hope, to complete that one faster.</p></div>






<p class="date">
<a href="http://antti-juhani.kaijanaho.fi/newblog/archives/1614">by Antti-Juhani Kaijanaho at August 23, 2014 05:44 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.joachim-breitner.de//blog" title="nomeata’s mind shares">Joachim Breitner</a></h3>

<div class="entrygroup" id="http://www.joachim-breitner.de/blog/656-This_blog_goes_static">
<blockquote>
<h1 class="entry"><a href="http://www.joachim-breitner.de/blog/656-This_blog_goes_static">This blog goes static</a></h1>
<div class="entry">
<p>After a bit more than 9 years, I am replacing <a href="http://s9y.org/">Serendipity</a>, which as been hosting my blog, by a self-made static solution. This means that when you are reading this, my server no longer has to execute some rather large body of untyped code to produce the bytes sent to you. Instead, that happens once in a while on my laptop, and they are stored as static files on the server.
  </p>
  <p>I hope to get a little performance boost from this, so that my site can more easily hold up to being <a href="https://news.ycombinator.com/item?id=6934611">mentioned on hackernews</a>. I also do not want to worry about security issues in Serendipity – static files are not hacked.
  </p>
  <p>Of course there are down-sides to having a static blog. The editing is a bit more annoying: I need to use my laptop (previously I could post from anywhere) and I edit text files instead of using a JavaScript-based WYSIWYG editor (but I was slightly annoyed by that as well). But most importantly your readers cannot comment on static pages. There are cloud-based solutions that integrate commenting via JavaScript on your static pages, but I decided to go for something even more low-level: You can comment by writing an e-mail to me, and I’ll put your comment on the page. This has the nice benefit of solving the blog comment spam problem.</p>
  <p>The actual implementation of the blog is rather masochistic, as my web page runs on one of these weird obfuscated languages (<a href="http://www.w3.org/TR/xslt">XSLT</a>). Previously, it contained of XSLT stylesheets producing makefiles calling XSLT sheets. Now it is a bit more-self-contained, with one XSLT stylesheet writing out all the various html and rss files.
  </p>
  <p>I managed to import all my old posts and comments thanks to <a href="https://gist.github.com/michitux/3731880">this script</a> by Michael Hamann (I had played around with this some months ago and just spend what seemed to be an hour to me to find this script again) and a small Haskell script. Old URLs are rewritten (using <a href="http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html">mod_rewrite</a>) to the new paths, but feed readers might still be confused by this.</p>
  <p>This opens the door to a long due re-design of my webpage. But not today...</p></div>






<p class="date">
<a href="http://www.joachim-breitner.de/blog/656-This_blog_goes_static">by Joachim Breitner (mail@joachim-breitner.de) at August 23, 2014 03:54 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://idontgetoutmuch.wordpress.com" title="Idontgetoutmuch's Weblog">Dominic Steinitz</a></h3>

<div class="entrygroup" id="http://idontgetoutmuch.wordpress.com/?p=728">
<blockquote>
<h1 class="entry"><a href="http://idontgetoutmuch.wordpress.com/2014/08/23/importance-sampling/">Importance Sampling</a></h1>
<div class="entry">
<h1 id="importance-sampling">Importance Sampling</h1>
<p>Suppose we have an random variable <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> with pdf <img src="http://s0.wp.com/latex.php?latex=1%2F2%5Cexp%7B-%5Clvert+x%5Crvert%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="1/2\exp{-\lvert x\rvert}" class="latex" title="1/2\exp{-\lvert x\rvert}" /> and we wish to find its second moment numerically. However, the <a href="https://hackage.haskell.org/package/random-fu">random-fu</a> package does not support sampling from such as distribution. We notice that</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++%5Cint_%7B-%5Cinfty%7D%5E%5Cinfty+x%5E2+%5Cfrac%7B1%7D%7B2%7D+%5Cexp%7B-%5Clvert+x%5Crvert%7D+%5Cmathrm%7Bd%7Dx+%3D++%5Cint_%7B-%5Cinfty%7D%5E%5Cinfty+x%5E2+%5Cfrac%7B%5Cfrac%7B1%7D%7B2%7D+%5Cexp%7B-%5Clvert+x%5Crvert%7D%7D+++++++++++++++++++++++++++++++++%7B%5Cfrac%7B1%7D%7B%5Csqrt%7B8%5Cpi%7D%7D%7B%5Cexp%7B-x%5E2%2F8%7D%7D%7D++++++++++++++++++++++++%5Cfrac%7B1%7D%7B%5Csqrt%7B8%5Cpi%7D%7D%7B%5Cexp%7B-x%5E2%2F8%7D%7D++%5C%2C%5Cmathrm%7Bd%7Dx++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   \int_{-\infty}^\infty x^2 \frac{1}{2} \exp{-\lvert x\rvert} \mathrm{d}x =  \int_{-\infty}^\infty x^2 \frac{\frac{1}{2} \exp{-\lvert x\rvert}}                                 {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}                        \frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}  \,\mathrm{d}x  " class="latex" title="\displaystyle   \int_{-\infty}^\infty x^2 \frac{1}{2} \exp{-\lvert x\rvert} \mathrm{d}x =  \int_{-\infty}^\infty x^2 \frac{\frac{1}{2} \exp{-\lvert x\rvert}}                                 {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}                        \frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}  \,\mathrm{d}x  " />
</div>
<p></p>
<p>So we can sample from <img src="http://s0.wp.com/latex.php?latex=%7B%5Ccal%7BN%7D%7D%280%2C+4%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="{\cal{N}}(0, 4)" class="latex" title="{\cal{N}}(0, 4)" /> and evaluate</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++x%5E2+%5Cfrac%7B%5Cfrac%7B1%7D%7B2%7D+%5Cexp%7B-%5Clvert+x%5Crvert%7D%7D+++++++++++%7B%5Cfrac%7B1%7D%7B%5Csqrt%7B8%5Cpi%7D%7D%7B%5Cexp%7B-x%5E2%2F8%7D%7D%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   x^2 \frac{\frac{1}{2} \exp{-\lvert x\rvert}}           {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}  " class="latex" title="\displaystyle   x^2 \frac{\frac{1}{2} \exp{-\lvert x\rvert}}           {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}  " />
</div>
<p></p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -Wall                     #-}</span>
<span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -fno-warn-name-shadowing  #-}</span>
<span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -fno-warn-type-defaults   #-}</span>
<span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -fno-warn-unused-do-bind  #-}</span>
<span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span>
<span>&gt;</span> <span style="color: green;">{-# OPTIONS_GHC -fno-warn-orphans         #-}</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span style="color: blue; font-weight: bold;">module</span> <span>Importance</span> <span style="color: blue; font-weight: bold;">where</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Control</span><span>.</span><span>Monad</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Data</span><span>.</span><span>Random</span><span>.</span><span>Source</span><span>.</span><span>PureMT</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Data</span><span>.</span><span>Random</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Data</span><span>.</span><span>Random</span><span>.</span><span>Distribution</span><span>.</span><span>Binomial</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Data</span><span>.</span><span>Random</span><span>.</span><span>Distribution</span><span>.</span><span>Beta</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span>Control</span><span>.</span><span>Monad</span><span>.</span><span>State</span>
<span>&gt;</span> <span style="color: blue; font-weight: bold;">import</span> <span style="color: blue; font-weight: bold;">qualified</span> <span>Control</span><span>.</span><span>Monad</span><span>.</span><span>Writer</span> <span style="color: blue; font-weight: bold;">as</span> <span>W</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>sampleImportance</span> <span style="color: red;">::</span> <span>RVarT</span> <span style="color: red;">(</span><span>W</span><span>.</span><span>Writer</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span><span style="color: red;">)</span> <span>()</span>
<span>&gt;</span> <span>sampleImportance</span> <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
<span>&gt;</span>   <span>x</span> <span style="color: red;">&lt;-</span> <span>rvarT</span> <span>$</span> <span>Normal</span> <span class="hs-num">0.0</span> <span class="hs-num">2.0</span>
<span>&gt;</span>   <span style="color: blue; font-weight: bold;">let</span> <span>x2</span> <span style="color: red;">=</span> <span>x</span><span>^</span><span class="hs-num">2</span>
<span>&gt;</span>       <span>u</span> <span style="color: red;">=</span> <span>x2</span> <span>*</span> <span class="hs-num">0.5</span> <span>*</span> <span>exp</span> <span style="color: red;">(</span><span style="color: green;">-</span><span style="color: red;">(</span><span>abs</span> <span>x</span><span style="color: red;">)</span><span style="color: red;">)</span>
<span>&gt;</span>       <span>v</span> <span style="color: red;">=</span> <span style="color: red;">(</span><span>exp</span> <span style="color: red;">(</span><span style="color: red;">(</span><span style="color: green;">-</span><span>x2</span><span style="color: red;">)</span><span>/</span><span class="hs-num">8</span><span style="color: red;">)</span><span style="color: red;">)</span> <span>*</span> <span style="color: red;">(</span><span>recip</span> <span style="color: red;">(</span><span>sqrt</span> <span style="color: red;">(</span><span class="hs-num">8</span><span>*</span><span>pi</span><span style="color: red;">)</span><span style="color: red;">)</span><span style="color: red;">)</span>
<span>&gt;</span>       <span>w</span> <span style="color: red;">=</span> <span>u</span> <span>/</span> <span>v</span>
<span>&gt;</span>   <span>lift</span> <span>$</span> <span>W</span><span>.</span><span>tell</span> <span style="color: red;">[</span><span>w</span><span style="color: red;">]</span>
<span>&gt;</span>   <span>return</span> <span>()</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>runImportance</span> <span style="color: red;">::</span> <span>Int</span> <span style="color: red;">-&gt;</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>runImportance</span> <span>n</span> <span style="color: red;">=</span>
<span>&gt;</span>   <span>snd</span> <span>$</span>
<span>&gt;</span>   <span>W</span><span>.</span><span>runWriter</span> <span>$</span>
<span>&gt;</span>   <span>evalStateT</span> <span style="color: red;">(</span><span>sample</span> <span style="color: red;">(</span><span>replicateM</span> <span>n</span> <span>sampleImportance</span><span style="color: red;">)</span><span style="color: red;">)</span>
<span>&gt;</span>              <span style="color: red;">(</span><span>pureMT</span> <span class="hs-num">2</span><span style="color: red;">)</span>
</code></pre>
<p>We can run this 10,000 times to get an estimate.</p>
<pre><code><span style="color: gray;">ghci&gt; </span>import Formatting
<span style="color: gray;">ghci&gt; </span>format (fixed 2) (sum (runImportance 10000) / 10000)
  "2.03"
</code></pre>
<p>Since we know that the <img src="http://s0.wp.com/latex.php?latex=n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n" class="latex" title="n" />-th moment of the exponential distribution is <img src="http://s0.wp.com/latex.php?latex=n%21+%2F+%5Clambda%5En&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n! / \lambda^n" class="latex" title="n! / \lambda^n" /> where <img src="http://s0.wp.com/latex.php?latex=%5Clambda&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lambda" class="latex" title="\lambda" /> is the rate (1 in this example), the exact answer is 2 which is not too far from our estimate using importance sampling.</p>
<p>The value of</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++w%28x%29+%3D+%5Cfrac%7B1%7D%7BN%7D%5Cfrac%7B%5Cfrac%7B1%7D%7B2%7D+%5Cexp%7B-%5Clvert+x%5Crvert%7D%7D+++++++++++++++++++++++++%7B%5Cfrac%7B1%7D%7B%5Csqrt%7B8%5Cpi%7D%7D%7B%5Cexp%7B-x%5E2%2F8%7D%7D%7D+++++++%3D+%5Cfrac%7Bp%28x%29%7D%7B%5Cpi%28x%29%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   w(x) = \frac{1}{N}\frac{\frac{1}{2} \exp{-\lvert x\rvert}}                         {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}       = \frac{p(x)}{\pi(x)}  " class="latex" title="\displaystyle   w(x) = \frac{1}{N}\frac{\frac{1}{2} \exp{-\lvert x\rvert}}                         {\frac{1}{\sqrt{8\pi}}{\exp{-x^2/8}}}       = \frac{p(x)}{\pi(x)}  " />
</div>
<p></p>
<p>is called the weight, <img src="http://s0.wp.com/latex.php?latex=p&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="p" class="latex" title="p" /> is the pdf from which we wish to sample and <img src="http://s0.wp.com/latex.php?latex=%5Cpi&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\pi" class="latex" title="\pi" /> is the pdf of the importance distribution.</p>
<h1 id="importance-sampling-approximation-of-the-posterior">Importance Sampling Approximation of the Posterior</h1>
<p>Suppose that the posterior distribution of a model in which we are interested has a complicated functional form and that we therefore wish to approximate it in some way. First assume that we wish to calculate the expectation of some arbitrary function <img src="http://s0.wp.com/latex.php?latex=f&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="f" class="latex" title="f" /> of the parameters.</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++%7B%5Cmathbb%7BE%7D%7D%28f%28%7Bx%7D%29+%5C%2C%5Cvert%5C%2C+y_1%2C+%5Cldots+y_T%29+%3D++%5Cint_%5COmega+f%28%7Bx%7D%29+p%28%7Bx%7D+%5C%2C+%5Cvert+%5C%2C+y_1%2C+%5Cldots+y_T%29+%5C%2C%5Cmathrm%7Bd%7D%7Bx%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   {\mathbb{E}}(f({x}) \,\vert\, y_1, \ldots y_T) =  \int_\Omega f({x}) p({x} \, \vert \, y_1, \ldots y_T) \,\mathrm{d}{x}  " class="latex" title="\displaystyle   {\mathbb{E}}(f({x}) \,\vert\, y_1, \ldots y_T) =  \int_\Omega f({x}) p({x} \, \vert \, y_1, \ldots y_T) \,\mathrm{d}{x}  " />
</div>
<p></p>
<p>Using Bayes</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++%5Cint_%5COmega+f%28%7Bx%7D%29+%7Bp%5Cleft%28x+%5C%2C%5Cvert%5C%2C+y_1%2C+%5Cldots+y_T%5Cright%29%7D+%5C%2C%5Cmathrm%7Bd%7D%7Bx%7D+%3D++%5Cfrac%7B1%7D%7BZ%7D%5Cint_%5COmega+f%28%7Bx%7D%29+%7Bp%5Cleft%28y_1%2C+%5Cldots+y_T+%5C%2C%5Cvert%5C%2C+x%5Cright%29%7Dp%28x%29+%5C%2C%5Cmathrm%7Bd%7D%7Bx%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   \int_\Omega f({x}) {p\left(x \,\vert\, y_1, \ldots y_T\right)} \,\mathrm{d}{x} =  \frac{1}{Z}\int_\Omega f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x) \,\mathrm{d}{x}  " class="latex" title="\displaystyle   \int_\Omega f({x}) {p\left(x \,\vert\, y_1, \ldots y_T\right)} \,\mathrm{d}{x} =  \frac{1}{Z}\int_\Omega f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x) \,\mathrm{d}{x}  " />
</div>
<p></p>
<p>where <img src="http://s0.wp.com/latex.php?latex=Z&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="Z" class="latex" title="Z" /> is some normalizing constant.</p>
<p>As before we can re-write this using a proposal distribution <img src="http://s0.wp.com/latex.php?latex=%5Cpi%28x%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\pi(x)" class="latex" title="\pi(x)" /></p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++%5Cfrac%7B1%7D%7BZ%7D%5Cint_%5COmega+f%28%7Bx%7D%29+%7Bp%5Cleft%28y_1%2C+%5Cldots+y_T+%5C%2C%5Cvert%5C%2C+x%5Cright%29%7Dp%28x%29+%5C%2C%5Cmathrm%7Bd%7D%7Bx%7D+%3D++%5Cfrac%7B1%7D%7BZ%7D%5Cint_%5COmega+%5Cfrac%7Bf%28%7Bx%7D%29+%7Bp%5Cleft%28y_1%2C+%5Cldots+y_T+%5C%2C%5Cvert%5C%2C+x%5Cright%29%7Dp%28x%29%7D%7B%5Cpi%28x%29%7D%5Cpi%28x%29+%5C%2C%5Cmathrm%7Bd%7D%7Bx%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   \frac{1}{Z}\int_\Omega f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x) \,\mathrm{d}{x} =  \frac{1}{Z}\int_\Omega \frac{f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x)}{\pi(x)}\pi(x) \,\mathrm{d}{x}  " class="latex" title="\displaystyle   \frac{1}{Z}\int_\Omega f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x) \,\mathrm{d}{x} =  \frac{1}{Z}\int_\Omega \frac{f({x}) {p\left(y_1, \ldots y_T \,\vert\, x\right)}p(x)}{\pi(x)}\pi(x) \,\mathrm{d}{x}  " />
</div>
<p></p>
<p>We can now sample <img src="http://s0.wp.com/latex.php?latex=X%5E%7B%28i%29%7D+%5Csim+%5Cpi%28%7Bx%7D%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X^{(i)} \sim \pi({x})" class="latex" title="X^{(i)} \sim \pi({x})" /> repeatedly to obtain</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++%7B%5Cmathbb%7BE%7D%7D%28f%28%7Bx%7D%29+%5C%2C%5Cvert%5C%2C+y_1%2C+%5Cldots+y_T%29+%5Capprox+%5Cfrac%7B1%7D%7BZN%7D%5Csum_1%5EN++f%28%7BX%5E%7B%28i%29%7D%7D%29+%5Cfrac%7Bp%28y_1%2C+%5Cldots+y_T+%5C%2C+%5Cvert+%5C%2C+%7BX%5E%7B%28i%29%7D%7D%29p%28%7BX%5E%7B%28i%29%7D%7D%29%7D++++++++++++++++++++++++++++++%7B%5Cpi%28%7BX%5E%7B%28i%29%7D%7D%29%7D+%3D++%5Csum_1%5EN+w_if%28%7BX%5E%7B%28i%29%7D%7D%29++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   {\mathbb{E}}(f({x}) \,\vert\, y_1, \ldots y_T) \approx \frac{1}{ZN}\sum_1^N  f({X^{(i)}}) \frac{p(y_1, \ldots y_T \, \vert \, {X^{(i)}})p({X^{(i)}})}                              {\pi({X^{(i)}})} =  \sum_1^N w_if({X^{(i)}})  " class="latex" title="\displaystyle   {\mathbb{E}}(f({x}) \,\vert\, y_1, \ldots y_T) \approx \frac{1}{ZN}\sum_1^N  f({X^{(i)}}) \frac{p(y_1, \ldots y_T \, \vert \, {X^{(i)}})p({X^{(i)}})}                              {\pi({X^{(i)}})} =  \sum_1^N w_if({X^{(i)}})  " />
</div>
<p></p>
<p>where the weights <img src="http://s0.wp.com/latex.php?latex=w_i&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="w_i" class="latex" title="w_i" /> are defined as before by</p>
<p>
</p><div style="text-align: center;">
<img src="http://s0.wp.com/latex.php?latex=%5Cdisplaystyle+++w_i+%3D+%5Cfrac%7B1%7D%7BZN%7D+%5Cfrac%7Bp%28y_1%2C+%5Cldots+y_T+%5C%2C+%5Cvert+%5C%2C+%7BX%5E%7B%28i%29%7D%7D%29p%28%7BX%5E%7B%28i%29%7D%7D%29%7D++++++++++++++++++++++++++%7B%5Cpi%28%7BX%5E%7B%28i%29%7D%7D%29%7D++&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\displaystyle   w_i = \frac{1}{ZN} \frac{p(y_1, \ldots y_T \, \vert \, {X^{(i)}})p({X^{(i)}})}                          {\pi({X^{(i)}})}  " class="latex" title="\displaystyle   w_i = \frac{1}{ZN} \frac{p(y_1, \ldots y_T \, \vert \, {X^{(i)}})p({X^{(i)}})}                          {\pi({X^{(i)}})}  " />
</div>
<p></p>
<p>We follow <a href="http://blog.nus.edu.sg/alexcook/teaching/sph6004/">Alex Cook</a> and use the example from <span class="citation">(Rerks-Ngarm et al. 2009)</span>. We take the prior as <img src="http://s0.wp.com/latex.php?latex=%5Csim+%7B%5Ccal%7BBe%7D%7D%281%2C1%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\sim {\cal{Be}}(1,1)" class="latex" title="\sim {\cal{Be}}(1,1)" /> and use <img src="http://s0.wp.com/latex.php?latex=%7B%5Ccal%7BU%7D%7D%280.0%2C1.0%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="{\cal{U}}(0.0,1.0)" class="latex" title="{\cal{U}}(0.0,1.0)" /> as the proposal distribution. In this case the proposal and the prior are identical just expressed differently and therefore cancel.</p>
<p>Note that we use the log of the pdf in our calculations otherwise we suffer from (silent) underflow, e.g.,</p>
<pre><code><span style="color: gray;">ghci&gt; </span>pdf (Binomial nv (0.4 :: Double)) xv
  0.0
</code></pre>
<p>On the other hand if we use the log pdf form</p>
<pre><code><span style="color: gray;">ghci&gt; </span>logPdf (Binomial nv (0.4 :: Double)) xv
  -3900.8941170876574
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>xv</span><span style="color: red;">,</span> <span>nv</span> <span style="color: red;">::</span> <span>Int</span>
<span>&gt;</span> <span>xv</span> <span style="color: red;">=</span> <span class="hs-num">51</span>
<span>&gt;</span> <span>nv</span> <span style="color: red;">=</span> <span class="hs-num">8197</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>sampleUniform</span> <span style="color: red;">::</span> <span>RVarT</span> <span style="color: red;">(</span><span>W</span><span>.</span><span>Writer</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span><span style="color: red;">)</span> <span>()</span>
<span>&gt;</span> <span>sampleUniform</span> <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
<span>&gt;</span>   <span>x</span> <span style="color: red;">&lt;-</span> <span>rvarT</span> <span>StdUniform</span>
<span>&gt;</span>   <span>lift</span> <span>$</span> <span>W</span><span>.</span><span>tell</span> <span style="color: red;">[</span><span>x</span><span style="color: red;">]</span>
<span>&gt;</span>   <span>return</span> <span>()</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>runSampler</span> <span style="color: red;">::</span> <span>RVarT</span> <span style="color: red;">(</span><span>W</span><span>.</span><span>Writer</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span><span style="color: red;">)</span> <span>()</span> <span style="color: red;">-&gt;</span>
<span>&gt;</span>               <span>Int</span> <span style="color: red;">-&gt;</span> <span>Int</span> <span style="color: red;">-&gt;</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>runSampler</span> <span>sampler</span> <span>seed</span> <span>n</span> <span style="color: red;">=</span>
<span>&gt;</span>   <span>snd</span> <span>$</span>
<span>&gt;</span>   <span>W</span><span>.</span><span>runWriter</span> <span>$</span>
<span>&gt;</span>   <span>evalStateT</span> <span style="color: red;">(</span><span>sample</span> <span style="color: red;">(</span><span>replicateM</span> <span>n</span> <span>sampler</span><span style="color: red;">)</span><span style="color: red;">)</span>
<span>&gt;</span>              <span style="color: red;">(</span><span>pureMT</span> <span style="color: red;">(</span><span>fromIntegral</span> <span>seed</span><span style="color: red;">)</span><span style="color: red;">)</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>sampleSize</span> <span style="color: red;">::</span> <span>Int</span>
<span>&gt;</span> <span>sampleSize</span> <span style="color: red;">=</span> <span class="hs-num">1000</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>pv</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>pv</span> <span style="color: red;">=</span> <span>runSampler</span> <span>sampleUniform</span> <span class="hs-num">2</span> <span>sampleSize</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>logWeightsRaw</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>logWeightsRaw</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>p</span> <span style="color: red;">-&gt;</span> <span>logPdf</span> <span style="color: red;">(</span><span>Beta</span> <span class="hs-num">1.0</span> <span class="hs-num">1.0</span><span style="color: red;">)</span> <span>p</span> <span>+</span>
<span>&gt;</span>                            <span>logPdf</span> <span style="color: red;">(</span><span>Binomial</span> <span>nv</span> <span>p</span><span style="color: red;">)</span> <span>xv</span> <span style="color: green;">-</span>
<span>&gt;</span>                            <span>logPdf</span> <span>StdUniform</span> <span>p</span><span style="color: red;">)</span> <span>pv</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>logWeightsMax</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>logWeightsMax</span> <span style="color: red;">=</span> <span>maximum</span> <span>logWeightsRaw</span>
<span>&gt;</span> 
<span>&gt;</span> <span>weightsRaw</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>weightsRaw</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>w</span> <span style="color: red;">-&gt;</span> <span>exp</span> <span style="color: red;">(</span><span>w</span> <span style="color: green;">-</span> <span>logWeightsMax</span><span style="color: red;">)</span><span style="color: red;">)</span> <span>logWeightsRaw</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>weightsSum</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>weightsSum</span> <span style="color: red;">=</span> <span>sum</span> <span>weightsRaw</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>weights</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>weights</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span>/</span> <span>weightsSum</span><span style="color: red;">)</span> <span>weightsRaw</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>meanPv</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>meanPv</span> <span style="color: red;">=</span> <span>sum</span> <span>$</span> <span>zipWith</span> <span style="color: red;">(</span><span>*</span><span style="color: red;">)</span> <span>pv</span> <span>weights</span>
<span>&gt;</span> 
<span>&gt;</span> <span>meanPv2</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>meanPv2</span> <span style="color: red;">=</span> <span>sum</span> <span>$</span> <span>zipWith</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>p</span> <span>w</span> <span style="color: red;">-&gt;</span> <span>p</span> <span>*</span> <span>p</span> <span>*</span> <span>w</span><span style="color: red;">)</span> <span>pv</span> <span>weights</span>
<span>&gt;</span> 
<span>&gt;</span> <span>varPv</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>varPv</span> <span style="color: red;">=</span> <span>meanPv2</span> <span style="color: green;">-</span> <span>meanPv</span> <span>*</span> <span>meanPv</span>
</code></pre>
<p>We get the answer</p>
<pre><code><span style="color: gray;">ghci&gt; </span>meanPv
  6.400869727227364e-3
</code></pre>
<p>But if we look at the size of the weights and the effective sample size</p>
<pre><code><span style="color: gray;">ghci&gt; </span>length $ filter (&gt;= 1e-6) weights
  9

<span style="color: gray;">ghci&gt; </span>(sum weights)^2 / (sum $ map (^2) weights)
  4.581078458313967
</code></pre>
<p>so we may not be getting a very good estimate. Let’s try</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>sampleNormal</span> <span style="color: red;">::</span> <span>RVarT</span> <span style="color: red;">(</span><span>W</span><span>.</span><span>Writer</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span><span style="color: red;">)</span> <span>()</span>
<span>&gt;</span> <span>sampleNormal</span> <span style="color: red;">=</span> <span style="color: blue; font-weight: bold;">do</span>
<span>&gt;</span>   <span>x</span> <span style="color: red;">&lt;-</span> <span>rvarT</span> <span>$</span> <span>Normal</span> <span>meanPv</span> <span style="color: red;">(</span><span>sqrt</span> <span>varPv</span><span style="color: red;">)</span>
<span>&gt;</span>   <span>lift</span> <span>$</span> <span>W</span><span>.</span><span>tell</span> <span style="color: red;">[</span><span>x</span><span style="color: red;">]</span>
<span>&gt;</span>   <span>return</span> <span>()</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>pvC</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>pvC</span> <span style="color: red;">=</span> <span>runSampler</span> <span>sampleNormal</span> <span class="hs-num">3</span> <span>sampleSize</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>logWeightsRawC</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>logWeightsRawC</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>p</span> <span style="color: red;">-&gt;</span> <span>logPdf</span> <span style="color: red;">(</span><span>Beta</span> <span class="hs-num">1.0</span> <span class="hs-num">1.0</span><span style="color: red;">)</span> <span>p</span> <span>+</span>
<span>&gt;</span>                             <span>logPdf</span> <span style="color: red;">(</span><span>Binomial</span> <span>nv</span> <span>p</span><span style="color: red;">)</span> <span>xv</span> <span style="color: green;">-</span>
<span>&gt;</span>                             <span>logPdf</span> <span style="color: red;">(</span><span>Normal</span> <span>meanPv</span> <span style="color: red;">(</span><span>sqrt</span> <span>varPv</span><span style="color: red;">)</span><span style="color: red;">)</span> <span>p</span><span style="color: red;">)</span> <span>pvC</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>logWeightsMaxC</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>logWeightsMaxC</span> <span style="color: red;">=</span> <span>maximum</span> <span>logWeightsRawC</span>
<span>&gt;</span> 
<span>&gt;</span> <span>weightsRawC</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>weightsRawC</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>w</span> <span style="color: red;">-&gt;</span> <span>exp</span> <span style="color: red;">(</span><span>w</span> <span style="color: green;">-</span> <span>logWeightsMaxC</span><span style="color: red;">)</span><span style="color: red;">)</span> <span>logWeightsRawC</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>weightsSumC</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>weightsSumC</span> <span style="color: red;">=</span> <span>sum</span> <span>weightsRawC</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>weightsC</span> <span style="color: red;">::</span> <span style="color: red;">[</span><span>Double</span><span style="color: red;">]</span>
<span>&gt;</span> <span>weightsC</span> <span style="color: red;">=</span> <span>map</span> <span style="color: red;">(</span><span>/</span> <span>weightsSumC</span><span style="color: red;">)</span> <span>weightsRawC</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>meanPvC</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>meanPvC</span> <span style="color: red;">=</span> <span>sum</span> <span>$</span> <span>zipWith</span> <span style="color: red;">(</span><span>*</span><span style="color: red;">)</span> <span>pvC</span> <span>weightsC</span>
</code></pre>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span>&gt;</span> <span>meanPvC2</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>meanPvC2</span> <span style="color: red;">=</span> <span>sum</span> <span>$</span> <span>zipWith</span> <span style="color: red;">(</span><span style="color: red;">\</span><span>p</span> <span>w</span> <span style="color: red;">-&gt;</span> <span>p</span> <span>*</span> <span>p</span> <span>*</span> <span>w</span><span style="color: red;">)</span> <span>pvC</span> <span>weightsC</span>
<span>&gt;</span> 
<span>&gt;</span> <span>varPvC</span> <span style="color: red;">::</span> <span>Double</span>
<span>&gt;</span> <span>varPvC</span> <span style="color: red;">=</span> <span>meanPvC2</span> <span style="color: green;">-</span> <span>meanPvC</span> <span>*</span> <span>meanPvC</span>
</code></pre>
<p>Now the weights and the effective size are more re-assuring</p>
<pre><code><span style="color: gray;">ghci&gt; </span>length $ filter (&gt;= 1e-6) weightsC
  1000

<span style="color: gray;">ghci&gt; </span>(sum weightsC)^2 / (sum $ map (^2) weightsC)
  967.113872888872
</code></pre>
<p>And we can take more confidence in the estimate</p>
<pre><code><span style="color: gray;">ghci&gt; </span>meanPvC
  6.371225269833208e-3
</code></pre>
<div class="references">
<h1>Bibliography</h1>
<p>Rerks-Ngarm, Supachai, Punnee Pitisuttithum, Sorachai Nitayaphan, Jaranit Kaewkungwal, Joseph Chiu, Robert Paris, Nakorn Premsri, et al. 2009. “Vaccination with ALVAC and AIDSVAX to Prevent HIV-1 Infection in Thailand.” <em>New England Journal of Medicine</em> 361 (23) (December 3): 2209–2220. doi:<a href="http://dx.doi.org/10.1056/nejmoa0908492">10.1056/nejmoa0908492</a>. <a href="http://dx.doi.org/10.1056/nejmoa0908492">http://dx.doi.org/10.1056/nejmoa0908492</a>.</p>
</div><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/idontgetoutmuch.wordpress.com/728/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/idontgetoutmuch.wordpress.com/728/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=idontgetoutmuch.wordpress.com&amp;blog=2944309&amp;post=728&amp;subd=idontgetoutmuch&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://idontgetoutmuch.wordpress.com/2014/08/23/importance-sampling/">by Dominic Steinitz at August 23, 2014 08:05 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 21, 2014</h2>

<div class="channelgroup">







<h3><a href="http://theorylunch.wordpress.com" title="Theory Lunch">Theory Lunch (Institute of Cybernetics, Tallinn)</a></h3>

<div class="entrygroup" id="http://theorylunch.wordpress.com/?p=1221">
<blockquote>
<h1 class="entry"><a href="http://theorylunch.wordpress.com/2014/01/14/transgressing-the-limits/">Transgressing the limits</a></h1>
<div class="entry">
<p>Today, the 14th of January 2014, we had a special session of our Theory Lunch. I spoke about ultrafilters and how they allow to generalize the notion of limit.</p>
<p><span style="font-style: inherit; line-height: 1.625;">Consider the space <img src="http://s0.wp.com/latex.php?latex=%5Cell%5E%5Cinfty&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\ell^\infty" class="latex" title="\ell^\infty" /> of bounded sequences of real numbers, </span>together with the supremum norm. We would like to define a notion of limit which holds for <em>every</em> <img src="http://s0.wp.com/latex.php?latex=%5C%7Bx_n%5C%7D_%7Bn+%5Cgeq+0%7D+%5Cin+%5Cell%5E%5Cinfty&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{x_n\}_{n \geq 0} \in \ell^\infty" class="latex" title="\{x_n\}_{n \geq 0} \in \ell^\infty" /> and satisfies the well known properties of standard limit:<span id="more-1221"></span></p>
<ol>
<li><em>Linearity:</em> <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D+%28%5Clambda+x_n+%2B+%5Cmu+y_n%29+%3D+%5Clambda+%5Clim_%7Bn+%5Cto+%5Cinfty%7D+x_n+%2B+%5Cmu+%5Clim_%7Bn+%5Cto+%5Cinfty%7D+y_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \infty} (\lambda x_n + \mu y_n) = \lambda \lim_{n \to \infty} x_n + \mu \lim_{n \to \infty} y_n" class="latex" title="\lim_{n \to \infty} (\lambda x_n + \mu y_n) = \lambda \lim_{n \to \infty} x_n + \mu \lim_{n \to \infty} y_n" />.</li>
<li><em>Homogeneity:</em> <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D+%28x_n+%5Ccdot+y_n%29+%3D+%28%5Clim_%7Bn+%5Cto+%5Cinfty%7D+x_n%29+%5Ccdot+%28%5Clim_%7Bn+%5Cto+%5Cinfty%7D+y_n%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \infty} (x_n \cdot y_n) = (\lim_{n \to \infty} x_n) \cdot (\lim_{n \to \infty} y_n)" class="latex" title="\lim_{n \to \infty} (x_n \cdot y_n) = (\lim_{n \to \infty} x_n) \cdot (\lim_{n \to \infty} y_n)" />.</li>
<li><em>Monotonicity:</em> if <img src="http://s0.wp.com/latex.php?latex=x_n+%5Cleq+y_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n \leq y_n" class="latex" title="x_n \leq y_n" /> for every <img src="http://s0.wp.com/latex.php?latex=n+%5Cgeq+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n \geq 0" class="latex" title="n \geq 0" /> then <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D+x_n+%5Cleq+%5Clim_%7Bn+%5Cto+%5Cinfty%7D+y_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \infty} x_n \leq \lim_{n \to \infty} y_n" class="latex" title="\lim_{n \to \infty} x_n \leq \lim_{n \to \infty} y_n" />.</li>
<li><em>Nontriviality:</em> if <img src="http://s0.wp.com/latex.php?latex=x_n+%3D+1&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n = 1" class="latex" title="x_n = 1" /> for every <img src="http://s0.wp.com/latex.php?latex=n+%5Cgeq+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n \geq 0" class="latex" title="n \geq 0" /> then <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D+x_n+%3D+1&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \infty} x_n = 1" class="latex" title="\lim_{n \to \infty} x_n = 1" />.</li>
<li><em>Consistency:</em> if the limit exists in the classical sense, then the two notions coincide.</li>
</ol>
<p>The consistency condition is reasonable also because it avoids trivial cases: if we fix <img src="http://s0.wp.com/latex.php?latex=n_0+%5Cin+%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n_0 \in \mathbb{N}" class="latex" title="n_0 \in \mathbb{N}" /> and we define the limit of the sequence <img src="http://s0.wp.com/latex.php?latex=x_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n" class="latex" title="x_n" /> as the value <img src="http://s0.wp.com/latex.php?latex=x_%7Bn_0%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_{n_0}" class="latex" title="x_{n_0}" />, then the first four properties are satisfied.</p>
<p>Let us recall the classical definition of limit: we say that <img src="http://s0.wp.com/latex.php?latex=x_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n" class="latex" title="x_n" /> converges to <img src="http://s0.wp.com/latex.php?latex=x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x" class="latex" title="x" /> if and only if, for every <img src="http://s0.wp.com/latex.php?latex=%5Cvarepsilon+%3E+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\varepsilon &gt; 0" class="latex" title="\varepsilon &gt; 0" />, the set of values <img src="http://s0.wp.com/latex.php?latex=n+%5Cin+%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n \in \mathbb{N}" class="latex" title="n \in \mathbb{N}" /> such that <img src="http://s0.wp.com/latex.php?latex=%7Cx_n+-+x%7C+%3C+%5Cvarepsilon&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="|x_n - x| &lt; \varepsilon" class="latex" title="|x_n - x| &lt; \varepsilon" /> is <em>cofinite</em>, <em>i.e.</em>, has a finite complement: the inequality <img src="http://s0.wp.com/latex.php?latex=%7Cx_n+-+x%7C+%5Cgeq+%5Cvarepsilon&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="|x_n - x| \geq \varepsilon" class="latex" title="|x_n - x| \geq \varepsilon" /> can be satisfied at most for finitely many values of <img src="http://s0.wp.com/latex.php?latex=n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n" class="latex" title="n" />. The family <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> of cofinite subsets of <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" /> (in fact, of any set <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" />) has the following properties:</p>
<ol>
<li><em>Upper closure:</em> if <img src="http://s0.wp.com/latex.php?latex=A+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \in \mathcal{F}" class="latex" title="A \in \mathcal{F}" /> and <img src="http://s0.wp.com/latex.php?latex=B+%5Csupseteq+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \supseteq A" class="latex" title="B \supseteq A" /> then <img src="http://s0.wp.com/latex.php?latex=B+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \in \mathcal{F}" class="latex" title="B \in \mathcal{F}" />.</li>
<li><em>Meet stability:</em> if <img src="http://s0.wp.com/latex.php?latex=A%2CB+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A,B \in \mathcal{F}" class="latex" title="A,B \in \mathcal{F}" /> then <img src="http://s0.wp.com/latex.php?latex=A+%5Ccap+B+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \cap B \in \mathcal{F}" class="latex" title="A \cap B \in \mathcal{F}" />.</li>
</ol>
<p>A family <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> of subsets of <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> with the two properties above is called a <em>filter</em> on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" />. An immediate example is the <em>trivial filter</em> <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D+%3D+%5C%7BX%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F} = \{X\}" class="latex" title="\mathcal{F} = \{X\}" />; another example is the <em>improper filter</em> <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D+%3D+%5Cmathcal%7BP%7D%28X%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F} = \mathcal{P}(X)" class="latex" title="\mathcal{F} = \mathcal{P}(X)" />. The family <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D%28X%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}(X)" class="latex" title="\mathcal{F}(X)" /> of cofinite subset of <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> is called the <em>Fréchet filter</em> on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" />. The Fréchet filter is not the improper one if and only if <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> is infinite.</p>
<p>An <em>ultrafilter</em> on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> is a filter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> satisfying the following additional conditions:</p>
<ol>
<li><em>Properness:</em> <img src="http://s0.wp.com/latex.php?latex=%5Cemptyset+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\emptyset \not \in \mathcal{U}" class="latex" title="\emptyset \not \in \mathcal{U}" />.</li>
<li><em>Maximality:</em> for every <img src="http://s0.wp.com/latex.php?latex=A+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \subseteq X" class="latex" title="A \subseteq X" />, either <img src="http://s0.wp.com/latex.php?latex=A+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \in \mathcal{U}" class="latex" title="A \in \mathcal{U}" /> or  <img src="http://s0.wp.com/latex.php?latex=X+%5Csetminus+A+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X \setminus A \in \mathcal{U}" class="latex" title="X \setminus A \in \mathcal{U}" />.</li>
</ol>
<p>For example, if <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in X" class="latex" title="x \in X" />, then <img src="http://s0.wp.com/latex.php?latex=%28x%29+%3D+%5C%7B+A+%5Csubseteq+X+%5Cmid+x+%5Cin+A+%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="(x) = \{ A \subseteq X \mid x \in A \}" class="latex" title="(x) = \{ A \subseteq X \mid x \in A \}" /> is an ultrafilter on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" />, called the <em>principal ultrafilter</em> generated by <img src="http://s0.wp.com/latex.php?latex=x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x" class="latex" title="x" />. Observe that <img src="http://s0.wp.com/latex.php?latex=%5Cbigcap_%7BA+%5Cin+%28x%29%7D+A+%3D+%5C%7Bx%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\bigcap_{A \in (x)} A = \{x\}" class="latex" title="\bigcap_{A \in (x)} A = \{x\}" />: if <img src="http://s0.wp.com/latex.php?latex=%5Cbigcap_%7BA+%5Cin+%5Cmathcal%7BU%7D%7D+A+%3D+%5Cemptyset&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\bigcap_{A \in \mathcal{U}} A = \emptyset" class="latex" title="\bigcap_{A \in \mathcal{U}} A = \emptyset" /> we say that <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> is <em>free</em>. These are, in fact, the only two options.</p>
<p><strong>Lemma 1.</strong> For a proper filter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> to be an ultrafilter, it is necessary and sufficient that it satisfies the following condition: for every <img src="http://s0.wp.com/latex.php?latex=n+%5Cgeq+2&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n \geq 2" class="latex" title="n \geq 2" /> and nonempty <img src="http://s0.wp.com/latex.php?latex=A_1%2C+%5Cldots%2C+A_n+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1, \ldots, A_n \subseteq X" class="latex" title="A_1, \ldots, A_n \subseteq X" />, if <img src="http://s0.wp.com/latex.php?latex=%5Cbigcup_%7Bi%3D1%7D%5En+A_i+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\bigcup_{i=1}^n A_i \in \mathcal{F}" class="latex" title="\bigcup_{i=1}^n A_i \in \mathcal{F}" /> then <img src="http://s0.wp.com/latex.php?latex=A_i+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_i \in \mathcal{F}" class="latex" title="A_i \in \mathcal{F}" /> for at least one <img src="http://s0.wp.com/latex.php?latex=i+%5Cin+%5C%7B1%2C+%5Cldots%2C+n%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="i \in \{1, \ldots, n\}" class="latex" title="i \in \{1, \ldots, n\}" />.</p>
<p><em>Proof:</em> It is sufficient to prove the thesis with <img src="http://s0.wp.com/latex.php?latex=n%3D2&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n=2" class="latex" title="n=2" />. If <img src="http://s0.wp.com/latex.php?latex=A+%5Ccup+B+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \cup B \in \mathcal{F}" class="latex" title="A \cup B \in \mathcal{F}" /> with <img src="http://s0.wp.com/latex.php?latex=A%2CB+%5Cnot+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A,B \not \in \mathcal{F}" class="latex" title="A,B \not \in \mathcal{F}" />, then <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D%27+%3D+%5C%7B+B%27+%5Csubseteq+X+%5Cmid+B%27+%5Cneq+%5Cemptyset%2C+A+%5Ccup+B%27+%5Cin+%5Cmathcal%7BF%7D+%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}' = \{ B' \subseteq X \mid B' \neq \emptyset, A \cup B' \in \mathcal{F} \}" class="latex" title="\mathcal{F}' = \{ B' \subseteq X \mid B' \neq \emptyset, A \cup B' \in \mathcal{F} \}" /> is a proper filter that properly contains <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" />. If the condition is satisfied, for every <img src="http://s0.wp.com/latex.php?latex=A+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \subseteq X" class="latex" title="A \subseteq X" /> which is neither <img src="http://s0.wp.com/latex.php?latex=%5Cemptyset&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\emptyset" class="latex" title="\emptyset" /> nor <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> we have <img src="http://s0.wp.com/latex.php?latex=A+%5Ccup+%28X+%5Csetminus+A%29+%3D+X+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \cup (X \setminus A) = X \in \mathcal{F}" class="latex" title="A \cup (X \setminus A) = X \in \mathcal{F}" />, thus either <img src="http://s0.wp.com/latex.php?latex=A+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \in \mathcal{F}" class="latex" title="A \in \mathcal{F}" /> or <img src="http://s0.wp.com/latex.php?latex=X+%5Csetminus+A+%5Cin+%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X \setminus A \in \mathcal{F}" class="latex" title="X \setminus A \in \mathcal{F}" />. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p><strong>Theorem 1.</strong> Every nonprincipal ultrafilter is free. In addition, an ultrafilter is free if and only if it extends the Fréchet filter. In particular, every ultrafilter over a finite set is principal.</p>
<p><em>Proof:</em> Let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> be a nonprincipal ultrafilter. Let <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in X" class="latex" title="x \in X" />: then <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%5Cneq+%28x%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} \neq (x)" class="latex" title="\mathcal{U} \neq (x)" />, so either there exists <img src="http://s0.wp.com/latex.php?latex=B+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \subseteq X" class="latex" title="B \subseteq X" /> such that <img src="http://s0.wp.com/latex.php?latex=x+%5Cnot+%5Cin+B&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \not \in B" class="latex" title="x \not \in B" /> and <img src="http://s0.wp.com/latex.php?latex=B+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \in \mathcal{U}" class="latex" title="B \in \mathcal{U}" />, or there exists <img src="http://s0.wp.com/latex.php?latex=B%27+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B' \subseteq X" class="latex" title="B' \subseteq X" /> such that <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+B%27&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in B'" class="latex" title="x \in B'" /> and <img src="http://s0.wp.com/latex.php?latex=B%27+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B' \not \in \mathcal{U}" class="latex" title="B' \not \in \mathcal{U}" />. In the first case, <img src="http://s0.wp.com/latex.php?latex=x+%5Cnot+%5Cin+%5Cbigcap_%7BA+%5Cin+%5Cmathcal%7BU%7D%7D+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \not \in \bigcap_{A \in \mathcal{U}} A" class="latex" title="x \not \in \bigcap_{A \in \mathcal{U}} A" />; in the second case, we consider <img src="http://s0.wp.com/latex.php?latex=B+%3D+X+%5Csetminus+B%27&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B = X \setminus B'" class="latex" title="B = X \setminus B'" /> and reduce to the first case. As <img src="http://s0.wp.com/latex.php?latex=x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x" class="latex" title="x" /> is arbitrary, <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> is free.</p>
<p>Now, for every <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in X" class="latex" title="x \in X" /> the set <img src="http://s0.wp.com/latex.php?latex=X+%5Csetminus+%5C%7Bx%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X \setminus \{x\}" class="latex" title="X \setminus \{x\}" /> belongs to <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D%28X%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}(X)" class="latex" title="\mathcal{F}(X)" /> but not to <img src="http://s0.wp.com/latex.php?latex=%28x%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="(x)" class="latex" title="(x)" />: therefore, no principal ultrafilter extends the Fréchet filter. On the other hand, if <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> is an ultrafilter, <img src="http://s0.wp.com/latex.php?latex=A+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \subseteq X" class="latex" title="A \subseteq X" /> is finite, and <img src="http://s0.wp.com/latex.php?latex=X+%5Csetminus+A+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X \setminus A \not \in \mathcal{U}" class="latex" title="X \setminus A \not \in \mathcal{U}" />, then <img src="http://s0.wp.com/latex.php?latex=A+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \in \mathcal{U}" class="latex" title="A \in \mathcal{U}" /> by maximality, hence <img src="http://s0.wp.com/latex.php?latex=%5C%7Bx%5C%7D+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{x\} \in \mathcal{U}" class="latex" title="\{x\} \in \mathcal{U}" /> for some <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in A" class="latex" title="x \in A" /> because of Lemma 1, thus <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%3D+%28x%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} = (x)" class="latex" title="\mathcal{U} = (x)" /> cannot be a free ultrafilter. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p>So it seems that free ultrafilters are the right thing to consider when trying to expand the concept of limit. There is an issue, though: we have not seen any single example of a free ultrafilter; in fact, we do not even (yet) know whether free ultrafilters do exist! The answer to this problem comes, in a shamelessly nonconstructive way, from the following</p>
<p><strong>Ultrafilter lemma.</strong> Every proper filter can be extended to an ultrafilter.</p>
<p>The ultrafilter lemma, together with Theorem 1, implies the existence of free ultrafilters on every infinite set, and in particular on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />. On the other hand, to prove the ultrafilter lemma the Axiom of Choice is required, in the form of Zorn’s lemma. Before giving such proof, we recall that a family of sets has the <em>finite intersection property</em> if every finite subfamily has a nonempty intersection: every proper filter has the finite intersection property.</p>
<p><em>Proof of the ultrafilter lemma.</em> Let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> be a proper filter on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> and let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" /> be the family of the collections of subsets of <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> that extend <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> and have the finite intersection property, ordered by inclusion. Let <img src="http://s0.wp.com/latex.php?latex=%5C%7BU_i%5C%7D_%7Bi+%5Cin+I%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{U_i\}_{i \in I}" class="latex" title="\{U_i\}_{i \in I}" /> be a totally ordered subfamily of <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" />: then <img src="http://s0.wp.com/latex.php?latex=U+%3D+%5Cbigcup_%7Bi+%5Cin+I%7D+U_i&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="U = \bigcup_{i \in I} U_i" class="latex" title="U = \bigcup_{i \in I} U_i" /> extends <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F}" class="latex" title="\mathcal{F}" /> and has the finite intersection property, because for every finitely many <img src="http://s0.wp.com/latex.php?latex=A_1%2C+%5Cldots%2C+A_n+%5Cin+U&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1, \ldots, A_n \in U" class="latex" title="A_1, \ldots, A_n \in U" /> there exists by construction <img src="http://s0.wp.com/latex.php?latex=i+%5Cin+I&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="i \in I" class="latex" title="i \in I" /> such that <img src="http://s0.wp.com/latex.php?latex=A_1%2C+%5Cldots%2C+A_n+%5Cin+U_i&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1, \ldots, A_n \in U_i" class="latex" title="A_1, \ldots, A_n \in U_i" />.</p>
<p>By Zorn’s lemma, <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" /> has a maximal element <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />, which surely satisfies <img src="http://s0.wp.com/latex.php?latex=%5Cemptyset+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\emptyset \not \in \mathcal{U}" class="latex" title="\emptyset \not \in \mathcal{U}" /> and <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BF%7D+%5Csubseteq+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{F} \subseteq \mathcal{U}" class="latex" title="\mathcal{F} \subseteq \mathcal{U}" />. If <img src="http://s0.wp.com/latex.php?latex=A+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \in \mathcal{U}" class="latex" title="A \in \mathcal{U}" /> and <img src="http://s0.wp.com/latex.php?latex=B+%5Csupseteq+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \supseteq A" class="latex" title="B \supseteq A" />, then <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%5Ccup+%5C%7BB%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} \cup \{B\}" class="latex" title="\mathcal{U} \cup \{B\}" /> still has the finite intersection property, therefore <img src="http://s0.wp.com/latex.php?latex=B+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B \in \mathcal{U}" class="latex" title="B \in \mathcal{U}" /> by maximality. If <img src="http://s0.wp.com/latex.php?latex=A%2CB+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A,B \in \mathcal{U}" class="latex" title="A,B \in \mathcal{U}" /> then <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%5Ccup+%5C%7BA+%5Ccap+B%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} \cup \{A \cap B\}" class="latex" title="\mathcal{U} \cup \{A \cap B\}" /> still has the finite intersection property, therefore again <img src="http://s0.wp.com/latex.php?latex=A+%5Ccap+B+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \cap B \in \mathcal{U}" class="latex" title="A \cap B \in \mathcal{U}" /> by maximality.</p>
<p>Suppose, for the sake of contradiction, that there exists <img src="http://s0.wp.com/latex.php?latex=A+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \subseteq X" class="latex" title="A \subseteq X" /> such that <img src="http://s0.wp.com/latex.php?latex=A+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A \not \in \mathcal{U}" class="latex" title="A \not \in \mathcal{U}" /> and <img src="http://s0.wp.com/latex.php?latex=X+%5Csetminus+A+%5Cnot+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X \setminus A \not \in \mathcal{U}" class="latex" title="X \setminus A \not \in \mathcal{U}" />: then neither <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%5Ccup+%5C%7BA%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} \cup \{A\}" class="latex" title="\mathcal{U} \cup \{A\}" /> nor <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%5Ccup+%5C%7BX+%5Csetminus+A%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} \cup \{X \setminus A\}" class="latex" title="\mathcal{U} \cup \{X \setminus A\}" /> have the finite intersection property, hence there exist <img src="http://s0.wp.com/latex.php?latex=A_1%2C+%5Cldots%2C+A_m%2C+B_1%2C+%5Cldots%2C+B_n+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1, \ldots, A_m, B_1, \ldots, B_n \in \mathcal{U}" class="latex" title="A_1, \ldots, A_m, B_1, \ldots, B_n \in \mathcal{U}" /> such that <img src="http://s0.wp.com/latex.php?latex=A_1+%5Ccap+%5Cldots+%5Ccap+A_m+%5Ccap+A+%3D+B_1+%5Ccap+%5Cldots+%5Ccap+B_n+%5Ccap+%28X+%5Csetminus+A%29+%3D+%5Cemptyset&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1 \cap \ldots \cap A_m \cap A = B_1 \cap \ldots \cap B_n \cap (X \setminus A) = \emptyset" class="latex" title="A_1 \cap \ldots \cap A_m \cap A = B_1 \cap \ldots \cap B_n \cap (X \setminus A) = \emptyset" />. But <img src="http://s0.wp.com/latex.php?latex=A_1+%5Ccap+%5Cldots+%5Ccap+A_m+%5Ccap+A+%3D+%5Cemptyset&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1 \cap \ldots \cap A_m \cap A = \emptyset" class="latex" title="A_1 \cap \ldots \cap A_m \cap A = \emptyset" /> means <img src="http://s0.wp.com/latex.php?latex=A_1+%5Ccap+%5Cldots+%5Ccap+A_m+%5Csubseteq+X+%5Csetminus+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1 \cap \ldots \cap A_m \subseteq X \setminus A" class="latex" title="A_1 \cap \ldots \cap A_m \subseteq X \setminus A" />, and <img src="http://s0.wp.com/latex.php?latex=B_1+%5Ccap+%5Cldots+%5Ccap+B_n+%5Ccap+%28X+%5Csetminus+A%29+%3D+%5Cemptyset&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B_1 \cap \ldots \cap B_n \cap (X \setminus A) = \emptyset" class="latex" title="B_1 \cap \ldots \cap B_n \cap (X \setminus A) = \emptyset" /> means <img src="http://s0.wp.com/latex.php?latex=B_1+%5Ccap+%5Cldots+%5Ccap+B_n+%5Csubseteq+A&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="B_1 \cap \ldots \cap B_n \subseteq A" class="latex" title="B_1 \cap \ldots \cap B_n \subseteq A" />: therefore,</p>
<p style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=A_1+%5Ccap+%5Cldots+%5Ccap+A_m+%5Ccap+B_1+%5Ccap+%5Cldots+%5Ccap+B_n+%5Csubseteq+%28X+%5Csetminus+A%29+%5Ccap+A+%3D+%5Cemptyset%2C&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1 \cap \ldots \cap A_m \cap B_1 \cap \ldots \cap B_n \subseteq (X \setminus A) \cap A = \emptyset," class="latex" title="A_1 \cap \ldots \cap A_m \cap B_1 \cap \ldots \cap B_n \subseteq (X \setminus A) \cap A = \emptyset," /></p>
<p style="text-align: left;">against <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> having the finite intersection property. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p style="text-align: left;">We are now ready to expand the idea of limit. Let <img src="http://s0.wp.com/latex.php?latex=%28X%2Cd%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="(X,d)" class="latex" title="(X,d)" /> be a metric space and let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> be an ultrafilter on <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" />: we say that <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in X" class="latex" title="x \in X" /> is the <em>ultralimit</em> of the sequence <img src="http://s0.wp.com/latex.php?latex=%5C%7Bx_n%5C%7D_%7Bn+%5Cgeq+0%7D+%5Csubseteq+X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{x_n\}_{n \geq 0} \subseteq X" class="latex" title="\{x_n\}_{n \geq 0} \subseteq X" /> along <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> if for every <img src="http://s0.wp.com/latex.php?latex=%5Cvarepsilon+%3E+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\varepsilon &gt; 0" class="latex" title="\varepsilon &gt; 0" /> the set</p>
<p style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5C%7B+n+%5Cgeq+0+%5Cmid+d%28x_n%2C+x%29+%3C+%5Cvarepsilon+%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{ n \geq 0 \mid d(x_n, x) &lt; \varepsilon \}" class="latex" title="\{ n \geq 0 \mid d(x_n, x) &lt; \varepsilon \}" /></p>
<p style="text-align: left;">belongs to <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />. (Observe how, in the standard definition of limit, the above set is required to belong to the Fréchet filter.) If this is the case, we write</p>
<p style="text-align: center;"><img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cmathcal%7BU%7D%7D+x_n+%3D+x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \mathcal{U}} x_n = x" class="latex" title="\lim_{n \to \mathcal{U}} x_n = x" /></p>
<p style="text-align: left;">Ultralimits, if they exist, are unique and satisfy our first four conditions. Moreover, the choice of a principal ultrafilter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D+%3D+%28n_0%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U} = (n_0)" class="latex" title="\mathcal{U} = (n_0)" /> corresponds to the trivial definition <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cmathcal%7BU%7D%7D+x_n+%3D+x_%7Bn_0%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \mathcal{U}} x_n = x_{n_0}" class="latex" title="\lim_{n \to \mathcal{U}} x_n = x_{n_0}" />. So, what about free ultrafilters?</p>
<p style="text-align: left;"><strong>Theorem 2.</strong> Every bounded sequence of real numbers has an ultralimit along every free ultrafilter on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />.</p>
<p style="text-align: left;"><em>Proof:</em> It is not restrictive to suppose <img src="http://s0.wp.com/latex.php?latex=x_n+%5Cin+%5B0%2C1%5D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n \in [0,1]" class="latex" title="x_n \in [0,1]" /> for every <img src="http://s0.wp.com/latex.php?latex=n+%5Cgeq+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="n \geq 0" class="latex" title="n \geq 0" />. Let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> be an arbitrary, but fixed, free ultrafilter on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />. We will construct a sequence of closed intervals <img src="http://s0.wp.com/latex.php?latex=A_k&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_k" class="latex" title="A_k" />, <img src="http://s0.wp.com/latex.php?latex=k+%5Cgeq+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="k \geq 0" class="latex" title="k \geq 0" />, such that <img src="http://s0.wp.com/latex.php?latex=A_%7Bk%2B1%7D+%5Csubseteq+A_k&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_{k+1} \subseteq A_k" class="latex" title="A_{k+1} \subseteq A_k" /> and <img src="http://s0.wp.com/latex.php?latex=%5Cmathrm%7Bdiam%7D+%5C%2C+A_k+%3D+2%5E%7B-k%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathrm{diam} \, A_k = 2^{-k}" class="latex" title="\mathrm{diam} \, A_k = 2^{-k}" /> for every <img src="http://s0.wp.com/latex.php?latex=k+%5Cgeq+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="k \geq 0" class="latex" title="k \geq 0" />. By the Cantor intersection theorem it will be <img src="http://s0.wp.com/latex.php?latex=%5Cbigcap_%7Bk+%5Cgeq+0%7D+A_k+%3D+%5C%7Bx%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\bigcap_{k \geq 0} A_k = \{x\}" class="latex" title="\bigcap_{k \geq 0} A_k = \{x\}" />: we will then show that <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cmathcal%7BU%7D%7D+x_n+%3D+x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \mathcal{U}} x_n = x" class="latex" title="\lim_{n \to \mathcal{U}} x_n = x" />.</p>
<p style="text-align: left;">Let <img src="http://s0.wp.com/latex.php?latex=A_0+%3D+%5B0%2C1%5D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_0 = [0,1]" class="latex" title="A_0 = [0,1]" />. Let <img src="http://s0.wp.com/latex.php?latex=A_1&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_1" class="latex" title="A_1" /> be either <img src="http://s0.wp.com/latex.php?latex=%5B0%2C1%2F2%5D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="[0,1/2]" class="latex" title="[0,1/2]" /> or <img src="http://s0.wp.com/latex.php?latex=%5B1%2F2%2C1%5D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="[1/2,1]" class="latex" title="[1/2,1]" />, chosen according to the following criterion: <img src="http://s0.wp.com/latex.php?latex=%5C%7Bn+%5Cgeq+0+%5Cmid+x_n+%5Cin+A_1%5C%7D+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{n \geq 0 \mid x_n \in A_1\} \in \mathcal{U}" class="latex" title="\{n \geq 0 \mid x_n \in A_1\} \in \mathcal{U}" />. If both halves satisfy the criterion, then we just choose one once and for all. We iterate the procedure by always choosing <img src="http://s0.wp.com/latex.php?latex=A_%7Bk%2B1%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_{k+1}" class="latex" title="A_{k+1}" /> as one of the two halves of <img src="http://s0.wp.com/latex.php?latex=A_k&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_k" class="latex" title="A_k" /> such that <img src="http://s0.wp.com/latex.php?latex=%5C%7Bn+%5Cgeq+0+%5Cmid+x_n+%5Cin+A_%7Bk%2B1%7D%5C%7D+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{n \geq 0 \mid x_n \in A_{k+1}\} \in \mathcal{U}" class="latex" title="\{n \geq 0 \mid x_n \in A_{k+1}\} \in \mathcal{U}" />.</p>
<p style="text-align: left;">Let <img src="http://s0.wp.com/latex.php?latex=%5Cbigcap_%7Bk+%5Cgeq+0%7D+A_k+%3D+%5C%7Bx%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\bigcap_{k \geq 0} A_k = \{x\}" class="latex" title="\bigcap_{k \geq 0} A_k = \{x\}" />. Let <img src="http://s0.wp.com/latex.php?latex=%5Cvarepsilon+%3E+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\varepsilon &gt; 0" class="latex" title="\varepsilon &gt; 0" />, and let <img src="http://s0.wp.com/latex.php?latex=k&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="k" class="latex" title="k" /> be so large that <img src="http://s0.wp.com/latex.php?latex=2%5E%7B-k%7D+%3C+%5Cvarepsilon&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="2^{-k} &lt; \varepsilon" class="latex" title="2^{-k} &lt; \varepsilon" />: then <img src="http://s0.wp.com/latex.php?latex=A_k+%5Csubseteq+%28x-%5Cvarepsilon%2C+x%2B%5Cvarepsilon%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="A_k \subseteq (x-\varepsilon, x+\varepsilon)" class="latex" title="A_k \subseteq (x-\varepsilon, x+\varepsilon)" />, thus <img src="http://s0.wp.com/latex.php?latex=%5C%7Bn+%5Cgeq+0+%5Cmid+x_n+%5Cin+A_k%5C%7D+%5Csubseteq+%5C%7Bn+%5Cgeq+0+%5Cmid+%7Cx_n-x%7C+%3C+%5Cvarepsilon%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{n \geq 0 \mid x_n \in A_k\} \subseteq \{n \geq 0 \mid |x_n-x| &lt; \varepsilon\}" class="latex" title="\{n \geq 0 \mid x_n \in A_k\} \subseteq \{n \geq 0 \mid |x_n-x| &lt; \varepsilon\}" />. As the smaller set belongs to <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />, so does the larger one. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p style="text-align: left;">We have thus almost achieved our original target: a notion of limit which applies to every bounded sequence of real numbers. Such notion will depend on the specific free ultrafilter we choose: but it is already very reassuring that such a notion exists at all! To complete our job we need one more check: we have to be sure that the definition is consistent with the classical one. And this is indeed what happens!</p>
<p style="text-align: left;"><strong style="font-style: inherit; line-height: 1.625;">Theorem 3.</strong><span style="font-style: inherit; line-height: 1.625;"> Let <img src="http://s0.wp.com/latex.php?latex=%5C%7Bx_n%5C%7D_%7Bn+%5Cgeq+0%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\{x_n\}_{n \geq 0}" class="latex" title="\{x_n\}_{n \geq 0}" /> be a sequence of real numbers and let <img src="http://s0.wp.com/latex.php?latex=x+%5Cin+%5Cmathbb%7BR%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x \in \mathbb{R}" class="latex" title="x \in \mathbb{R}" />. Then <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D+x_n+%3D+x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \infty} x_n = x" class="latex" title="\lim_{n \to \infty} x_n = x" /> in the classical sense if and only if <img src="http://s0.wp.com/latex.php?latex=%5Clim_%7Bn+%5Cto+%5Cmathcal%7BU%7D%7D+x_n+%3D+x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\lim_{n \to \mathcal{U}} x_n = x" class="latex" title="\lim_{n \to \mathcal{U}} x_n = x" /> for every free ultrafilter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />.</span></p>
<p style="text-align: left;">To prove Theorem 3 we make use of an auxiliary result, which is of interest by itself.</p>
<p><strong>Lemma 2.</strong> Let <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D%28X%29&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}(X)" class="latex" title="\mathcal{M}(X)" /> be the family of collections of subsets of <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> that have the finite intersection property. The maximal elements of <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" /> are precisely the ultrafilters.</p>
<p><em>Proof:</em> Every ultrafilter is clearly maximal in <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" />. If <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> is maximal in <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BM%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{M}" class="latex" title="\mathcal{M}" />, then it is clearly proper and upper closed, and we can reason as in the proof of the ultrafilter lemma to show that it is actually an ultrafilter. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p style="text-align: left;"><em>Proof of Theorem 3:</em> Suppose <img src="http://s0.wp.com/latex.php?latex=x_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n" class="latex" title="x_n" /> does not converge to <img src="http://s0.wp.com/latex.php?latex=x&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x" class="latex" title="x" /> in the classical sense. Fix <img src="http://s0.wp.com/latex.php?latex=%5Cvarepsilon_0+%3E+0&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\varepsilon_0 &gt; 0" class="latex" title="\varepsilon_0 &gt; 0" /> such that the set <img src="http://s0.wp.com/latex.php?latex=S+%3D+%5C%7Bn+%5Cgeq+0+%5Cmid+%7Cx_n-x%7C+%5Cgeq+%5Cvarepsilon_0%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="S = \{n \geq 0 \mid |x_n-x| \geq \varepsilon_0\}" class="latex" title="S = \{n \geq 0 \mid |x_n-x| \geq \varepsilon_0\}" /> is infinite. Then the family <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BV%7D+%3D+%5C%7BS+%5Csetminus+%5C%7Bn%5C%7D+%5Cmid+n+%5Cgeq+0%5C%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{V} = \{S \setminus \{n\} \mid n \geq 0\}" class="latex" title="\mathcal{V} = \{S \setminus \{n\} \mid n \geq 0\}" /> has the finite intersection property: an ultrafilter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> that extends <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BV%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{V}" class="latex" title="\mathcal{V}" /> must be free. Then <img src="http://s0.wp.com/latex.php?latex=S+%5Cin+%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="S \in \mathcal{U}" class="latex" title="S \in \mathcal{U}" />, and <img src="http://s0.wp.com/latex.php?latex=x_n&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="x_n" class="latex" title="x_n" /> does not have an ultralimit along <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />.</p>
<p style="text-align: left;">The converse implication follows from the classical definition of limit, together with the very notion of free ultrafilter. <img src="http://s0.wp.com/latex.php?latex=%5CBox&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\Box" class="latex" title="\Box" /></p>
<p style="text-align: left;">Theorem 3 does hold for sequences of real numbers, but does not extend to arbitrary metric spaces. In fact, the following holds, which we state without proving.</p>
<p style="text-align: left;"><strong>Theorem 4.</strong> Let <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> be a metric space. The following are equivalent.</p>
<ol>
<li>For <span style="text-decoration: underline;">some</span> free ultrafilter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />, every sequence in <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> has an ultralimit along <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />.</li>
<li>For <span style="text-decoration: underline;">every</span> free ultrafilter <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" /> on <img src="http://s0.wp.com/latex.php?latex=%5Cmathbb%7BN%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathbb{N}" class="latex" title="\mathbb{N}" />, every sequence in <img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> has an ultralimit along <img src="http://s0.wp.com/latex.php?latex=%5Cmathcal%7BU%7D&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="\mathcal{U}" class="latex" title="\mathcal{U}" />.</li>
<li><img src="http://s0.wp.com/latex.php?latex=X&amp;bg=ffffff&amp;fg=333333&amp;s=0" alt="X" class="latex" title="X" /> is compact.</li>
</ol>
<p style="text-align: left;">Ultrafilters are useful in many other contexts. For instance, they are used to construct <em>hyperreal numbers</em>, which in turn allow a rigorous definition of infinitesimals and the foundation of calculus over those. But this might be the topic for another Theory Lunch talk.</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/theorylunch.wordpress.com/1221/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/theorylunch.wordpress.com/1221/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=theorylunch.wordpress.com&amp;blog=43735749&amp;post=1221&amp;subd=theorylunch&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://theorylunch.wordpress.com/2014/01/14/transgressing-the-limits/">by Silvio Capobianco at August 21, 2014 03:15 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://blog.ezyang.com" title="Inside 206-105">Edward Z. Yang</a></h3>

<div class="entrygroup" id="http://blog.ezyang.com/?p=9103">
<blockquote>
<h1 class="entry"><a href="http://feedproxy.google.com/~r/ezyang/~3/VUSeqjV5Fs8/">The fundamental problem of programming language package management</a></h1>
<div class="entry">
<div class="document">



<p>Why are there so many goddamn package managers? They sprawl across both operating systems (apt, yum, pacman, Homebrew) as well as for programming languages (Bundler, Cabal, Composer, CPAN, CRAN, CTAN, EasyInstall, Go Get, Maven, npm, NuGet, OPAM, PEAR, pip, RubyGems, etc etc etc). "It is a truth universally acknowledged that a programming language must be in want of a package manager." What is the fatal attraction of package management that makes programming language after programming language jump off this cliff? Why can't we just, you know, <a href="http://www.standalone-sysadmin.com/blog/2014/03/just-what-we-need-another-package-manager/" class="reference external">reuse</a> an existing package manager?</p>
<p>You can probably think of a few reasons why trying to use apt to manage your Ruby gems would end in tears. "System and language package managers are completely different! Distributions are vetted, but that's completely unreasonable for most libraries tossed up on GitHub. Distributions move too slowly. Every programming language is different. The different communities don't talk to each other. Distributions install packages globally. I want control over what libraries are used." These reasons are all <em>right</em>, but they are missing the essence of the problem.</p>
<p>The fundamental problem is that programming languages package management is <strong>decentralized</strong>.</p>
<p>This decentralization starts with the central premise of a package manager: that is, to install software and libraries that would otherwise not be locally available. Even with an idealized, centralized distribution curating the packages, there are still two parties involved: the distribution and the <em>programmer</em> who is building applications locally on top of these libraries. In real life, however, the library ecosystem is further fragmented, composed of packages provided by a huge variety of developers. Sure, the packages may all be uploaded and indexed in one place, but that doesn't mean that any given author knows about any other given package. And then there's what the Perl world calls DarkPAN: the uncountable lines of code which probably exist, but which we have no insight into because they are locked away on proprietary servers and source code repositories. Decentralization can only be avoided when you control absolutely <em>all</em> of the lines of code in your application.. but in that case, you hardly need a package manager, do you? (By the way, my industry friends tell me this is basically mandatory for software projects beyond a certain size, like the Windows operating system or the Google Chrome browser.)</p>
<p>Decentralized systems are hard. Really, really hard. Unless you design your package manager accordingly, your developers <em>will</em> fall into dependency hell. Nor is there a one "right" way to solve this problem: I can identify at least three distinct approaches to the problem among the emerging generation of package managers, each of which has their benefits and downsides.</p>
<p><strong>Pinned versions.</strong> Perhaps the most popular school of thought is that developers should aggressively pin package versions; this approach advocated by Ruby's Bundler, PHP's Composer, Python's virtualenv and pip, and generally any package manager which describes itself as inspired by the Ruby/node.js communities (e.g. Java's Gradle, Rust's Cargo). Reproduceability of builds is king: these package managers solve the decentralization problem by simply pretending the ecosystem doesn't exist once you have pinned the versions. The primary benefit of this approach is that you are always in control of the code you are running. Of course, the downside of this approach is that you are always in control of the code you are running. An all-to-common occurrence is for dependencies to be pinned, and then forgotten about, even if there are important security updates to the libraries involved.  Keeping bundled dependencies up-to-date requires developer cycles--cycles that more often than not are spent on other things (like new features).</p>
<p><strong>A stable distribution.</strong> If bundling requires every individual application developer to spend effort keeping dependencies up-to-date and testing if they keep working with their application, we might wonder if there is a way to centralize this effort. This leads to the second school of thought: to <em>centralize</em> the package repository, creating a blessed distribution of packages which are known to play well together, and which will receive bug fixes and security fixes while maintaining backwards compatibility. In programming languages, this is much less common: the two I am aware of are Anaconda for Python and Stackage for Haskell. But if we look closely, this model is <em>exactly the same</em> as the model of most operating system distributions. As a system administrator, I often recommend my users use libraries that are provided by the operating system as much as possible. They won't take backwards incompatible changes until we do a release upgrade, and at the same time you'll still get bugfixes and security updates for your code. (You won't get the new hotness, but that's essentially contradictory with stability!)</p>
<p><strong>Embracing decentralization.</strong> Up until now, both of these approaches have thrown out decentralization, requiring a central authority, either the application developer or the distribution manager, for updates. Is this throwing out the baby with the bathwater? The primary downside of centralization is the huge amount of <em>work</em> it takes to maintain a stable distribution or keep an individual application up-to-date. Furthermore, one might not expect the entirety of the universe to be compatible with one another, but this doesn't stop subsets of packages from being useful together. An ideal decentralized ecosystem distributes the problem of identifying what subsets of packages <em>work</em> across everyone participating in the system. Which brings us to the fundamental, unanswered question of programming languages package management:</p>
<blockquote>
<em>How can we create a decentralized package ecosystem that works?</em></blockquote>
<p>Here are a few things that can help:</p>
<ol class="arabic simple">
<li><strong>Stronger encapsulation for dependencies.</strong> One of the reasons why dependency hell is so insidious is the dependency of a package is often an inextricable part of its outwards facing API: thus, the choice of a dependency is not a local choice, but rather a global choice which affects the entire application. Of course, if a library uses some library internally, but this choice is entirely an implementation detail, this <em>shouldn't</em> result in any sort of global constraint. Node.js's NPM takes this choice to its logical extreme: by default, it doesn't deduplicate dependencies at all, giving each library its own copy of each of its dependencies. While I'm <a href="http://stackoverflow.com/questions/25268545/why-does-npms-policy-of-duplicated-dependencies-work" class="reference external">a little dubious</a> about duplicating everything (it certainly occurs in the Java/Maven ecosystem), I certainly agree that keeping dependency constraints local improves <em>composability.</em></li>
<li><strong>Advancing semantic versioning.</strong> In a decentralized system, it's especially important that library writers give <em>accurate</em> information, so that tools and users can make informed decisions.  Wishful, invented version ranges and artistic version number bumps simply exacerbate an already hard problem (as I mentioned in my <a href="http://blog.ezyang.com/2014/08/whats-a-module-system-good-for-anyway/" class="reference external">previous post</a>). If you can <a href="http://bndtools.org/" class="reference external">enforce semantic versioning</a>, or better yet, ditch semantic versions and record the true, <em>type-level</em> dependency on interfaces, our tools can make better choices. The gold standard of information in a decentralized system is, "Is package A compatible with package B", and this information is often difficult (or impossible, for dynamically typed systems) to calculate.</li>
<li><strong>Centralization as a special-case.</strong> The point of a decentralized system is that every participant can make policy choices which are appropriate for them. This includes maintaining their own central authority, or deferring to someone else's central authority: centralization is a special-case. If we suspect users are going to attempt to create their own, operating system style stable distributions, we need to give them the tools to do so... and make them easy to use!</li>
</ol>
<p>For a long time, the source control management ecosystem was completely focused on centralized systems. Distributed version control systems such as Git fundamentally changed the landscape: although Git may be more difficult to use than Subversion for a non-technical user, the benefits of decentralization are diverse. The Git of package management doesn't exist yet: if someone tells you that package management is solved, just reimplement Bundler, I entreat you: think about decentralization as well!</p>
</div>
<img width="1" src="http://feeds.feedburner.com/~r/ezyang/~4/VUSeqjV5Fs8" height="1" /></div>






<p class="date">
<a href="http://feedproxy.google.com/~r/ezyang/~3/VUSeqjV5Fs8/">by Edward Z. Yang at August 21, 2014 01:02 PM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://leepike.wordpress.com" title="A Critical Systems Blog">Lee Pike</a></h3>

<div class="entrygroup" id="http://leepike.wordpress.com/?p=713">
<blockquote>
<h1 class="entry"><a href="http://leepike.wordpress.com/2014/08/20/smartchecking-matt-mights-red-black-trees/">SmartChecking Matt Might’s Red-Black Trees</a></h1>
<div class="entry">
<p>Matt Might gave a nice <a href="http://matt.might.net/articles/quick-quickcheck/">intro to QuickCheck</a> via testing red-black trees recently. Of course, QuickCheck has been around for over a decade now, but it’s still useful (if underused–why aren’t <em>you</em> QuickChecking your programs!?).</p>
<p>In a couple of weeks, I’m <a href="https://github.com/leepike/SmartCheck/blob/master/paper/paper.pdf?raw=true">presenting a paper</a> on an alternative to QuickCheck called <a href="https://github.com/leepike/SmartCheck">SmartCheck</a> at the <a href="http://www.haskell.org/haskell-symposium/">Haskell Symposium</a>.</p>
<p>SmartCheck focuses on efficiently shrinking and generalizing large counterexamples. I thought it’d be fun to try some of Matt’s examples with SmartCheck.</p>
<p>The kinds of properties Matt Checked really aren’t in the sweet spot of SmartCheck, since the counterexamples are so small (Matt didn’t even have to define instances for <tt>shrink</tt>!). SmartCheck focuses on shrinking and generalizing large counterexamples.</p>
<p>Still, let’s see what it looks like. (The code can be found <a href="https://github.com/leepike/SmartCheck/tree/master/examples/RedBlackTrees">here</a>.)</p>
<p>SmartCheck is only interesting for failed properties, so let’s look at an early example in Matt’s blog post where something goes wrong. A lot of the blog post focuses on generating sufficiently constrained arbitrary red-black trees. In the section entitled, “A property for balanced black depth”, a property is given to check that the path from the root of a tree to every leaf passes through the same number of black nodes. An early generator for trees fails to satisfy the property.</p>
<p>To get the code to work with SmartCheck, we derive <tt>Typeable</tt> and <tt>Generic</tt> instances for the datatypes, and use GHC Generics to automatically derive instances for SmartCheck’s typeclass. The only other main issue is that SmartCheck doesn’t support a `<a href="http://hackage.haskell.org/package/QuickCheck-2.7.6/docs/Test-QuickCheck-Property.html#v:forAll">forall</a>` function like in QuickCheck. So instead of a call to QuickCheck such as</p>
<p><code> &gt; quickCheck (forAll nrrTree prop_BlackBalanced)<br />
</code></p>
<p>We change the <tt>arbitrary</tt> instance to be the <tt>nrrTree</tt> generator.</p>
<p>Because it is so easy to find a small counterexample, SmartCheck’s reduction algorithm does a little bit of automatic shrinking, but not too much. For example, a typical minimal counterexample returned by SmartCheck looks like</p>
<p><code> T R E 2 (T B E 5 E)<br />
</code></p>
<p>which is about as small as possible. Now onto generalization!</p>
<p>There are three generalization phases in SmartCheck, but we’ll look at just one, in which a formula is returned that is universally quantified if every test case fails. For the test case above, SmartCheck returns the following formula:</p>
<p><code> forall values x0 x1:<br />
T R E 2 (T B x1 5 x0)<br />
</code></p>
<p>Intuitively, this means that for any well-typed trees chosen that could replace the variables <tt>x0</tt> and <tt>x1</tt>, the resulting formula is still a counterexample.</p>
<p>The benefit to developers is seeing instantly that those subterms in the counterexample probably don’t matter. The real issue is that <tt>E</tt> on the left is unbalanced with (<tt>T B E 5 E)</tt> on the right.</p>
<p>One of the early design decisions in SmartCheck was focus on structurally shrinking data types and essentially ignore “base types” like Int, char, etc. The motivation was to improve efficiency on shrinking large counterexamples.</p>
<p>But for a case like this, generalizing base types would be interesting. We’d hypothetically get something like</p>
<p><code> forall values (x0, x1 :: RBSet Int) (x2, x3 :: Int):<br />
T R E x2 (T B x1 x3 x0)<br />
</code></p>
<p>further generalizing the counterexample. It may be worth adding this behavior to SmartCheck.</p>
<p>SmartCheck’s generalization begins to bridge the gap from specific counterexamples to <em>formulas</em> characterizing counterexamples. The idea is related to <a href="http://www.cse.chalmers.se/~nicsma/papers/quickspec.pdf">QuickSpec</a>, another cool tool developed by Claessen and Hughes (and SmallBone). Moreover, it’s a bridge between testing and verification, or as Matt puts it, from the 80% to the 20%.</p><br />  <a href="http://feeds.wordpress.com/1.0/gocomments/leepike.wordpress.com/713/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/leepike.wordpress.com/713/" alt="" border="0" /></a> <img src="http://pixel.wp.com/b.gif?host=leepike.wordpress.com&amp;blog=7358124&amp;post=713&amp;subd=leepike&amp;ref=&amp;feed=1" alt="" border="0" width="1" height="1" /></div>






<p class="date">
<a href="http://leepike.wordpress.com/2014/08/20/smartchecking-matt-mights-red-black-trees/">by Lee Pike at August 21, 2014 04:53 AM</a>
</p>
</blockquote>
</div>



</div>
<div class="channelgroup">







<h3><a href="https://www.fpcomplete.com/school" title="FP Complete» News/Blog">FP Complete</a></h3>

<div class="entrygroup" id="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">
<blockquote>
<h1 class="entry"><a href="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">IAP: Speeding up conduit</a></h1>
<div class="entry">
<p>This post contains fragments of active Haskell code, best viewed and executed at
<a href="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit</a>
</p>
<p>As most of us know, performance isn't a one-dimensional spectrum. There are in
fact multiple different ways to judge performance of a program. A commonly
recognized tradeoff is that between CPU and memory usage. Often times, a
program can be sped up by caching more data, for example.</p><p>conduit is a streaming data library. In that sense, it has two very specific
performance criterion it aims for:</p><ul><li>Constant memory usage.</li><li>Efficient usage of scarce resources, such as closing file descriptors as early as possible.</li></ul><p>While CPU performance is always a nice goal, it has never been my top priority in
the library's design, especially given that in the main use case for conduit
(streaming data in an I/O context), the I/O cost almost always far outweighs any
CPU overhead from conduit.</p><p>However, for our <a href="https://www.fpcomplete.com/business/iap/">upcoming Integrated Analysis
Platform (IAP)</a> release, this is no longer
the case. conduit will be used in tight loops, where we <i>do</i> need to optimize
for the lowest CPU overhead possible.</p><p>This blog post covers the first set of optimizations I've applied to conduit.
There is still more work to be done, and throughout this blogpost I'll be
describing some of the upcoming changes I am attempting.</p><p>I'll give a brief summary up front:</p><ul><li>Applying the codensity transform results in much better complexity of monadic bind.</li><li>We're also less reliant on rewrite rules firing, which has always been unreliable (and now I know why).</li><li>This change <i>does</i> represent a breaking API change. However, it only affects users of the <code>Data.Conduit.Internal</code> module. If you've just been using the public API, your code will be unaffected, besides getting an automatic speedup.</li><li>These changes will soon be released as conduit 1.2.0, after a period for community feedback.</li></ul><p>Note that this blog post follows the actual steps I went through (more or less)
in identifying the performance issues I wanted to solve. If you want to skip
ahead to the solution itself, you may want to <a href="http://feeds.feedburner.com/fpcomplete#difference-lists">skip to the discussion on
difference lists</a>, or even straight to <a href="http://feeds.feedburner.com/fpcomplete#continuation-passing-style--church-encoding--codensity">continuation passing
style, church-encoding,
codensity</a>.</p><p>By the way, after I originally wrote this blog post, I continued working on the
optimizations I describe as possible future enhancements. Those are actually
working out far better than I expected, and it looks like conduit 1.2.0 will be
able to ship with them. I'll be writing a separate blog post detailing those
changes. A bit of a teaser is: for vector-equivalent code, conduit now
generates identical core as vector itself.</p><h2>The benchmarks</h2><p>Before embarking on any kind of serious optimizations, it's important to have
some benchmarks. I defined three benchmarks for the work I was going to be
doing:</p><ul><li><p>A simple sum: adding up the numbers from 1 to 10000. This is to get a baseline of the overhead coming from conduit.</p></li><li><p>A monte carlo analysis: This was <a href="https://www.fpcomplete.com/blog/2014/03/monte-carlo-haskell">based on a previous IAP blog post</a>. I noticed when working on that benchmark that, while the conduit solution was highly <i>memory</i> efficient, there was still room to speed up the benchmark.</p></li><li><p>Sliding vectors: Naren Sundar recently <a href="https://github.com/fpco/conduit-combinators/pull/6">sent a sliding windows pull requests</a>, which allow us to get a view of a fixed size of a stream of values. This feature is very useful for a number of financial analyses, especially regarding time series.</p><p>Naren's pull request was based on immutable data structures, and for those cases it is highly efficient. However, it's possible to be far more memory efficient by writing to a mutable vector instead, and then taking immutable slices of that vector. Mihaly Barasz <a href="https://github.com/fpco/conduit-combinators/pull/8">sent a pull request for this feature</a>, and much to our disappointment, for small window sizes, it performed worse than sliding windows. We want to understand why.</p></li></ul><p>You can <a href="https://github.com/snoyberg/conduit/blob/ff5a25845ddc3b8a6df3fbfe31c3fb886c7a6bb9/conduit/benchmarks/optimize-201408.hs">see the benchmark code</a>, which stays mostly unchanged for the rest of this blog post (a few new cases are added to demonstrate extra points). The benchmarks always contain a low-level base case representing the optimal performance we can expect from hand-written Haskell (without resorting to any kind of FFI tricks or the like).</p><p>You can <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/01-4b901bef293126dd07908c23c4e37c1c3a404ccb.html">see the first run
results</a>
which reflect conduit 1.1.7, plus inlining of a few functions. Some initial analysis:</p><ul><li>Control.Monad.foldM is surpringly slow.</li><li>Data.Conduit.List.foldM has a rather steep performance hit versus Data.Conduit.List.fold.</li><li>There's a <i>very</i> high overhead in the monte carlo analysis.</li><li>For sliding vector, the conduit overhead is more pronounced at smaller window sizes.</li><li>But even with large window sizes, mutable vector conduits still have a large overhead. The sliding window/immutable approach, however, shows almost no overhead.</li></ul><p>That hopefully sets the scene enough for us to begin to dive in.</p><h2>Rewrite rules: lift</h2><p>GHC offers a very powerful optimization technique: rewrite rules. This allows
you to tell the compiler that a certain expression can be rewritten to a more
efficient one. A common example of a rewrite rule would be to state that <code>map f
. map g</code> is the same as <code>map (f . g)</code>. This can be expressed as:</p><p>{-# RULES "map f . map g" forall f g. map f . map g = map (f . g) #-}</p><p>Note that GHC's list rewrite rules are actually more complicated than this, and
revolve around a concept called build/foldr fusion.</p><p>Let's look at the implementation of the <code>yield</code> function in conduit (with some newtypes stripped away):</p><pre><code class="haskell">yield :: Monad m =&gt; o -&gt; ConduitM i o m ()
yield o = HaveOutput (Done ()) (return ()) o
{-# INLINE [1] yield #-}
{-# RULES
    "yield o &gt;&gt; p" forall o (p :: ConduitM i o m r).
    yield o &gt;&gt; p = HaveOutput p (return ()) o
  #-}</code></pre><p>The core datatype of conduit is recursive. The <code>HaveOutput</code> constructor
contains a field for "what to do next." In the case of <code>yield</code>, there <i>isn't</i>
anything to do next, so we fill that with <code>Done ()</code>. However, creating that
<code>Done ()</code> value just to throw it away after a monadic bind is wasteful. So we
have a rewrite rule to fuse those two steps together.</p><p>But no such rewrite rule exists for <code>lift</code>! My first step was to <a href="https://github.com/snoyberg/conduit/commit/f23b3e8fdc057da5448b5089478317bd425ad263#diff-fcbe586e03ed1156ac9ff7f0855a03e8R1171">add such a
rule</a>, and <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/02-f23b3e8fdc057da5448b5089478317bd425ad263.html">check the
results</a>.
Unfortunately, the rule didn't have any real impact, because it wasn't firing.
Let's put that issue to the side; we'll come back to it later.</p><h2>Cleanup, inlining</h2><p>One of the nice features introduced in (I believe) GHC 7.8 is that the compiler
will now warn you when a rewrite rule may not fire. When compiling conduit, I
saw messages like:</p><pre><code class="haskell">Data/Conduit/List.hs:274:11: Warning:
    Rule "source/map fusion $=" may never fire
      because ‘$=’ might inline first
    Probable fix: add an INLINE[n] or NOINLINE[n] pragma on ‘$=’

Data/Conduit/List.hs:275:11: Warning:
    Rule "source/map fusion =$=" may never fire
      because ‘=$=’ might inline first
    Probable fix: add an INLINE[n] or NOINLINE[n] pragma on ‘=$=’

Data/Conduit/List.hs:542:11: Warning:
    Rule "source/filter fusion $=" may never fire
      because ‘$=’ might inline first
    Probable fix: add an INLINE[n] or NOINLINE[n] pragma on ‘$=’

Data/Conduit/List.hs:543:11: Warning:
    Rule "source/filter fusion =$=" may never fire
      because ‘=$=’ might inline first
    Probable fix: add an INLINE[n] or NOINLINE[n] pragma on ‘=$=’

Data/Conduit/List.hs:552:11: Warning:
    Rule "connect to sinkNull" may never fire
      because ‘$$’ might inline first
    Probable fix: add an INLINE[n] or NOINLINE[n] pragma on ‘$$’</code></pre><p>This demonstrates an important interaction between inlining and rewrite rules.
We need to make sure that expressions that need to be rewritten are not inlined
first. If they are first inlined, then GHC won't be able to rewrite them to our
more optimized version.</p><p>A common approach to this is to <i>delay</i> inlining of functions until a later
<i>simplification phase</i>. The GHC simplification process runs in multiple steps,
and we can state that rules and inlining should only happen before or after a
certain phase. The phases count down from 2 to 0, so we commonly want to delay
inlining of functions until phase 0, if they may be subject to rewriting.</p><p>Conversely, some functions need to be inlined <i>before</i> a rewrite rule can fire. In stream fusion, for example, the fusion framework depends on the following sequencing to get good performance:</p><pre><code class="haskell">map f . map g
-- inline map
unstream . mapS f . stream . unstream . mapS g . stream
-- rewrite stream . unstream
unstream . mapS f . mapS g . stream
-- rewrite mapS . mapS
unstream . mapS (f . g) . stream</code></pre><p>In conduit, we need to make sure that all of this is happening in the correct
order. There was one particular complexity that made it difficult to ensure
this happened. conduit in fact has <i>two</i> core datatypes: <code>Pipe</code> and <code>ConduitM</code>,
with the latter being a more friendly newtype wrapper around the first. Up
until this point, the code for the two was jumbled into a single internal
module, making it difficult to track which things were being written in which
version of the API.</p><p>My next step was to <a href="https://github.com/snoyberg/conduit/commit/dfff204e1c603f2466060e37a4a193462f5fa52f">split things into .Pipe and .Conduit internal
modules</a>,
and then <a href="https://github.com/snoyberg/conduit/commit/164f01f412b1cac2529bfdeb3fd4584b3c097856">clean up GHC's
warnings</a>
to get rules to fire more reliably. This <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/04-164f01f412b1cac2529bfdeb3fd4584b3c097856.html">gave a modest performance
boost</a>
to the sliding vector benchmarks, but not much else. But it <i>does</i> pave the way
for future improvements.</p><h2>Getting serious about sum, by cheating</h2><p>The results so far have been uninspiring. We've identified a core problem (too
many of those <code>Done</code> data constructors being used), and noticed that the
rewrite rules that <i>should</i> fix that don't seem to be doing their job. Now
let's take our first stab at <i>really</i> improving performance: with aggressive
rewrite rules.</p><p>Our <code>sum</code> benchmark is really simple: use <code>enumFromTo</code> to create a stream of
values, and <code>fold</code> (or <code>foldM</code>) to consume that. The thing that slows us down
is that, in between these two simple functions, we end up allocating a bunch of
temporary data structures. Let's <a href="https://github.com/snoyberg/conduit/commit/307dab9461dd3c30b577bb094e499e0fba493c78">get rid of them with rewrite
rules</a>!</p><p>This <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/06-211db90fce8b906e6e02345d20a290dc37395692.html">certainly did the
trick</a>.
The conduit implementation jumped from 185us to just 8.63us. For comparison,
the low level approach (or vector's stream fusion) clocks in at 5.77us, whereas
<code>foldl'</code> on a list is 80.6us. This is a huge win!</p><p>But it's also misleading. All we've done here is sneakily rewritten our conduit
algorithm into a low-level format. This solves the specific problem on the
table (connecting enumFromTo with fold), but won't fully generalize to other
cases. A more representative demonstration of this improvement is the speedup
for <code>foldM</code>, which went from 1180us to 81us. The reason this is more realistic
is that the rewrite rule is not specialized to <code>enumFromTo</code>, but rather works
on <i>any</i> <code>Source</code>.</p><p>I took a big detour at this point, and ended up <a href="https://github.com/snoyberg/conduit/blob/optimize-201408-stream-conduit/stream-conduit/Data/StreamConduit.hs">writing an initial
implementation of stream fusion in
conduit</a>.
Unfortunately, I ran into a dead end on that branch, and had to put that work
to the side temporarily. However, the improvements discussed in the rest of
this blog post will hopefully reopen the door to stream fusion, which I hope to
investigate next.</p><h2>Monte carlo, and associativity</h2><p>Now that I'd made the results of the sum benchmark thoroughly useless, I
decided to focus on the results of monte carlo, where the low level
implementation still won by a considerable margin (3.42ms vs 10.6ms). The
question was: why was this happening? To understand, let's start by looking at the code:</p><pre><code class="haskell">analysis = do
    successes &lt;- sourceRandomN count
              $$ CL.fold (\t (x, y) -&gt;
                            if (x*x + y*(y :: Double) &lt; 1)
                                then t + 1
                                else t)
                    (0 :: Int)
    return $ fromIntegral successes / fromIntegral count * 4

sourceRandomN :: (MWC.Variate a, MonadIO m) =&gt; Int -&gt; Source m a
sourceRandomN cnt0 = do
    gen &lt;- liftIO MWC.createSystemRandom
    let loop 0 = return ()
        loop cnt = do
            liftIO (MWC.uniform gen) &gt;&gt;= yield &gt;&gt; loop (cnt - 1)
    loop cnt0</code></pre><p>The <code>analysis</code> function is not very interesting: it simply connects <code>sourceRandomN</code> with a <code>fold</code>. Given that we now have a well behaved and consistently-firing rewrite rule for connecting to folds, it's safe to say that was not the source of our slowdown. So our slowdown must be coming from:</p><pre><code class="haskell">liftIO (MWC.uniform gen) &gt;&gt;= yield &gt;&gt; loop (cnt - 1)</code></pre><p>This should in theory generate really efficient code. <code>yield &gt;&gt; loop (cnt - 1)</code>
should be rewritten to <code>\x -&gt; HaveOutput (loop (cnt - 1)) (return ()) x)</code>, and
then <code>liftIO</code> should get rewritten to generate:</p><pre><code class="haskell">PipeM $ do
    x &lt;- MWC.uniform gen
    return $ HaveOutput (loop $ cnt - 1) (return ()) x</code></pre><p>I <a href="https://github.com/snoyberg/conduit/commit/a62e7ebeaaf2ef16265751bdec3d91ffb16034c0">added another
commit</a>
to include a few more versions of the monte carlo benchmark (<a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/08-a62e7ebeaaf2ef16265751bdec3d91ffb16034c0.html">results here</a>). The two most
interesting are:</p><ul><li><p>Explicit usage of the <code>Pipe</code> constructors:</p><pre><code class="haskell">sourceRandomNConstr :: (MWC.Variate a, MonadIO m) =&gt; Int -&gt; Source m a
sourceRandomNConstr cnt0 = ConduitM $ PipeM $ do
    gen &lt;- liftIO MWC.createSystemRandom
    let loop 0 = return $ Done ()
        loop cnt = do
            x &lt;- liftIO (MWC.uniform gen)
            return $ HaveOutput (PipeM $ loop (cnt - 1)) (return ()) x
    loop cnt0</code></pre><p>This version ran in 4.84ms, vs the original conduit version which ran in 15.8ms. So this is definitely the problem!</p></li><li><p>Explicitly force right-associated binding order:</p><pre><code class="haskell">sourceRandomNBind :: (MWC.Variate a, MonadIO m) =&gt; Int -&gt; Source m a
sourceRandomNBind cnt0 = lift (liftIO MWC.createSystemRandom) &gt;&gt;= \gen -&gt;
    let loop 0 = return ()
        loop cnt = do
            lift (liftIO $ MWC.uniform gen) &gt;&gt;= (\o -&gt; yield o &gt;&gt; loop (cnt - 1))
     in loop cnt0</code></pre><p>Or to zoom in on the important bit:</p><pre><code class="haskell">lift (liftIO $ MWC.uniform gen) &gt;&gt;= (\o -&gt; yield o &gt;&gt; loop (cnt - 1))</code></pre><p>By the monad laws, this code is identical to the original. However, instead of standard left-associativity, we have right associativity or monadic bind. This code ran in 5.19ms, an approximate threefold speedup vs the left associative code!</p></li></ul><p>This issue of associativity was something Roman Cheplyaka <a href="http://www.reddit.com/r/haskell/comments/23m4bs/i_added_a_coroutine_example_to_the_wiki_did_i/cgyfxux">told me about back
in
April</a>,
so I wasn't surprised to see it here. Back then, I'd looked into using
<code>Codensity</code> together with <code>ConduitM</code>, but didn't get immediate results, and
therefore postponed further research until I had more time.</p><p>OK, so why exactly does left-associativity hurt us so much? There are two reasons actually:</p><ul><li>Generally speaking, many monads perform better when they are right associated. This is especially true for free monads, of which conduit is just a special case. Janis Voigtl ̈ander's paper <a href="http://www.iai.uni-bonn.de/~jv/mpc08.pdf">Asymptotic Improvement of Computations over Free Monads</a> and Edward Kmett's blog post series <a href="http://comonad.com/reader/2011/free-monads-for-less/">free monads for less</a> do a far better job of explaining the issue than I could.</li><li>In the case of conduit, left associativity prevented the <code>lift</code> and <code>yield</code> rewrite rules from firing, which introduced extra, unnecessary monadic bind operations. Forcing right associativity allows these rules to fire, avoiding a lot of unnecessary data constructor allocation and analysis.</li></ul><p>At this point, it became obvious at this point that the main slowdown I
was seeing was driven by this problem. The question is: how should we
solve it?</p><h2>Difference lists</h2><p>To pave the way for the next step, I want to take a quick detour and talk about
something simpler: difference lists. Consider the following code:</p><pre><code class="haskell">(((w ++ x) ++ y) ++ z)</code></pre><p>Most experienced Haskellers will cringe upon reading that. The append operation
for a list needs to traverse every cons cell in its left value. When we
left-associate append operations like this, we will need to traverse every cell
in <code>w</code>, then every cell in <code>w ++ x</code>, then every cell in <code>w ++ x ++ y</code>. This is highly
inefficient, and would clearly be better done in a right-associated style
(sound familiar?).</p><p>But forcing programmers to ensure that their code is always right-associated
isn't always practical. So instead, we have two common alternatives. The first
is: use a better datastructure. In particular, <code>Data.Sequence</code> has far cheaper
append operations than lists.</p><p>The other approach is to use <i>difference lists</i>. Difference lists are
<i>functions</i> instead of actual list values. They are instructions for adding
values to the beginning of the list. In order to append, you use normal
function composition. And to convert them to a list, you apply the resulting
function to an empty list. As an example:</p><pre><code class="haskell active">type DList a = [a] -&gt; [a]

dlist1 :: DList Int
dlist1 rest = 1 : 2 : rest

dlist2 :: DList Int
dlist2 rest = 3 : 4 : rest

final :: [Int]
final = dlist1 . dlist2 $ []

main :: IO ()
main = print final</code></pre><p>Both difference lists and sequences have advantages. Probably the simplest summary is:</p><ul><li>Difference lists have smaller constant factors for appending.</li><li>Sequences allow you to analyze them directly, without having to convert them to a different data type first.</li></ul><p>That second point is important. If you need to regularly analyze your list and
then continue to append, the performance of a difference list will be abysmal.
You will constantly be swapping representations, and converting from a list to
a difference list is an O(n) operation. But if you will simply be constructing
a list once without any analysis, odds are difference lists will be faster.</p><p>This situation is <i>almost</i> identical to our problems with conduit. Our monadic
composition operator- like list's append operator- needs to traverse the entire
left hand side. This connection is more clearly spelled out in <a href="http://homepages.cwi.nl/~ploeg/papers/zseq.pdf">Reflection
without Remorse</a> by Atze van
der Ploeg and Oleg Kiselyov (and for me, care of Roman).</p><p>Alright, with that out of the way, let's finally fix conduit!</p><h2>Continuation passing style, church-encoding, codensity</h2><p>There are essentially two things we need to do with conduits:</p><ul><li>Monadically compose them to sequence two streams into a larger stream.</li><li>Categorically compose them to connect one stream to the next in a pipeline.</li></ul><p>The latter requires that we be able to case analyze our datatypes, while
theoretically the former does not: something like difference lists for simple
appending would be ideal. In the past, I've tried out a number of different
alternative implementations of conduit, none of which worked well enough. The
problem I always ran into was that either monadic bind became too expensive, or
categorical composition became too expensive.</p><p>Roman, Mihaly, Edward and I <a href="https://github.com/snoyberg/conduit/commit/5cacdc36d140d075ce7b7bfc397c2fc08fffe7cd#commitcomment-7414323">discussed these issues a
bit</a>
on Github, and based on Roman's advice, I went ahead with <a href="https://github.com/snoyberg/conduit-cps-benchmarks">writing a benchmark
of different conduit
implementations</a>. I
currently have four implementations in this benchmark (and hope to add more):</p><ul><li>Standard, which looks very much like conduit 1.1, just a bit simplified (no rewrite rules, no finalizers, no leftovers).</li><li>Free, which is conduit rewritten to explicitly use the free monad transformer.</li><li>Church, which modifies Free to instead use the Church-encoded free monad transformer.</li><li>Codensity, which is a Codensity-transform-inspired version of conduit.</li></ul><p>You can <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/cps-benchmark-20140818b.html">see the benchmark
results</a>,
which clearly show the codensity version to be the winner. Though it would be
interesting, I think I'll avoid going into depth on the other three
implementations for now (this blog post is long enough already).</p><h3>What is Codensity?</h3><p>Implementing Codensity in conduit just means changing the <code>ConduitM</code> newtype
wrapper to look like this:</p><pre><code class="haskell">newtype ConduitM i o m r = ConduitM
    { unConduitM :: forall b.
                    (r -&gt; Pipe i i o () m b) -&gt; Pipe i i o () m b
    }</code></pre><p>What this says is "I'm going to provide an <code>r</code> value. If you give me a function that needs an <code>r</code> value, I'll give it that <code>r</code> value and then continue with the resulting <code>Pipe</code>." Notice how similar this looks to the type signature of monadic bind itself:</p><pre><code class="haskell">(&gt;&gt;=) :: Pipe i i o () m r
      -&gt; (r -&gt; Pipe i i o () m b)
      -&gt; Pipe i i o () m b</code></pre><p>This isn't by chance, it's by construction. More information is available in
<a href="http://hackage.haskell.org/package/kan-extensions-4.0.3/docs/Control-Monad-Codensity.html">the Haddocks of
kan-extension</a>,
or in the above-linked paper and blog posts by Janis and Edward. To see why
this change is important, let's look at the new implementations of some of the
core conduit functions and type classes:</p><pre><code class="haskell">yield o = ConduitM $ \rest -&gt; HaveOutput (rest ()) (return ()) o

await = ConduitM $ \f -&gt; NeedInput (f . Just) (const $ f Nothing)

instance Monad (ConduitM i o m) where
    return x = ConduitM ($ x)
    ConduitM f &gt;&gt;= g = ConduitM $ \h -&gt; f $ \a -&gt; unConduitM (g a) h

instance MonadTrans (ConduitM i o) where
    lift mr = ConduitM $ \rest -&gt; PipeM (liftM rest mr)</code></pre><p>Instead of having explicit <code>Done</code> constructors in <code>yield</code>, <code>await</code>, and <code>lift</code>,
we use the continuation <code>rest</code>. This is the <i>exact same transformation</i> we were
previously relying on rewrite rules to provide. However, our rewrite rules
couldn't fire properly in a left-associated monadic binding. Now we've avoided
the whole problem!</p><p>Our <code>Monad</code> instance also became much smaller. Notice that in order to
monadically compose, there is no longer any need to case-analyze the left hand
side, which avoids the high penalty of left association.</p><p>Another interesting quirk is that our <code>Monad</code> instance on <code>ConduitM</code> no longer
requires that the base <code>m</code> type constructor itself be a <code>Monad</code>. This is nice
feature of <code>Codensity</code>.</p><p>So that's half the story. What about categorical composition? That certainly
<i>does</i> require analyzing both the left and right hand structures. So don't we
lose all of our speed gains of <code>Codensity</code> with this? Actually, I think not.
Let's look at the code for categorical composition:</p><pre><code class="haskell">ConduitM left0 =$= ConduitM right0 = ConduitM $ \rest -&gt;
    let goRight final left right =
            case right of
                HaveOutput p c o  -&gt; HaveOutput (recurse p) (c &gt;&gt; final) o
                NeedInput rp rc   -&gt; goLeft rp rc final left
                Done r2           -&gt; PipeM (final &gt;&gt; return (rest r2))
                PipeM mp          -&gt; PipeM (liftM recurse mp)
                Leftover right' i -&gt; goRight final (HaveOutput left final i) right'
          where
            recurse = goRight final left

        goLeft rp rc final left =
            case left of
                HaveOutput left' final' o -&gt; goRight final' left' (rp o)
                NeedInput left' lc        -&gt; NeedInput (recurse . left') (recurse . lc)
                Done r1                   -&gt; goRight (return ()) (Done r1) (rc r1)
                PipeM mp                  -&gt; PipeM (liftM recurse mp)
                Leftover left' i          -&gt; Leftover (recurse left') i
          where
            recurse = goLeft rp rc final
     in goRight (return ()) (left0 Done) (right0 Done)</code></pre><p>In the last line, we apply <code>left0</code> and <code>right0</code> to <code>Done</code>, which is how we
convert our Codensity version into something we can actually analyze. (This is
equivalent to applying a difference list to an empty list.) We then traverse
these values in the same way that we did in conduit 1.1 and earlier.</p><p>The important difference is how we ultimately finish. The code in question is
the <code>Done</code> clause of the <code>goRight</code>'s case analysis, namely:</p><pre><code class="haskell">Done r2           -&gt; PipeM (final &gt;&gt; return (rest r2))</code></pre><p>Notice the usage of <code>rest</code>, instead of what we would have previously done: used
the <code>Done</code> constructor. By doing this, we're immediately recreating a Codensity
version of our resulting <code>Pipe</code>, which allows us to only traverse our incoming
<code>Pipe</code> values once each, and not need to retraverse the outgoing <code>Pipe</code> for
future monadic binding.</p><p>This trick doesn't just work for composition. There are a large number of
functions in <code>conduit</code> that need to analyze a <code>Pipe</code>, such as <code>addCleanup</code> and
<code>catchC</code>. All of them are now implemented in this same style.</p><p>After implementing this change, the <a href="https://s3.amazonaws.com/download.fpcomplete.com/benchmarks/conduit-201408/10-5cacdc36d140d075ce7b7bfc397c2fc08fffe7cd.html">resulting benchmarks look much
better</a>.
The naive implementation of monte carlo is now quite close to the low-level
version (5.28ms vs 3.44ms, as opposed to the original 15ms). Sliding vector is
also much better: the unboxed, 1000-size window benchmark went from 7.96ms to
4.05ms, vs a low-level implementation at 1.87ms.</p><h3>Type-indexed sequences</h3><p>One approach that I haven't tried yet is the type-indexed sequence approach
from Reflection without Remorse. I still intend to add it to my conduit
benchmark, but I'm not optimistic about it beating out Codensity. My guess is
that a sequence data type will have a higher constant factor overhead, and
based on the way composition is implemented in conduit, we won't get any
benefit from avoiding the need to transition between two representations.</p><p>Edward said he's hoping to get an implementation of such a data structure into
the free package, at which point I'll update my benchmark to see how it
performs.</p><h2>To pursue next: streamProducer, streamConsumer, and more</h2><p>While this round of benchmarking produced some very nice results, we're clearly
not yet at the same level as low-level code. My goal is to focus on that next.
I have some experiments going already relating to getting conduit to expose
stream fusion rules. In simple cases, I've generated a conduit-compatible API
with the same performance as vector.</p><p>The sticking point is getting something which is efficient not just for
functions explicitly written in stream style, but also provides decent
performance when composed with the <code>await</code>/<code>yield</code> approach. While the latter
approach will almost certainly be slower than stream fusion, I'm hoping we can
get it to degrade to current-conduit performance levels, and allow stream
fusion to provide a significant speedup when categorically composing two
<code>Conduit</code>s written in that style.</p><p>The code discussed in this post is now available on the <code>next-cps</code> branch of
conduit. conduit-extra, conduit-combinators, and a number of other packages
either compile out-of-the-box with these changes, or require minor tweaks
(already implemented), so I'm hoping that this API change does not affect too
many people.</p><p>As I mentioned initially, I'd like to have some time for community discussion
on this before I make this next release.</p></div>






<p class="date">
<a href="https://www.fpcomplete.com/blog/2014/08/iap-speeding-up-conduit">August 21, 2014 12:00 AM</a>
</p>
</blockquote>
</div>


</div>

</div>
<div class="daygroup">
<h2>August 20, 2014</h2>

<div class="channelgroup">







<h3><a href="http://neilmitchell.blogspot.com/" title="Neil Mitchell's Haskell Blog">Neil Mitchell</a></h3>

<div class="entrygroup" id="tag:blogger.com,1999:blog-7094652.post-9035262543512338818">
<blockquote>
<h1 class="entry"><a href="http://neilmitchell.blogspot.com/2014/08/continuations-and-exceptions.html">Continuations and Exceptions</a></h1>
<div class="entry">
<p><em>Summary: In moving Shake to continuations, exceptions were the biggest headache. I figured out how to somewhat integrate continuations and exception handling.</em></p><p>The <a href="https://github.com/ndmitchell/shake">git repo for Shake</a> now suspends inactive computations by capturing their continuation instead of blocking their thread, based on the continuations I described in a <a href="http://neilmitchell.blogspot.com/2014/06/optimisation-with-continuations.html">previous blog post</a>. The most difficult part was managing exceptions. I needed to define a monad where I could capture continuations and work with exceptions, requiring the definitions:</p><pre><code>data M a = ... deriving (Functor, Applicative, Monad, MonadIO)<br />throwM :: SomeException -&gt; M a<br />catchM :: M a -&gt; (SomeException -&gt; M a) -&gt; M a<br />captureM :: ((a -&gt; IO ()) -&gt; IO ()) -&gt; M a<br /></code></pre><p>I'm using <code>M</code> as the name of the monad. I want equivalents of <code>throwIO</code> and <code>catch</code> for <code>M</code>, along with a function to capture continuations.</p><p><strong>The first observation</strong> is that since <code>catchM</code> must catch any exceptions, including those thrown by users calling <code>error</code>, then <code>throwM</code> can be defined as:</p><pre><code>throwM = liftIO . throwIO<br /></code></pre><p>Using <code>throwIO</code> gives better guarantees about when the exception is raised, compared to just <code>throw</code>.</p><p><strong>The second observation</strong> is that sometimes I want to raise an exception on the continuation, rather than passing back a value. I can build that on top of <code>captureM</code> with:</p><pre><code>captureM' :: ((Either SomeException a -&gt; IO ()) -&gt; IO ()) -&gt; M a<br />captureM' k = either throwM return =&lt;&lt; captureM k<br /></code></pre><p><strong>The third observation</strong> (which I observed after a few weeks trying not to follow it) is that the continuation may never be called, and that means you cannot implement a robust <code>finallyM</code> function. In particular, if the person who was intending to run the continuation themselves raises an exception, the continuation is likely to be lost. I originally tried to come up with schemes for defining the function passed the continuation to guarantee the continuation was called, but it became messy very quickly.</p><p><strong>The properties</strong> we expect of the implementation, to a rough approximation, include:</p><ul><li><code>catchM (x &gt;&gt; throwM e) (\_ -&gt; y) &gt;&gt; z === x &gt;&gt; y &gt;&gt; z</code> -- if you throw an exception inside a <code>catchM</code>, you must run the handler.</li><li><code>captureM (\k -&gt; x) &gt;&gt;= y === x</code> -- if you execute something not using the continuation inside <code>captureM</code> it must behave like it does outside <code>captureM</code>. In particular, if the <code>captureM</code> is inside a <code>catchM</code>, that <code>catchM</code> must not catch the exception.</li><li><code>captureM (\k -&gt; k x) &gt;&gt;= y === x &gt;&gt;= y</code> -- if you capture the continuation then continue that must be equivalent to not capturing the continuation.</li><li><code>captureM (\k -&gt; k x &gt;&gt; k x) &gt;&gt;= y === (x &gt;&gt;= y) &gt;&gt; (x &gt;&gt;= y)</code> -- if you run the continuation twice it must do the same <code>IO</code> actions each time. In particular, if the first gets its exceptions caught, the second must do also.</li></ul><p>These properties are incomplete (there are other things you expect), and fuzzy (for example, the second property isn't type correct) - but hopefully they give an intuition.</p><p><strong>The implementation</strong> was non-trivial and (sadly) non-elegant. I suspect a better implementation is known in the literature, and I'd welcome a pointer. My implementation defines <code>M</code> as:</p><pre><code>type M a = ContT () (ReaderT (IORef (SomeException -&gt; IO ())) IO) a<br /></code></pre><p>Here we have a continuation monad wrapping a reader monad. The reader contains an <code>IORef</code> which stores the exception handler. The basic idea is that whenever we start running anything in <code>M</code> we call the Haskell <code>catch</code> function, and the exception handler forwards to the <code>IORef</code>. We can define <code>catchM</code> as:</p><pre><code>catchM :: M a -&gt; (SomeException -&gt; M a) -&gt; M a<br />catchM m hdl = ContT $ \k -&gt; ReaderT $ \s -&gt; do<br />    old &lt;- liftIO $ readIORef s<br />    writeIORef s $ \e -&gt; do<br />        s &lt;- newIORef old<br />        hdl e `runContT` k `runReaderT` s `catch`<br />            \e -&gt; ($ e) =&lt;&lt; readIORef s<br />    flip runReaderT s $ m `runContT` \v -&gt; do<br />        s &lt;- ask<br />        liftIO $ writeIORef s old<br />        k v<br /></code></pre><ul><li>We store the previous exception handler as <code>old</code>, and insert a new one. After the code has finished (we have left the <code>catchM</code> block) we restore the <code>old</code> exception handler. In effect, we have a stack of exception handlers.</li><li>When running the handler we pop off the current exception handler by restoring <code>old</code>, then since we have already used up our <code>catch</code>, we add a new <code>catch</code> to catch exceptions in the handler.</li></ul><p>We then define <code>captureM</code> as:</p><pre><code>captureM :: ((a -&gt; IO ()) -&gt; IO ()) -&gt; M a<br />captureM f = ContT $ \k -&gt; ReaderT $ \s -&gt; do<br />    old &lt;- readIORef s<br />    writeIORef s throwIO<br />    f $ \x -&gt; do<br />        s &lt;- newIORef old<br />        flip runReaderT s (k x) `E.catch`<br />            \e -&gt; ($ e) =&lt;&lt; readIORef s<br />        writeIORef s throwIO<br /></code></pre><ul><li>We make sure to switch the <code>IORef</code> back to <code>throwIO</code> before we start running the users code, and after we have finished running our code and switch back to user code. As a result, if the function that captures the continuation throws an exception, it will be raised as normal.</li><li>When running the continuation we create a new <code>IORef</code> for the handler, since the continuation might be called twice in parallel, and the separate <code>IORef</code> ensures they don't conflict with each other.</li></ul><p>Finally, we need a way to run the computation. I've called that <code>runM</code>:</p><pre><code>runM :: M a -&gt; (Either SomeException a -&gt; IO ()) -&gt; IO ()<br />runM m k = do<br />    let mm = do<br />            captureM $ \k -&gt; k ()<br />            catchM (Right &lt;$&gt; m) (return . Left)<br />    s &lt;- newIORef throwIO<br />    mm `runContT` (liftIO . k) `runReaderT` s<br /></code></pre><p>The signature of <code>runM</code> ends up being the only signature the makes sense given the underlying mechanisms. We define <code>mm</code> by using the facilities of <code>captureM</code> to insert a <code>catch</code> and <code>catchM</code> to ensure we never end up in an exception state from <code>runM</code>. The rest is just matching up the types.</p><p><strong>Stack depth</strong> could potentially become a problem with this solution. If you regularly do:</p><pre><code>captureM (\k -&gt; k ())<br /></code></pre><p>Then each time a <code>catch</code> will be wrapped around the function. You can avoid that by changing <code>captureM</code> to throw an exception:</p><pre><code>captureM :: ((a -&gt; IO ()) -&gt; IO ()) -&gt; M a<br />captureM f = ContT $ \k -&gt; ReaderT $ \s -&gt; do<br />    old &lt;- readIORef s<br />    writeIORef s $ \_ -&gt;<br />        f $ \x -&gt; do<br />            s &lt;- newIORef old<br />            flip runReaderT s (k x) `E.catch`<br />                \e -&gt; ($ e) =&lt;&lt; readIORef s<br />    throwIO anyException<br /></code></pre><p>Here we unwind the <code>catch</code> by doing a <code>throwIO</code>, after installing our exception handler which actually passes the continuation. It is a bit ugly, and I haven't checked if either the <code>catch</code> is a problem, or that this solution solves it.</p><p><strong>The implementation in Shake</strong> is a bit different to that described above. In Shake I know that captured continuations are never called more than once, so I<br />can avoid creating a new <code>IORef</code> in <code>captureM</code>, and I can reuse the existing one. Since I never change the handler, I can use a slightly less powerful definition of <code>M</code>:</p><pre><code>type M a = ReaderT (IORef (SomeException -&gt; IO ())) (ContT () IO) a<br /></code></pre><p>The resulting code is <a href="https://github.com/ndmitchell/shake/blob/master/Development/Shake/Monad.hs">Development.Shake.Monad</a>, which implements the <code>RAW</code> monad, and also does a few extra things which are irrelevant to this post.</p><p><strong>The cool thing about Haskell</strong> is that I've been able to completely replace the underlying Shake <code>Action</code> monad from <code>StateT</code>/<code>IO</code>, to <code>ReaderT</code>/<code>IO</code>, to <code>ReaderT</code>/<code>ContT</code>/<code>IO</code>, without ever breaking any users of Shake. Haskell allows me to produce effective and flexible abstractions.</p></div>






<p class="date">
<a href="http://neilmitchell.blogspot.com/2014/08/continuations-and-exceptions.html">by Neil Mitchell (noreply@blogger.com) at August 20, 2014 05:39 PM</a>
</p>
</blockquote>
</div>


</div>

</div>


<div class="sidebar">
<img src="images/new-planet-haskell.jpg" width="136" height="136" alt="">

<p>The content on this planet is republished with permission from the blogs
of the relevant authors.<br>
<br>
<strong>Last updated:</strong><br>
September 17, 2014 12:06 PM<br>
<em>All times are UTC.</em><br>
<br>
Powered by:<br>
<a href="http://intertwingly.net/code/venus/"><img src="images/venus.png" width="80" height="15" alt="Venus" border="0"></a><br /><br />
Aggregate feeds:<br />
<a href="rss20.xml">RSS 2.0</a><br />
<a href="atom.xml">Atom</a><br /><br />
Direct your Haskell questions to the <a href="http://www.haskell.org/haskellwiki/Mailing_lists">mailing lists</a>.<br /><br />
For contacting the Planet admins:<br /><a href="mailto:planet@community.haskell.org">planet@community.haskell.org</a><br />
<a href="faq.html">FAQ</a> (read it if you want to get added)
</p>
<hr />
<h2>Authors</h2>
<ul>
<li><a href="http://ghclive.wordpress.com" title="ghcLiVE">A multi-user browser-based GHCi</a> <a href="http://ghclive.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://blog.luigiscorner.com" title="Luigi's corner » Haskell">ARJANEN Loïc Jean David</a> <a href="http://blog.luigiscorner.com/category/haskell/feed/atom/">(feed)</a></li>
<li><a href="http://notes-on-haskell.blogspot.com/" title="Notes on Haskell">Adam Turoff</a> <a href="http://www.blogger.com/feeds/6655746112052720933/posts/default">(feed)</a></li>
<li><a href="http://abuiles.blogspot.com/" title="Adventures in a Pure World">Adolfo Builes</a> <a href="http://www.blogger.com/feeds/5264335596042843369/posts/default">(feed)</a></li>
<li><a href="http://covector.blogspot.com/" title="vanishing points">Alberto Ruiz</a> <a href="http://www.blogger.com/feeds/15077948/posts/default">(feed)</a></li>
<li><a href="http://cppcabrera.blogspot.com/search/label/haskell" title="Read, Review, Refactor">Alejandro Cabrera</a> <a href="http://www.blogger.com/feeds/5533014087482697280/posts/default/-/haskell">(feed)</a></li>
<li><a href="http://serras-haskell-gsoc.blogspot.com/" title="Summers on Haskell and {Eclipse,Emacs}">Alejandro Serrano Mena</a> <a href="http://www.blogger.com/feeds/881207385008920659/posts/default">(feed)</a></li>
<li><a href="http://alenribic.com" title="Alen Ribic">Alen Ribic</a> <a href="http://feeds.feedburner.com/alenribic">(feed)</a></li>
<li><a href="http://alessandrovermeulen.me/" title="Alessandro Vermeulen">Alessandro Vermeulen</a> <a href="http://alessandrovermeulen.me/atom.xml">(feed)</a></li>
<li><a href="http://random.axman6.com/blog" title="Data.Random">Alex Mason</a> <a href="http://random.axman6.com/blog/?feed=rss2">(feed)</a></li>
<li><a href="http://darcs-gsoc2010.blogspot.com/" title="Improving Darcs' network performance">Alexey Levan</a> <a href="http://www.blogger.com/feeds/6749355461879878917/posts/default">(feed)</a></li>
<li><a href="http://alpmestan.com" title="Alp Mestanogullari's blog">Alp Mestanogullari</a> <a href="http://alpmestan.com/rss.xml">(feed)</a></li>
<li><a href="http://www.alsonkemp.com" title="Alson Kemp">Alson Kemp</a> <a href="http://www.alsonkemp.com/feed/">(feed)</a></li>
<li><a href="http://blog.closuretohome.com/" title="Closure to Home">Andreas Farre</a> <a href="http://www.blogger.com/feeds/5920937985901716221/posts/default">(feed)</a></li>
<li><a href="http://lambdacolyte.wordpress.com" title="The Lambda Acolyte">Andrew Calleja</a> <a href="http://lambdacolyte.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://algorithm.com.au/index.html" title="Stay Hungry, Stay Foolish">André Pang (ozone)</a> <a href="http://algorithm.com.au/blog/files/rss.xml">(feed)</a></li>
<li><a href="http://panicsonic.blogspot.com/search/label/haskell" title="FS">Antoine Latter</a> <a href="http://panicsonic.blogspot.com/feeds/posts/default/-/haskell?alt=rss">(feed)</a></li>
<li><a href="http://programmingzen.com" title="Zen and the Art of Programming » Page not found">Antonio Cangiano</a> <a href="http://programmingzen.com/category/haskell/feed">(feed)</a></li>
<li><a href="http://antti-juhani.kaijanaho.fi/newblog" title="Antti-Juhani Kaijanaho » Haskell">Antti-Juhani Kaijanaho (ibid)</a> <a href="http://antti-juhani.kaijanaho.fi/newblog/archives/tag/haskell/feed">(feed)</a></li>
<li><a href="http://archhaskell.wordpress.com" title="Arch Linux and Haskell">Arch Haskell News</a> <a href="http://archhaskell.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://ashish.typepad.com/ashishs_niti/" title="Ashish's Niti">Ashish Hanwadikar</a> <a href="http://feeds.feedburner.com/typepad/ahanwadi/ashishs_niti">(feed)</a></li>
<li><a href="http://pugs.blogs.com/pugs/" title="Pugs">Audrey Tang</a> <a href="http://pugs.blogs.com/pugs/index.rdf">(feed)</a></li>
<li><a href="http://adoseoflogic.blogspot.com/" title="A dose of logic">Bas van Gijzel</a> <a href="http://www.blogger.com/feeds/8387731529560364137/posts/default">(feed)</a></li>
<li><a href="http://nattermorphisms.blogspot.com/" title="Nattermorphisms">Ben Moseley</a> <a href="http://www.blogger.com/feeds/3857512306503018420/posts/default">(feed)</a></li>
<li><a href="http://moreindirection.blogspot.com/" title="more indirection">Bill Atkins</a> <a href="http://www.blogger.com/feeds/5428232882395758357/posts/default">(feed)</a></li>
<li><a href="http://flygdynamikern.blogspot.com/" title="Flygdynamikern">Bjorn Buckwalter</a> <a href="http://www.blogger.com/feeds/2553815923640620572/posts/default">(feed)</a></li>
<li><a href="http://braincrater.wordpress.com" title="Brain Crater">Braden Shepherdson</a> <a href="http://braincrater.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://brandon.si/" title="Posts on code | Brandon.Si(mmons)">Brandon Simmons</a> <a href="http://brandon.si/code/atom.xml">(feed)</a></li>
<li><a href="http://byorgey.wordpress.com" title="blog :: Brent -&amp;gt; [String]">Brent Yorgey</a> <a href="http://byorgey.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://www.serpentine.com/blog" title="teideal glic deisbhéalach">Bryan O'Sullivan</a> <a href="http://www.serpentine.com/blog/feed/">(feed)</a></li>
<li><a href="http://scrollingtext.org/taxonomy/term/56/0" title="ScrollingText - Haskell">Bryce Verdier</a> <a href="http://scrollingtext.org/taxonomy/term/56/0/feed/">(feed)</a></li>
<li><a href="http://www.xoltar.org" title="Xoltar">Bryn Keller</a> <a href="http://www.xoltar.org/rss.xml">(feed)</a></li>
<li><a href="http://ro-che.info/ccc" title="Cartesian Closed Comic">Cartesian Closed Comic</a> <a href="http://feeds.feedburner.com/CartesianClosedComic">(feed)</a></li>
<li><a href="http://chrismbrown.blogspot.com/" title="A Haskell Blog">Chris Brown</a> <a href="http://www.blogger.com/feeds/615478026137333873/posts/default">(feed)</a></li>
<li><a href="http://readerunner.wordpress.com" title="readerunner">Chris Reade</a> <a href="http://readerunner.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://cdsmith.wordpress.com" title="Sententia cdsmithus">Chris Smith</a> <a href="http://cdsmith.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://lambda.xyz" title="Posts tagged ‘haskell’">Chris Wong</a> <a href="http://lambda.xyz/tags/haskell.xml">(feed)</a></li>
<li><a href="" title="">Christophe Poucet (vincenz)</a> <a href="">(feed)</a></li>
<li><a href="http://chrisdone.com" title="Chris Done's home page feed.">Christopher Done</a> <a href="http://chrisdone.com/haskell.rss">(feed)</a></li>
<li><a href="http://blog.downstairspeople.org" title="Lane's Blog » Haskell">Christopher Lane Hinson</a> <a href="http://blog.downstairspeople.org/category/haskell/feed/atom/">(feed)</a></li>
<li><a href="http://conway.rutgers.edu/~ccshan/wiki/blog/tags/english/" title="Proper Treatment">Chung-chieh Shan</a> <a href="http://conway.rutgers.edu/~ccshan/wiki/blog/tags/english/index.rss">(feed)</a></li>
<li><a href="http://cliffordbeshers.blogspot.com/" title="RuMiNaTiOnS">Clifford Beshers</a> <a href="http://www.blogger.com/feeds/6919669035402552575/posts/default">(feed)</a></li>
<li><a href="http://conal.net/blog" title="Conal Elliott">Conal Elliott</a> <a href="http://feeds.feedburner.com/conal">(feed)</a></li>
<li><a href="http://blog.kfish.org/" title="Conrad Parker">Conrad Parker</a> <a href="http://www.blogger.com/feeds/9101292118679422945/posts/default?alt=atom">(feed)</a></li>
<li><a href="http://abstractabsurd.blogspot.com/" title="Abstract Absurdities">Creighton Hogg</a> <a href="http://abstractabsurd.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://unknownparallel.wordpress.com" title="Unknown Parallel">Dan Burton</a> <a href="http://unknownparallel.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://blog.sigfpe.com/" title="A Neighborhood of Infinity">Dan Piponi (sigfpe)</a> <a href="http://blog.sigfpe.com/rss.xml">(feed)</a></li>
<li><a href="http://duplode.github.io" title="The Life Monadic">Daniel Mlot (duplode)</a> <a href="http://duplode.github.io/rss.xml">(feed)</a></li>
<li><a href="http://parenz.wordpress.com" title="(parentheses) » Haskell">Daniil Frumin</a> <a href="http://parenz.wordpress.com/category/cs/haskell/feed/atom/">(feed)</a></li>
<li><a href="http://jozefg.bitbucket.org" title="Code and Co">Danny Gratzer</a> <a href="http://jozefg.bitbucket.org/rss.xml">(feed)</a></li>
<li><a href="http://blog.darcs.net/" title="darcs advanced revision control system">Darcs</a> <a href="http://www.blogger.com/feeds/819021106854702432/posts/default">(feed)</a></li>
<li><a href="http://haskellformaths.blogspot.com/" title="Haskell for Maths">David Amos</a> <a href="http://www.blogger.com/feeds/5195188167565410449/posts/default">(feed)</a></li>
<li><a href="http://projectscoutess.blogspot.com/" title="Scoutess GSOC">David McGillicuddy</a> <a href="http://www.blogger.com/feeds/4503472289464918478/posts/default">(feed)</a></li>
<li><a href="http://www.dmpots.com/" title="dmpots thoughts">David Peixotto</a> <a href="http://www.dmpots.com/feeds/posts/default">(feed)</a></li>
<li><a href="http://netsuperbrain.com/blog" title="Less Sugar/More Meat">David Sankel</a> <a href="http://netsuperbrain.com/blog/?feed=rss2">(feed)</a></li>
<li><a href="http://blog.davidterei.com/" title="David Terei">David Terei</a> <a href="http://blog.davidterei.com/feeds/posts/default">(feed)</a></li>
<li><a href="http://syntaxfree.wordpress.com" title="Data.Syntaxfree">Diego Navarro (syntaxfree)</a> <a href="http://syntaxfree.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://disciple-devel.blogspot.com/" title="Disciple Development">Disciple/DDC</a> <a href="http://www.blogger.com/feeds/301893373063372699/posts/default">(feed)</a></li>
<li><a href="http://dorchard.wordpress.com" title="..never odd or even..">Dominic Orchard</a> <a href="http://dorchard.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://idontgetoutmuch.wordpress.com" title="Idontgetoutmuch's Weblog">Dominic Steinitz</a> <a href="http://idontgetoutmuch.wordpress.com/feed/">(feed)</a></li>
<li><a href="http://donsbot.wordpress.com" title="Control.Monad.Writer">Don Stewart (dons)</a> <a href="http://donsbot.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://logicaltypes.blogspot.com/" title="Typed Logic">Douglas M. Auclair (geophf)</a> <a href="http://www.blogger.com/feeds/4650294074444534066/posts/default">(feed)</a></li>
<li><a href="http://gergo.erdi.hu/blog/tags/haskell" title="Gergő.Érdi.hu — haskell">ERDI Gergo</a> <a href="http://gergo.erdi.hu/blog/tags/haskell/feed.xml">(feed)</a></li>
<li><a href="http://blog.edwardamsden.com/" title="Facts and Theories">Edward Amsden</a> <a href="http://www.blogger.com/feeds/129107585769892414/posts/default">(feed)</a></li>
<li><a href="http://comonad.com/reader" title="The Comonad.Reader">Edward Kmett</a> <a href="http://comonad.com/reader/feed/atom/">(feed)</a></li>
<li><a href="http://blog.ezyang.com" title="Inside 206-105">Edward Z. Yang</a> <a href="http://feeds.feedburner.com/ezyang">(feed)</a></li>
<li><a href="http://edwinb.wordpress.com" title="Edwin Brady">Edwin Brady</a> <a href="http://edwinb.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://www.randomhacks.net/" title="Random Hacks">Eric Kidd</a> <a href="http://www.randomhacks.net/feed.xml">(feed)</a></li>
<li><a href="http://koweycode.blogspot.com/" title="koweycode">Eric Kow (kowey)</a> <a href="http://www.blogger.com/feeds/21123659/posts/default?alt=atom">(feed)</a></li>
<li><a href="" title="m3ga blog">Erik de Castro Lopo</a> <a href="http://www.mega-nerd.com/erikd/Blog/CodeHacking/index.atom">(feed)</a></li>
<li><a href="https://www.fpcomplete.com/school" title="FP Complete» News/Blog">FP Complete</a> <a href="http://feeds.feedburner.com/fpcomplete">(feed)</a></li>
<li><a href="http://sneezy.cs.nott.ac.uk/fplunch/weblog" title="FP Lunch">FP Lunch</a> <a href="http://sneezy.cs.nott.ac.uk/fplunch/weblog/?feed=rss2">(feed)</a></li>
<li><a href="" title="m3ga blog">FP-Syd: Sydney FP Group</a> <a href="http://www.mega-nerd.com/erikd/Blog/FP-Syd/index.atom">(feed)</a></li>
<li><a href="http://blog.felipe.lessa.nom.br" title="Felipe Lessa">Felipe Almeida Lessa</a> <a href="http://blog.felipe.lessa.nom.br/?feed=rss2">(feed)</a></li>
<li><a href="http://functionaljobs.com/" title="Functional Jobs: Search 'haskell'">Functional Jobs</a> <a href="http://functionaljobs.com/jobs/search/?q=haskell&amp;format=rss">(feed)</a></li>
<li><a href="http://ku-fpg.blogspot.com/" title="Functional Programming at the University of Kansas">Functional Programming Group at the University of Kansas</a> <a href="http://ku-fpg.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://ghcsparc.blogspot.com/" title="GHC on SPARC">GHC / OpenSPARC Project</a> <a href="http://www.blogger.com/feeds/1257971411439114772/posts/default">(feed)</a></li>
<li><a href="http://www.haskellforall.com/" title="Haskell for all">Gabriel Gonzalez</a> <a href="http://www.blogger.com/feeds/1777990983847811806/posts/default">(feed)</a></li>
<li><a href="http://hsenag.livejournal.com/" title="Ganesh Sittampalam">Ganesh Sittampalam</a> <a href="http://hsenag.livejournal.com/data/rss?tag=haskell,darcs">(feed)</a></li>
<li><a href="http://totherme.livejournal.com/" title="totherme">Gareth Smith (gds)</a> <a href="http://totherme.livejournal.com/data/rss">(feed)</a></li>
<li><a href="http://just-bottom.blogspot.com/search/label/haskell" title="Nothing Personal">Gergely Patai</a> <a href="http://www.blogger.com/feeds/7548736674449953374/posts/default/-/haskell">(feed)</a></li>
<li><a href="http://syntax.wikidot.com" title="Blog feed">Gregg Reynolds</a> <a href="http://syntax.wikidot.com/feed/pages/category/blog/t/Blog+feed">(feed)</a></li>
<li><a href="http://gregorycollins.net/feed.xml" title="gregory david collins">Gregory Collins</a> <a href="http://gregorycollins.net/feed.xml">(feed)</a></li>
<li><a href="http://happstack.com/page/blog" title="Happstack">Happstack Web Framework</a> <a href="http://happstack.com/page/atom-feed">(feed)</a></li>
<li><a href="http://haskellwebnews.wordpress.com" title="The Haskell Web News">Haskell Web News</a> <a href="http://haskellwebnews.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://blog.on-a-horse.org" title="Haskell on a Horse on a Web-Log">Haskell on a Horse</a> <a href="http://blog.on-a-horse.org/rss.xml">(feed)</a></li>
<li><a href="http://blog.holdenkarau.com/" title="Holden's Blog">Holden Karau</a> <a href="http://feeds.feedburner.com/holdenkarau/iYtm">(feed)</a></li>
<li><a href="http://holumbus.fh-wedel.de/blog" title="The Holumbus Developer">Holumbus</a> <a href="http://holumbus.fh-wedel.de/blog/?feed=rss2">(feed)</a></li>
<li><a href="http://www.skybluetrades.net" title="Sky Blue Trades RSS feed.">Ian Ross</a> <a href="http://www.skybluetrades.net/haskell-rss.xml">(feed)</a></li>
<li><a href="http://haddock2009.wordpress.com" title="Isaac Dupree's">Isaac Dupree</a> <a href="http://haddock2009.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://ivanmiljenovic.wordpress.com" title="«Insert Name Here»">Ivan Lazar Miljenovic</a> <a href="http://ivanmiljenovic.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://jpmoresmau.blogspot.com/" title="JP Moresmau's Programming Blog">JP Moresmau</a> <a href="http://www.blogger.com/feeds/37404288/posts/default">(feed)</a></li>
<li><a href="http://lambda.jstolarek.com" title="Yet Another Lambda Blog">Jan Stolarek</a> <a href="http://lambda.jstolarek.com/feed/">(feed)</a></li>
<li><a href="http://blog.codersbase.com/" title="dagit.o">Jason Dagit</a> <a href="http://blog.codersbase.com/feeds/posts/default">(feed)</a></li>
<li><a href="http://jaspervdj.be" title="jaspervdj - Posts tagged haskell">Jasper Van der Jeugt</a> <a href="http://jaspervdj.be/tags/haskell.xml">(feed)</a></li>
<li><a href="http://vis.renci.org/jeff" title="Hieroglyphics">Jeff Heard</a> <a href="http://vis.renci.org/jeff/?feed=rss2">(feed)</a></li>
<li><a href="http://patternsinfp.wordpress.com" title="Patterns in Functional Programming">Jeremy Gibbons</a> <a href="http://patternsinfp.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://wewantarock.wordpress.com" title="A rock to wind a piece of string around">Jeremy O'Donoghue</a> <a href="http://wewantarock.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://nhlab.blogspot.com/" title="n-heptane lab">Jeremy Shaw</a> <a href="http://www.blogger.com/feeds/6381777424713448943/posts/default">(feed)</a></li>
<li><a href="http://happstack.blogspot.com/" title="Happstack">Jeremy Shaw</a> <a href="http://www.blogger.com/feeds/3300386911011555799/posts/default">(feed)</a></li>
<li><a href="http://blog.jbapple.com/" title="Everyone Else is Crazy">Jim Apple</a> <a href="http://blog.jbapple.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://www.joachim-breitner.de//blog" title="nomeata’s mind shares">Joachim Breitner</a> <a href="http://www.joachim-breitner.de/blog/tag/English_feed.rss">(feed)</a></li>
<li><a href="http://johanjeuring.blogspot.com/" title="Johan Jeuring's blog">Johan Jeuring</a> <a href="http://www.blogger.com/feeds/1307152710341271576/posts/default">(feed)</a></li>
<li><a href="http://blog.johantibell.com/" title="Johan Tibell">Johan Tibell</a> <a href="http://www.blogger.com/feeds/927289640963145319/posts/default">(feed)</a></li>
<li><a href="http://changelog.complete.org" title="The Changelog » haskell">John Goerzen (CosmicRay)</a> <a href="http://changelog.complete.org/archives/tag/haskell-s9y/feed">(feed)</a></li>
<li><a href="http://www.jonkri.com" title="Jon Kristensen » Haskell">Jon Kristensen</a> <a href="http://www.jonkri.com/tag/haskell/feed/">(feed)</a></li>
<li><a href="http://computationalthoughts.blogspot.com/" title="Computational Thoughts">Josef Svenningsson</a> <a href="http://www.blogger.com/feeds/1228698015266547737/posts/default">(feed)</a></li>
<li><a href="http://hauptwerk.blogspot.com/search/label/programming" title="Hauptwerk">José Pedro Magalhães</a> <a href="http://www.blogger.com/feeds/5868652468914213610/posts/default/-/programming">(feed)</a></li>
<li><a href="http://joyridelabs.de/blog/" title="Joyride Laboratories » λ">Joyride Laboratories</a> <a href="http://joyridelabs.de/blog/?feed=atom&amp;tag=planet-haskell">(feed)</a></li>
<li><a href="http://joaopizani.hopto.org/en/" title="Experimento imaginário » Haskell">João Paulo Pizani Flor</a> <a href="http://joaopizani.hopto.org/en/category/haskell/feed/">(feed)</a></li>
<li><a href="http://mainisusuallyafunction.blogspot.com/" title="main is usually a function">Keegan McAllister</a> <a href="http://www.blogger.com/feeds/1563623855220143059/posts/default">(feed)</a></li>
<li><a href="http://kenta.blogspot.com/search/label/haskell" title="Ken's blog">Ken T Takusagawa</a> <a href="http://www.blogger.com/feeds/6757805/posts/default/-/haskell">(feed)</a></li>
<li><a href="http://blog.malde.org" title="Ketil's blog">Ketil Malde</a> <a href="http://blog.malde.org/rss.xml">(feed)</a></li>
<li><a href="http://kpreid.livejournal.com/" title="Kevin Reid's blog">Kevin Reid (kpreid)</a> <a href="http://kpreid.livejournal.com/data/rss">(feed)</a></li>
<li><a href="http://kevin.scaldeferri.com/blog/tech" title="Kevin's Weblog">Kevin Scaldeferri</a> <a href="http://kevin.scaldeferri.com/blog/tech/index.rss">(feed)</a></li>
<li><a href="http://www.dialectical-computing.de/blog/" title="In Clojure We Trust - Haskell">Kototama</a> <a href="http://dialectical-computing.de/blog/haskell.xml">(feed)</a></li>
<li><a href="http://lhc-compiler.blogspot.com/" title="Notes on the LHC">LHC Team</a> <a href="http://www.blogger.com/feeds/1862878851303132605/posts/default">(feed)</a></li>
<li><a href="http://lambdacube3d.wordpress.com" title="LambdaCube 3D">LambdaCube</a> <a href="http://lambdacube3d.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://lpenz.org" title="Avulsos by Penz - Articles tagged as haskell">Leandro Penz</a> <a href="http://feeds.feedburner.com/lpenz/avulsos/articles/haskell">(feed)</a></li>
<li><a href="http://leepike.wordpress.com" title="A Critical Systems Blog">Lee Pike</a> <a href="http://leepike.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://cohatoe.blogspot.com/" title="Leif Frenzel's Haskell and Eclipse blog">Leif Frenzel</a> <a href="http://cohatoe.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://augustss.blogspot.com/" title="Things that amuse me">Lennart Augustsson</a> <a href="http://augustss.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://lennartkolmodin.blogspot.com/" title="Bits and Bytes">Lennart Kolmodin</a> <a href="http://lennartkolmodin.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://blog.melding-monads.com" title="Melding Monads">Leon P Smith</a> <a href="https://blog.melding-monads.com/feed/atom/">(feed)</a></li>
<li><a href="http://araujoluis.blogspot.com/" title="araujo's blog">Luis Araujo</a> <a href="http://www.blogger.com/feeds/6913397465984649777/posts/default">(feed)</a></li>
<li><a href="http://lukepalmer.wordpress.com" title="Luke Palmer » haskell">Luke Palmer</a> <a href="http://lukepalmer.wordpress.com/tag/haskell/feed/atom/">(feed)</a></li>
<li><a href="http://lukeplant.me.uk/blog/categories/haskell/" title="All Unkept">Luke Plant</a> <a href="http://lukeplant.me.uk/blog/categories/haskell/atom/index.xml">(feed)</a></li>
<li><a href="http://lindstroem.wordpress.com" title="Haskellville">Mads Lindstrøm</a> <a href="http://lindstroem.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://therning.org/magnus" title="therning.org/ magnus">Magnus Therning</a> <a href="http://therning.org/magnus/feed/">(feed)</a></li>
<li><a href="http://nhc98.blogspot.com/" title="malcolm">Malcolm Wallace</a> <a href="http://feeds.feedburner.com/malcolm">(feed)</a></li>
<li><a href="http://justtesting.org/" title="Just Testing">Manuel M T Chakravarty</a> <a href="http://justtesting.org/rss#_=_">(feed)</a></li>
<li><a href="http://marcot.eti.br//tag/haskell/" title="pages tagged haskell">Marco Túlio Gontijo e Silva</a> <a href="http://marcot.eti.br/tag/haskell/index.rss">(feed)</a></li>
<li><a href="http://gsoc2013cwithmobiledevices.blogspot.com/" title="GSoC 2013 - Communicating with Mobile Devices">Marcos Pividori</a> <a href="http://www.blogger.com/feeds/1745485961030073287/posts/default">(feed)</a></li>
<li><a href="http://blog.plover.com" title="The Universe of Discourse">Mark Jason Dominus</a> <a href="http://blog.plover.com/index.atom">(feed)</a></li>
<li><a href="http://www.shimweasel.com" title="shimweasel">Mark Wotton</a> <a href="http://www.shimweasel.com/articles.rss">(feed)</a></li>
<li><a href="http://martijn.local/journal" title="Martijn's Journal » Haskell">Martijn van Steenbergen</a> <a href="http://martijn.van.steenbergen.nl/journal/category/programming/haskell/feed/">(feed)</a></li>
<li><a href="http://sulzmann.blogspot.com/" title="Martin Sulzmann's Blog">Martin Sulzmann</a> <a href="http://www.blogger.com/feeds/4642782805835050446/posts/default">(feed)</a></li>
<li><a href="http://fuuzetsu.co.uk/blog" title="Fūzetsu's Corner">Mateusz Kowalczyk</a> <a href="http://fuuzetsu.co.uk/blog/atom.xml">(feed)</a></li>
<li><a href="http://cogracenotes.wordpress.com" title="Adventures in Duality">Matt Gruen (Gracenotes)</a> <a href="http://cogracenotes.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://matt.immute.net/taxonomy/term/13/0" title="mh - haskell">Matt Hellige</a> <a href="http://matt.immute.net/taxonomy/term/13/0/feed/">(feed)</a></li>
<li><a href="http://www.wellquite.org/blog/" title="Reactionary Visions">Matthew Sackman</a> <a href="http://www.wellquite.org/blog/feeds/index.rss2">(feed)</a></li>
<li><a href="http://mmartedp.blogspot.com/" title="Michael's Declarative Programming Blog">Michael Marte</a> <a href="http://mmartedp.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://pgraycode.wordpress.com" title="Code and Bugs">Mihai Maruseac</a> <a href="http://pgraycode.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://blog.mikael.johanssons.org" title="Michi's blog">Mikael Vejdemo Johansson (Syzygy-)</a> <a href="http://blog.mikael.johanssons.org/feed/">(feed)</a></li>
<li><a href="http://izbicki.me" title="Mike Izbicki's blog posts">Mike Izbicki</a> <a href="https://izbicki.me/blog/category/computer-science/feed">(feed)</a></li>
<li><a href="http://coldwa.st/e" title="coldwa.st/e - All posts">Mikhail Glushenkov</a> <a href="http://feeds.feedburner.com/ChurningAndChurning">(feed)</a></li>
<li><a href="http://jshaskell.blogspot.com/" title="Writing JavaScript games in Haskell">Nathan Hüsken</a> <a href="http://www.blogger.com/feeds/6355249120999252418/posts/default">(feed)</a></li>
<li><a href="http://chplib.wordpress.com" title="Communicating Haskell Processes">Neil Brown</a> <a href="http://chplib.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://neilmitchell.blogspot.com/" title="Neil Mitchell's Haskell Blog">Neil Mitchell</a> <a href="http://neilmitchell.blogspot.com/rss.xml">(feed)</a></li>
<li><a href="http://zenzike.com" title="Zenzike's Blog">Nicolas Wu</a> <a href="http://zenzike.com/rss.xml">(feed)</a></li>
<li><a href="http://nibrofun.blogspot.com/" title="Functional Fun">Niklas Broberg</a> <a href="http://www.blogger.com/feeds/6994932821484835003/posts/default">(feed)</a></li>
<li><a href="http://noamlewis.wordpress.com" title="Enough Blogging!">Noam Lewis</a> <a href="http://noamlewis.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://ocharles.org.uk/blog" title="Inside ocharles">Oliver Charles</a> <a href="https://ocharles.org.uk/blog/posts.rss">(feed)</a></li>
<li><a href="http://greenokapi.net/blog" title="Just another lambdabananacamel, » haskell">Osfameron</a> <a href="http://greenokapi.net/blog/tag/haskell/feed">(feed)</a></li>
<li><a href="" title="">PMatos Minority Blog</a> <a href="http://feeds2.feedburner.com/PmatosMinority-Haskell">(feed)</a></li>
<li><a href="http://pcapriotti.github.com/" title="Paolo Capriotti's blog - Haskell">Paolo Capriotti</a> <a href="http://pcapriotti.github.com/atom.xml">(feed)</a></li>
<li><a href="http://pchiusano.blogspot.com/search/label/haskell" title="Prettt-tty, pretty, pretty good!">Paul Chiusano</a> <a href="http://www.blogger.com/feeds/2267747408703654731/posts/default/-/haskell">(feed)</a></li>
<li><a href="http://paulspontifications.blogspot.com/" title="Paul's Pontifications">Paul Johnson</a> <a href="http://www.blogger.com/feeds/5975524006824862804/posts/default">(feed)</a></li>
<li><a href="http://praisecurseandrecurse.blogspot.com/" title="Praise, Curse, and Recurse">Paul Potts</a> <a href="http://praisecurseandrecurse.blogspot.com/feeds/posts/default?alt=rss">(feed)</a></li>
<li><a href="http://web.mornfall.net/tag/darcs.html" title="tag/darcs">Petr Rockai</a> <a href="http://web.mornfall.net/tag/darcs.rss">(feed)</a></li>
<li><a href="http://wadler.blogspot.com/" title="Wadler's Blog">Philip Wadler</a> <a href="http://www.blogger.com/feeds/9757377/posts/default?alt=atom">(feed)</a></li>
<li><a href="http://flippac.wordpress.com" title="flippac">Philippa Cowderoy</a> <a href="http://flippac.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://pls.posterous.com" title="PLS @ UNSW">Programming Languages and Systems research group at the University of New South Wales</a> <a href="http://pls.posterous.com/rss.xml">(feed)</a></li>
<li><a href="http://blogs.msdn.com/b/ralflammel/" title="Grammarware, Haskellware, XMLware">Ralf Lammel</a> <a href="http://blogs.msdn.com/b/ralflammel/rss.aspx">(feed)</a></li>
<li><a href="http://randprocnotes.wordpress.com" title="RandProcNotes">RandProc</a> <a href="http://randprocnotes.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://www.realworldhaskell.org/blog" title="Real World Haskell">Real-World Haskell</a> <a href="http://www.realworldhaskell.org/blog/feed/">(feed)</a></li>
<li><a href="http://reinerp.wordpress.com" title="Reiner Pope">Reiner Pope</a> <a href="http://reinerp.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://typesandkinds.wordpress.com" title="Types and Kinds">Richard Eisenberg</a> <a href="http://typesandkinds.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://control.monad.st" title="Control.Monad.ST">Richard Smith (zygoloid)</a> <a href="http://control.monad.st/feed">(feed)</a></li>
<li><a href="http://existentialtype.wordpress.com" title="Existential Type">Robert Harper</a> <a href="http://existentialtype.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://setoidsandcats.blogspot.com/" title="Setoids and Cats">Robin Green</a> <a href="http://www.blogger.com/feeds/32922462/posts/default?alt=atom">(feed)</a></li>
<li><a href="http://blog.gekkou.co.uk/search/label/Haskell" title="Gekkou Blog">Robin KAY</a> <a href="http://www.blogger.com/feeds/4001434382262009587/posts/default/-/Haskell">(feed)</a></li>
<li><a href="http://ro-che.info/" title="Roman Cheplyaka">Roman Cheplyaka</a> <a href="http://feeds.feedburner.com/RomanCheplyaka">(feed)</a></li>
<li><a href="http://www.latermuse.com" title="Latermuse.com">Ron Watkins</a> <a href="http://www.latermuse.com/rss/rss.xml">(feed)</a></li>
<li><a href="http://r6.ca/blog/" title="Russell O’Connor’s Blog">Russell O'Connor</a> <a href="http://r6.ca/blog/feed.atom">(feed)</a></li>
<li><a href="http://lambdasandwich.blogspot.com/" title="Lambda Sandwich">Sam Anklesaria <amsay@amsay.net></a> <a href="http://www.blogger.com/feeds/3084965657276734482/posts/default">(feed)</a></li>
<li><a href="http://splonderzoek.blogspot.com/" title="splonderzoek">Sean Leather</a> <a href="http://feeds.feedburner.com/splonderzoek">(feed)</a></li>
<li><a href="http://lambdalog.seanseefried.com" title="Lambdalog">Sean Seefried</a> <a href="http://lambdalog.seanseefried.com/rss.xml">(feed)</a></li>
<li><a href="http://theformalworld.wordpress.com" title="The Formal World » Haskell">Sergio Costa</a> <a href="http://theformalworld.wordpress.com/category/haskell/feed/atom/">(feed)</a></li>
<li><a href="http://cleantypecheck.wordpress.com" title="Clean Typecheck">Shayan Najd Javadipour</a> <a href="http://cleantypecheck.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://www.iis.sinica.edu.tw/~scm" title="niche computing science » Research Blog">Shin-Cheng Mu</a> <a href="http://www.iis.sinica.edu.tw/~scm/?feed=rss2&amp;cat=1">(feed)</a></li>
<li><a href="http://engineering.silk.co/" title="Silk Engineering Blog">Silk</a> <a href="http://feeds.feedburner.com/typlab/blog">(feed)</a></li>
<li><a href="http://lambda-view.blogspot.com/" title="λ-view">Simon Meier</a> <a href="http://www.blogger.com/feeds/3734004713473160250/posts/default">(feed)</a></li>
<li><a href="http://joyful.com" title="Joyful Systems blog">Simon Michael</a> <a href="http://joyful.com/_blog.xml">(feed)</a></li>
<li><a href="http://snapframework.com/blog/blog/feed.xml" title="Snap Framework Blog">Snap Framework</a> <a href="http://snapframework.com/blog/feed.xml">(feed)</a></li>
<li><a href="http://fmapfixreturn.wordpress.com" title="fmap fix return">Sterling Clover</a> <a href="http://fmapfixreturn.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://cprg-research.blogspot.com/search/label/haskell" title="The Cambridge Programming Research Group Blog">The Cambridge Programming Research group</a> <a href="http://cprg-research.blogspot.com/feeds/posts/default/-/haskell?alt=rss">(feed)</a></li>
<li><a href="http://ghc.haskell.org/trac/ghc/blog" title="GHC - Blog">The GHC Team</a> <a href="https://ghc.haskell.org/trac/ghc/blog?format=rss">(feed)</a></li>
<li><a href="http://gentoohaskell.wordpress.com" title="Gentoo Linux and Haskell">The Gentoo Haskell Team</a> <a href="http://gentoohaskell.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://timber-lang.blogspot.com/" title="Timber">The Timber programming language</a> <a href="http://www.blogger.com/feeds/3797711495555655602/posts/default">(feed)</a></li>
<li><a href="http://yhc06.blogspot.com/" title="York Haskell Compiler">The York Haskell Compiler</a> <a href="http://yhc06.blogspot.com/rss.xml">(feed)</a></li>
<li><a href="http://theorylunch.wordpress.com" title="Theory Lunch">Theory Lunch (Institute of Cybernetics, Tallinn)</a> <a href="http://theorylunch.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://me-hunz.blogspot.com/" title="Emancipate yourselves from mental slavery">Thiago Negri</a> <a href="http://feeds.feedburner.com/blogspot/hSASX">(feed)</a></li>
<li><a href="http://tommd.wordpress.com" title="Beware the Jabberwolk">Thomas M. DuBuisson</a> <a href="http://tommd.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://nominolo.blogspot.com/" title="nominolo's Blog">Thomas Schilling</a> <a href="http://www.blogger.com/feeds/35609023/posts/default">(feed)</a></li>
<li><a href="http://cabaltest.blogspot.com/" title="Cabal Testing Summer of Code">Thomas Tuegel</a> <a href="http://www.blogger.com/feeds/2098836520432505250/posts/default">(feed)</a></li>
<li><a href="http://eclipsefp.wordpress.com" title="EclipseFP GSoC '09">Thomas ten Cate</a> <a href="http://eclipsefp.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://tillmannvogt.wordpress.com" title="Tillmann Vogt">Tillmann Vogt</a> <a href="http://tillmannvogt.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://twdkz.wordpress.com" title="twdkz">Tim Docker</a> <a href="http://twdkz.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://tom.lokhorst.eu" title="Tom Lokhorst's blog » Haskell">Tom Lokhorst</a> <a href="http://tom.lokhorst.eu/category/haskell/feed">(feed)</a></li>
<li><a href="http://blog.moertel.com" title="Tom Moertel's Blog">Tom Moertel</a> <a href="http://blog.moertel.com/xml/atom/feed.xml">(feed)</a></li>
<li><a href="http://tomschrijvers.blogspot.com/search/label/Haskell" title="Tom's Declarative Languages Blog">Tom Schrijvers</a> <a href="http://www.blogger.com/feeds/5844006452378085451/posts/default/-/Haskell">(feed)</a></li>
<li><a href="http://blog.tupil.com" title="Tupil Code Blog » Haskell">Tupil</a> <a href="http://blog.tupil.com/tag/haskell/feed">(feed)</a></li>
<li><a href="http://twanvl.nl/blog" title="Twan van Laarhoven's blog">Twan van Laarhoven</a> <a href="http://twanvl.nl/feed">(feed)</a></li>
<li><a href="http://utrechthaskellcompiler.wordpress.com" title="@UHC">UHC (Utrecht Haskell Compiler)</a> <a href="http://utrechthaskellcompiler.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://ulissesaraujo.wordpress.com" title="Ulisses Costa Blog » English">Ulisses Costa</a> <a href="http://feeds.feedburner.com/UlissesCostaBlogEnglish">(feed)</a></li>
<li><a href="http://tab.snarc.org" title="Vincent's haskell chronicles">Vincent Hanquez</a> <a href="http://tab.snarc.org/rss/haskell.xml">(feed)</a></li>
<li><a href="http://www.well-typed.com/blog/" title="Well-Typed Blog">Well-Typed.Com</a> <a href="http://www.well-typed.com/blog/rss2.xml">(feed)</a></li>
<li><a href="http://jeltsch.wordpress.com" title="Wolfgang Jeltsch">Wolfgang Jeltsch</a> <a href="http://jeltsch.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://xmonad.wordpress.com" title="xmonad">Xmonad</a> <a href="http://xmonad.wordpress.com/feed/atom/">(feed)</a></li>
<li><a href="http://www.yesodweb.com/" title="Yesod Web Framework Blog">Yesod Web Framework</a> <a href="http://www.yesodweb.com/feed">(feed)</a></li>
<li><a href="http://yi-editor.blogspot.com/" title="The Yi Blog">Yi</a> <a href="http://www.blogger.com/feeds/5111467676053815782/posts/default">(feed)</a></li>
<li><a href="http://apfelmus.nfshost.com/" title="apfeλmus">apfelmus</a> <a href="http://apfelmus.nfshost.com/rss.xml">(feed)</a></li>
<li><a href="http://factisresearch.blogspot.com/search/label/PlanetHaskell" title="factis research blog">factis research</a> <a href="https://www.blogger.com/feeds/6980262235392061030/posts/default/-/PlanetHaskell">(feed)</a></li>
<li><a href="http://hyperq.github.io" title="hyperq">hyperq</a> <a href="http://hyperq.github.io/index.xml">(feed)</a></li>
<li><a href="http://lpuppet.banquise.net/" title="The language-puppet website.">language-puppet</a> <a href="http://lpuppet.banquise.net/atom.xml">(feed)</a></li>
<li><a href="http://softwaresimply.blogspot.com/" title="Software Simply">mightybyte</a> <a href="http://feeds.feedburner.com/SoftwareSimply">(feed)</a></li>
<li><a href="http://winterkoninkje.dreamwidth.org/" title="Renaissance Grrrl">wren gayle romano</a> <a href="http://winterkoninkje.dreamwidth.org/data/rss">(feed)</a></li>
</ul>


<p>
<h2>Planetarium:</h2>
<ul>
<li><a href="http://planet.ocamlcore.org">Ocamlcore Planet</a></li>
<li><a href="http://www.planetapache.org/">Planet Apache</a></li>
<li><a href="http://planet.debian.net/">Planet Debian</a></li>
<li><a href="http://planet.freedesktop.org/">Planet freedesktop.org</a></li>
<li><a href="http://planet.gnome.org/">Planet GNOME</a></li>
<li><a href="http://planet.fedoraproject.org/">Fedora Planet</a></li>
<li><a href="http://www.planetplanet.org/">more...</a></li>
</ul>
</p>
</div>
</body>

</html>
